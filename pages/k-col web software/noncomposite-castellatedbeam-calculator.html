<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Castellated Beam Design Calculator</title>
    <!-- html2canvas library for converting HTML to image -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js" 
            onload="window.html2canvasLoaded = true; console.log('html2canvas loaded');"
            onerror="console.error('html2canvas failed to load');"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            /* 텍스트 선택 방지 */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            /* 드래그 방지 */
            -webkit-user-drag: none;
            -moz-user-drag: none;
            -ms-user-drag: none;
            user-drag: none;
        }

        /* 입력 필드는 선택 가능하도록 예외 처리 */
        input, textarea, select {
            -webkit-user-select: text !important;
            -moz-user-select: text !important;
            -ms-user-select: text !important;
            user-select: text !important;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            /* 텍스트 선택 방지 */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .calculator-wrapper {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3a5f, #2d5a87);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
        }

        .header a {
            color: rgba(255,255,255,0.9);
            text-decoration: none;
            font-size: 14px;
            padding: 8px 16px;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 6px;
            transition: all 0.3s;
        }

        .header a:hover {
            background: rgba(255,255,255,0.1);
        }

        .header .header-links {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .type-badge {
            display: inline-block;
            padding: 4px 12px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            font-size: 12px;
            margin-left: 10px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            min-height: 600px;
        }

        .left-section, .right-section {
            padding: 25px;
            max-height: calc(100vh - 100px);
            overflow-y: auto;
        }

        .left-section {
            background: #f8fafc;
            border-right: 1px solid #e2e8f0;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px 20px;
            align-content: start;
        }

        .right-section {
            background: #ffffff;
        }

        .section-title {
            font-size: 18px;
            font-weight: 700;
            color: #1e3a5f;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3b82f6;
            grid-column: 1 / -1;
        }

        .input-group {
            margin-bottom: 0;
        }
        
        .input-group.full-width {
            grid-column: 1 / -1;
        }

        .input-group label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: #475569;
            margin-bottom: 6px;
        }

        .input-field {
            width: 100%;
            padding: 10px;
            border: 2px solid #cbd5e1;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .input-field:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .calc-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
            margin-top: 20px;
        }

        .calc-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.5);
        }

        .results-container {
            display: none;
        }

        .results-container.active {
            display: block;
        }

        /* 계산 결과 이미지 스타일 */
        .results-container img {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-user-drag: none;
            -moz-user-drag: none;
            -ms-user-drag: none;
            user-drag: none;
            pointer-events: none;
            max-width: 100%;
            height: auto;
        }

        .result-section {
            margin-bottom: 25px;
            padding: 15px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .result-section-title {
            font-size: 16px;
            font-weight: 700;
            color: #1e3a5f;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #3b82f6;
        }

        .result-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        .result-table th,
        .result-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        .result-table th {
            background: #f1f5f9;
            font-weight: 600;
            color: #475569;
        }

        .result-value {
            font-weight: 600;
            color: #1e3a5f;
            text-align: right;
        }

        .status-ok {
            color: #10b981;
            font-weight: 700;
        }

        .status-ng {
            color: #ef4444;
            font-weight: 700;
        }

        .info-box {
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 0;
            font-size: 13px;
            color: #1e40af;
            line-height: 1.6;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .left-section {
                border-right: none;
                border-bottom: 1px solid #e2e8f0;
            }
        }

        /* 인쇄 방지 스타일 */
        @media print {
            body * {
                visibility: hidden !important;
            }
            body::before {
                content: "이 페이지는 인쇄할 수 없습니다.";
                visibility: visible !important;
                display: block;
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                font-size: 24px;
                color: #000;
            }
        }
    </style>
</head>
<body>
    <div class="calculator-wrapper">
        <div class="header">
            <div>
                <h1>Castellated Beam Design Calculator
                    <span class="type-badge" id="typeBadge">Loading...</span>
                </h1>
            </div>
            <div class="header-links">
                <a href="/">← 홈으로</a>
                <a href="?type=without-slab" id="typeToggleLink">Without Top-Slab 바로가기</a>
            </div>
        </div>

        <div class="main-content">
            <div class="left-section">
                <div class="section-title">입력 조건</div>
                
                <div class="info-box input-group full-width" id="typeInfo">
                    계산 방식을 확인 중...
                </div>

                <div class="input-group">
                    <label for="beamSpan">보 스팬 (L, m)</label>
                    <input type="number" id="beamSpan" class="input-field" value="13.5" step="0.1" min="0.1">
                </div>

                <div class="input-group">
                    <label for="loadWidth">하중 폭 (B, m)</label>
                    <input type="number" id="loadWidth" class="input-field" value="3.0" step="0.1" min="0.1">
                </div>

                <div class="input-group">
                    <label for="liveLoad">활하중 (qL, kN/m²)</label>
                    <input type="number" id="liveLoad" class="input-field" value="3.5" step="0.1" min="0">
                </div>

                <div class="input-group">
                    <label for="deadLoad">고정하중 (qD, kN/m²) - Super imposed Dead Load</label>
                    <input type="number" id="deadLoad" class="input-field" value="0.8" step="0.1" min="0">
                </div>

                <div class="input-group">
                    <label for="constructionLoad">가설하중 (qConst, kN/m²) - 시공하중</label>
                    <input type="number" id="constructionLoad" class="input-field" value="1.0" step="0.1" min="0">
                </div>

                <div class="input-group">
                    <label for="selfWeight">보 자중 (self_w, kN/m²) - 자동계산</label>
                    <input type="number" id="selfWeight" class="input-field" value="1.0" step="0.001" min="0" readonly style="background: #f1f5f9;">
                </div>

                <div class="input-group">
                    <label for="slabThickness">슬래브 두께 (ts, mm)</label>
                    <input type="number" id="slabThickness" class="input-field" value="135" step="1" min="0">
                </div>

                <div class="input-group">
                    <label for="steelGrade">강종</label>
                    <select id="steelGrade" class="input-field">
                        <option value="SM355" selected>SM355 (Fy = 355 MPa)</option>
                        <option value="SM420">SM420 (Fy = 420 MPa)</option>
                        <option value="SS275">SS275 (Fy = 275 MPa)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="slabWeight">슬래브 자중 (kN/m²) - 자동계산</label>
                    <input type="number" id="slabWeight" class="input-field" value="0" step="0.001" min="0" readonly style="background: #f1f5f9;">
                </div>

                <div class="section-title" style="margin-top: 20px;">원단면 치수 (H형강)</div>

                <div class="input-group full-width">
                    <label for="ksSection">KS 단면 선택</label>
                    <select id="ksSection" class="input-field" style="height: 40px;">
                        <option value="">직접 입력</option>
                    </select>
                    <div style="font-size: 11px; color: #94a3b8; margin-top: 4px;">※ KS 단면 선택 시 아래 값이 자동 입력됩니다</div>
                </div>

                <div class="input-group">
                    <label for="beamDepth">보 높이 (dc, mm) - dc = 원치수 × 1.5 (자동계산)</label>
                    <input type="number" id="beamDepth" class="input-field" value="900" step="10" min="100">
                    <div style="font-size: 11px; color: #94a3b8; margin-top: 4px;">※ KS 단면 선택 시 자동 계산됩니다 (예: H600 → 900mm)</div>
                </div>

                <div class="input-group">
                    <label for="flangeWidth">플랜지 폭 (bf, mm)</label>
                    <input type="number" id="flangeWidth" class="input-field" value="200" step="1" min="0">
                </div>

                <div class="input-group">
                    <label for="flangeThickness">플랜지 두께 (tf, mm)</label>
                    <input type="number" id="flangeThickness" class="input-field" value="17" step="1" min="0">
                </div>

                <div class="input-group">
                    <label for="webThickness">웹 두께 (tw, mm)</label>
                    <input type="number" id="webThickness" class="input-field" value="11" step="1" min="0">
                </div>

                <div class="input-group">
                    <label for="filletRadius">필렛 반경 (r, mm)</label>
                    <input type="number" id="filletRadius" class="input-field" value="18" step="1" min="0">
                    <div style="font-size: 11px; color: #94a3b8; margin-top: 4px;">※ KS 단면 선택 시 자동 입력됩니다</div>
                </div>

                <!-- 합성보 정보 (with-slab 타입일 때만 표시) -->
                <div id="compositeSection" class="section-title" style="margin-top: 20px; display: none;">합성보 정보</div>

                <div id="compositeEffectiveWidth" class="input-group" style="display: none;">
                    <label for="effectiveWidth">슬래브 유효폭 (beff, m)</label>
                    <input type="number" id="effectiveWidth" class="input-field" value="3.0" step="0.1" min="0.5">
                    <div style="font-size: 11px; color: #94a3b8; margin-top: 4px;">※ AISC I3.1: min(L/4, 보간격, b0+16ts)</div>
                </div>

                <div id="compositeConcreteStrength" class="input-group" style="display: none;">
                    <label for="concreteStrength">콘크리트 압축강도 (f'c, MPa)</label>
                    <input type="number" id="concreteStrength" class="input-field" value="24" step="1" min="20" max="50">
                </div>

                <div id="compositeConcreteUnitWeight" class="input-group" style="display: none;">
                    <label for="concreteUnitWeight">콘크리트 단위중량 (γc, kN/m³)</label>
                    <input type="number" id="concreteUnitWeight" class="input-field" value="24" step="0.1" min="20" max="30">
                    <div style="font-size: 11px; color: #94a3b8; margin-top: 4px;">※ 일반적으로 24 kN/m³</div>
                </div>

                <!-- 전단연결재 정보 -->
                <div id="compositeShearConnectorTitle" class="section-title" style="margin-top: 20px; display: none;">전단연결재 (Shear Connector)</div>

                <div id="compositeConnectorType" class="input-group" style="display: none;">
                    <label for="connectorType">전단연결재 타입</label>
                    <select id="connectorType" class="input-field">
                        <option value="stud" selected>Stud (헤드 스터드)</option>
                        <option value="channel">Channel (채널형)</option>
                    </select>
                </div>

                <div id="compositeStudDiameter" class="input-group" style="display: none;">
                    <label for="studDiameter">스터드 직경 (d, mm)</label>
                    <input type="number" id="studDiameter" class="input-field" value="19" step="1" min="13" max="30">
                    <div style="font-size: 11px; color: #94a3b8; margin-top: 4px;">※ 일반적으로 19mm, 22mm, 25mm</div>
                </div>

                <div id="compositeStudHeight" class="input-group" style="display: none;">
                    <label for="studHeight">스터드 높이 (h, mm)</label>
                    <input type="number" id="studHeight" class="input-field" value="100" step="5" min="50" max="200">
                    <div style="font-size: 11px; color: #94a3b8; margin-top: 4px;">※ 슬래브 두께보다 최소 38mm 이상</div>
                </div>

                <div id="compositeStudFu" class="input-group" style="display: none;">
                    <label for="studFu">스터드 설계기준 인장강도 (fu, MPa)</label>
                    <input type="number" id="studFu" class="input-field" value="400" step="10" min="350" max="500">
                    <div style="font-size: 11px; color: #94a3b8; margin-top: 4px;">※ 일반적으로 400 MPa</div>
                </div>

                <div id="compositeStudRows" class="input-group" style="display: none;">
                    <label for="studRows">스터드 열수 (n)</label>
                    <input type="number" id="studRows" class="input-field" value="2" step="1" min="1" max="5">
                    <div style="font-size: 11px; color: #94a3b8; margin-top: 4px;">※ 보 폭 방향 스터드 개수</div>
                </div>

                <div id="compositeStudSpacing" class="input-group" style="display: none;">
                    <label for="studSpacing">스터드 간격 (s, mm)</label>
                    <input type="number" id="studSpacing" class="input-field" value="300" step="50" min="100" max="600">
                    <div style="font-size: 11px; color: #94a3b8; margin-top: 4px;">※ 보 길이 방향 스터드 간격 (최소: 6d, 최대: 8ts 또는 600mm)</div>
                </div>

                <div id="compositeDeckPlate" class="input-group" style="display: none;">
                    <label for="useDeckPlate">데크플레이트 사용 여부</label>
                    <select id="useDeckPlate" class="input-field">
                        <option value="no" selected>사용 안 함</option>
                        <option value="yes">사용</option>
                    </select>
                </div>

                <div id="compositeDeckThickness" class="input-group" style="display: none;">
                    <label for="deckThickness">데크플레이트 두께 (td, mm)</label>
                    <input type="number" id="deckThickness" class="input-field" value="0.9" step="0.1" min="0.5" max="2.0">
                    <div style="font-size: 11px; color: #94a3b8; margin-top: 4px;">※ 데크플레이트 사용 시 입력</div>
                </div>

                <div id="compositeDeckDirection" class="input-group" style="display: none;">
                    <label for="deckDirection">데크플레이트 골 방향</label>
                    <select id="deckDirection" class="input-field">
                        <option value="perpendicular" selected>보에 직각</option>
                        <option value="parallel">보에 평행</option>
                    </select>
                    <div style="font-size: 11px; color: #94a3b8; margin-top: 4px;">※ 데크플레이트 사용 시 선택</div>
                </div>

                <div class="section-title" style="margin-top: 20px;">개구부 정보</div>
                
                <div style="margin: 15px 0; text-align: center;">
                    <img src="/assets/images/castellated-beam-section.png" alt="Castellated Beam Section" style="width: 100%; max-width: 600px; height: auto; display: block; margin: 0 auto; border: 1px solid #e2e8f0; border-radius: 4px;" onerror="console.error('Image failed to load: castellated-beam-section.png'); this.style.display='none';">
                </div>

                <div class="input-group">
                    <label for="openingHeight">개구부 높이 (ho, m) - ho ≤ 0.6dc (자동계산)</label>
                    <input type="number" id="openingHeight" class="input-field" value="0.6" step="0.01" min="0.1" readonly style="background: #f1f5f9;">
                </div>

                <div class="input-group">
                    <label for="openingSpacing">개구부 간격 (p, m) - p = W_open + e (자동계산)</label>
                    <input type="number" id="openingSpacing" class="input-field" value="0.9" step="0.01" min="0.1" readonly style="background: #f1f5f9;">
                </div>

                <div class="input-group">
                    <label for="openingAngle">개구부 각도 (θ, deg)</label>
                    <input type="number" id="openingAngle" class="input-field" value="60" step="1" min="0" max="90">
                </div>

                <div class="input-group">
                    <label for="endPost">양단 End Post 길이 (m) - endPost = dc × 1.5 (자동계산)</label>
                    <input type="number" id="endPost" class="input-field" value="0.9" step="0.01" min="0" readonly style="background: #f1f5f9;">
                </div>

                <div class="input-group full-width">
                    <label for="openingWidth">웹포스트폭 (Web Post width : e, mm) = 두 개구부 사이 남는 웹 두께 방향 폭</label>
                    <input type="number" id="openingWidth" class="input-field" value="200" step="1" min="0">
                    <div id="openingWidthRange" style="font-size: 11px; color: #64748b; margin-top: 4px;">
                        최소값(H/2)= <span id="openingWidthMin">-</span>mm ~ 최대값(1.5*ho)= <span id="openingWidthMax">-</span>mm
                    </div>
                </div>

                <button class="calc-btn input-group full-width" onclick="calculateBeam()" style="grid-column: 1 / -1;">계산하기</button>
            </div>

            <div class="right-section">
                <div class="section-title">계산 결과</div>
                <div id="resultsContainer" class="results-container">
                    <div id="noResults" style="text-align: center; padding: 60px 20px; color: #94a3b8;">
                        <p style="font-size: 16px; margin-bottom: 10px;">계산 결과가 여기에 표시됩니다</p>
                        <p style="font-size: 12px;">좌측 입력값을 입력하고 "계산하기" 버튼을 클릭하세요</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 페이지 로드 확인
        // #region agent log
        console.log('[DEBUG] noncomposite-castellatedbeam-calculator.html script loaded', {
            readyState: document.readyState,
            url: window.location.href,
            timestamp: new Date().toISOString()
        });
        // fetch 요청 시도 (실패해도 계속 진행)
        try {
            fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{
                method:'POST',
                headers:{'Content-Type':'application/json'},
                body:JSON.stringify({
                    location:'noncomposite-castellatedbeam-calculator.html:script-load',
                    message:'Page script loaded',
                    data:{readyState:document.readyState,url:window.location.href},
                    timestamp:Date.now(),
                    sessionId:'debug-session',
                    runId:'run1',
                    hypothesisId:'LOAD'
                })
            }).then(() => {
                console.log('[DEBUG] Log sent successfully');
            }).catch((err) => {
                console.warn('[DEBUG] Log fetch failed (this is OK):', err.message);
            });
        } catch (e) {
            console.warn('[DEBUG] Log fetch exception (this is OK):', e.message);
        }
        // #endregion
        
        // 인쇄 방지 기능
        (function() {
            // #region agent log
            fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:print-prevention',message:'Print prevention initialized',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'PRINT'})}).catch(()=>{});
            // #endregion
            
            // Ctrl+P 키 조합 감지 및 차단
            document.addEventListener('keydown', function(e) {
                // Ctrl+P 또는 Cmd+P (Mac)
                if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:keydown',message:'Ctrl+P detected and blocked',data:{ctrlKey:e.ctrlKey,metaKey:e.metaKey,key:e.key},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'PRINT'})}).catch(()=>{});
                    // #endregion
                    e.preventDefault();
                    e.stopPropagation();
                    alert('이 페이지는 인쇄할 수 없습니다.');
                    return false;
                }
                // F12 (개발자 도구)도 차단 (선택사항)
                if (e.key === 'F12') {
                    e.preventDefault();
                    return false;
                }
            }, true); // capture phase에서 처리하여 우선 차단

            // beforeprint 이벤트 감지 (인쇄 대화상자 열릴 때)
            window.addEventListener('beforeprint', function(e) {
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:beforeprint',message:'beforeprint event detected',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'PRINT'})}).catch(()=>{});
                // #endregion
                e.preventDefault();
                // 모든 내용 숨기기
                document.body.style.visibility = 'hidden';
                // 인쇄 취소
                setTimeout(function() {
                    document.body.style.visibility = 'visible';
                }, 100);
            });

            // afterprint 이벤트 (인쇄 대화상자 닫힐 때)
            window.addEventListener('afterprint', function() {
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:afterprint',message:'afterprint event detected',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'PRINT'})}).catch(()=>{});
                // #endregion
                document.body.style.visibility = 'visible';
            });

            // window.print() 호출 차단
            const originalPrint = window.print;
            window.print = function() {
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:window.print',message:'window.print() called and blocked',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'PRINT'})}).catch(()=>{});
                // #endregion
                alert('이 페이지는 인쇄할 수 없습니다.');
                return false;
            };
        })();

        // 클립보드 차단 기능
        (function() {
            // #region agent log
            fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:clipboard-prevention',message:'Clipboard prevention initialized',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'CLIPBOARD'})}).catch(()=>{});
            // #endregion

            // 텍스트 선택 방지 (추가 보안)
            document.addEventListener('selectstart', function(e) {
                // 입력 필드가 아닌 경우에만 차단
                const target = e.target;
                if (target.tagName !== 'INPUT' && target.tagName !== 'TEXTAREA' && target.tagName !== 'SELECT') {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:selectstart',message:'Text selection blocked',data:{tagName:target.tagName},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'CLIPBOARD'})}).catch(()=>{});
                    // #endregion
                    e.preventDefault();
                    return false;
                }
            });

            // 드래그 방지
            document.addEventListener('dragstart', function(e) {
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:dragstart',message:'Drag blocked',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'CLIPBOARD'})}).catch(()=>{});
                // #endregion
                e.preventDefault();
                return false;
            });

            // 우클릭 메뉴 차단
            document.addEventListener('contextmenu', function(e) {
                // 입력 필드가 아닌 경우에만 차단
                const target = e.target;
                if (target.tagName !== 'INPUT' && target.tagName !== 'TEXTAREA' && target.tagName !== 'SELECT') {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:contextmenu',message:'Right-click menu blocked',data:{tagName:target.tagName},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'CLIPBOARD'})}).catch(()=>{});
                    // #endregion
                    e.preventDefault();
                    return false;
                }
            });

            // 복사 이벤트 차단
            document.addEventListener('copy', function(e) {
                // 입력 필드가 아닌 경우에만 차단
                const target = e.target;
                if (target.tagName !== 'INPUT' && target.tagName !== 'TEXTAREA' && target.tagName !== 'SELECT') {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:copy',message:'Copy event blocked',data:{tagName:target.tagName},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'CLIPBOARD'})}).catch(()=>{});
                    // #endregion
                    e.clipboardData.setData('text/plain', '');
                    e.preventDefault();
                    return false;
                }
            });

            // 잘라내기 이벤트 차단
            document.addEventListener('cut', function(e) {
                // 입력 필드가 아닌 경우에만 차단
                const target = e.target;
                if (target.tagName !== 'INPUT' && target.tagName !== 'TEXTAREA' && target.tagName !== 'SELECT') {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:cut',message:'Cut event blocked',data:{tagName:target.tagName},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'CLIPBOARD'})}).catch(()=>{});
                    // #endregion
                    e.clipboardData.setData('text/plain', '');
                    e.preventDefault();
                    return false;
                }
            });

            // 붙여넣기 이벤트 차단 (입력 필드 외부)
            document.addEventListener('paste', function(e) {
                const target = e.target;
                if (target.tagName !== 'INPUT' && target.tagName !== 'TEXTAREA' && target.tagName !== 'SELECT') {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:paste',message:'Paste event blocked',data:{tagName:target.tagName},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'CLIPBOARD'})}).catch(()=>{});
                    // #endregion
                    e.preventDefault();
                    return false;
                }
            });

            // 키보드 단축키 차단 (Ctrl+C, Ctrl+V, Ctrl+X, Ctrl+A)
            document.addEventListener('keydown', function(e) {
                const target = e.target;
                const isInputField = target.tagName === 'INPUT' || target.tagName === 'TEXTAREA' || target.tagName === 'SELECT';
                
                // 입력 필드가 아닌 경우에만 차단
                if (!isInputField) {
                    // Ctrl+C (복사) 또는 Cmd+C
                    if ((e.ctrlKey || e.metaKey) && e.key === 'c') {
                        // #region agent log
                        fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:keydown-copy',message:'Ctrl+C blocked',data:{ctrlKey:e.ctrlKey,metaKey:e.metaKey,key:e.key},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'CLIPBOARD'})}).catch(()=>{});
                        // #endregion
                        e.preventDefault();
                        e.stopPropagation();
                        return false;
                    }
                    // Ctrl+V (붙여넣기) 또는 Cmd+V
                    if ((e.ctrlKey || e.metaKey) && e.key === 'v') {
                        // #region agent log
                        fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:keydown-paste',message:'Ctrl+V blocked',data:{ctrlKey:e.ctrlKey,metaKey:e.metaKey,key:e.key},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'CLIPBOARD'})}).catch(()=>{});
                        // #endregion
                        e.preventDefault();
                        e.stopPropagation();
                        return false;
                    }
                    // Ctrl+X (잘라내기) 또는 Cmd+X
                    if ((e.ctrlKey || e.metaKey) && e.key === 'x') {
                        // #region agent log
                        fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:keydown-cut',message:'Ctrl+X blocked',data:{ctrlKey:e.ctrlKey,metaKey:e.metaKey,key:e.key},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'CLIPBOARD'})}).catch(()=>{});
                        // #endregion
                        e.preventDefault();
                        e.stopPropagation();
                        return false;
                    }
                    // Ctrl+A (전체 선택) 또는 Cmd+A
                    if ((e.ctrlKey || e.metaKey) && e.key === 'a') {
                        // #region agent log
                        fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:keydown-selectall',message:'Ctrl+A blocked',data:{ctrlKey:e.ctrlKey,metaKey:e.metaKey,key:e.key},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'CLIPBOARD'})}).catch(()=>{});
                        // #endregion
                        e.preventDefault();
                        e.stopPropagation();
                        return false;
                    }
                }
            }, true); // capture phase에서 처리하여 우선 차단
        })();

        // 스크린샷 및 화면 캡처 방지 기능
        (function() {
            // #region agent log
            fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:screenshot-prevention',message:'Screenshot prevention initialized',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'SCREENSHOT'})}).catch(()=>{});
            // #endregion

            // Print Screen 키 차단
            document.addEventListener('keydown', function(e) {
                // Print Screen (일부 브라우저에서 감지 가능)
                if (e.key === 'PrintScreen' || e.keyCode === 44) {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:keydown-printscreen',message:'Print Screen blocked',data:{key:e.key,keyCode:e.keyCode},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'SCREENSHOT'})}).catch(()=>{});
                    // #endregion
                    e.preventDefault();
                    e.stopPropagation();
                    alert('스크린샷은 허용되지 않습니다.');
                    return false;
                }
            }, true);

            // 개발자 도구 단축키 차단
            document.addEventListener('keydown', function(e) {
                // Ctrl+Shift+I (개발자 도구)
                if ((e.ctrlKey || e.metaKey) && e.shiftKey && (e.key === 'I' || e.key === 'i')) {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:keydown-devtools',message:'Ctrl+Shift+I blocked',data:{ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,key:e.key},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'SCREENSHOT'})}).catch(()=>{});
                    // #endregion
                    e.preventDefault();
                    e.stopPropagation();
                    return false;
                }
                // Ctrl+Shift+J (콘솔)
                if ((e.ctrlKey || e.metaKey) && e.shiftKey && (e.key === 'J' || e.key === 'j')) {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:keydown-devtools',message:'Ctrl+Shift+J blocked',data:{ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,key:e.key},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'SCREENSHOT'})}).catch(()=>{});
                    // #endregion
                    e.preventDefault();
                    e.stopPropagation();
                    return false;
                }
                // Ctrl+Shift+C (요소 검사)
                if ((e.ctrlKey || e.metaKey) && e.shiftKey && (e.key === 'C' || e.key === 'c')) {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:keydown-devtools',message:'Ctrl+Shift+C blocked',data:{ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,key:e.key},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'SCREENSHOT'})}).catch(()=>{});
                    // #endregion
                    e.preventDefault();
                    e.stopPropagation();
                    return false;
                }
                // Ctrl+Shift+K (Firefox 콘솔)
                if ((e.ctrlKey || e.metaKey) && e.shiftKey && (e.key === 'K' || e.key === 'k')) {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:keydown-devtools',message:'Ctrl+Shift+K blocked',data:{ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,key:e.key},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'SCREENSHOT'})}).catch(()=>{});
                    // #endregion
                    e.preventDefault();
                    e.stopPropagation();
                    return false;
                }
                // Ctrl+U (페이지 소스 보기)
                if ((e.ctrlKey || e.metaKey) && (e.key === 'U' || e.key === 'u')) {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:keydown-source',message:'Ctrl+U blocked',data:{ctrlKey:e.ctrlKey,key:e.key},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'SCREENSHOT'})}).catch(()=>{});
                    // #endregion
                    e.preventDefault();
                    e.stopPropagation();
                    return false;
                }
                // Ctrl+S (페이지 저장)
                if ((e.ctrlKey || e.metaKey) && (e.key === 'S' || e.key === 's')) {
                    const target = e.target;
                    const isInputField = target.tagName === 'INPUT' || target.tagName === 'TEXTAREA' || target.tagName === 'SELECT';
                    if (!isInputField) {
                        // #region agent log
                        fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:keydown-save',message:'Ctrl+S blocked',data:{ctrlKey:e.ctrlKey,key:e.key},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'SCREENSHOT'})}).catch(()=>{});
                        // #endregion
                        e.preventDefault();
                        e.stopPropagation();
                        return false;
                    }
                }
            }, true);

            // 화면 녹화 API 차단 (getDisplayMedia)
            if (navigator.mediaDevices && navigator.mediaDevices.getDisplayMedia) {
                const originalGetDisplayMedia = navigator.mediaDevices.getDisplayMedia;
                navigator.mediaDevices.getDisplayMedia = function() {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:getDisplayMedia',message:'getDisplayMedia blocked',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'SCREENSHOT'})}).catch(()=>{});
                    // #endregion
                    return Promise.reject(new Error('화면 녹화는 허용되지 않습니다.'));
                };
            }

            // 페이지 가시성 변경 감지 (탭 전환 시 스크린샷 시도 감지)
            let visibilityChangeCount = 0;
            document.addEventListener('visibilitychange', function() {
                if (document.hidden) {
                    visibilityChangeCount++;
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:visibilitychange',message:'Page visibility changed',data:{hidden:document.hidden,count:visibilityChangeCount},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'SCREENSHOT'})}).catch(()=>{});
                    // #endregion
                    // 페이지가 숨겨졌을 때 (탭 전환 등) 경고는 하지 않음 (정상적인 사용일 수 있음)
                } else {
                    // 페이지가 다시 보일 때
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:visibilitychange',message:'Page visibility restored',data:{hidden:document.hidden},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'SCREENSHOT'})}).catch(()=>{});
                    // #endregion
                }
            });

            // 개발자 도구 열림 감지 (간접적 방법)
            let devtools = {
                open: false,
                orientation: null
            };
            const threshold = 160;
            setInterval(function() {
                if (window.outerHeight - window.innerHeight > threshold || 
                    window.outerWidth - window.innerWidth > threshold) {
                    if (!devtools.open) {
                        devtools.open = true;
                        // #region agent log
                        fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:devtools-detected',message:'Developer tools detected',data:{outerHeight:window.outerHeight,innerHeight:window.innerHeight,outerWidth:window.outerWidth,innerWidth:window.innerWidth},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'SCREENSHOT'})}).catch(()=>{});
                        // #endregion
                        // 개발자 도구가 열렸을 때 페이지 내용을 숨기거나 경고할 수 있음
                        // document.body.style.display = 'none';
                        // alert('개발자 도구 사용이 감지되었습니다.');
                    }
                } else {
                    devtools.open = false;
                }
            }, 500);
        })();

        // Get type from URL parameter
        const urlParams = new URLSearchParams(window.location.search);
        const beamType = urlParams.get('type') || 'without-slab';

        // KS H-beam section database (H×B×tw×tf) - 직사각형 H형강
        // 단중(kg/m) 계산 함수
        function calculateUnitWeight(d, bf, tw, tf) {
            const hw = d - 2 * tf;
            const area = bf * tf * 2 + hw * tw; // mm²
            const unitWeight = (area / 1000000) * 7850; // kg/m (강재 밀도 7850 kg/m³)
            return unitWeight;
        }

        const ksSections = {
            'H150x75x5x7': { d: 150, bf: 75, tw: 5, tf: 7, r: 8 },
            'H198x99x4.5x7': { d: 198, bf: 99, tw: 4.5, tf: 7, r: 8 },
            'H200x100x5.5x8': { d: 200, bf: 100, tw: 5.5, tf: 8, r: 8 },
            'H250x125x6x9': { d: 250, bf: 125, tw: 6, tf: 9, r: 10 },
            'H294x200x8x12': { d: 294, bf: 200, tw: 8, tf: 12, r: 13 },
            'H298x149x6.5x9': { d: 298, bf: 149, tw: 6.5, tf: 9, r: 13 },
            'H300x150x6.5x9': { d: 300, bf: 150, tw: 6.5, tf: 9, r: 13 },
            'H346x174x6x9': { d: 346, bf: 174, tw: 6, tf: 9, r: 13 },
            'H350x175x7x11': { d: 350, bf: 175, tw: 7, tf: 11, r: 13 },
            'H340x250x9x14': { d: 340, bf: 250, tw: 9, tf: 14, r: 13 },
            'H390x300x10x16': { d: 390, bf: 300, tw: 10, tf: 16, r: 18 },
            'H396x199x7x11': { d: 396, bf: 199, tw: 7, tf: 11, r: 13 },
            'H400x200x8x13': { d: 400, bf: 200, tw: 8, tf: 13, r: 13 },
            'H446x199x8x12': { d: 446, bf: 199, tw: 8, tf: 12, r: 13 },
            'H450x200x9x14': { d: 450, bf: 200, tw: 9, tf: 14, r: 18 },
            'H482x300x11x15': { d: 482, bf: 300, tw: 11, tf: 15, r: 18 },
            'H488x300x11x16': { d: 488, bf: 300, tw: 11, tf: 16, r: 18 },
            'H496x199x9x14': { d: 496, bf: 199, tw: 9, tf: 14, r: 18 },
            'H500x200x10x16': { d: 500, bf: 200, tw: 10, tf: 16, r: 18 },
            'H506x201x11x19': { d: 506, bf: 201, tw: 11, tf: 19, r: 18 },
            'H582x300x12x17': { d: 582, bf: 300, tw: 12, tf: 17, r: 18 },
            'H588x300x12x18': { d: 588, bf: 300, tw: 12, tf: 18, r: 18 },
            'H594x302x14x23': { d: 594, bf: 302, tw: 14, tf: 23, r: 22 },
            'H596x199x10x15': { d: 596, bf: 199, tw: 10, tf: 15, r: 18 },
            'H600x200x11x17': { d: 600, bf: 200, tw: 11, tf: 17, r: 18 },
            'H606x201x12x20': { d: 606, bf: 201, tw: 12, tf: 20, r: 18 },
            'H692x300x13x20': { d: 692, bf: 300, tw: 13, tf: 20, r: 22 },
            'H700x300x13x24': { d: 700, bf: 300, tw: 13, tf: 24, r: 22 },
            'H792x300x14x22': { d: 792, bf: 300, tw: 14, tf: 22, r: 22 },
            'H800x300x14x26': { d: 800, bf: 300, tw: 14, tf: 26, r: 22 },
            'H890x299x15x23': { d: 890, bf: 299, tw: 15, tf: 23, r: 22 },
            'H900x300x16x28': { d: 900, bf: 300, tw: 16, tf: 28, r: 22 },
            'H912x302x18x34': { d: 912, bf: 302, tw: 18, tf: 34, r: 22 }
        };

        // 각 단면의 단중 계산 및 저장
        Object.keys(ksSections).forEach(key => {
            const section = ksSections[key];
            section.unitWeight = calculateUnitWeight(section.d, section.bf, section.tw, section.tf);
        });

        // KS 단면 옵션 생성 함수
        function populateKsSectionOptions() {
            // #region agent log
            fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:populateKsSectionOptions',message:'populateKsSectionOptions called',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'A'})}).catch(()=>{});
            // #endregion
            try {
                const ksSectionSelect = document.getElementById('ksSection');
                if (!ksSectionSelect) {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:populateKsSectionOptions',message:'ksSection select element not found',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'B'})}).catch(()=>{});
                    // #endregion
                    console.log('[DEBUG] populateKsSectionOptions: ksSection select element not found');
                    return false;
                }
                
                if (typeof ksSections === 'undefined' || !ksSections) {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:populateKsSectionOptions',message:'ksSections is not defined',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'C'})}).catch(()=>{});
                    // #endregion
                    console.error('[ERROR] populateKsSectionOptions: ksSections is not defined');
                    return false;
                }
                
                const sectionsCount = Object.keys(ksSections).length;
                if (sectionsCount === 0) {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:populateKsSectionOptions',message:'ksSections is empty',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'D'})}).catch(()=>{});
                    // #endregion
                    console.error('[ERROR] populateKsSectionOptions: ksSections is empty');
                    return false;
                }
                
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:populateKsSectionOptions',message:'Starting to populate options',data:{sectionsCount:sectionsCount},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'E'})}).catch(()=>{});
                console.log('[DEBUG] populateKsSectionOptions: Starting to populate', sectionsCount, 'options');
                // #endregion
                
                // 모든 옵션 제거 후 직접 입력 옵션만 다시 추가
                ksSectionSelect.innerHTML = '<option value="">직접 입력</option>';
                console.log('[DEBUG] populateKsSectionOptions: Cleared and added default option');
                
                // 높이(d) 순으로 정렬
                const sortedKeys = Object.keys(ksSections).sort((a, b) => {
                    const dA = ksSections[a].d;
                    const dB = ksSections[b].d;
                    if (dA !== dB) return dA - dB;
                    // 높이가 같으면 폭(bf) 순으로 정렬
                    return ksSections[a].bf - ksSections[b].bf;
                });
                
                // 기본값 설정 (H600x200x11x17)
                const defaultSection = 'H600x200x11x17';
                
                sortedKeys.forEach(key => {
                    try {
                        const section = ksSections[key];
                        if (!section) {
                            console.warn('[WARN] Section not found for key:', key);
                            return;
                        }
                        const option = document.createElement('option');
                        option.value = key;
                        
                        // 기본값으로 선택
                        if (key === defaultSection) {
                            option.selected = true;
                        }
                        
                        // 단면명 추출 (예: "H500x200x10x16" -> "H 500×200")
                        const match = key.match(/H(\d+)x(\d+)/);
                        if (match) {
                            // 단중이 있으면 함께 표시
                            if (section.unitWeight) {
                                option.textContent = `H ${match[1]}×${match[2]} (단중: ${section.unitWeight.toFixed(1)} kg/m)`;
                            } else {
                                option.textContent = `H ${match[1]}×${match[2]}`;
                            }
                        } else {
                            // 단중이 있으면 함께 표시
                            if (section.unitWeight) {
                                option.textContent = `${key} (단중: ${section.unitWeight.toFixed(1)} kg/m)`;
                            } else {
                                option.textContent = key;
                            }
                        }
                        
                        ksSectionSelect.appendChild(option);
                    } catch (err) {
                        console.error('[ERROR] Error creating option for key:', key, err);
                    }
                });
                
                // #region agent log
                const finalOptionsCount = ksSectionSelect.options.length;
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:populateKsSectionOptions',message:'Options populated',data:{finalOptionsCount:finalOptionsCount,selectedValue:ksSectionSelect.value},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'F'})}).catch(()=>{});
                console.log('[DEBUG] populateKsSectionOptions: Completed. Total options:', finalOptionsCount, 'Selected:', ksSectionSelect.value);
                // #endregion
                
                // 기본값이 설정된 경우 관련 필드 자동 업데이트
                if (ksSections[defaultSection]) {
                    setTimeout(() => {
                        onKsSectionChange();
                    }, 100);
                }
                
                return true;
            } catch (error) {
                console.error('[ERROR] populateKsSectionOptions error:', error);
                return false;
            }
        }

        // KS 섹션 선택 시 자동 입력
        function onKsSectionChange() {
            // #region agent log
            fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:477',message:'onKsSectionChange called',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'A'})}).catch(()=>{});
            console.log('[DEBUG] onKsSectionChange called');
            // #endregion
            
            try {
                const ksSectionSelect = document.getElementById('ksSection');
                if (!ksSectionSelect) {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:482',message:'ksSectionSelect is null',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'A'})}).catch(()=>{});
                    // #endregion
                    console.error('[ERROR] ksSection element not found');
                    return;
                }
                
                const selectedValue = ksSectionSelect.value;
                console.log('[DEBUG] onKsSectionChange: selectedValue =', selectedValue);
                
                if (!selectedValue || selectedValue === '') {
                    // 직접 입력 모드
                    console.log('[DEBUG] onKsSectionChange: Direct input mode, returning');
                    return;
                }
                
                const section = ksSections[selectedValue];
                if (!section) {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:495',message:'Section not found in ksSections',data:{selectedValue:selectedValue},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'B'})}).catch(()=>{});
                    // #endregion
                    console.error('[ERROR] Section not found:', selectedValue);
                    return;
                }
                
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:500',message:'Setting section values',data:{section:section,selectedValue:selectedValue},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'C'})}).catch(()=>{});
                console.log('[DEBUG] onKsSectionChange: Setting values for section', selectedValue, section);
                // #endregion
                
                // 치수 입력 (mm 단위) - null 체크 추가
                const flangeWidthEl = document.getElementById('flangeWidth');
                const flangeThicknessEl = document.getElementById('flangeThickness');
                const webThicknessEl = document.getElementById('webThickness');
                const beamDepthEl = document.getElementById('beamDepth');
                const filletRadiusEl = document.getElementById('filletRadius');
                
                if (!flangeWidthEl) {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:510',message:'flangeWidth element is null',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'D'})}).catch(()=>{});
                    // #endregion
                    console.error('[ERROR] flangeWidth element not found');
                    return;
                }
                if (!flangeThicknessEl) {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:516',message:'flangeThickness element is null',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'D'})}).catch(()=>{});
                    // #endregion
                    console.error('[ERROR] flangeThickness element not found');
                    return;
                }
                if (!webThicknessEl) {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:522',message:'webThickness element is null',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'D'})}).catch(()=>{});
                    // #endregion
                    console.error('[ERROR] webThickness element not found');
                    return;
                }
                if (!beamDepthEl) {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:528',message:'beamDepth element is null',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'D'})}).catch(()=>{});
                    // #endregion
                    console.error('[ERROR] beamDepth element not found');
                    return;
                }
                
                flangeWidthEl.value = section.bf;
                flangeThicknessEl.value = section.tf;
                webThicknessEl.value = section.tw;
                
                // 필렛 반경 설정
                if (filletRadiusEl && section.r) {
                    filletRadiusEl.value = section.r;
                }
                
                // 보 높이 입력 (원치수의 1.5배, mm 단위)
                // 예: H600 (600mm) → 600 × 1.5 = 900mm
                const beamDepthValue = Math.round(section.d * 1.5);
                beamDepthEl.value = beamDepthValue;
                
                // 보 자중 자동 계산
                setTimeout(updateSelfWeight, 50);
                
                // 개구부 높이 자동 계산 (ho ≤ 0.6dc)
                // dc는 mm 단위, ho는 m 단위로 표시
                const openingHeightEl = document.getElementById('openingHeight');
                if (openingHeightEl) {
                    const hoValue = (0.6 * beamDepthValue) / 1000;  // mm → m 변환
                    openingHeightEl.value = hoValue.toFixed(3);
                }
                
                // 개구부 간격은 updateOpeningSpacing()에서 자동 계산됨
                // (openingWidth가 먼저 설정되어야 함)
                setTimeout(updateOpeningSpacing, 100);
                
                // End Post 길이 자동 계산 (endPost = dc × 1.5)
                // dc는 mm 단위, endPost는 m 단위로 표시
                const endPostEl = document.getElementById('endPost');
                if (endPostEl) {
                    const endPostValue = (beamDepthValue * 1.5) / 1000;  // mm → m 변환 (1.5배 적용)
                    endPostEl.value = endPostValue.toFixed(3);
                }
                
                // 개구부 폭 범위 업데이트 (개구부 높이가 먼저 계산되어야 함)
                // updateOpeningWidth()는 beamDepth와 openingHeight 변경 시 자동 호출됨
                setTimeout(updateOpeningWidth, 50);
                
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:540',message:'Values set successfully',data:{bf:section.bf,tf:section.tf,tw:section.tw,beamDepth:beamDepthValue},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'C'})}).catch(()=>{});
                // #endregion
            } catch (error) {
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:544',message:'Error in onKsSectionChange',data:{error:error.message,stack:error.stack},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'E'})}).catch(()=>{});
                // #endregion
                console.error('[ERROR] onKsSectionChange error:', error);
                alert('단면 선택 중 오류가 발생했습니다: ' + error.message);
            }
        }

        // Update UI based on type
        function initializeType() {
            const typeBadge = document.getElementById('typeBadge');
            const typeInfo = document.getElementById('typeInfo');
            const headerH1 = document.querySelector('.header h1');

            // 합성보 관련 입력 필드 표시/숨김 제어
            function toggleCompositeInputs(show) {
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:toggleCompositeInputs',message:'toggleCompositeInputs called',data:{show:show,readyState:document.readyState},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'H1'})}).catch(()=>{});
                // #endregion
                const compositeElements = [
                    'compositeSection',
                    'compositeEffectiveWidth',
                    'compositeConcreteStrength',
                    'compositeConcreteUnitWeight',
                    'compositeShearConnectorTitle',
                    'compositeConnectorType',
                    'compositeStudDiameter',
                    'compositeStudHeight',
                    'compositeStudFu',
                    'compositeStudRows',
                    'compositeStudSpacing',
                    'compositeDeckPlate',
                    'compositeDeckThickness',
                    'compositeDeckDirection'
                ];
                
                const foundElements = [];
                const notFoundElements = [];
                
                compositeElements.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        const oldDisplay = element.style.display;
                        element.style.display = show ? 'block' : 'none';
                        foundElements.push({id, oldDisplay, newDisplay: element.style.display});
                        // #region agent log
                        fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:toggleCompositeInputs',message:'Element found and updated',data:{id:id,oldDisplay:oldDisplay,newDisplay:element.style.display,show:show},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'H2'})}).catch(()=>{});
                        // #endregion
                    } else {
                        notFoundElements.push(id);
                        // #region agent log
                        fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:toggleCompositeInputs',message:'Element not found',data:{id:id,show:show},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'H3'})}).catch(()=>{});
                        // #endregion
                    }
                });
                
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:toggleCompositeInputs',message:'toggleCompositeInputs completed',data:{show:show,foundCount:foundElements.length,notFoundCount:notFoundElements.length,notFound:notFoundElements},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'H4'})}).catch(()=>{});
                // #endregion

                // 데크플레이트 관련 필드는 데크플레이트 사용 여부에 따라 추가 제어
                if (show) {
                    const useDeckPlate = document.getElementById('useDeckPlate');
                    const deckThickness = document.getElementById('compositeDeckThickness');
                    const deckDirection = document.getElementById('compositeDeckDirection');
                    
                    function updateDeckPlateVisibility() {
                        const isDeckPlateUsed = useDeckPlate && useDeckPlate.value === 'yes';
                        if (deckThickness) deckThickness.style.display = isDeckPlateUsed ? 'block' : 'none';
                        if (deckDirection) deckDirection.style.display = isDeckPlateUsed ? 'block' : 'none';
                    }
                    
                    if (useDeckPlate) {
                        useDeckPlate.addEventListener('change', updateDeckPlateVisibility);
                        updateDeckPlateVisibility();
                    }
                }
            }

            // #region agent log
            fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:beamType-check',message:'Checking beamType',data:{beamType:beamType,urlParams:window.location.search,readyState:document.readyState},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'H5'})}).catch(()=>{});
            // #endregion

            if (beamType === 'with-slab') {
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:with-slab',message:'with-slab branch entered',data:{beamType:beamType},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'H6'})}).catch(()=>{});
                // #endregion
                typeBadge.textContent = 'with top-slab';
                typeInfo.innerHTML = '<strong>Castellated Beam with top-slab</strong><br>상부 슬래브가 있는 Castellated Beam 설계 계산기입니다.';
                if (headerH1) {
                    // h1의 텍스트 노드 찾기
                    for (let node of headerH1.childNodes) {
                        if (node.nodeType === 3) { // Text node
                            node.textContent = 'Composite Castellated Beam Design Calculator ';
                            break;
                        }
                    }
                }
                // 합성보 입력 필드 표시
                toggleCompositeInputs(true);
                // 링크 업데이트: with-slab 페이지에서는 without-slab로 가는 링크 표시
                const typeToggleLink = document.getElementById('typeToggleLink');
                if (typeToggleLink) {
                    typeToggleLink.href = '?type=without-slab';
                    typeToggleLink.textContent = 'Without Top-Slab 바로가기';
                }
            } else {
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:without-slab',message:'without-slab branch entered',data:{beamType:beamType},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'H7'})}).catch(()=>{});
                // #endregion
                typeBadge.textContent = 'without top-slab';
                typeInfo.innerHTML = '<strong>Castellated Beam without top-slab</strong><br>상부 슬래브가 없는 Castellated Beam 설계 계산기입니다.';
                if (headerH1) {
                    // h1의 텍스트 노드 찾기
                    for (let node of headerH1.childNodes) {
                        if (node.nodeType === 3) { // Text node
                            node.textContent = 'Non Composite Castellated Beam Design Calculator ';
                            break;
                        }
                    }
                }
                // 합성보 입력 필드 숨김
                toggleCompositeInputs(false);
                // 링크 업데이트: without-slab 페이지에서는 with-slab로 가는 링크 표시
                const typeToggleLink = document.getElementById('typeToggleLink');
                if (typeToggleLink) {
                    typeToggleLink.href = '?type=with-slab';
                    typeToggleLink.textContent = 'With Top-Slab 바로가기';
                }
            }
        }

        // Format number with commas
        function formatNumber(num, decimals) {
            if (isNaN(num) || !isFinite(num)) return '-';
            return num.toFixed(decimals).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }

        // Get Fy from steel grade
        function getFy(grade) {
            const grades = {
                'SM355': 355,
                'SM420': 420,
                'SS275': 275
            };
            return grades[grade] || 355;
        }

        // Main calculation function
        function calculateBeam() {
            // #region agent log
            console.log('[DEBUG] calculateBeam called');
            fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:calculateBeam',message:'calculateBeam function called',data:{timestamp:Date.now()},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'CALC'})}).catch((err)=>{console.error('Log fetch error:',err);});
            // #endregion
            try {
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:669',message:'calculateBeam 함수 시작',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'A'})}).catch(()=>{});
                // #endregion
                
                // 공통 상수 정의
                const phi_b = 0.90;  // AISC 360 저감계수 (휨강도)
                const phi_v = 0.90;  // AISC 360 저감계수 (전단강도)
                
                // Get input values
                const L = parseFloat(document.getElementById('beamSpan').value) || 0;
                const B = parseFloat(document.getElementById('loadWidth').value) || 0;
                const qL = parseFloat(document.getElementById('liveLoad').value) || 0;
                const qD = parseFloat(document.getElementById('deadLoad').value) || 0;
                const qConst = parseFloat(document.getElementById('constructionLoad').value) || 0;
                const self_w = parseFloat(document.getElementById('selfWeight').value) || 0;
                const slabWeight = parseFloat(document.getElementById('slabWeight').value) || 0;
                
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:677',message:'입력값 읽기 완료',data:{qD:qD,self_w:self_w,slabWeight:slabWeight,B:B},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'B'})}).catch(()=>{});
                // #endregion
                const steelGrade = document.getElementById('steelGrade').value;
                const Fy = getFy(steelGrade);
                
                // Section dimensions (dc는 mm 단위로 입력받고, m 단위로 변환)
                const dc = (parseFloat(document.getElementById('beamDepth').value) || 0) / 1000;  // mm → m
                const bf = parseFloat(document.getElementById('flangeWidth').value) || 0;
                const tf = parseFloat(document.getElementById('flangeThickness').value) || 0;
                const tw = parseFloat(document.getElementById('webThickness').value) || 0;
                
                // Opening parameters
                const ho = parseFloat(document.getElementById('openingHeight').value) || 0;
                const p = parseFloat(document.getElementById('openingSpacing').value) || 0;
                const theta = parseFloat(document.getElementById('openingAngle').value) || 0;
                const end_post = parseFloat(document.getElementById('endPost').value) || 0;
                const e = parseFloat(document.getElementById('openingWidth').value) || 0;
                
                // Slab thickness
                const ts = parseFloat(document.getElementById('slabThickness').value) || 0;

                // Validation
                if (L <= 0 || B <= 0) {
                    alert('보 스팬과 하중 폭을 입력해주세요.');
                    return;
                }
                if (dc <= 0 || bf <= 0 || tf <= 0 || tw <= 0) {
                    alert('원단면 치수를 모두 입력해주세요.');
                    return;
                }
                if (ho <= 0 || p <= 0 || e <= 0) {
                    alert('개구부 정보를 모두 입력해주세요.');
                    return;
                }

                // Convert distributed loads to line loads (kN/m)
                // 고정하중 = Super imposed Dead Load + 보 자중 + 슬래브 자중
                const qD_total = qD + self_w + slabWeight;  // kN/m²
                const DL = qD_total * B;  // kN/m
                const LL = qL * B;  // kN/m
                
                // 보 자중을 선하중으로 변환 (결과 표시용)
                const self_w_kNm = self_w * B;  // kN/m
                
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:717',message:'고정하중 계산 확인',data:{qD:qD,self_w:self_w,slabWeight:slabWeight,qD_total:qD_total,DL:DL,B:B},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'A'})}).catch(()=>{});
                // #endregion
                
                // Total factored load (LRFD)
                // DL에 이미 보 자중과 슬래브 자중이 포함되어 있음
                const wu = 1.2 * DL + 1.6 * LL;  // kN/m

                // Construction stage calculations (시공단계 계산)
                const Es = 200000; // MPa (강재 탄성계수)
                // 시공중 고정하중: 슬래브 자중 + 철골보 자중
                const w_DL_construction = (slabWeight + self_w) * B; // kN/m
                // 시공중 활하중: Construction Load
                const w_CLL_construction = qConst * B; // kN/m
                // 시공중 계수하중 (LRFD): max[1.4*DL, 1.2*DL + 1.6*LL]
                const w_u1_construction = 1.4 * w_DL_construction; // kN/m
                const w_u2_construction = 1.2 * w_DL_construction + 1.6 * w_CLL_construction; // kN/m
                const w_u_construction = Math.max(w_u1_construction, w_u2_construction); // kN/m
                // 시공 중 소요휨강도
                const M_u_construction = w_u_construction * Math.pow(L, 2) / 8; // kN·m
                // 시공 중 소요단면2차모멘트 (처짐 제한 60mm 고려)
                const delta_allow_construction = 60; // mm (콘크리트 타설 시공성 고려)
                const I_req_construction = (5 * w_DL_construction * Math.pow(L * 1000, 4)) / (384 * Es * delta_allow_construction); // mm⁴
                
                // Castellated beam 단면2차모멘트 계산
                // Castellated beam 높이 = dc (이미 castellated beam으로 제작됨)
                const d_castellated = dc * 1000; // mm (Castellated beam 높이)
                const hw_castellated = d_castellated - 2 * tf; // mm
                
                // 필렛 반경 (r값) 가져오기
                const r = parseFloat(document.getElementById('filletRadius')?.value) || 0; // mm
                
                // Castellated beam 단면 2차 모멘트: Ix = I_flange + I_web - I_fillet (r값 고려)
                // 플랜지: (bf * tf^3) / 12 + (bf * tf) * ((d - tf) / 2)^2 (상하 각각)
                // 웹: (tw * hw^3) / 12
                const I_flange = (bf * Math.pow(tf, 3)) / 12; // 플랜지 자체 모멘트
                const A_flange = bf * tf; // 플랜지 단면적
                const y_flange = (d_castellated - tf) / 2; // 플랜지 중심까지 거리
                const I_flange_parallel = A_flange * Math.pow(y_flange, 2); // 평행축 정리
                const I_web = (tw * Math.pow(hw_castellated, 3)) / 12; // 웹 모멘트
                
                // r값을 고려한 필렛 부분 모멘트 감소 (근사 계산)
                // 필렛은 1/4 원형으로 근사, 각 모서리에서 제거되는 면적: A_fillet = r²(1 - π/4) ≈ 0.2146r²
                // 필렛 부분의 모멘트는 작지만, 보정 계수를 사용하여 근사적으로 반영
                // 일반적으로 r값이 작을 때는 영향이 미미하지만, 정확도를 위해 보정 계수 적용
                let I_fillet_correction = 0;
                if (r > 0) {
                    // 필렛 부분 면적 (4개 모서리)
                    const A_fillet_total = 4 * (r * r - Math.PI * r * r / 4); // mm²
                    // 필렛 부분의 모멘트 감소 (근사: 필렛 중심까지 거리를 평균적으로 고려)
                    const y_fillet = (d_castellated - tf) / 2; // 필렛 중심까지 거리 (플랜지 중심과 동일)
                    I_fillet_correction = A_fillet_total * Math.pow(y_fillet, 2); // mm⁴
                }
                
                const Ix_steel = I_flange * 2 + I_flange_parallel * 2 + I_web - I_fillet_correction; // mm⁴
                
                // 원단면(H형강) 단면2차모멘트 계산 (비교용)
                const d_original = d_castellated / 1.5; // mm (원단면 높이)
                const hw_original = d_original - 2 * tf; // mm
                const I_flange_original = (bf * Math.pow(tf, 3)) / 12; // 플랜지 자체 모멘트
                const A_flange_original = bf * tf; // 플랜지 단면적
                const y_flange_original = (d_original - tf) / 2; // 플랜지 중심까지 거리
                const I_flange_parallel_original = A_flange_original * Math.pow(y_flange_original, 2); // 평행축 정리
                const I_web_original = (tw * Math.pow(hw_original, 3)) / 12; // 웹 모멘트
                let I_fillet_correction_original = 0;
                if (r > 0) {
                    const A_fillet_total_original = 4 * (r * r - Math.PI * r * r / 4); // mm²
                    const y_fillet_original = (d_original - tf) / 2;
                    I_fillet_correction_original = A_fillet_total_original * Math.pow(y_fillet_original, 2); // mm⁴
                }
                const Ix_original = I_flange_original * 2 + I_flange_parallel_original * 2 + I_web_original - I_fillet_correction_original; // mm⁴
                
                // 단면적 계산 (원 beam과 castellated beam 동일)
                const A_total = bf * tf * 2 + hw_castellated * tw; // mm²
                if (r > 0) {
                    const A_fillet_total = 4 * (r * r - Math.PI * r * r / 4); // mm²
                    // 단면적에서 필렛 부분 제거는 하지 않음 (근사적으로 무시)
                }
                
                // 단면계수 계산
                const Sx_original = Ix_original / (d_original / 2); // mm³
                const Sx_castellated = Ix_steel / (d_castellated / 2); // mm³
                
                // 회전반경 계산
                const rx_original = Math.sqrt(Ix_original / A_total); // mm
                const rx_castellated = Math.sqrt(Ix_steel / A_total); // mm
                
                // Iy 계산 (Y축 단면2차모멘트)
                const Iy_flange = (tf * Math.pow(bf, 3)) / 12; // 플랜지 Y축 모멘트
                const Iy_web = (hw_castellated * Math.pow(tw, 3)) / 12; // 웹 Y축 모멘트
                const Iy_original = Iy_flange * 2 + Iy_web; // mm⁴
                const Iy_castellated = Iy_original; // Y축은 높이 변화 없으므로 동일
                const ry_original = Math.sqrt(Iy_original / A_total); // mm
                const ry_castellated = ry_original; // Y축 회전반경도 동일
                
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:809',message:'Castellated beam Ix 계산',data:{dc:dc,d_castellated:d_castellated,bf:bf,tf:tf,tw:tw,hw_castellated:hw_castellated,r:r,I_flange:I_flange,A_flange:A_flange,y_flange:y_flange,I_flange_parallel:I_flange_parallel,I_web:I_web,I_fillet_correction:I_fillet_correction,Ix_steel:Ix_steel,Ix_steel_M6:Ix_steel/1e6},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'A'})}).catch(()=>{});
                // #endregion

                // Service stage calculations (사용단계 계산)
                // 합성 전 고정하중: 슬래브 자중 + 철골보 자중
                const w_DL_service = (slabWeight + self_w) * B; // kN/m
                // 합성 후 고정하중: Dead Load (합성 후 추가 고정하중)
                const w_SIDL_service = qD * B; // kN/m
                // 합성 후 활하중: Live Load
                const w_LL_service = qL * B; // kN/m
                // 사용 중 계수하중 (LRFD): max[1.4*(DL+SIDL), 1.2*(DL+SIDL) + 1.6*LL]
                const w_u1_service = 1.4 * (w_DL_service + w_SIDL_service); // kN/m
                const w_u2_service = 1.2 * (w_DL_service + w_SIDL_service) + 1.6 * w_LL_service; // kN/m
                const w_u_service = Math.max(w_u1_service, w_u2_service); // kN/m
                // 사용 중 소요휨강도
                const M_u_service = w_u_service * Math.pow(L, 2) / 8; // kN·m
                // 사용 중 소요전단강도
                const V_u_service = w_u_service * L / 2; // kN
                // 사용 중 소요단면 2차 모멘트 (처짐 제한 L/360 고려)
                const delta_allow_service = (L * 1000) / 360; // mm (L/360)
                const I_req_service = (5 * w_LL_service * Math.pow(L * 1000, 4)) / (384 * Es * delta_allow_service); // mm⁴

                // Shear and moment functions
                function Vx(x) {
                    return 0.5 * wu * L - wu * x;
                }

                function Mx(x) {
                    return 0.5 * wu * x * (L - x);
                }

                // Calculate opening parameters
                // e = 웹 포스트 폭 (개구부 사이 남는 웹 두께 방향 폭) - 입력값
                // W_rect = 개구부 폭 (직사각형 부분) - 계산 필요
                // W_open = 개구부 전체 폭 (직사각형 + 삼각형 부분)
                // p = 개구부 간격 = W_open + e
                const delta_x = (ho * 1000.0) / (2.0 * Math.sqrt(3.0));  // mm
                // p에서 e를 빼면 W_open이 됨: W_open = p - e
                const W_open = p * 1000.0 - e;  // mm (개구부 전체 폭)
                const W_rect = W_open - 2.0 * delta_x;  // mm (개구부 폭, 직사각형 부분)
                const b_wp = e;  // mm (웹 포스트 폭 = e)

                // Number of openings
                // 웹 포스트 폭(e)이 커지면 p = W_open + e가 커지고, 따라서 N = L_open / p가 작아짐
                const L_open = L - 2.0 * end_post;
                const N = Math.round(L_open / p);
                
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:889',message:'개구부 개수 계산',data:{L:L,end_post:end_post,L_open:L_open,p:p,N:N,e:e,W_open:W_open,W_rect:W_rect,b_wp:b_wp},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'A'})}).catch(()=>{});
                // #endregion
                
                const x1 = end_post + 0.5 * p;
                const xs = [];
                for (let i = 0; i < N; i++) {
                    xs.push(x1 + i * p);
                }

                // Tee section properties (these would normally be calculated from section geometry)
                // For now, using placeholder values - these should be calculated based on actual Tee section
                const phiPn = 1553.7;  // kN (placeholder - should be calculated)
                const phiMn_tee_placeholder = 21.47;   // kN·m (placeholder - should be calculated, for opening UR calculation)
                const d_eff = 0.8379;  // m (placeholder - should be calculated)
                const h_top = 0.4189;  // m (placeholder - should be calculated)
                // Mtee 계산: 개구부 폭(W_rect)의 1/4 사용
                // Python 코드의 e는 개구부 폭을 의미하며, 웹포스트 폭(e)이 증가해도
                // 개구부 폭(W_rect)은 변하지 않으므로 UR이 안정적으로 유지됨
                const W_rect_over_4 = (W_rect / 4.0) / 1000.0;  // m (개구부 폭 사용)

                // Calculate for each opening
                const openingResults = [];
                let maxUR = 0;
                let maxURIndex = 0;
                
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:915',message:'UR 계산 시작 (수정 후: W_rect 사용)',data:{N:N,e:e,W_rect:W_rect,W_rect_over_4:W_rect_over_4,phiPn:phiPn,phiMn_tee_placeholder:phiMn_tee_placeholder,d_eff:d_eff},timestamp:Date.now(),sessionId:'debug-session',runId:'post-fix',hypothesisId:'A'})}).catch(()=>{});
                // #endregion
                
                for (let i = 0; i < xs.length; i++) {
                    const x = xs[i];
                    const V = Vx(x);
                    const M = Mx(x);
                    const P = M / d_eff;
                    // Mtee 계산: 개구부 폭(W_rect) 사용 (로그 분석 결과 올바른 방법)
                    // Python 코드의 e는 개구부 폭을 의미하며, 웹포스트 폭(e)이 증가해도
                    // 개구부 폭(W_rect)은 변하지 않으므로 UR이 안정적으로 유지됨
                    const Mtee = Math.abs(V) * W_rect_over_4;  // 개구부 폭 사용
                    const UR = Math.abs(P) / phiPn + Mtee / phiMn_tee_placeholder;
                    
                    // #region agent log
                    // 수정 후 검증을 위한 로그 (W_rect 사용)
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:957',message:'개구부별 UR 계산 (수정 후: W_rect 사용)',data:{i:i+1,x:x,V:V,M:M,P:P,e:e,W_rect:W_rect,W_open:W_open,W_rect_over_4:W_rect_over_4,Mtee:Mtee,UR:UR,phiPn:phiPn,phiMn_tee_placeholder:phiMn_tee_placeholder},timestamp:Date.now(),sessionId:'debug-session',runId:'post-fix',hypothesisId:'A'})}).catch(()=>{});
                    // #endregion
                    
                    openingResults.push({
                        i: i + 1,
                        x: x,
                        V: V,
                        M: M,
                        P: P,
                        Mtee: Mtee,
                        UR: UR
                    });
                    
                    if (UR > maxUR) {
                        maxUR = UR;
                        maxURIndex = i;
                    }
                }

                // Governing opening
                const govOpening = openingResults[maxURIndex];

                // Governing web-post (maximum dP)
                let maxDP = 0;
                let maxDPIndex = 0;
                for (let i = 1; i < openingResults.length; i++) {
                    const dP = Math.abs(openingResults[i].P - openingResults[i-1].P);
                    if (dP > maxDP) {
                        maxDP = dP;
                        maxDPIndex = i;
                    }
                }
                const Vrh = maxDP;
                const webPostPair = [openingResults[maxDPIndex - 1].i, openingResults[maxDPIndex].i];

                // Web-post buckling (DG31)
                // Mp 계산: 개구부 전체 폭(W_open) 사용
                const Mp_webpost = (0.25 * tw * Math.pow(W_open, 2) * Fy) / 1e6;  // kN·m
                const etw = e / tw;  // 웹 포스트 폭비
                const r10 = 0.408;
                const r20 = 0.437;
                let ratio;
                if (etw <= 10) {
                    ratio = r10;
                } else if (etw >= 20) {
                    ratio = r20;
                } else {
                    ratio = r10 + (r20 - r10) * ((etw - 10) / 10);
                }
                const Mocr = ratio * Mp_webpost;
                const phiMocr = phi_b * Mocr;
                const Mrh = Vrh * h_top;
                const buckling_ok = Mrh <= phiMocr;

                // ===== 1. 전단강도 및 Vierendeel 거동검토 =====
                
                // 1.1 전체 전단 강도 검토 (AISC 360 Ch. G)
                // 최대 전단력 (단순지지보)
                const Vu_max = wu * L / 2;  // kN
                
                // 전단 면적
                const Aw = d_castellated * tw;  // mm²
                
                // 전단 좌굴 계수 Cv 계산 (AISC 360 G2)
                const h_tw = hw_castellated / tw;
                const kv = 5.0;  // 웹 판재 좌굴 계수 (stiffener 없음)
                const h_tw_limit = 1.10 * Math.sqrt(kv * Es / Fy);
                
                let Cv = 1.0;
                if (h_tw <= h_tw_limit) {
                    Cv = 1.0;  // 전단 좌굴 없음
                } else {
                    const h_tw_r = 1.37 * Math.sqrt(kv * Es / Fy);
                    if (h_tw <= h_tw_r) {
                        // 비탄성 전단 좌굴
                        Cv = 1.10 * Math.sqrt(kv * Es / Fy) / h_tw;
                    } else {
                        // 탄성 전단 좌굴
                        Cv = 1.51 * kv * Es / (Math.pow(h_tw, 2) * Fy);
                    }
                }
                
                // 공칭 전단 강도 (AISC 360 G2-1)
                const Vn = 0.6 * Fy * Aw * Cv / 1000;  // kN
                
                // 설계 전단 강도 (phi_v는 함수 상단에서 선언됨)
                const phiVn = phi_v * Vn;  // kN
                
                // 전체 전단 강도 판정
                const shear_global_ok = Vu_max <= phiVn;
                const shear_global_UR = Vu_max / phiVn;  // 사용률
                
                // 1.2 Web Post 전단 강도 (DG31)
                // Web post의 전단 면적
                const Aw_webpost = e * tw;  // mm² (Web post 전단 면적)
                
                // Web post 전단 강도 (AISC 360 G2, 웹 post에 적용)
                // Web post는 짧은 구간이므로 전단 좌굴은 고려하지 않음 (보수적)
                const Vn_webpost = 0.6 * Fy * Aw_webpost / 1000;  // kN
                const phiVn_webpost = phi_v * Vn_webpost;  // kN
                
                // Web post 전단 강도 판정
                const shear_webpost_ok = Vrh <= phiVn_webpost;
                const shear_webpost_UR = Vrh / phiVn_webpost;  // 사용률
                
                // ===== 2. 전단파괴모드 검토 (Web Post Failure) =====
                
                // 2.1 Web Post 전단 파괴 모드 분석 (AISC DG31)
                // Web Post의 전단 파괴는 전단 강도와 좌굴에 의해 결정됨
                // 파괴 모드: 1) 전단 강도 파괴, 2) 좌굴 파괴
                
                // Web Post 전단 파괴 모드 판정
                // 전단 강도 파괴: Vrh > φVn_webpost
                // 좌굴 파괴: Mrh > φMocr
                const webpost_shear_failure = Vrh > phiVn_webpost;
                const webpost_buckling_failure = Mrh > phiMocr;
                
                // 지배 파괴 모드 결정
                let webpost_failure_mode = 'None';
                let webpost_failure_mode_kr = '파괴 없음';
                if (webpost_shear_failure && webpost_buckling_failure) {
                    // 두 모드 모두 파괴
                    if (shear_webpost_UR > (Mrh / phiMocr)) {
                        webpost_failure_mode = 'Shear';
                        webpost_failure_mode_kr = '전단 강도 파괴 (지배)';
                    } else {
                        webpost_failure_mode = 'Buckling';
                        webpost_failure_mode_kr = '좌굴 파괴 (지배)';
                    }
                } else if (webpost_shear_failure) {
                    webpost_failure_mode = 'Shear';
                    webpost_failure_mode_kr = '전단 강도 파괴';
                } else if (webpost_buckling_failure) {
                    webpost_failure_mode = 'Buckling';
                    webpost_failure_mode_kr = '좌굴 파괴';
                }
                
                // Web Post 안전성 종합 판정
                const webpost_failure_ok = !webpost_shear_failure && !webpost_buckling_failure;
                
                // Web Post 전단 파괴 모드별 사용률
                const webpost_shear_UR = Vrh / phiVn_webpost;
                const webpost_buckling_UR = Mrh / phiMocr;
                const webpost_max_UR = Math.max(webpost_shear_UR, webpost_buckling_UR);
                
                // Web Post 치수 검토
                // e/tw 비율 검토 (DG31 권장: e/tw ≤ 20)
                const etw_ratio = e / tw;
                const etw_limit = 20.0;
                const etw_ok = etw_ratio <= etw_limit;
                
                // Web Post 높이비 검토 (ho/e 비율, DG31 권장: ho/e ≤ 1.5)
                const ho_e_ratio = (ho * 1000) / e;  // ho는 m 단위이므로 mm로 변환
                const ho_e_limit = 1.5;
                const ho_e_ok = ho_e_ratio <= ho_e_limit;
                
                // ===== 3. 글로벌 휨강도 검토 (Overall Flexural Strength) =====
                // AISC 360 Ch. F + DG31
                
                // 3.1 검토 단면 선정
                // Opening 구간과 Solid web 구간 중 지배 구간 선정
                // Opening 구간: 개구부 중심에서의 모멘트 (지배 개구부 사용)
                const M_opening = govOpening.M;  // kN·m (Opening 구간 모멘트)
                // Solid web 구간: 개구부 사이 중간점에서의 모멘트 (최대 모멘트 구간)
                const M_solid = wu * Math.pow(L, 2) / 8;  // kN·m (단순지지보 최대 모멘트)
                // 지배 구간: 더 큰 모멘트를 받는 구간
                const M_max = Math.max(M_opening, M_solid);  // kN·m
                const governing_section = M_opening > M_solid ? 'Opening 구간' : 'Solid web 구간';
                
                // 3.2 단면 분류 (AISC 360 Table B4.1)
                // 플랜지 slenderness
                const lambda_f = bf / (2 * tf);  // 플랜지 slenderness
                const lambda_pf = 0.38 * Math.sqrt(Es / Fy);  // Compact limit
                const lambda_rf = 1.0 * Math.sqrt(Es / Fy);  // Noncompact limit
                
                const flange_compact = lambda_f <= lambda_pf;
                const flange_noncompact = lambda_f > lambda_pf && lambda_f <= lambda_rf;
                const flange_slender = lambda_f > lambda_rf;
                
                // 웹 slenderness (Castellated beam 전체 높이 기준)
                const lambda_w = hw_castellated / tw;  // 웹 slenderness
                const lambda_pw = 3.76 * Math.sqrt(Es / Fy);  // Compact limit
                const lambda_rw = 5.70 * Math.sqrt(Es / Fy);  // Noncompact limit
                
                const web_compact = lambda_w <= lambda_pw;
                const web_noncompact = lambda_w > lambda_pw && lambda_w <= lambda_rw;
                const web_slender = lambda_w > lambda_rw;
                
                // 단면 분류 결정
                let section_class = 'Compact';
                if (flange_slender || web_slender) {
                    section_class = 'Slender';
                } else if (flange_noncompact || web_noncompact) {
                    section_class = 'Noncompact';
                }
                
                // 3.3 횡비틀림좌굴 검토 (AISC 360 F2)
                // Lp, Lr 계산
                // rts (effective radius of gyration for LTB)
                const rts = Math.sqrt(Math.sqrt(Iy_castellated * Ix_steel) / (Sx_castellated / (d_castellated / 2)));  // mm (근사)
                // ho (flange center-to-center distance)
                const ho_flexural = d_castellated - tf;  // mm
                // J (torsional constant)
                const J = (2 * bf * Math.pow(tf, 3) + hw_castellated * Math.pow(tw, 3)) / 3;  // mm⁴
                // Cw (warping constant)
                const Cw = Iy_castellated * Math.pow(ho_flexural, 2) / 4;  // mm⁶
                
                // Lp (plastic LTB length)
                const Lp = 1.76 * rts * Math.sqrt(Es / Fy) / 1000;  // m
                // Lr (elastic LTB length)
                const FL = 0.7 * Fy;  // MPa (for rolled shapes)
                const Lr = 1.95 * rts * (Es / FL) * Math.sqrt((J / (Sx_castellated * ho_flexural)) + Math.sqrt(Math.pow(J / (Sx_castellated * ho_flexural), 2) + 6.76 * Math.pow(FL / Es, 2))) / 1000;  // m
                
                // Lb (unbraced length) - 보 스팬 전체 (보수적)
                const Lb = L;  // m
                
                // LTB case 결정
                let LTB_case = '';
                if (Lb <= Lp) {
                    LTB_case = 'LTB 비지배 (Lb ≤ Lp)';
                } else if (Lb <= Lr) {
                    LTB_case = '비탄성 LTB (Lp < Lb ≤ Lr)';
                } else {
                    LTB_case = '탄성 LTB (Lb > Lr)';
                }
                
                // 3.4 공칭 휨강도 산정 (AISC 360 F2)
                // 소성 단면계수 Zx 계산 (근사)
                const Zx_castellated = 1.14 * Sx_castellated;  // mm³ (근사, 일반적으로 Zx ≈ 1.14Sx)
                // Mp (plastic moment)
                const Mp_flexural = Zx_castellated * Fy / 1e6;  // kN·m
                
                // Mn 계산 (LTB case에 따라)
                let Mn = 0;
                if (Lb <= Lp) {
                    // LTB 비지배
                    Mn = Mp_flexural;  // kN·m
                } else if (Lb <= Lr) {
                    // 비탄성 LTB
                    const Cb = 1.0;  // 보수적으로 1.0 사용
                    Mn = Cb * (Mp_flexural - (Mp_flexural - 0.7 * Fy * Sx_castellated / 1e6) * ((Lb - Lp) / (Lr - Lp)));  // kN·m
                    Mn = Math.min(Mn, Mp_flexural);  // Mp를 초과할 수 없음
                } else {
                    // 탄성 LTB
                    const Cb = 1.0;  // 보수적으로 1.0 사용
                    const Fcr = (Cb * Math.PI * Math.PI * Es) / (Math.pow(Lb * 1000 / rts, 2));  // MPa
                    Mn = Fcr * Sx_castellated / 1e6;  // kN·m
                    Mn = Math.min(Mn, Mp_flexural);  // Mp를 초과할 수 없음
                }
                
                // 저감계수 (이미 함수 상단에서 선언됨)
                const phiMn = phi_b * Mn;  // kN·m
                
                // 3.5 휨강도 판정
                // 사용단계 최대 모멘트 사용
                const Mu = M_u_service;  // kN·m (사용단계 최대 모멘트)
                const flexural_ok = Mu <= phiMn;
                const flexural_UR = Mu / phiMn;  // 사용률
                
                // ===== 4. 전단 항복 및 전단 좌굴 (Gross Shear Strength) =====
                // 개구부 없는 Web 부분의 전단 항복 및 전단 좌굴 검토 (AISC 360 Ch. G)
                // 특히 지점부 인접 개구부 주의
                
                // 4.1 지점부 인접 개구부 위치 확인
                // 첫 번째 개구부와 마지막 개구부의 위치
                const firstOpeningX = xs.length > 0 ? xs[0] : 0;  // m
                const lastOpeningX = xs.length > 0 ? xs[xs.length - 1] : L;  // m
                const endPostDistance = Math.min(firstOpeningX, L - lastOpeningX);  // m (지점부에서 가장 가까운 개구부까지의 거리)
                const endPostDistance_mm = endPostDistance * 1000;  // mm
                
                // 지점부 인접 개구부 경고 여부 (DG31 권장: 지점부에서 최소 0.5d 이상 이격)
                const minEndPostDistance = 0.5 * d_castellated / 1000;  // m
                const endPostDistance_ok = endPostDistance >= minEndPostDistance;
                
                // 4.2 개구부 없는 Web 부분의 전단 강도 계산
                // Solid web 구간의 전단 면적 (개구부 없는 부분)
                const Aw_solid = d_castellated * tw;  // mm² (전체 높이 기준)
                
                // 지점부에서의 전단력 (최대 전단력)
                const Vu_end = Vu_max;  // kN
                
                // 전단 좌굴 계수 Cv 계산 (AISC 360 G2)
                // h/tw 비율
                const h_tw_solid = hw_castellated / tw;
                const kv_solid = 5.0;  // 웹 판재 좌굴 계수 (stiffener 없음)
                const h_tw_limit_solid = 1.10 * Math.sqrt(kv_solid * Es / Fy);
                const h_tw_limit_elastic = 1.37 * Math.sqrt(kv_solid * Es / Fy);
                
                let Cv_solid = 1.0;
                if (h_tw_solid <= h_tw_limit_solid) {
                    // 전단 항복 지배 (AISC 360 G2-1)
                    Cv_solid = 1.0;
                } else if (h_tw_solid <= h_tw_limit_elastic) {
                    // 전단 좌굴 (비탄성, AISC 360 G2-2)
                    Cv_solid = 1.10 * Math.sqrt(kv_solid * Es / Fy) / h_tw_solid;
                } else {
                    // 전단 좌굴 (탄성, AISC 360 G2-3)
                    Cv_solid = 1.51 * kv_solid * Es / (Fy * Math.pow(h_tw_solid, 2));
                }
                
                // 공칭 전단 강도 (AISC 360 G2-1)
                const Vn_solid = 0.6 * Fy * Aw_solid * Cv_solid / 1000;  // kN
                
                // 설계 전단 강도
                const phiVn_solid = phi_v * Vn_solid;  // kN
                
                // 4.3 전단 강도 판정
                const shear_solid_ok = Vu_end <= phiVn_solid;
                const shear_solid_UR = Vu_end / phiVn_solid;  // 사용률
                
                // 전단 항복 여부 판정
                const shear_yielding = h_tw_solid <= h_tw_limit_solid;
                const shear_buckling = h_tw_solid > h_tw_limit_solid;
                const shear_buckling_elastic = h_tw_solid > h_tw_limit_elastic;
                
                // ===== 5. 개구부 위치 제한 검토 (Geometric Limits) =====
                // AISC Design Guide 31 권장사항
                
                // 5.1 개구부 높이 검토: 0.5h ≤ ho ≤ 0.75h
                const h_total = d_castellated / 1000;  // m (전체 보 높이)
                const ho_min_limit = 0.5 * h_total;  // m
                const ho_max_limit = 0.75 * h_total;  // m
                const ho_geometric_ok = ho >= ho_min_limit && ho <= ho_max_limit;
                
                // 5.2 Web Post 폭 검토: e ≥ 0.25ho
                const e_min_limit = 0.25 * ho * 1000;  // mm (ho는 m 단위이므로 mm로 변환)
                const e_geometric_ok = e >= e_min_limit;
                
                // 5.3 지점부 개구부 이격거리 검토: ≥ 1.5h
                const endPostDistance_min_limit = 1.5 * h_total;  // m
                const endPostDistance_geometric_ok = endPostDistance >= endPostDistance_min_limit;
                
                // 종합 판정
                const geometric_limits_ok = ho_geometric_ok && e_geometric_ok && endPostDistance_geometric_ok;
                
                // 1.3 Vierendeel Bending 검토 (DG31)
                // 지배 개구부에서의 Vierendeel 거동 검토
                const V_tee = govOpening.V;  // kN (개구부 중심의 전단력)
                const M_tee = govOpening.Mtee;  // kN·m (Tee section 모멘트)
                const P_tee = govOpening.P;  // kN (상부 Tee 축력, 압축)
                const P_tee_bottom = -govOpening.P;  // kN (하부 Tee 축력, 인장 또는 압축 반대 방향)
                const UR_tee = govOpening.UR;  // 축+휨 상호작용 사용률
                
                // Tee section 치수
                const h_tee_web = ho * 1000;  // mm (Tee 웹 높이)
                const h_tee_total = h_tee_web + tf;  // mm (Tee 전체 높이)
                const A_tee = bf * tf + h_tee_web * tw;  // mm² (Tee 단면적)
                
                // Tee section 단면2차모멘트 (개구부 중심 기준)
                const Ix_tee = (bf * Math.pow(tf, 3)) / 12 + bf * tf * Math.pow(h_tee_web + tf/2, 2) + (tw * Math.pow(h_tee_web, 3)) / 12;  // mm⁴
                const Sx_tee = Ix_tee / (h_tee_total / 2);  // mm³
                
                // Tee section 휨강도 (AISC 360 F2, 단순화)
                // 소성 단면계수 근사
                const Zx_tee_approx = bf * tf * (h_tee_web + tf/2) + tw * Math.pow(h_tee_web, 2) / 4;  // mm³
                const Mp_tee = Zx_tee_approx * Fy / 1e6;  // kN·m
                const phiMn_tee = 0.9 * Mp_tee;  // kN·m
                
                // Tee section 전단강도
                const Aw_tee = h_tee_web * tw;  // mm² (Tee 웹 전단 면적)
                const Vn_tee = 0.6 * Fy * Aw_tee / 1000;  // kN
                const phiVn_tee = phi_v * Vn_tee;  // kN
                
                // Vierendeel Bending 판정
                const vierendeel_flexural_ok = M_tee <= phiMn_tee;
                const vierendeel_flexural_UR = M_tee / phiMn_tee;
                const vierendeel_shear_ok = V_tee <= phiVn_tee;
                const vierendeel_shear_UR = V_tee / phiVn_tee;
                const vierendeel_ok = vierendeel_flexural_ok && vierendeel_shear_ok;
                
                // Weld design
                const Fexx = 490.0;  // MPa
                const phi_w = 0.75;
                const Aw_req = (Vrh * 1000.0) / (phi_w * 0.6 * Fexx);  // mm²
                const w_req = Aw_req / (0.707 * e);  // mm
                const w_final = Math.ceil(w_req);  // mm

                // Prepare results
                const results = {
                    type: beamType,
                    L: L,
                    B: B,
                    DL: DL,
                    LL: LL,
                    self_w: self_w,  // kN/m²
                    slabWeight: slabWeight,  // kN/m²
                    self_w_kNm: self_w_kNm,  // kN/m
                    wu: wu,
                    Fy: Fy,
                    Es: Es,  // 탄성계수
                    steelGrade: steelGrade,
                    dc: dc,
                    bf: bf,
                    tf: tf,
                    tw: tw,
                    ho: ho,
                    p: p,
                    theta: theta,
                    end_post: end_post,
                    e: e,  // 웹 포스트 폭
                    delta_x: delta_x,
                    W_open: W_open,  // 개구부 전체 폭
                    W_rect: W_rect,  // 개구부 폭 (직사각형 부분)
                    b_wp: b_wp,  // 웹 포스트 폭 (= e)
                    N: N,
                    openingResults: openingResults,
                    govOpening: govOpening,
                    Vrh: Vrh,
                    webPostPair: webPostPair,
                    Mrh: Mrh,
                    Mp: Mp_webpost,
                    etw: etw,
                    ratio: ratio,
                    Mocr: Mocr,
                    phiMocr: phiMocr,
                    buckling_ok: buckling_ok,
                    w_req: w_req,
                    w_final: w_final,
                    ts: ts,
                    // 전단강도 및 Vierendeel 거동검토
                    Vu_max: Vu_max,
                    Aw: Aw,
                    h_tw: h_tw,
                    Cv: Cv,
                    Vn: Vn,
                    phiVn: phiVn,
                    shear_global_ok: shear_global_ok,
                    shear_global_UR: shear_global_UR,
                    Aw_webpost: Aw_webpost,
                    Vn_webpost: Vn_webpost,
                    phiVn_webpost: phiVn_webpost,
                    shear_webpost_ok: shear_webpost_ok,
                    shear_webpost_UR: shear_webpost_UR,
                    V_tee: V_tee,
                    M_tee: M_tee,
                    P_tee: P_tee,
                    P_tee_bottom: P_tee_bottom,
                    UR_tee: UR_tee,
                    h_tee_web: h_tee_web,
                    h_tee_total: h_tee_total,
                    A_tee: A_tee,
                    Ix_tee: Ix_tee,
                    Sx_tee: Sx_tee,
                    Zx_tee_approx: Zx_tee_approx,
                    Mp_tee: Mp_tee,
                    phiMn_tee: phiMn_tee,
                    Aw_tee: Aw_tee,
                    Vn_tee: Vn_tee,
                    phiVn_tee: phiVn_tee,
                    vierendeel_flexural_ok: vierendeel_flexural_ok,
                    vierendeel_flexural_UR: vierendeel_flexural_UR,
                    vierendeel_shear_ok: vierendeel_shear_ok,
                    vierendeel_shear_UR: vierendeel_shear_UR,
                    vierendeel_UR: maxUR,  // 최대 Vierendeel 상호작용 사용률
                    vierendeel_ok: vierendeel_ok,
                    phiPn: phiPn,  // Tee section 축력 강도
                    // 전단파괴모드 검토 (Web Post Failure)
                    webpost_shear_failure: webpost_shear_failure,
                    webpost_buckling_failure: webpost_buckling_failure,
                    webpost_failure_mode: webpost_failure_mode,
                    webpost_failure_mode_kr: webpost_failure_mode_kr,
                    webpost_failure_ok: webpost_failure_ok,
                    webpost_shear_UR: webpost_shear_UR,
                    webpost_buckling_UR: webpost_buckling_UR,
                    webpost_max_UR: webpost_max_UR,
                    buckling_safety_factor: phiMocr / Mrh,  // 좌굴안전율
                    etw_ratio: etw_ratio,
                    etw_limit: etw_limit,
                    etw_ok: etw_ok,
                    ho_e_ratio: ho_e_ratio,
                    ho_e_limit: ho_e_limit,
                    ho_e_ok: ho_e_ok,
                    // 글로벌 휨강도 검토
                    M_opening: M_opening,
                    M_solid: M_solid,
                    M_max: M_max,
                    governing_section: governing_section,
                    lambda_f: lambda_f,
                    lambda_pf: lambda_pf,
                    lambda_rf: lambda_rf,
                    flange_compact: flange_compact,
                    flange_noncompact: flange_noncompact,
                    flange_slender: flange_slender,
                    lambda_w: lambda_w,
                    lambda_pw: lambda_pw,
                    lambda_rw: lambda_rw,
                    web_compact: web_compact,
                    web_noncompact: web_noncompact,
                    web_slender: web_slender,
                    section_class: section_class,
                    rts: rts,
                    ho_flexural: ho_flexural,
                    J: J,
                    Cw: Cw,
                    Lp: Lp,
                    Lr: Lr,
                    Lb: Lb,
                    LTB_case: LTB_case,
                    Zx_castellated: Zx_castellated,
                    Mp_flexural: Mp_flexural,
                    Mn: Mn,
                    phi_b: phi_b,
                    phiMn: phiMn,
                    Mu: Mu,
                    flexural_ok: flexural_ok,
                    flexural_UR: flexural_UR,
                    // 전단 항복 및 전단 좌굴 (Gross Shear Strength)
                    firstOpeningX: firstOpeningX,
                    lastOpeningX: lastOpeningX,
                    endPostDistance: endPostDistance,
                    endPostDistance_mm: endPostDistance_mm,
                    minEndPostDistance: minEndPostDistance,
                    endPostDistance_ok: endPostDistance_ok,
                    Aw_solid: Aw_solid,
                    Vu_end: Vu_end,
                    h_tw_solid: h_tw_solid,
                    kv_solid: kv_solid,
                    h_tw_limit_solid: h_tw_limit_solid,
                    h_tw_limit_elastic: h_tw_limit_elastic,
                    Cv_solid: Cv_solid,
                    Vn_solid: Vn_solid,
                    phiVn_solid: phiVn_solid,
                    shear_solid_ok: shear_solid_ok,
                    shear_solid_UR: shear_solid_UR,
                    shear_yielding: shear_yielding,
                    shear_buckling: shear_buckling,
                    shear_buckling_elastic: shear_buckling_elastic,
                    phi_v: phi_v,  // 저감계수 (전단강도)
                    // 개구부 위치 제한 검토 (Geometric Limits)
                    h_total: h_total,
                    ho_min_limit: ho_min_limit,
                    ho_max_limit: ho_max_limit,
                    ho_geometric_ok: ho_geometric_ok,
                    e_min_limit: e_min_limit,
                    e_geometric_ok: e_geometric_ok,
                    endPostDistance_min_limit: endPostDistance_min_limit,
                    endPostDistance_geometric_ok: endPostDistance_geometric_ok,
                    geometric_limits_ok: geometric_limits_ok,
                    // Composite beam calculations (with-slab type only)
                    composite_calculated: false,
                    // Construction stage results
                    qConst: qConst,
                    w_DL_construction: w_DL_construction,
                    w_CLL_construction: w_CLL_construction,
                    w_u1_construction: w_u1_construction,
                    w_u2_construction: w_u2_construction,
                    w_u_construction: w_u_construction,
                    M_u_construction: M_u_construction,
                    I_req_construction: I_req_construction,
                    Ix_steel: Ix_steel,
                    delta_allow_construction: delta_allow_construction,
                    // Section properties
                    d_original: d_original,
                    Ix_original: Ix_original,
                    Sx_original: Sx_original,
                    rx_original: rx_original,
                    Iy_original: Iy_original,
                    ry_original: ry_original,
                    d_castellated: d_castellated,
                    Sx_castellated: Sx_castellated,
                    rx_castellated: rx_castellated,
                    Iy_castellated: Iy_castellated,
                    ry_castellated: ry_castellated,
                    A_total: A_total,
                    // Service stage results
                    w_DL_service: w_DL_service,
                    w_SIDL_service: w_SIDL_service,
                    w_LL_service: w_LL_service,
                    w_u1_service: w_u1_service,
                    w_u2_service: w_u2_service,
                    w_u_service: w_u_service,
                    M_u_service: M_u_service,
                    V_u_service: V_u_service,
                    I_req_service: I_req_service,
                    delta_allow_service: delta_allow_service
                };

                // Composite beam calculations (for with-slab type only)
                if (results.type === 'with-slab') {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:calculateBeam',message:'Starting composite beam calculations',data:{type:results.type,hasIx_steel:results.Ix_steel!==undefined,hasD_castellated:results.d_castellated!==undefined,hasA_total:results.A_total!==undefined,hasMu:results.Mu!==undefined,ts:ts},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'COMPOSITE'})}).catch(()=>{});
                    // #endregion
                    
                    try {
                        // Read composite beam input values
                        const effectiveWidth = parseFloat(document.getElementById('effectiveWidth')?.value) || 0;
                        const concreteStrength = parseFloat(document.getElementById('concreteStrength')?.value) || 24;
                        const concreteUnitWeight = parseFloat(document.getElementById('concreteUnitWeight')?.value) || 24;
                        const connectorType = document.getElementById('connectorType')?.value || 'Stud';
                        const studDiameter = parseFloat(document.getElementById('studDiameter')?.value) || 19;
                        const studHeight = parseFloat(document.getElementById('studHeight')?.value) || 90;
                        const studFu = parseFloat(document.getElementById('studFu')?.value) || 400;
                        const studRows = parseFloat(document.getElementById('studRows')?.value) || 1;
                        const studSpacing = parseFloat(document.getElementById('studSpacing')?.value) || 0;
                        const useDeckPlate = document.getElementById('useDeckPlate')?.checked || false;
                        const deckThickness = useDeckPlate ? (parseFloat(document.getElementById('deckThickness')?.value) || 0) : 0;
                        const deckDirection = useDeckPlate ? (document.getElementById('deckDirection')?.value || 'perpendicular') : 'none';
                        
                        // #region agent log
                        fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:calculateBeam',message:'Composite inputs read',data:{effectiveWidth:effectiveWidth,concreteStrength:concreteStrength,studDiameter:studDiameter,studRows:studRows,ts:ts},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'COMPOSITE'})}).catch(()=>{});
                        // #endregion
                    
                    // Concrete elastic modulus
                    const Ec = 4700 * Math.sqrt(concreteStrength); // MPa
                    const n = Math.round(Es / Ec); // Modular ratio
                    
                    // Effective width (mm)
                    const beff_mm = effectiveWidth * 1000; // mm
                    
                    // Shear connector strength (AISC I8.1)
                    // Qn = 0.5 * Asa * sqrt(fc * Ec) <= Asa * Fu
                    const studArea = Math.PI * Math.pow(studDiameter / 2, 2); // mm²
                    const Qn_single = 0.5 * studArea * Math.sqrt(concreteStrength * Ec) / 1000; // kN
                    const Qn_max = (studArea * studFu) / 1000; // kN
                    const Qn = Math.min(Qn_single, Qn_max); // kN
                    
                    // Total shear connector strength required
                    // ΣQn = w_u_service * L (for half span)
                    const w_u_service_composite = results.w_u_service || wu; // kN/m
                    const SigmaQn = w_u_service_composite * L; // kN
                    
                    // Number of studs required
                    const n_stud_half = Math.ceil(SigmaQn / (Qn * studRows)); // per half span
                    const n_stud_total = 2 * n_stud_half; // total
                    
                    // Stud spacing calculation
                    const L_half_mm = (L * 1000) / 2; // mm
                    const s_stud_calc = L_half_mm / n_stud_half; // mm
                    
                    // Spacing limits (AISC I8.2)
                    const min_spacing = 6 * studDiameter; // mm
                    const max_spacing_1 = 8 * ts; // mm (8t_slab)
                    const max_spacing_2 = 900; // mm
                    const max_spacing = Math.min(max_spacing_1, max_spacing_2); // mm
                    
                    // Adjust spacing to meet limits
                    let s_stud = Math.floor(s_stud_calc / 10) * 10; // 10mm units
                    if (s_stud < min_spacing) {
                        s_stud = Math.ceil(min_spacing / 10) * 10;
                    } else if (s_stud > max_spacing) {
                        s_stud = Math.floor(max_spacing / 10) * 10;
                    }
                    const spacing_ok = (s_stud >= min_spacing && s_stud <= max_spacing);
                    
                    // Composite section properties (using castellated beam section)
                    // Slab equivalent area
                    const As_slab_equiv = (beff_mm * ts) / n; // mm²
                    results.As_slab_equiv = As_slab_equiv; // Store for comparison
                    
                    // Use Ix_steel (castellated beam moment of inertia)
                    const Ix_castellated = results.Ix_steel || 0; // mm⁴
                    
                    // Composite neutral axis
                    const y_slab_centroid = ts / 2; // mm
                    const y_steel_centroid = results.d_castellated / 2; // mm (castellated depth)
                    const d_composite = results.d_castellated + ts; // mm
                    
                    const y_bar_composite = (As_slab_equiv * y_slab_centroid + results.A_total * (ts + y_steel_centroid)) / (As_slab_equiv + results.A_total);
                    
                    // Composite moment of inertia
                    const I_slab_own = beff_mm * Math.pow(ts, 3) / (12 * n); // mm⁴
                    const d_slab = y_bar_composite - y_slab_centroid;
                    const I_slab = I_slab_own + As_slab_equiv * Math.pow(d_slab, 2);
                    
                    const d_steel = (ts + y_steel_centroid) - y_bar_composite;
                    const Ix_composite = I_slab + Ix_castellated + results.A_total * Math.pow(d_steel, 2); // mm⁴
                    
                    // Composite section modulus
                    const y_top_composite = y_bar_composite;
                    const y_bottom_composite = d_composite - y_bar_composite;
                    const Sx_composite_top = Ix_composite / y_top_composite; // mm³
                    const Sx_composite_bottom = Ix_composite / y_bottom_composite; // mm³
                    const Sx_composite = Math.min(Sx_composite_top, Sx_composite_bottom); // mm³
                    
                    // Plastic moment capacity (AISC I3.3)
                    const C_slab = 0.85 * concreteStrength * beff_mm * ts / 1000; // kN
                    const T_steel = Fy * results.A_total / 1000; // kN
                    
                    // 합성 정도 계산
                    const composite_degree = C_slab / T_steel; // 합성 정도 (1.0 이상이면 완전 합성)
                    let composite_degree_kr = '';
                    if (composite_degree >= 1.0) {
                        composite_degree_kr = '완전 합성';
                    } else if (composite_degree >= 0.5) {
                        composite_degree_kr = '부분 합성';
                    } else {
                        composite_degree_kr = '미합성';
                    }
                    
                    let Mn_composite;
                    let y_pna;
                    let failure_mode_composite = '';
                    if (C_slab >= T_steel) {
                        // PNA in slab
                        const a = T_steel / (0.85 * concreteStrength * beff_mm / 1000); // mm
                        y_pna = a / 2; // from top of slab
                        const d_arm = (results.d_castellated + ts) / 2 - y_pna; // moment arm
                        Mn_composite = T_steel * d_arm / 1000; // kN·m
                        failure_mode_composite = '슬래브 압축 파괴';
                    } else {
                        // PNA in steel (simplified)
                        y_pna = ts + results.d_castellated / 2;
                        Mn_composite = C_slab * (results.d_castellated + ts) / 2 / 1000; // kN·m
                        failure_mode_composite = '강재 인장 파괴';
                    }
                    
                    // Flexural strength
                    const phiMn_composite = phi_b * Mn_composite; // kN·m
                    const flexuralRatio_composite = results.Mu / phiMn_composite;
                    const flexural_ok_composite = flexuralRatio_composite <= 1.0;
                    
                        // Add composite results to results object
                        results.composite_calculated = true;
                        results.effectiveWidth = effectiveWidth;
                        results.concreteStrength = concreteStrength;
                        results.concreteUnitWeight = concreteUnitWeight;
                        results.connectorType = connectorType;
                        results.studDiameter = studDiameter;
                        results.studHeight = studHeight;
                        results.studFu = studFu;
                        results.studRows = studRows;
                        results.studSpacing = studSpacing;
                        results.useDeckPlate = useDeckPlate;
                        results.deckThickness = deckThickness;
                        results.deckDirection = deckDirection;
                        results.Ec = Ec;
                        results.n = n;
                        results.beff_mm = beff_mm;
                        results.Qn = Qn;
                        results.Qn_max = Qn_max;
                        results.Qn_single = Qn_single;
                        results.SigmaQn = SigmaQn;
                        results.n_stud_half = n_stud_half;
                        results.n_stud_total = n_stud_total;
                        results.s_stud_calc = s_stud_calc;
                        results.s_stud = s_stud;
                        results.min_spacing = min_spacing;
                        results.max_spacing = max_spacing;
                        results.spacing_ok = spacing_ok;
                        results.Ix_composite = Ix_composite;
                        results.Sx_composite = Sx_composite;
                        results.y_bar_composite = y_bar_composite;
                        results.y_pna = y_pna;
                        results.Mn_composite = Mn_composite;
                        results.phiMn_composite = phiMn_composite;
                        results.flexuralRatio_composite = flexuralRatio_composite;
                        results.flexural_ok_composite = flexural_ok_composite;
                        results.composite_degree = composite_degree;
                        results.composite_degree_kr = composite_degree_kr;
                        results.failure_mode_composite = failure_mode_composite;
                        results.C_slab = C_slab;
                        results.T_steel = T_steel;
                        
                        // ===== B.6 슬래브에 의한 전단강도 검토 (Composite Beam) =====
                        // Composite beam의 전단강도는 steel beam만 고려 (AISC I3.1)
                        // 계수하중은 비합성보와 동일 (DL에 이미 슬래브 자중이 포함되어 있음)
                        const w_slab = concreteUnitWeight * beff_mm * ts / 1e6; // kN/m (슬래브 자중, 참고용)
                        const w_u_composite = wu; // kN/m (계수하중은 비합성보와 동일)
                        const Vu_max_composite = w_u_composite * L / 2; // kN
                        
                        // Composite beam 전단강도 (steel beam 전단강도와 동일)
                        const Vn_composite = results.Vn; // kN (steel beam 전단강도)
                        const phiVn_composite = results.phiVn; // kN
                        
                        // Composite beam 전단강도 판정
                        const shear_composite_ok = Vu_max_composite <= phiVn_composite;
                        const shear_composite_UR = Vu_max_composite / phiVn_composite;
                        
                        // ===== B.7 Vierendeel 휨 검토 (Composite Beam) =====
                        // Composite beam의 Vierendeel bending은 중립축 상승으로 인해 상부 Tee 휨응력이 감소
                        // 중립축이 상승하면서 상부 Tee까지의 거리가 줄어들어 휨응력이 감소
                        // 중립축 상승 비율: (y_bar_composite - d_castellated/2) / (d_castellated/2)
                        const y_bar_noncomposite = results.d_castellated / 2; // 비합성보 중립축 (mm)
                        const neutral_axis_shift_ratio = (results.y_bar_composite - y_bar_noncomposite) / y_bar_noncomposite; // 중립축 상승 비율
                        // 상부 Tee 휨응력 감소: 중립축 상승으로 인해 상부 Tee까지의 거리가 줄어듦
                        // 휨응력은 중립축까지의 거리에 비례하므로, 중립축이 상승하면 상부 Tee의 휨응력은 감소
                        const flexural_stress_reduction_factor = 1.0 - Math.abs(neutral_axis_shift_ratio) * 0.5; // 휨응력 감소 계수 (최대 50% 감소)
                        const M_tee_composite = results.M_tee * Math.max(flexural_stress_reduction_factor, 0.5); // kN·m (최소 50% 유지)
                        
                        // #region agent log
                        fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:B.7-Vierendeel',message:'상부 Tee 휨응력 감소 계산',data:{M_tee_noncomposite:results.M_tee,M_tee_composite:M_tee_composite,y_bar_noncomposite:y_bar_noncomposite,y_bar_composite:results.y_bar_composite,neutral_axis_shift_ratio:neutral_axis_shift_ratio,flexural_stress_reduction_factor:flexural_stress_reduction_factor,reduction_percent:(1-Math.max(flexural_stress_reduction_factor,0.5))*100,M_tee_change:M_tee_composite-results.M_tee,M_tee_change_percent:((M_tee_composite-results.M_tee)/results.M_tee*100)},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'TEE_FLEXURAL_REDUCTION'})}).catch(()=>{});
                        // #endregion
                        const V_tee_composite = results.V_tee * (w_u_composite / wu); // kN (전단력은 하중 비례)
                        // 상부 Tee 축압축력 증가: 합성 작용으로 슬래브가 압축을 담당하면서 상부 Tee에도 추가 압축력이 작용
                        // 중립축이 상승하면서 상부 Tee까지의 거리가 줄어들지만, 슬래브 압축력이 상부 Tee로 전달되어 축압축력은 증가
                        const axial_compression_increase_factor = 1.0 + Math.abs(neutral_axis_shift_ratio) * 0.3; // 축압축력 증가 계수 (최대 30% 증가)
                        const P_tee_composite = results.P_tee * axial_compression_increase_factor; // kN (상부 Tee 축압축력 증가)
                        
                        // 하부 Tee 축력 감소: 합성 작용으로 중립축이 상승하면서 하부 Tee의 축력(인장 또는 압축)이 감소
                        // 중립축 상승으로 인해 하부 Tee까지의 거리가 줄어들어 축력이 감소
                        const axial_tension_reduction_factor = 1.0 - Math.abs(neutral_axis_shift_ratio) * 0.3; // 하부 Tee 축력 감소 계수 (최대 30% 감소)
                        const P_tee_bottom_composite = results.P_tee_bottom * Math.max(axial_tension_reduction_factor, 0.5); // kN (하부 Tee 축력 감소, 최소 50% 유지)
                        
                        // #region agent log
                        fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:B.7-Vierendeel',message:'상부Tee 압축력 증가 계산',data:{P_tee_noncomposite:results.P_tee,P_tee_composite:P_tee_composite,axial_compression_increase_factor:axial_compression_increase_factor,neutral_axis_shift_ratio:neutral_axis_shift_ratio,increase_percent:(axial_compression_increase_factor-1.0)*100,P_tee_change:P_tee_composite-results.P_tee,P_tee_change_percent:((P_tee_composite-results.P_tee)/Math.abs(results.P_tee)*100),calculation_formula:`${results.P_tee} × ${axial_compression_increase_factor} = ${P_tee_composite}`},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'TEE_AXIAL_COMPRESSION'})}).catch(()=>{});
                        fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:B.7-Vierendeel',message:'하부Tee 축력 감소 계산',data:{P_tee_bottom_noncomposite:results.P_tee_bottom,P_tee_bottom_composite:P_tee_bottom_composite,axial_tension_reduction_factor:axial_tension_reduction_factor,neutral_axis_shift_ratio:neutral_axis_shift_ratio,reduction_percent:(1.0-Math.max(axial_tension_reduction_factor,0.5))*100,P_tee_bottom_change:P_tee_bottom_composite-results.P_tee_bottom,P_tee_bottom_change_percent:((P_tee_bottom_composite-results.P_tee_bottom)/Math.abs(results.P_tee_bottom)*100),calculation_formula:`${results.P_tee_bottom} × ${Math.max(axial_tension_reduction_factor,0.5)} = ${P_tee_bottom_composite}`},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'TEE_BOTTOM_AXIAL'})}).catch(()=>{});
                        // #endregion
                        
                        // Tee section 강도는 동일 (steel beam)
                        const vierendeel_flexural_ok_composite = M_tee_composite <= results.phiMn_tee;
                        const vierendeel_flexural_UR_composite = M_tee_composite / results.phiMn_tee;
                        const vierendeel_shear_ok_composite = V_tee_composite <= results.phiVn_tee;
                        const vierendeel_shear_UR_composite = V_tee_composite / results.phiVn_tee;
                        const vierendeel_ok_composite = vierendeel_flexural_ok_composite && vierendeel_shear_ok_composite;
                        
                        // Tee 축+휨 상호작용 (AISC H1)
                        // phiPn과 phiMn_tee는 동일하므로 UR만 재계산
                        const phiPn_tee = results.phiPn || 1553.7; // kN (Tee section 축력 강도)
                        const UR_tee_composite = Math.abs(P_tee_composite) / phiPn_tee + M_tee_composite / results.phiMn_tee;
                        
                        // ===== B.8 웹포스트 검토 (Composite Beam) =====
                        // Composite beam의 웹포스트 검토는 하중 증가 및 합성 작용에 따른 재검토
                        // Web post 압축력 증가: 하중 증가 + 중립축 상승으로 인한 추가 압축력 증가
                        // 중립축 상승으로 인해 Web post에 더 많은 압축력이 전달됨
                        const webpost_compression_increase_factor = 1.0 + Math.abs(neutral_axis_shift_ratio) * 0.2; // Web post 압축력 증가 계수 (최대 20% 추가 증가)
                        const Vrh_composite = results.Vrh * (w_u_composite / wu) * webpost_compression_increase_factor; // kN (하중 증가 + 합성 작용 증가)
                        const Mrh_composite = results.Mrh * (w_u_composite / wu) * webpost_compression_increase_factor; // kN·m
                        
                        // #region agent log
                        fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:B.8-WebPost',message:'Web Post 압축력 증가 계산',data:{Vrh_noncomposite:results.Vrh,Vrh_composite:Vrh_composite,webpost_compression_increase_factor:webpost_compression_increase_factor,neutral_axis_shift_ratio:neutral_axis_shift_ratio,load_ratio:w_u_composite/wu,increase_percent:(webpost_compression_increase_factor-1.0)*100,Vrh_change:Vrh_composite-results.Vrh,Vrh_change_percent:((Vrh_composite-results.Vrh)/results.Vrh*100),calculation_formula:`${results.Vrh} × (${w_u_composite}/${wu}) × ${webpost_compression_increase_factor} = ${Vrh_composite}`},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'WEBPOST_COMPRESSION'})}).catch(()=>{});
                        // #endregion
                        
                        // 웹포스트 전단강도 판정 (강도는 동일)
                        const shear_webpost_ok_composite = Vrh_composite <= phiVn_webpost;
                        const shear_webpost_UR_composite = Vrh_composite / phiVn_webpost;
                        
                        // 웹포스트 좌굴 판정
                        // 합성보에서 좌굴 강도는 단면 특성에 의존하므로 동일하지만, 
                        // 합성 작용으로 인한 추가 압축력이 좌굴 거동에 영향을 줄 수 있음
                        // 좌굴 강도는 동일하지만, 좌굴 사용률과 안전율은 합성보에서 더 불리함
                        const phiMocr_composite = results.phiMocr; // 좌굴 강도는 동일 (단면 특성 의존)
                        const buckling_ok_composite = Mrh_composite <= phiMocr_composite;
                        const buckling_UR_composite = Mrh_composite / phiMocr_composite;
                        const webpost_ok_composite = shear_webpost_ok_composite && buckling_ok_composite;
                        const webpost_max_UR_composite = Math.max(shear_webpost_UR_composite, buckling_UR_composite);
                        
                        // 좌굴안전율 계산 (phiMocr / Mrh)
                        const buckling_safety_factor = results.phiMocr / results.Mrh;
                        const buckling_safety_factor_composite = phiMocr_composite / Mrh_composite;
                        
                        // 좌굴 강도 차이 (비합성보와 합성보 비교)
                        const phiMocr_difference = phiMocr_composite - results.phiMocr; // 일반적으로 0 (동일)
                        results.phiMocr_composite = phiMocr_composite;
                        results.phiMocr_difference = phiMocr_difference;
                        
                        // #region agent log
                        fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:B.8-WebPost',message:'Web Post 좌굴 강도 계산',data:{phiMocr_noncomposite:results.phiMocr,phiMocr_composite:phiMocr_composite,phiMocr_difference:phiMocr_difference,Mrh_noncomposite:results.Mrh,Mrh_composite:Mrh_composite,buckling_UR_noncomposite:results.webpost_buckling_UR,buckling_UR_composite:buckling_UR_composite,buckling_safety_factor_noncomposite:buckling_safety_factor,buckling_safety_factor_composite:buckling_safety_factor_composite},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'WEBPOST_BUCKLING'})}).catch(()=>{});
                        // #endregion
                        
                        // ===== B.9 장기처짐 검토 (Long-term Deflection) =====
                        // AISC I3.1b, ACI 318 크리프 및 수축 고려
                        // 즉시처짐 (Immediate Deflection)
                        const E_composite = Es; // Steel elastic modulus
                        const I_eff_composite = Ix_composite; // mm⁴ (composite moment of inertia)
                        const delta_immediate = (5 * w_u_service_composite * Math.pow(L * 1000, 4)) / (384 * E_composite * I_eff_composite); // mm
                        
                        // 장기처짐 계수 (크리프 및 수축)
                        // ACI 318: λ = ξ / (1 + 50ρ') where ξ = 2.0 for 5 years, ρ' = 0 (no compression reinforcement)
                        const xi = 2.0; // 5년 후 크리프 계수
                        const rho_prime = 0; // 압축 철근 비율 (없음)
                        const lambda = xi / (1 + 50 * rho_prime); // 장기처짐 계수
                        
                        // 장기처짐 (Long-term Deflection)
                        // 슬래브 하중에 대한 장기처짐만 고려 (DL + SIDL)
                        const w_DL_composite = w_DL_service + w_SIDL_service; // kN/m
                        const delta_longterm = lambda * (5 * w_DL_composite * Math.pow(L * 1000, 4)) / (384 * E_composite * I_eff_composite); // mm
                        
                        // 총 처짐
                        const delta_total = delta_immediate + delta_longterm; // mm
                        
                        // 허용 처짐 (AISC I3.1b: L/360 for LL, L/240 for total)
                        const delta_allow_LL = (L * 1000) / 360; // mm
                        const delta_allow_total = (L * 1000) / 240; // mm
                        
                        // 처짐 판정
                        const deflection_LL_ok = delta_immediate <= delta_allow_LL;
                        const deflection_total_ok = delta_total <= delta_allow_total;
                        const deflection_ok = deflection_LL_ok && deflection_total_ok;
                        
                        // Composite beam 추가 결과 저장
                        results.w_slab = w_slab;
                        results.w_u_composite = w_u_composite;
                        results.Vu_max_composite = Vu_max_composite;
                        results.Vn_composite = Vn_composite;
                        results.phiVn_composite = phiVn_composite;
                        results.shear_composite_ok = shear_composite_ok;
                        results.shear_composite_UR = shear_composite_UR;
                        results.M_tee_composite = M_tee_composite;
                        results.V_tee_composite = V_tee_composite;
                        results.P_tee_composite = P_tee_composite;
                        results.P_tee_bottom_composite = P_tee_bottom_composite;
                        results.axial_tension_reduction_factor = axial_tension_reduction_factor;
                        results.y_bar_noncomposite = y_bar_noncomposite;
                        results.neutral_axis_shift_ratio = neutral_axis_shift_ratio;
                        results.flexural_stress_reduction_factor = flexural_stress_reduction_factor;
                        results.axial_compression_increase_factor = axial_compression_increase_factor;
                        results.webpost_compression_increase_factor = webpost_compression_increase_factor;
                        
                        // 하부 Tee 인장응력 계산 (σ = M / S)
                        const tensile_stress_noncomposite = (results.M_tee * 1e6) / results.Sx_tee; // MPa (비합성보)
                        const tensile_stress_composite = (results.M_tee_composite * 1e6) / results.Sx_tee; // MPa (합성보)
                        results.tensile_stress_noncomposite = tensile_stress_noncomposite;
                        results.tensile_stress_composite = tensile_stress_composite;
                        results.UR_tee_composite = UR_tee_composite;
                        results.vierendeel_UR_composite = UR_tee_composite;  // Vierendeel 상호작용 사용률 (composite)
                        results.vierendeel_flexural_ok_composite = vierendeel_flexural_ok_composite;
                        results.vierendeel_flexural_UR_composite = vierendeel_flexural_UR_composite;
                        results.vierendeel_shear_ok_composite = vierendeel_shear_ok_composite;
                        results.vierendeel_shear_UR_composite = vierendeel_shear_UR_composite;
                        results.vierendeel_ok_composite = vierendeel_ok_composite;
                        results.phiPn_tee = phiPn_tee;
                        results.Vrh_composite = Vrh_composite;
                        results.Mrh_composite = Mrh_composite;
                        results.shear_webpost_ok_composite = shear_webpost_ok_composite;
                        results.shear_webpost_UR_composite = shear_webpost_UR_composite;
                        results.buckling_ok_composite = buckling_ok_composite;
                        results.buckling_UR_composite = buckling_UR_composite;
                        results.webpost_ok_composite = webpost_ok_composite;
                        results.webpost_max_UR_composite = webpost_max_UR_composite;
                        results.buckling_safety_factor = buckling_safety_factor;
                        results.buckling_safety_factor_composite = buckling_safety_factor_composite;
                        results.delta_immediate = delta_immediate;
                        results.delta_longterm = delta_longterm;
                        results.delta_total = delta_total;
                        results.delta_allow_LL = delta_allow_LL;
                        results.delta_allow_total = delta_allow_total;
                        results.deflection_LL_ok = deflection_LL_ok;
                        results.deflection_total_ok = deflection_total_ok;
                        results.deflection_ok = deflection_ok;
                        results.lambda = lambda;
                        
                        // #region agent log
                        fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:calculateBeam',message:'Composite beam calculations completed',data:{Qn:Qn,SigmaQn:SigmaQn,n_stud_total:n_stud_total,phiMn_composite:phiMn_composite,flexuralRatio_composite:flexuralRatio_composite,shear_composite_ok:shear_composite_ok,vierendeel_ok_composite:vierendeel_ok_composite,webpost_ok_composite:webpost_ok_composite,deflection_ok:deflection_ok,composite_calculated:results.composite_calculated},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'COMPOSITE'})}).catch(()=>{});
                        // #endregion
                    } catch (compositeError) {
                        // #region agent log
                        fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:calculateBeam',message:'Composite beam calculation error',data:{error:compositeError.message,stack:compositeError.stack,name:compositeError.name},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'COMPOSITE'})}).catch(()=>{});
                        // #endregion
                        console.error('합성보 계산 중 오류:', compositeError);
                        results.composite_calculated = false;
                    }
                }

                // #region agent log
                console.log('[DEBUG] About to call displayResults', {
                    hasResults: !!results,
                    resultsKeys: results ? Object.keys(results) : [],
                    resultsType: typeof results
                });
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:calculateBeam',message:'About to call displayResults',data:{hasResults:!!results,resultsKeys:results?Object.keys(results):[],resultsType:typeof results},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'CALC'})}).catch((err)=>{console.error('Log fetch error:',err);});
                // #endregion

                displayResults(results);
                
                // #region agent log
                console.log('[DEBUG] displayResults call completed');
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:calculateBeam',message:'displayResults call completed',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'CALC'})}).catch((err)=>{console.error('Log fetch error:',err);});
                // #endregion
            } catch (error) {
                // #region agent log
                console.error('[ERROR] Calculation error:', error);
                console.error('[ERROR] Error stack:', error.stack);
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:calculateBeam',message:'Calculation error caught',data:{errorMessage:error.message,errorStack:error.stack,errorName:error.name},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'ERROR'})}).catch((err)=>{console.error('Log fetch error:',err);});
                // #endregion
                console.error('Calculation error:', error);
                alert('계산 중 오류가 발생했습니다: ' + error.message);
            }
        }

        // Display results
        function displayResults(results) {
            // #region agent log
            console.log('[DEBUG] displayResults called', {hasResults:!!results,resultsKeys:results?Object.keys(results):[]});
            fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:displayResults',message:'displayResults function called',data:{hasResults:!!results,resultsKeys:results?Object.keys(results):[]},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'IMAGE'})}).catch((err)=>{console.error('Log fetch error:',err);});
            // #endregion
            
            let container = document.getElementById('resultsContainer');
            let noResults = document.getElementById('noResults');

            if (!container || !noResults) {
                // If elements are missing, it might be due to a previous image conversion.
                // Recreate them if the right-section already contains an image.
                const rightSection = document.querySelector('.right-section');
                if (rightSection && rightSection.querySelector('img')) {
                    rightSection.innerHTML = `
                        <div class="section-title">계산 결과</div>
                        <div id="resultsContainer" class="results-container">
                            <div id="noResults" style="text-align: center; padding: 60px 20px; color: #94a3b8;">
                                <p style="font-size: 16px; margin-bottom: 10px;">계산 결과가 여기에 표시됩니다</p>
                                <p style="font-size: 12px;">좌측 입력값을 입력하고 "계산하기" 버튼을 클릭하세요</p>
                            </div>
                        </div>
                    `;
                    // Re-get references after recreating
                    container = document.getElementById('resultsContainer');
                    noResults = document.getElementById('noResults');
                }
                if (!container || !noResults) {
                // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:displayResults',message:'DOM elements not found after recreation attempt',data:{container:!!container,noResults:!!noResults},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'H_RECREATE'})}).catch(()=>{});
                // #endregion
                    alert('결과 표시 영역을 찾을 수 없습니다.');
                return;
                }
            }

            container.classList.add('active');
            if (noResults) {
                noResults.style.display = 'none';
            }

            // #region agent log
            fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:displayResults',message:'Checking composite section display condition',data:{type:results.type,composite_calculated:results.composite_calculated,shouldDisplay:results.type === 'with-slab' && results.composite_calculated,hasEffectiveWidth:results.effectiveWidth!==undefined,hasQn:results.Qn!==undefined,hasPhiMn_composite:results.phiMn_composite!==undefined},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'DISPLAY'})}).catch(()=>{});
            // #endregion

            // Create opening results table
            let openingTableRows = '';
            results.openingResults.forEach(op => {
                const urStatus = op.UR <= 1.0 ? 'status-ok' : 'status-ng';
                openingTableRows += `
                    <tr>
                        <td>${op.i}</td>
                        <td>${formatNumber(op.x, 2)}</td>
                        <td>${formatNumber(op.V, 2)}</td>
                        <td>${formatNumber(op.M, 2)}</td>
                        <td>${formatNumber(op.P, 2)}</td>
                        <td>${formatNumber(op.Mtee, 2)}</td>
                        <td class="result-value ${urStatus}">${formatNumber(op.UR, 3)}</td>
                    </tr>
                `;
            });

            // #region agent log - Debug NG display
            fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:1108',message:'displayResults called',data:{shear_webpost_ok:results.shear_webpost_ok,buckling_ok:results.buckling_ok,webpost_failure_ok:results.webpost_failure_ok},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'A'})}).catch(()=>{});
            // #endregion
            
            // #region agent log
            fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:displayResults',message:'Building HTML content with section A',data:{type:results.type,hasCompositeCalculated:results.composite_calculated!==undefined,composite_calculated:results.composite_calculated},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'HTML'})}).catch(()=>{});
            // #endregion
            
            // #region agent log
            fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:displayResults',message:'Before setting container.innerHTML',data:{type:results.type,composite_calculated:results.composite_calculated,shouldDisplayC:results.type === 'with-slab' && results.composite_calculated},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'C_SECTION'})}).catch(()=>{});
            // #endregion
            
            container.innerHTML = `
                <!-- A. 전단연결재와 슬래브 체결전 -->
                <div class="result-section">
                    <div class="result-section-title" style="font-size: 18px; font-weight: 700; color: #1e3a5f; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #3b82f6;">A. 전단연결재와 슬래브 체결전</div>
                    
                    <div style="font-size: 11px; color: #64748b; margin-bottom: 15px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                        <strong>검토 내용:</strong> 전단연결재와 슬래브를 체결하기 전의 Castellated Beam 구조계산을 수행합니다.
                    </div>
                </div>
                
                <!-- A.1 전단강도 및 Vierendeel 거동검토 -->
                <div class="result-section">
                    <div class="result-section-title" style="font-size: 18px; font-weight: 700; color: #1e3a5f; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #3b82f6;">A.1 전단강도 및 Vierendeel 거동검토</div>
                    
                    <!-- A.1.1 전체 전단 강도 검토 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">A.1.1 전체 전단 강도 검토 (AISC 360 Ch. G)</h4>
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 10px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                            <strong>검토 내용:</strong> Castellated beam의 전체 전단 강도를 검토합니다. (AISC 360 Ch. G)<br>
                            <strong>계산식:</strong> V<sub>n</sub> = 0.6F<sub>y</sub>A<sub>w</sub>C<sub>v</sub>, 판정: V<sub>u</sub> ≤ φV<sub>n</sub> (φ = 0.90)
                        </div>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>단위</th>
                            </tr>
                            <tr>
                                <td>최대 전단력 (V<sub>u</sub>)</td>
                                <td class="result-value">${formatNumber(results.Vu_max, 2)}</td>
                                <td>kN</td>
                            </tr>
                            <tr>
                                <td>전단 면적 (A<sub>w</sub>)</td>
                                <td class="result-value">${formatNumber(results.Aw, 1)}</td>
                                <td>mm²</td>
                            </tr>
                            <tr>
                                <td>h/t<sub>w</sub></td>
                                <td class="result-value">${formatNumber(results.h_tw, 2)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>전단 좌굴 계수 (C<sub>v</sub>)</td>
                                <td class="result-value">${formatNumber(results.Cv, 3)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>공칭 전단 강도 (V<sub>n</sub>)</td>
                                <td class="result-value">${formatNumber(results.Vn, 2)}</td>
                                <td>kN</td>
                            </tr>
                            <tr>
                                <td>설계 전단 강도 (φV<sub>n</sub>)</td>
                                <td class="result-value" style="font-weight: 600;">${formatNumber(results.phiVn, 2)}</td>
                                <td>kN</td>
                            </tr>
                            <tr>
                                <td>사용률</td>
                                <td class="result-value ${results.shear_global_ok ? 'status-ok' : 'status-ng'}">${formatNumber(results.shear_global_UR, 3)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>판정</td>
                                <td class="result-value ${results.shear_global_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.shear_global_ok ? '✅ 만족 (V<sub>u</sub> ≤ φV<sub>n</sub>)' : '❌ 불만족 (V<sub>u</sub> > φV<sub>n</sub>)'}
                                </td>
                                <td>-</td>
                            </tr>
                        </table>
                    </div>
                    
                    <!-- A.1.2 Web Post 전단 강도 검토 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">A.1.2 Web Post 전단 강도 검토 (AISC DG31)</h4>
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 10px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                            <strong>검토 내용:</strong> Web Post의 전단 강도를 검토합니다. (AISC DG31)<br>
                            <strong>계산식:</strong> V<sub>n,webpost</sub> = 0.6F<sub>y</sub>A<sub>w,webpost</sub>, 판정: V<sub>rh</sub> ≤ φV<sub>n,webpost</sub>
                        </div>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>단위</th>
                            </tr>
                            <tr>
                                <td>Web Post 전단력 (V<sub>rh</sub>)</td>
                                <td class="result-value">${formatNumber(results.Vrh, 2)}</td>
                                <td>kN</td>
                            </tr>
                            <tr>
                                <td>Web Post 전단 면적 (A<sub>w,webpost</sub>)</td>
                                <td class="result-value">${formatNumber(results.Aw_webpost, 1)}</td>
                                <td>mm²</td>
                            </tr>
                            <tr>
                                <td>공칭 전단 강도 (V<sub>n,webpost</sub>)</td>
                                <td class="result-value">${formatNumber(results.Vn_webpost, 2)}</td>
                                <td>kN</td>
                            </tr>
                            <tr>
                                <td>설계 전단 강도 (φV<sub>n,webpost</sub>)</td>
                                <td class="result-value" style="font-weight: 600;">${formatNumber(results.phiVn_webpost, 2)}</td>
                                <td>kN</td>
                            </tr>
                            <tr>
                                <td>사용률</td>
                                <td class="result-value ${results.shear_webpost_ok ? 'status-ok' : 'status-ng'}">${formatNumber(results.shear_webpost_UR, 3)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>판정</td>
                                <td class="result-value ${results.shear_webpost_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.shear_webpost_ok ? '✅ 만족 (V<sub>rh</sub> ≤ φV<sub>n,webpost</sub>)' : '❌ 불만족 (V<sub>rh</sub> > φV<sub>n,webpost</sub>)'}
                                </td>
                                <td>-</td>
                            </tr>
                        </table>
                    </div>
                    
                    <!-- A.1.3 Vierendeel Bending 검토 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">A.1.3 Vierendeel Bending 검토 (AISC DG31)</h4>
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 10px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                            <strong>검토 내용:</strong> Opening 상·하부 Tee section의 Vierendeel 거동을 검토합니다. (AISC DG31 Section 3.1)<br>
                            <strong>검토 항목:</strong> Tee section의 휨강도 및 전단강도 검토
                        </div>
                        
                        <h5 style="font-size: 13px; font-weight: 600; color: #475569; margin-top: 15px; margin-bottom: 8px;">Tee Section 휨강도 검토</h5>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>단위</th>
                            </tr>
                            <tr>
                                <td>Tee 모멘트 (M<sub>tee</sub>)</td>
                                <td class="result-value">${formatNumber(results.M_tee, 2)}</td>
                                <td>kN·m</td>
                            </tr>
                            <tr>
                                <td>Tee 단면적 (A<sub>tee</sub>)</td>
                                <td class="result-value">${formatNumber(results.A_tee, 1)}</td>
                                <td>mm²</td>
                            </tr>
                            <tr>
                                <td>Tee 단면2차모멘트 (I<sub>x,tee</sub>)</td>
                                <td class="result-value">${formatNumber(results.Ix_tee / 1e6, 2)}</td>
                                <td>×10⁶ mm⁴</td>
                            </tr>
                            <tr>
                                <td>Tee 단면계수 (S<sub>x,tee</sub>)</td>
                                <td class="result-value">${formatNumber(results.Sx_tee / 1e3, 1)}</td>
                                <td>×10³ mm³</td>
                            </tr>
                            <tr>
                                <td>소성 단면계수 (Z<sub>x,tee</sub>)</td>
                                <td class="result-value">${formatNumber(results.Zx_tee_approx / 1e3, 1)}</td>
                                <td>×10³ mm³</td>
                            </tr>
                            <tr>
                                <td>소성 모멘트 (M<sub>p,tee</sub>)</td>
                                <td class="result-value">${formatNumber(results.Mp_tee, 2)}</td>
                                <td>kN·m</td>
                            </tr>
                            <tr>
                                <td>설계 휨강도 (φM<sub>n,tee</sub>)</td>
                                <td class="result-value" style="font-weight: 600;">${formatNumber(results.phiMn_tee, 2)}</td>
                                <td>kN·m</td>
                            </tr>
                            <tr>
                                <td>사용률</td>
                                <td class="result-value ${results.vierendeel_flexural_ok ? 'status-ok' : 'status-ng'}">${formatNumber(results.vierendeel_flexural_UR, 3)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>판정</td>
                                <td class="result-value ${results.vierendeel_flexural_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.vierendeel_flexural_ok ? '✅ 만족 (M<sub>tee</sub> ≤ φM<sub>n,tee</sub>)' : '❌ 불만족 (M<sub>tee</sub> > φM<sub>n,tee</sub>)'}
                                </td>
                                <td>-</td>
                            </tr>
                        </table>
                        
                        <h5 style="font-size: 13px; font-weight: 600; color: #475569; margin-top: 15px; margin-bottom: 8px;">Tee Section 전단강도 검토</h5>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>단위</th>
                            </tr>
                            <tr>
                                <td>Tee 전단력 (V<sub>tee</sub>)</td>
                                <td class="result-value">${formatNumber(results.V_tee, 2)}</td>
                                <td>kN</td>
                            </tr>
                            <tr>
                                <td>Tee 웹 전단 면적 (A<sub>w,tee</sub>)</td>
                                <td class="result-value">${formatNumber(results.Aw_tee, 1)}</td>
                                <td>mm²</td>
                            </tr>
                            <tr>
                                <td>공칭 전단 강도 (V<sub>n,tee</sub>)</td>
                                <td class="result-value">${formatNumber(results.Vn_tee, 2)}</td>
                                <td>kN</td>
                            </tr>
                            <tr>
                                <td>설계 전단 강도 (φV<sub>n,tee</sub>)</td>
                                <td class="result-value" style="font-weight: 600;">${formatNumber(results.phiVn_tee, 2)}</td>
                                <td>kN</td>
                            </tr>
                            <tr>
                                <td>사용률</td>
                                <td class="result-value ${results.vierendeel_shear_ok ? 'status-ok' : 'status-ng'}">${formatNumber(results.vierendeel_shear_UR, 3)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>판정</td>
                                <td class="result-value ${results.vierendeel_shear_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.vierendeel_shear_ok ? '✅ 만족 (V<sub>tee</sub> ≤ φV<sub>n,tee</sub>)' : '❌ 불만족 (V<sub>tee</sub> > φV<sub>n,tee</sub>)'}
                                </td>
                                <td>-</td>
                            </tr>
                        </table>
                        
                        <div style="margin-top: 15px; padding: 10px; background: ${results.vierendeel_ok ? '#d1fae5' : '#fee2e2'}; border-radius: 6px; border: 1px solid ${results.vierendeel_ok ? '#10b981' : '#ef4444'};">
                            <div style="font-size: 12px; font-weight: 600; color: ${results.vierendeel_ok ? '#065f46' : '#991b1b'};">
                                ${results.vierendeel_ok ? '✅ Vierendeel Bending 검토 만족' : '❌ Vierendeel Bending 검토 불만족'}
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 2. 전단파괴모드 검토 (Web Post Failure) -->
                <div class="result-section">
                    <div class="result-section-title" style="font-size: 18px; font-weight: 700; color: #1e3a5f; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #3b82f6;">A.2 전단파괴모드 검토 (Web Post Failure)</div>
                    
                    <div style="font-size: 11px; color: #64748b; margin-bottom: 15px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                        <strong>검토 내용:</strong> Web Post의 전단 파괴 모드를 분석하고 검토합니다. (AISC DG31)<br>
                        <strong>파괴 모드:</strong> 1) 전단 강도 파괴 (V<sub>rh</sub> > φV<sub>n,webpost</sub>), 2) 좌굴 파괴 (M<sub>rh</sub> > φM<sub>ocr</sub>)
                    </div>
                    
                    <!-- A.2.1 Web Post 전단 파괴 모드 분석 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">A.2.1 Web Post 전단 파괴 모드 분석</h4>
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 10px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                            <strong>검토 내용:</strong> Web Post의 전단 강도 파괴와 좌굴 파괴를 각각 검토하여 지배 파괴 모드를 결정합니다. (AISC DG31)
                        </div>
                        
                        <table class="result-table">
                            <tr>
                                <th>검토 항목</th>
                                <th>소요값</th>
                                <th>설계값</th>
                                <th>사용률</th>
                                <th>판정</th>
                            </tr>
                            <tr>
                                <td>전단 강도 파괴</td>
                                <td class="result-value">V<sub>rh</sub> = ${formatNumber(results.Vrh, 2)}</td>
                                <td class="result-value">φV<sub>n,webpost</sub> = ${formatNumber(results.phiVn_webpost, 2)}</td>
                                <td class="result-value ${results.shear_webpost_ok ? 'status-ok' : 'status-ng'}">${formatNumber(results.webpost_shear_UR, 3)}</td>
                                <td class="result-value ${results.shear_webpost_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.shear_webpost_ok ? '✅ OK' : '❌ NG'}
                                    ${!results.shear_webpost_ok ? '<div style="font-size: 10px; color: #ef4444; margin-top: 4px;">Web Post 보강필요</div>' : ''}
                                </td>
                            </tr>
                            <tr>
                                <td>좌굴 파괴</td>
                                <td class="result-value">M<sub>rh</sub> = ${formatNumber(results.Mrh, 2)}</td>
                                <td class="result-value">φM<sub>ocr</sub> = ${formatNumber(results.phiMocr, 2)}</td>
                                <td class="result-value ${results.buckling_ok ? 'status-ok' : 'status-ng'}">${formatNumber(results.webpost_buckling_UR, 3)}</td>
                                <td class="result-value ${results.buckling_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.buckling_ok ? '✅ OK' : '❌ NG'}
                                    ${!results.buckling_ok ? '<div style="font-size: 10px; color: #ef4444; margin-top: 4px;">Web Post 보강필요</div>' : ''}
                                </td>
                            </tr>
                        </table>
                        
                        <div style="margin-top: 15px; padding: 15px; background: ${results.webpost_failure_ok ? '#d1fae5' : '#fee2e2'}; border-radius: 8px; border: 2px solid ${results.webpost_failure_ok ? '#10b981' : '#ef4444'};">
                            <div style="font-size: 14px; font-weight: 700; color: ${results.webpost_failure_ok ? '#065f46' : '#991b1b'}; margin-bottom: 10px; text-align: center;">
                                ${results.webpost_failure_ok ? '✅ Web Post 안전' : '❌ Web Post 파괴'}
                            </div>
                            <div style="font-size: 12px; color: ${results.webpost_failure_ok ? '#065f46' : '#991b1b'}; text-align: center;">
                                지배 파괴 모드: <strong>${results.webpost_failure_mode_kr}</strong>
                            </div>
                            <div style="font-size: 11px; color: ${results.webpost_failure_ok ? '#065f46' : '#991b1b'}; text-align: center; margin-top: 8px;">
                                최대 사용률: ${formatNumber(results.webpost_max_UR, 3)}
                            </div>
                        </div>
                    </div>
                    
                    <!-- A.2.2 Web Post 치수 검토 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">A.2.2 Web Post 치수 검토 (AISC DG31 권장사항)</h4>
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 10px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                            <strong>검토 내용:</strong> Web Post의 치수 비율을 검토하여 적정성을 확인합니다. (AISC DG31)<br>
                            <strong>권장 기준:</strong> e/t<sub>w</sub> ≤ 20, h<sub>o</sub>/e ≤ 1.5
                        </div>
                        
                        <table class="result-table">
                            <tr>
                                <th>검토 항목</th>
                                <th>계산값</th>
                                <th>권장 기준</th>
                                <th>판정</th>
                            </tr>
                            <tr>
                                <td>e/t<sub>w</sub> 비율</td>
                                <td class="result-value">${formatNumber(results.etw_ratio, 2)}</td>
                                <td class="result-value">≤ ${formatNumber(results.etw_limit, 1)}</td>
                                <td class="result-value ${results.etw_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.etw_ok ? '✅ OK' : '❌ NG'}
                                </td>
                            </tr>
                            <tr>
                                <td>h<sub>o</sub>/e 비율</td>
                                <td class="result-value">${formatNumber(results.ho_e_ratio, 2)}</td>
                                <td class="result-value">≤ ${formatNumber(results.ho_e_limit, 1)}</td>
                                <td class="result-value ${results.ho_e_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.ho_e_ok ? '✅ OK' : '❌ NG'}
                                </td>
                            </tr>
                        </table>
                        
                        <div style="margin-top: 10px; padding: 10px; background: #f1f5f9; border-radius: 4px;">
                            <div style="font-size: 12px; color: #64748b; line-height: 1.6;">
                                <strong>참고:</strong> Web Post 치수 비율이 권장 기준을 초과하면 전단 강도나 좌굴 강도가 저하될 수 있습니다. 필요시 Web Post 폭(e)을 증가시키거나 웹 두께(t<sub>w</sub>)를 증가시켜야 합니다.
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 3. 글로벌 휨강도 검토 (Overall Flexural Strength) -->
                <div class="result-section">
                    <div class="result-section-title" style="font-size: 18px; font-weight: 700; color: #1e3a5f; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #3b82f6;">A.3 글로벌 휨강도 검토 (Overall Flexural Strength)</div>
                    
                    <div style="font-size: 11px; color: #64748b; margin-bottom: 15px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                        <strong>검토 내용:</strong> Castellated beam의 전체 휨강도를 검토합니다. (AISC 360 Ch. F + DG31)<br>
                        <strong>검토 항목:</strong> 검토 단면 선정, 단면 분류, 횡비틀림좌굴 검토, 공칭 휨강도 산정, 휨강도 판정
                    </div>
                    
                    <!-- A.3.1 검토 단면 선정 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">A.3.1 검토 단면 선정</h4>
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 10px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                            <strong>검토 내용:</strong> Opening 구간과 Solid web 구간 중 더 큰 모멘트를 받는 지배 구간을 선정합니다. (AISC 360 Ch. F)
                        </div>
                        <table class="result-table">
                            <tr>
                                <th>구간</th>
                                <th>모멘트</th>
                                <th>단위</th>
                            </tr>
                            <tr>
                                <td>Opening 구간 (지배 개구부)</td>
                                <td class="result-value">${formatNumber(results.M_opening, 2)}</td>
                                <td>kN·m</td>
                            </tr>
                            <tr>
                                <td>Solid web 구간 (최대 모멘트)</td>
                                <td class="result-value">${formatNumber(results.M_solid, 2)}</td>
                                <td>kN·m</td>
                            </tr>
                            <tr>
                                <td style="font-weight: 600;">지배 구간</td>
                                <td class="result-value" style="font-weight: 600; color: #3b82f6;">${results.governing_section}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td style="font-weight: 600;">최대 모멘트 (M<sub>max</sub>)</td>
                                <td class="result-value" style="font-weight: 600;">${formatNumber(results.M_max, 2)}</td>
                                <td>kN·m</td>
                            </tr>
                        </table>
                    </div>
                    
                    <!-- A.3.2 단면 분류 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">A.3.2 단면 분류 (AISC 360 Table B4.1)</h4>
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 10px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                            <strong>검토 내용:</strong> 플랜지 및 웹의 slenderness를 계산하여 단면을 Compact, Noncompact, Slender로 분류합니다. (AISC 360 Table B4.1)
                        </div>
                        
                        <h5 style="font-size: 13px; font-weight: 600; color: #475569; margin-top: 15px; margin-bottom: 8px;">플랜지 Slenderness</h5>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>기준</th>
                                <th>판정</th>
                            </tr>
                            <tr>
                                <td>λ<sub>f</sub> = b<sub>f</sub>/(2t<sub>f</sub>)</td>
                                <td class="result-value">${formatNumber(results.lambda_f, 2)}</td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td>λ<sub>pf</sub> = 0.38√(E/F<sub>y</sub>)</td>
                                <td class="result-value">${formatNumber(results.lambda_pf, 2)}</td>
                                <td class="result-value">Compact limit</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td>λ<sub>rf</sub> = 1.0√(E/F<sub>y</sub>)</td>
                                <td class="result-value">${formatNumber(results.lambda_rf, 2)}</td>
                                <td class="result-value">Noncompact limit</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td>플랜지 분류</td>
                                <td class="result-value ${results.flange_compact ? 'status-ok' : (results.flange_noncompact ? '' : 'status-ng')}" style="font-weight: 600;">
                                    ${results.flange_compact ? '✅ Compact' : (results.flange_noncompact ? '⚠️ Noncompact' : '❌ Slender')}
                                </td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                            </tr>
                        </table>
                        
                        <h5 style="font-size: 13px; font-weight: 600; color: #475569; margin-top: 15px; margin-bottom: 8px;">웹 Slenderness</h5>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>기준</th>
                                <th>판정</th>
                            </tr>
                            <tr>
                                <td>λ<sub>w</sub> = h<sub>w</sub>/t<sub>w</sub></td>
                                <td class="result-value">${formatNumber(results.lambda_w, 2)}</td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td>λ<sub>pw</sub> = 3.76√(E/F<sub>y</sub>)</td>
                                <td class="result-value">${formatNumber(results.lambda_pw, 2)}</td>
                                <td class="result-value">Compact limit</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td>λ<sub>rw</sub> = 5.70√(E/F<sub>y</sub>)</td>
                                <td class="result-value">${formatNumber(results.lambda_rw, 2)}</td>
                                <td class="result-value">Noncompact limit</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td>웹 분류</td>
                                <td class="result-value ${results.web_compact ? 'status-ok' : (results.web_noncompact ? '' : 'status-ng')}" style="font-weight: 600;">
                                    ${results.web_compact ? '✅ Compact' : (results.web_noncompact ? '⚠️ Noncompact' : '❌ Slender')}
                                </td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                            </tr>
                        </table>
                        
                        <div style="margin-top: 15px; padding: 10px; background: ${results.section_class === 'Compact' ? '#d1fae5' : (results.section_class === 'Noncompact' ? '#fef3c7' : '#fee2e2')}; border-radius: 6px; border: 1px solid ${results.section_class === 'Compact' ? '#10b981' : (results.section_class === 'Noncompact' ? '#f59e0b' : '#ef4444')};">
                            <div style="font-size: 12px; font-weight: 600; color: ${results.section_class === 'Compact' ? '#065f46' : (results.section_class === 'Noncompact' ? '#92400e' : '#991b1b')}; text-align: center;">
                                단면 분류: <strong>${results.section_class}</strong>
                            </div>
                        </div>
                    </div>
                    
                    <!-- A.3.3 횡비틀림좌굴 검토 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">A.3.3 횡비틀림좌굴 검토 (AISC 360 F2)</h4>
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 10px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                            <strong>검토 내용:</strong> 횡비틀림좌굴(LTB) 길이 L<sub>p</sub>, L<sub>r</sub>을 산정하고 L<sub>b</sub>와 비교하여 LTB case를 결정합니다. (AISC 360 F2)
                        </div>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>단위</th>
                            </tr>
                            <tr>
                                <td>r<sub>ts</sub> (effective radius of gyration)</td>
                                <td class="result-value">${formatNumber(results.rts, 1)}</td>
                                <td>mm</td>
                            </tr>
                            <tr>
                                <td>h<sub>o</sub> (flange center-to-center)</td>
                                <td class="result-value">${formatNumber(results.ho_flexural, 1)}</td>
                                <td>mm</td>
                            </tr>
                            <tr>
                                <td>J (torsional constant)</td>
                                <td class="result-value">${formatNumber(results.J / 1e6, 2)}</td>
                                <td>×10⁶ mm⁴</td>
                            </tr>
                            <tr>
                                <td>C<sub>w</sub> (warping constant)</td>
                                <td class="result-value">${formatNumber(results.Cw / 1e12, 2)}</td>
                                <td>×10¹² mm⁶</td>
                            </tr>
                            <tr>
                                <td>L<sub>p</sub> (plastic LTB length)</td>
                                <td class="result-value">${formatNumber(results.Lp, 2)}</td>
                                <td>m</td>
                            </tr>
                            <tr>
                                <td>L<sub>r</sub> (elastic LTB length)</td>
                                <td class="result-value">${formatNumber(results.Lr, 2)}</td>
                                <td>m</td>
                            </tr>
                            <tr>
                                <td>L<sub>b</sub> (unbraced length)</td>
                                <td class="result-value">${formatNumber(results.Lb, 2)}</td>
                                <td>m</td>
                            </tr>
                            <tr>
                                <td style="font-weight: 600;">LTB Case</td>
                                <td class="result-value" style="font-weight: 600; color: #3b82f6;">${results.LTB_case}</td>
                                <td>-</td>
                            </tr>
                        </table>
                    </div>
                    
                    <!-- A.3.4 공칭 휨강도 산정 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">A.3.4 공칭 휨강도 산정 (AISC 360 F2)</h4>
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 10px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                            <strong>검토 내용:</strong> LTB case에 따라 공칭 휨강도 M<sub>n</sub>을 산정합니다. (AISC 360 F2)<br>
                            <strong>계산식:</strong> LTB 비지배: M<sub>n</sub> = M<sub>p</sub>, 비탄성 LTB: M<sub>n</sub> = C<sub>b</sub>[M<sub>p</sub> - (M<sub>p</sub> - 0.7F<sub>y</sub>S<sub>x</sub>)((L<sub>b</sub> - L<sub>p</sub>)/(L<sub>r</sub> - L<sub>p</sub>))], 탄성 LTB: M<sub>n</sub> = F<sub>cr</sub>S<sub>x</sub>
                        </div>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>단위</th>
                            </tr>
                            <tr>
                                <td>Z<sub>x</sub> (소성 단면계수)</td>
                                <td class="result-value">${formatNumber(results.Zx_castellated / 1e3, 1)}</td>
                                <td>×10³ mm³</td>
                            </tr>
                            <tr>
                                <td>M<sub>p</sub> (소성 모멘트)</td>
                                <td class="result-value">${formatNumber(results.Mp_flexural, 2)}</td>
                                <td>kN·m</td>
                            </tr>
                            <tr>
                                <td>M<sub>n</sub> (공칭 휨강도)</td>
                                <td class="result-value" style="font-weight: 600;">${formatNumber(results.Mn, 2)}</td>
                                <td>kN·m</td>
                            </tr>
                            <tr>
                                <td>φ<sub>b</sub> (저감계수)</td>
                                <td class="result-value">${formatNumber(results.phi_b, 2)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>φ<sub>b</sub>M<sub>n</sub> (설계 휨강도)</td>
                                <td class="result-value" style="font-weight: 600; color: #3b82f6;">${formatNumber(results.phiMn, 2)}</td>
                                <td>kN·m</td>
                            </tr>
                        </table>
                    </div>
                    
                    <!-- 3.5 휨강도 판정 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">3.5 휨강도 판정 (AISC 360 F2)</h4>
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 10px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                            <strong>검토 내용:</strong> 소요 휨모멘트와 설계 휨강도를 비교하여 휨강도를 판정합니다. (AISC 360 F2)<br>
                            <strong>판정 기준:</strong> M<sub>u</sub> ≤ φ<sub>b</sub>M<sub>n</sub>
                        </div>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>단위</th>
                            </tr>
                            <tr>
                                <td>소요 휨모멘트 (M<sub>u</sub>)</td>
                                <td class="result-value">${formatNumber(results.Mu, 2)}</td>
                                <td>kN·m</td>
                            </tr>
                            <tr>
                                <td>설계 휨강도 (φ<sub>b</sub>M<sub>n</sub>)</td>
                                <td class="result-value" style="font-weight: 600;">${formatNumber(results.phiMn, 2)}</td>
                                <td>kN·m</td>
                            </tr>
                            <tr>
                                <td>사용률</td>
                                <td class="result-value ${results.flexural_ok ? 'status-ok' : 'status-ng'}">${formatNumber(results.flexural_UR, 3)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>판정</td>
                                <td class="result-value ${results.flexural_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.flexural_ok ? '✅ 만족 (M<sub>u</sub> ≤ φ<sub>b</sub>M<sub>n</sub>)' : '❌ 불만족 (M<sub>u</sub> > φ<sub>b</sub>M<sub>n</sub>)'}
                                </td>
                                <td>-</td>
                            </tr>
                        </table>
                    </div>
                </div>
                
                <!-- 4. 전단 항복 및 전단 좌굴 (Gross Shear Strength) -->
                <div class="result-section">
                    <div class="result-section-title" style="font-size: 18px; font-weight: 700; color: #1e3a5f; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #3b82f6;">A.4 전단 항복 및 전단 좌굴 (Gross Shear Strength)</div>
                    
                    <div style="font-size: 11px; color: #64748b; margin-bottom: 15px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                        <strong>검토 내용:</strong> 개구부 없는 Web 부분의 전단 항복 및 전단 좌굴을 검토합니다. (AISC 360 Ch. G)<br>
                        <strong>주의사항:</strong> 특히 지점부 인접 개구부에 주의해야 합니다. (DG31 권장: 지점부에서 최소 0.5d 이상 이격)
                    </div>
                    
                    <!-- A.4.1 지점부 인접 개구부 위치 확인 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">A.4.1 지점부 인접 개구부 위치 확인</h4>
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 10px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                            <strong>검토 내용:</strong> 지점부에서 가장 가까운 개구부까지의 거리를 확인합니다. (DG31 권장: 지점부에서 최소 0.5d 이상 이격)
                        </div>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>단위</th>
                            </tr>
                            <tr>
                                <td>첫 번째 개구부 위치</td>
                                <td class="result-value">${formatNumber(results.firstOpeningX, 2)}</td>
                                <td>m</td>
                            </tr>
                            <tr>
                                <td>마지막 개구부 위치</td>
                                <td class="result-value">${formatNumber(results.lastOpeningX, 2)}</td>
                                <td>m</td>
                            </tr>
                            <tr>
                                <td>지점부에서 가장 가까운 개구부까지의 거리</td>
                                <td class="result-value">${formatNumber(results.endPostDistance_mm, 1)}</td>
                                <td>mm</td>
                            </tr>
                            <tr>
                                <td>최소 권장 거리 (0.5d)</td>
                                <td class="result-value">${formatNumber(results.minEndPostDistance * 1000, 1)}</td>
                                <td>mm</td>
                            </tr>
                            <tr>
                                <td>판정</td>
                                <td class="result-value ${results.endPostDistance_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.endPostDistance_ok ? '✅ 만족 (거리 ≥ 0.5d)' : '⚠️ 주의 필요 (거리 < 0.5d)'}
                                </td>
                                <td>-</td>
                            </tr>
                        </table>
                    </div>
                    
                    <!-- A.4.2 개구부 없는 Web 부분의 전단 강도 계산 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">A.4.2 개구부 없는 Web 부분의 전단 강도 계산 (AISC 360 Ch. G)</h4>
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 10px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                            <strong>검토 내용:</strong> Solid web 구간의 전단 항복 및 전단 좌굴을 검토합니다. (AISC 360 Ch. G)<br>
                            <strong>계산식:</strong> V<sub>n</sub> = 0.6F<sub>y</sub>A<sub>w</sub>C<sub>v</sub>, C<sub>v</sub>는 h/t<sub>w</sub> 비율에 따라 결정
                        </div>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>단위</th>
                            </tr>
                            <tr>
                                <td>전단 면적 (A<sub>w</sub>)</td>
                                <td class="result-value">${formatNumber(results.Aw_solid, 1)}</td>
                                <td>mm²</td>
                            </tr>
                            <tr>
                                <td>지점부 전단력 (V<sub>u</sub>)</td>
                                <td class="result-value">${formatNumber(results.Vu_end, 2)}</td>
                                <td>kN</td>
                            </tr>
                            <tr>
                                <td>h/t<sub>w</sub> 비율</td>
                                <td class="result-value">${formatNumber(results.h_tw_solid, 2)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>k<sub>v</sub> (웹 판재 좌굴 계수)</td>
                                <td class="result-value">${formatNumber(results.kv_solid, 1)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>전단 항복 한계 (1.10√(k<sub>v</sub>E/F<sub>y</sub>))</td>
                                <td class="result-value">${formatNumber(results.h_tw_limit_solid, 2)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>전단 좌굴 탄성 한계 (1.37√(k<sub>v</sub>E/F<sub>y</sub>))</td>
                                <td class="result-value">${formatNumber(results.h_tw_limit_elastic, 2)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>전단 좌굴 계수 (C<sub>v</sub>)</td>
                                <td class="result-value">${formatNumber(results.Cv_solid, 3)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>전단 거동 모드</td>
                                <td class="result-value ${results.shear_yielding ? 'status-ok' : (results.shear_buckling_elastic ? 'status-ng' : '')}" style="font-weight: 600;">
                                    ${results.shear_yielding ? '✅ 전단 항복 지배' : (results.shear_buckling_elastic ? '❌ 전단 좌굴 (탄성)' : '⚠️ 전단 좌굴 (비탄성)')}
                                </td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>공칭 전단 강도 (V<sub>n</sub>)</td>
                                <td class="result-value" style="font-weight: 600;">${formatNumber(results.Vn_solid, 2)}</td>
                                <td>kN</td>
                            </tr>
                            <tr>
                                <td>φ<sub>v</sub> (저감계수)</td>
                                <td class="result-value">${formatNumber(results.phi_v, 2)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>설계 전단 강도 (φ<sub>v</sub>V<sub>n</sub>)</td>
                                <td class="result-value" style="font-weight: 600; color: #3b82f6;">${formatNumber(results.phiVn_solid, 2)}</td>
                                <td>kN</td>
                            </tr>
                        </table>
                    </div>
                    
                    <!-- A.4.3 전단좌굴 검토 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">A.4.3 전단좌굴 검토 (AISC 360 G2)</h4>
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 10px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                            <strong>검토 내용:</strong> 웹의 h/t<sub>w</sub> 비율에 따른 전단 좌굴 계수 C<sub>v</sub>를 계산하고 전단 거동 모드를 판정합니다. (AISC 360 G2)<br>
                            <strong>관련 식:</strong><br>
                            • 전단 항복 지배: h/t<sub>w</sub> ≤ 1.10√(k<sub>v</sub>E/F<sub>y</sub>) → C<sub>v</sub> = 1.0 (AISC 360 G2-1)<br>
                            • 전단 좌굴 (비탄성): 1.10√(k<sub>v</sub>E/F<sub>y</sub>) < h/t<sub>w</sub> ≤ 1.37√(k<sub>v</sub>E/F<sub>y</sub>) → C<sub>v</sub> = 1.10√(k<sub>v</sub>E/F<sub>y</sub>)/(h/t<sub>w</sub>) (AISC 360 G2-2)<br>
                            • 전단 좌굴 (탄성): h/t<sub>w</sub> > 1.37√(k<sub>v</sub>E/F<sub>y</sub>) → C<sub>v</sub> = 1.51k<sub>v</sub>E/(F<sub>y</sub>(h/t<sub>w</sub>)²) (AISC 360 G2-3)
                        </div>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>단위</th>
                            </tr>
                            <tr>
                                <td>h/t<sub>w</sub> 비율</td>
                                <td class="result-value">${formatNumber(results.h_tw_solid, 2)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>k<sub>v</sub> (웹 판재 좌굴 계수)</td>
                                <td class="result-value">${formatNumber(results.kv_solid, 1)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>전단 항복 한계<br>1.10√(k<sub>v</sub>E/F<sub>y</sub>)</td>
                                <td class="result-value">${formatNumber(results.h_tw_limit_solid, 2)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>전단 좌굴 탄성 한계<br>1.37√(k<sub>v</sub>E/F<sub>y</sub>)</td>
                                <td class="result-value">${formatNumber(results.h_tw_limit_elastic, 2)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>전단 좌굴 계수 (C<sub>v</sub>)</td>
                                <td class="result-value" style="font-weight: 600;">${formatNumber(results.Cv_solid, 3)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>전단 거동 모드</td>
                                <td class="result-value ${results.shear_yielding ? 'status-ok' : (results.shear_buckling_elastic ? 'status-ng' : '')}" style="font-weight: 600;">
                                    ${results.shear_yielding ? '✅ 전단 항복 지배<br><span style="font-size: 10px; color: #64748b;">(C<sub>v</sub> = 1.0, AISC 360 G2-1)</span>' : (results.shear_buckling_elastic ? '❌ 전단 좌굴 (탄성)<br><span style="font-size: 10px; color: #64748b;">(C<sub>v</sub> = 1.51k<sub>v</sub>E/(F<sub>y</sub>(h/t<sub>w</sub>)²), AISC 360 G2-3)</span>' : '⚠️ 전단 좌굴 (비탄성)<br><span style="font-size: 10px; color: #64748b;">(C<sub>v</sub> = 1.10√(k<sub>v</sub>E/F<sub>y</sub>)/(h/t<sub>w</sub>), AISC 360 G2-2)</span>')}
                                </td>
                                <td>-</td>
                            </tr>
                        </table>
                        <div style="margin-top: 15px; padding: 10px; background: #f1f5f9; border-radius: 4px; border-left: 3px solid #64748b;">
                            <div style="font-size: 11px; color: #475569; line-height: 1.6;">
                                <strong>계산 과정:</strong><br>
                                ${results.shear_yielding ? 
                                    `h/t<sub>w</sub> = ${formatNumber(results.h_tw_solid, 2)} ≤ ${formatNumber(results.h_tw_limit_solid, 2)} (전단 항복 한계)<br>
                                    → 전단 항복 지배, C<sub>v</sub> = 1.0` :
                                    (results.shear_buckling_elastic ?
                                        `h/t<sub>w</sub> = ${formatNumber(results.h_tw_solid, 2)} > ${formatNumber(results.h_tw_limit_elastic, 2)} (전단 좌굴 탄성 한계)<br>
                                        → 전단 좌굴 (탄성)<br>
                                        C<sub>v</sub> = 1.51 × ${formatNumber(results.kv_solid, 1)} × ${formatNumber(results.Es, 0)} / (${formatNumber(results.Fy, 0)} × ${formatNumber(results.h_tw_solid, 2)}²) = ${formatNumber(results.Cv_solid, 3)}` :
                                        `${formatNumber(results.h_tw_limit_solid, 2)} < h/t<sub>w</sub> = ${formatNumber(results.h_tw_solid, 2)} ≤ ${formatNumber(results.h_tw_limit_elastic, 2)}<br>
                                        → 전단 좌굴 (비탄성)<br>
                                        C<sub>v</sub> = 1.10 × √(${formatNumber(results.kv_solid, 1)} × ${formatNumber(results.Es, 0)} / ${formatNumber(results.Fy, 0)}) / ${formatNumber(results.h_tw_solid, 2)} = ${formatNumber(results.Cv_solid, 3)}`
                                    )
                                }
                            </div>
                        </div>
                    </div>
                    
                    <!-- 4.4 전단 강도 판정 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">4.4 전단 강도 판정 (AISC 360 Ch. G)</h4>
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 10px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                            <strong>검토 내용:</strong> 소요 전단력과 설계 전단 강도를 비교하여 전단 강도를 판정합니다. (AISC 360 Ch. G)<br>
                            <strong>판정 기준:</strong> V<sub>u</sub> ≤ φ<sub>v</sub>V<sub>n</sub>
                        </div>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>단위</th>
                            </tr>
                            <tr>
                                <td>소요 전단력 (V<sub>u</sub>)</td>
                                <td class="result-value">${formatNumber(results.Vu_end, 2)}</td>
                                <td>kN</td>
                            </tr>
                            <tr>
                                <td>설계 전단 강도 (φ<sub>v</sub>V<sub>n</sub>)</td>
                                <td class="result-value" style="font-weight: 600;">${formatNumber(results.phiVn_solid, 2)}</td>
                                <td>kN</td>
                            </tr>
                            <tr>
                                <td>사용률</td>
                                <td class="result-value ${results.shear_solid_ok ? 'status-ok' : 'status-ng'}">${formatNumber(results.shear_solid_UR, 3)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>판정</td>
                                <td class="result-value ${results.shear_solid_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.shear_solid_ok ? '✅ 만족 (V<sub>u</sub> ≤ φ<sub>v</sub>V<sub>n</sub>)' : '❌ 불만족 (V<sub>u</sub> > φ<sub>v</sub>V<sub>n</sub>)'}
                                </td>
                                <td>-</td>
                            </tr>
                        </table>
                    </div>
                </div>
                
                <!-- 5. 개구부 위치 제한 검토 (Geometric Limits) -->
                <div class="result-section">
                    <div class="result-section-title" style="font-size: 18px; font-weight: 700; color: #1e3a5f; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #3b82f6;">A.5 개구부 위치 제한 검토 (Geometric Limits)</div>
                    
                    <div style="font-size: 11px; color: #64748b; margin-bottom: 15px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                        <strong>검토 내용:</strong> AISC Design Guide 31 권장사항에 따른 개구부 위치 제한을 검토합니다.<br>
                        <strong>검토 항목:</strong> 개구부 높이, Web Post 폭, 지점부 개구부 이격거리
                    </div>
                    
                    <table class="result-table" style="margin-bottom: 20px;">
                        <tr>
                            <th style="width: 35%;">검토 항목</th>
                            <th style="width: 20%;">계산값</th>
                            <th style="width: 20%;">권장 기준</th>
                            <th style="width: 25%;">판정</th>
                        </tr>
                        <tr>
                            <td><strong>개구부 높이</strong><br>0.5h ≤ h<sub>o</sub> ≤ 0.75h</td>
                            <td class="result-value">${formatNumber(results.ho * 1000, 1)} mm<br>(${formatNumber(results.ho, 3)} m)</td>
                            <td class="result-value">${formatNumber(results.ho_min_limit * 1000, 1)} ~ ${formatNumber(results.ho_max_limit * 1000, 1)} mm<br>(${formatNumber(results.ho_min_limit, 3)} ~ ${formatNumber(results.ho_max_limit, 3)} m)</td>
                            <td class="result-value ${results.ho_geometric_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                ${results.ho_geometric_ok ? '✅ 적합' : '❌ 부적합'}
                            </td>
                        </tr>
                        <tr>
                            <td><strong>Web Post 폭</strong><br>e ≥ 0.25h<sub>o</sub></td>
                            <td class="result-value">${formatNumber(results.e, 1)} mm</td>
                            <td class="result-value">≥ ${formatNumber(results.e_min_limit, 1)} mm</td>
                            <td class="result-value ${results.e_geometric_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                ${results.e_geometric_ok ? '✅ 적합' : '❌ 부적합'}
                            </td>
                        </tr>
                        <tr>
                            <td><strong>지점부 개구부 이격거리</strong><br>≥ 1.5h</td>
                            <td class="result-value">${formatNumber(results.endPostDistance_mm, 1)} mm<br>(${formatNumber(results.endPostDistance, 3)} m)</td>
                            <td class="result-value">≥ ${formatNumber(results.endPostDistance_min_limit * 1000, 1)} mm<br>(≥ ${formatNumber(results.endPostDistance_min_limit, 3)} m)</td>
                            <td class="result-value ${results.endPostDistance_geometric_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                ${results.endPostDistance_geometric_ok ? '✅ 적합' : '❌ 부적합'}
                            </td>
                        </tr>
                    </table>
                    
                    <div style="margin-top: 15px; padding: 10px; background: ${results.geometric_limits_ok ? '#d1fae5' : '#fee2e2'}; border-radius: 6px; border: 1px solid ${results.geometric_limits_ok ? '#10b981' : '#ef4444'};">
                        <div style="font-size: 12px; font-weight: 600; color: ${results.geometric_limits_ok ? '#065f46' : '#991b1b'}; text-align: center;">
                            종합 판정: <strong>${results.geometric_limits_ok ? '✅ 모든 항목 적합' : '❌ 일부 항목 부적합'}</strong>
                        </div>
                    </div>
                </div>
                
                <!-- 6. 입력 조건 -->
                <div class="result-section">
                    <div class="result-section-title">A.6 입력 조건</div>
                    <table class="result-table">
                        <tr>
                            <th>항목</th>
                            <th>값</th>
                            <th>단위</th>
                        </tr>
                        <tr>
                            <td>계산 타입</td>
                            <td class="result-value">${results.type === 'with-slab' ? 'B. 전단연결재 적용후 Composite Beam 계산' : 'A. 전단연결미체결 슬래브'}</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td>보 스팬 (L)</td>
                            <td class="result-value">${formatNumber(results.L, 2)}</td>
                            <td>m</td>
                        </tr>
                        <tr>
                            <td>하중 폭 (B)</td>
                            <td class="result-value">${formatNumber(results.B, 2)}</td>
                            <td>m</td>
                        </tr>
                        <tr>
                            <td>고정하중 (DL)</td>
                            <td class="result-value">${formatNumber(results.DL, 2)}</td>
                            <td>kN/m</td>
                        </tr>
                        <tr>
                            <td>활하중 (LL)</td>
                            <td class="result-value">${formatNumber(results.LL, 2)}</td>
                            <td>kN/m</td>
                        </tr>
                        <tr>
                            <td>보 자중 (self_w)</td>
                            <td class="result-value">${formatNumber(results.self_w, 3)}</td>
                            <td>kN/m²</td>
                        </tr>
                        <tr>
                            <td>보 자중 (self_w × B)</td>
                            <td class="result-value">${formatNumber(results.self_w_kNm, 2)}</td>
                            <td>kN/m</td>
                        </tr>
                        <tr>
                            <td>계수하중 (wu)<br><span style="font-size: 11px; color: #64748b; font-weight: normal;">LRFD: 1.2D + 1.6L</span></td>
                            <td class="result-value">${formatNumber(results.wu, 2)}</td>
                            <td>kN/m</td>
                        </tr>
                        <tr>
                            <td>강종</td>
                            <td class="result-value">${results.steelGrade} (Fy = ${results.Fy} MPa)</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td>원단면</td>
                            <td class="result-value">H${(results.dc*1000).toFixed(0)}×${results.bf}×${results.tw}×${results.tf}</td>
                            <td>-</td>
                        </tr>
                        ${results.type === 'with-slab' ? `
                        <tr>
                            <td>슬래브 두께 (ts)</td>
                            <td class="result-value">${formatNumber(results.ts, 0)}</td>
                            <td>mm</td>
                        </tr>
                        ` : ''}
                        <tr>
                            <td>개구부 높이 (ho)</td>
                            <td class="result-value">${formatNumber(results.ho, 2)}</td>
                            <td>m</td>
                        </tr>
                    </table>
                </div>

                <!-- 원단면 Section Properties -->
                <div class="result-section">
                    <div class="result-section-title">A.7 원단면 (H형강) Section Properties</div>
                    <table class="result-table">
                        <tr>
                            <th>항목</th>
                            <th>값</th>
                            <th>단위</th>
                        </tr>
                        <tr>
                            <td>높이 (d)</td>
                            <td class="result-value">${formatNumber(results.d_original, 1)}</td>
                            <td>mm</td>
                        </tr>
                        <tr>
                            <td>단면적 (A)</td>
                            <td class="result-value">${formatNumber(results.A_total, 1)}</td>
                            <td>mm²</td>
                        </tr>
                        <tr>
                            <td>단면2차모멘트 (Ix)</td>
                            <td class="result-value">${formatNumber(results.Ix_original / 1e6, 2)}</td>
                            <td>×10⁶ mm⁴</td>
                        </tr>
                        <tr>
                            <td>단면2차모멘트 (Iy)</td>
                            <td class="result-value">${formatNumber(results.Iy_original / 1e6, 2)}</td>
                            <td>×10⁶ mm⁴</td>
                        </tr>
                        <tr>
                            <td>단면계수 (Sx)</td>
                            <td class="result-value">${formatNumber(results.Sx_original / 1e3, 1)}</td>
                            <td>×10³ mm³</td>
                        </tr>
                        <tr>
                            <td>회전반경 (rx)</td>
                            <td class="result-value">${formatNumber(results.rx_original, 1)}</td>
                            <td>mm</td>
                        </tr>
                        <tr>
                            <td>회전반경 (ry)</td>
                            <td class="result-value">${formatNumber(results.ry_original, 1)}</td>
                            <td>mm</td>
                        </tr>
                    </table>
                </div>

                <!-- Castellated Beam Section Properties -->
                <div class="result-section">
                    <div class="result-section-title">A.8 Castellated Beam Section Properties</div>
                    <table class="result-table">
                        <tr>
                            <th>항목</th>
                            <th>값</th>
                            <th>단위</th>
                        </tr>
                        <tr>
                            <td>높이 (dc)</td>
                            <td class="result-value">${formatNumber(results.d_castellated, 1)}</td>
                            <td>mm</td>
                        </tr>
                        <tr>
                            <td>단면적 (A)</td>
                            <td class="result-value">${formatNumber(results.A_total, 1)}</td>
                            <td>mm²</td>
                        </tr>
                        <tr>
                            <td>단면2차모멘트 (Ix)</td>
                            <td class="result-value">${formatNumber(results.Ix_steel / 1e6, 2)}</td>
                            <td>×10⁶ mm⁴</td>
                        </tr>
                        <tr>
                            <td>단면2차모멘트 (Iy)</td>
                            <td class="result-value">${formatNumber(results.Iy_castellated / 1e6, 2)}</td>
                            <td>×10⁶ mm⁴</td>
                        </tr>
                        <tr>
                            <td>단면계수 (Sx)</td>
                            <td class="result-value">${formatNumber(results.Sx_castellated / 1e3, 1)}</td>
                            <td>×10³ mm³</td>
                        </tr>
                        <tr>
                            <td>회전반경 (rx)</td>
                            <td class="result-value">${formatNumber(results.rx_castellated, 1)}</td>
                            <td>mm</td>
                        </tr>
                        <tr>
                            <td>회전반경 (ry)</td>
                            <td class="result-value">${formatNumber(results.ry_castellated, 1)}</td>
                            <td>mm</td>
                        </tr>
                    </table>
                </div>

                <!-- 2. 개구부별 계산 결과 -->
                <div class="result-section">
                    <div class="result-section-title">A.9 개구부별 계산 결과</div>
                    <div style="overflow-x: auto;">
                        <table class="result-table">
                            <thead>
                                <tr>
                                    <th>i</th>
                                    <th>x (m)</th>
                                    <th>V(x) (kN)</th>
                                    <th>M(x) (kN·m)</th>
                                    <th>P_i (kN)</th>
                                    <th>M_tee,i (kN·m)</th>
                                    <th>UR_i</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${openingTableRows}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 3. 지배 개구부 -->
                <div class="result-section">
                    <div class="result-section-title">A.10 지배 개구부 (Governing Opening)</div>
                    <table class="result-table">
                        <tr>
                            <th>항목</th>
                            <th>값</th>
                            <th>단위</th>
                        </tr>
                        <tr>
                            <td>개구부 번호 (i)</td>
                            <td class="result-value">${results.govOpening.i}</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td>위치 (x)</td>
                            <td class="result-value">${formatNumber(results.govOpening.x, 2)}</td>
                            <td>m</td>
                        </tr>
                        <tr>
                            <td>전단력 V(x)</td>
                            <td class="result-value">${formatNumber(results.govOpening.V, 2)}</td>
                            <td>kN</td>
                        </tr>
                        <tr>
                            <td>모멘트 M(x)</td>
                            <td class="result-value">${formatNumber(results.govOpening.M, 2)}</td>
                            <td>kN·m</td>
                        </tr>
                        <tr>
                            <td>축력 P_i</td>
                            <td class="result-value">${formatNumber(results.govOpening.P, 2)}</td>
                            <td>kN</td>
                        </tr>
                        <tr>
                            <td>Tee 모멘트 M_tee,i</td>
                            <td class="result-value">${formatNumber(results.govOpening.Mtee, 2)}</td>
                            <td>kN·m</td>
                        </tr>
                        <tr>
                            <td>이용률 UR_i</td>
                            <td class="result-value ${results.govOpening.UR <= 1.0 ? 'status-ok' : 'status-ng'}">${formatNumber(results.govOpening.UR, 3)}</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td>검토 결과</td>
                            <td class="result-value ${results.govOpening.UR <= 1.0 ? 'status-ok' : 'status-ng'}">
                                ${results.govOpening.UR <= 1.0 ? '✅ 만족' : '❌ 불만족'}
                            </td>
                            <td>-</td>
                        </tr>
                    </table>
                </div>

                <!-- 4. 지배 Web-Post -->
                <div class="result-section">
                    <div class="result-section-title">A.11 지배 Web-Post (Governing Web-Post)</div>
                    <table class="result-table">
                        <tr>
                            <th>항목</th>
                            <th>값</th>
                            <th>단위</th>
                        </tr>
                        <tr>
                            <td>Web-Post 쌍</td>
                            <td class="result-value">${results.webPostPair[0]} - ${results.webPostPair[1]}</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td>전단력 V_rh</td>
                            <td class="result-value">${formatNumber(results.Vrh, 2)}</td>
                            <td>kN</td>
                        </tr>
                        <tr>
                            <td>모멘트 M_rh</td>
                            <td class="result-value">${formatNumber(results.Mrh, 2)}</td>
                            <td>kN·m</td>
                        </tr>
                    </table>
                </div>

                <!-- 5. Web-Post Buckling 검토 (DG31) -->
                <div class="result-section">
                    <div class="result-section-title">A.12 Web-Post Buckling 검토 (AISC DG31)</div>
                    <table class="result-table">
                        <tr>
                            <th>항목</th>
                            <th>값</th>
                            <th>단위</th>
                        </tr>
                        <tr>
                            <td>소성 모멘트 (Mp)</td>
                            <td class="result-value">${formatNumber(results.Mp, 2)}</td>
                            <td>kN·m</td>
                        </tr>
                        <tr>
                            <td>e/tw</td>
                            <td class="result-value">${formatNumber(results.etw, 2)}</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td>비율 (ratio)</td>
                            <td class="result-value">${formatNumber(results.ratio, 3)}</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td>좌굴 모멘트 (Mocr)</td>
                            <td class="result-value">${formatNumber(results.Mocr, 2)}</td>
                            <td>kN·m</td>
                        </tr>
                        <tr>
                            <td>설계 좌굴 모멘트 (φMocr)</td>
                            <td class="result-value">${formatNumber(results.phiMocr, 2)}</td>
                            <td>kN·m</td>
                        </tr>
                        <tr>
                            <td>소요 모멘트 (M_rh)</td>
                            <td class="result-value">${formatNumber(results.Mrh, 2)}</td>
                            <td>kN·m</td>
                        </tr>
                        <tr>
                            <td>검토 결과</td>
                            <td class="result-value ${results.buckling_ok ? 'status-ok' : 'status-ng'}">
                                ${results.buckling_ok ? '✅ 만족' : '❌ 불만족'}
                            </td>
                            <td>-</td>
                        </tr>
                    </table>
                </div>

                <!-- 7. 가설하중 검토 -->
                <div class="result-section">
                    <div class="result-section-title" style="font-size: 18px; font-weight: 700; color: #1e3a5f; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #cbd5e1;">A.13 작용하중단계별 소요강도 및 소요단면 2차 모멘트</div>
                    <div class="result-section-title">A.13.1 시공단계의 소요강도 및 소요단면 2차 모멘트</div>
                    <div style="font-size: 12px; color: #64748b; margin-bottom: 15px; padding: 8px; background: #f1f5f9; border-radius: 4px;">
                        간격 ${formatNumber(results.B, 1)}m의 보에 대한 선형등분포하중을 산정하여 작용하중단계별 소요휨강도, 소요전단강도, 소요단면 2차 모멘트를 구한다.
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">1) 선형등분포하중</h4>
                        <div style="font-size: 12px; color: #475569; line-height: 1.8; font-family: 'Courier New', monospace; background: #f8fafc; padding: 12px; border-radius: 6px; border: 1px solid #e2e8f0;">
                            <div>시공중 고정하중: w_DL = (${formatNumber(results.slabWeight || 0, 2)} + ${formatNumber(results.self_w, 2)})(${formatNumber(results.B, 2)}) = ${formatNumber(results.w_DL_construction, 2)} kN/m</div>
                            <div>시공중 활하중: w_CLL = (${formatNumber(results.qConst || 0, 2)})(${formatNumber(results.B, 2)}) = ${formatNumber(results.w_CLL_construction, 3)} kN/m</div>
                            <div style="margin-top: 12px; font-weight: 600;">시공중 계수하중:</div>
                            <div style="margin-left: 20px;">w_u1 = 1.4DL = 1.4(${formatNumber(results.w_DL_construction, 3)}) = ${formatNumber(results.w_u1_construction, 3)} kN/m</div>
                            <div style="margin-left: 20px;">w_u2 = 1.2DL + 1.6LL = 1.2(${formatNumber(results.w_DL_construction, 3)}) + 1.6(${formatNumber(results.w_CLL_construction, 3)}) = ${formatNumber(results.w_u2_construction, 3)} kN/m</div>
                            <div style="margin-left: 20px; font-weight: 600;">∴ w_u = max.[w_u1, w_u2] = ${formatNumber(results.w_u_construction, 3)} kN/m</div>
                        </div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">2) 시공 중 강재보의 소요휨강도</h4>
                        <div style="font-size: 12px; color: #475569; line-height: 1.8; font-family: 'Courier New', monospace; background: #f8fafc; padding: 12px; border-radius: 6px; border: 1px solid #e2e8f0;">
                            <div>시공 중 소요휨강도: M_u = (w_u × l²) / 8 = (${formatNumber(results.w_u_construction, 3)})(${formatNumber(results.L, 2)})² / 8 = ${formatNumber(results.M_u_construction, 2)} kN·m</div>
                        </div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">3) 시공 중 강재보의 소요단면2차모멘트</h4>
                        <div style="font-size: 12px; color: #475569; line-height: 1.8; font-family: 'Courier New', monospace; background: #f8fafc; padding: 12px; border-radius: 6px; border: 1px solid #e2e8f0;">
                            <div>시공 중 강재보의 처짐은 콘크리트 타설의 시공성을 고려하여 ${formatNumber(results.delta_allow_construction, 0)}mm로 제한한다.</div>
                            <div style="margin-top: 8px;">시공 중 소요단면2차모멘트: I_req = (5 × w_DL × l⁴) / (384 × E × Δ)</div>
                            <div style="margin-left: 20px;">I_req = (5 × ${formatNumber(results.w_DL_construction, 3)} × ${formatNumber(results.L * 1000, 0)}⁴) / (384 × ${formatNumber(200000 / 1000, 0)} × ${formatNumber(results.delta_allow_construction, 0)})</div>
                            <div style="margin-left: 20px;">I_req = ${formatNumber(results.I_req_construction / 1e6, 2)} × 10⁶ mm⁴</div>
                            <div style="margin-top: 8px; font-size: 11px; color: #64748b; font-style: italic;">※ 시공단계에서 이미 Castellated beam으로 제작되었으므로, Castellated beam의 단면2차모멘트를 사용합니다.</div>
                        </div>
                    </div>

                    <table class="result-table">
                        <tr>
                            <th>항목</th>
                            <th>값</th>
                            <th>단위</th>
                        </tr>
                        <tr>
                            <td>시공중 고정하중 (w_DL)</td>
                            <td class="result-value">${formatNumber(results.w_DL_construction, 3)}</td>
                            <td>kN/m</td>
                        </tr>
                        <tr>
                            <td>시공중 활하중 (w_CLL)</td>
                            <td class="result-value">${formatNumber(results.w_CLL_construction, 3)}</td>
                            <td>kN/m</td>
                        </tr>
                        <tr>
                            <td>시공중 계수하중 (w_u)</td>
                            <td class="result-value">${formatNumber(results.w_u_construction, 3)}</td>
                            <td>kN/m</td>
                        </tr>
                        <tr>
                            <td>시공 중 소요휨강도 (M_u)</td>
                            <td class="result-value">${formatNumber(results.M_u_construction, 2)}</td>
                            <td>kN·m</td>
                        </tr>
                        <tr>
                            <td>시공 중 소요단면2차모멘트 (I_req)</td>
                            <td class="result-value">${formatNumber(results.I_req_construction / 1e6, 2)}</td>
                            <td>×10⁶ mm⁴</td>
                        </tr>
                        <tr>
                            <td>강재보 단면2차모멘트 (Ix_steel)<br><span style="font-size: 11px; color: #64748b; font-weight: normal;">Castellated beam</span></td>
                            <td class="result-value">${formatNumber(results.Ix_steel / 1e6, 2)}</td>
                            <td>×10⁶ mm⁴</td>
                        </tr>
                        <tr>
                            <td>처짐 제한 (시공성 고려)</td>
                            <td class="result-value">${formatNumber(results.delta_allow_construction, 0)}</td>
                            <td>mm</td>
                        </tr>
                    </table>
                    ${results.Ix_steel < results.I_req_construction ? 
                        '<div class="warning-box"><strong>⚠️ 주의:</strong> 시공단계 소요단면2차모멘트를 만족하지 않습니다. 단면을 크게 하거나 보 스팬을 줄여주세요.</div>' : 
                        '<div style="background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; padding: 12px; margin-top: 15px; font-size: 12px; color: #065f46;"><strong>✅ 확인:</strong> 시공단계 소요단면2차모멘트를 만족합니다.</div>'}
                </div>

                <!-- 6. 용접 설계 -->
                <div class="result-section">
                    <div class="result-section-title">A.14 용접 설계</div>
                    <table class="result-table">
                        <tr>
                            <th>항목</th>
                            <th>값</th>
                            <th>단위</th>
                        </tr>
                        <tr>
                            <td>필요 용접 면적 (Aw_req)</td>
                            <td class="result-value">${formatNumber((results.Vrh * 1000.0) / (0.75 * 0.6 * 490.0), 2)}</td>
                            <td>mm²</td>
                        </tr>
                        <tr>
                            <td>필요 용접 크기 (w_req)</td>
                            <td class="result-value">${formatNumber(results.w_req, 2)}</td>
                            <td>mm</td>
                        </tr>
                        <tr>
                            <td>최종 용접 크기 (w_final)</td>
                            <td class="result-value">${results.w_final}</td>
                            <td>mm</td>
                        </tr>
                    </table>
                </div>
                
                ${(() => {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:displayResults',message:'B section display check',data:{type:results.type,composite_calculated:results.composite_calculated,shouldDisplay:results.type === 'with-slab' && results.composite_calculated,hasB6:results.shear_composite_ok!==undefined,hasB7:results.vierendeel_ok_composite!==undefined,hasB8:results.webpost_ok_composite!==undefined,hasB9:results.deflection_ok!==undefined},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'B_SECTION'})}).catch(()=>{});
                    // #endregion
                    return results.type === 'with-slab' && results.composite_calculated;
                })() ? `
                <!-- B. 전단연결재 적용후 Composite Beam 계산 -->
                <div class="result-section">
                    <div class="result-section-title" style="font-size: 18px; font-weight: 700; color: #1e3a5f; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #3b82f6;">B. 전단연결재 적용후 Composite Beam 계산</div>
                    
                    <div style="font-size: 11px; color: #64748b; margin-bottom: 15px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                        <strong>검토 내용:</strong> 전단연결재를 이용하여 슬래브와 합성한 합성보의 구조계산을 수행합니다. (AISC I3, I8)
                    </div>
                    
                    <!-- B.1 합성보 입력 조건 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">B.1 합성보 입력 조건</h4>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>단위</th>
                            </tr>
                            <tr>
                                <td>슬래브 유효폭 (beff)</td>
                                <td class="result-value">${formatNumber(results.effectiveWidth, 2)}</td>
                                <td>m</td>
                            </tr>
                            <tr>
                                <td>콘크리트 압축강도 (f'c)</td>
                                <td class="result-value">${formatNumber(results.concreteStrength, 1)}</td>
                                <td>MPa</td>
                            </tr>
                            <tr>
                                <td>콘크리트 단위중량</td>
                                <td class="result-value">${formatNumber(results.concreteUnitWeight, 1)}</td>
                                <td>kN/m³</td>
                            </tr>
                            <tr>
                                <td>전단연결재 타입</td>
                                <td class="result-value">${results.connectorType}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>스터드 직경</td>
                                <td class="result-value">${formatNumber(results.studDiameter, 0)}</td>
                                <td>mm</td>
                            </tr>
                            <tr>
                                <td>스터드 높이</td>
                                <td class="result-value">${formatNumber(results.studHeight, 0)}</td>
                                <td>mm</td>
                            </tr>
                            <tr>
                                <td>스터드 설계기준 인장강도 (Fu)</td>
                                <td class="result-value">${formatNumber(results.studFu, 0)}</td>
                                <td>MPa</td>
                            </tr>
                            <tr>
                                <td>스터드 열수</td>
                                <td class="result-value">${formatNumber(results.studRows, 0)}</td>
                                <td>열</td>
                            </tr>
                            ${results.useDeckPlate ? `
                            <tr>
                                <td>데크플레이트 사용</td>
                                <td class="result-value">사용</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>데크플레이트 두께</td>
                                <td class="result-value">${formatNumber(results.deckThickness, 0)}</td>
                                <td>mm</td>
                            </tr>
                            <tr>
                                <td>데크플레이트 골 방향</td>
                                <td class="result-value">${results.deckDirection === 'perpendicular' ? '수직' : '평행'}</td>
                                <td>-</td>
                            </tr>
                            ` : `
                            <tr>
                                <td>데크플레이트 사용</td>
                                <td class="result-value">미사용</td>
                                <td>-</td>
                            </tr>
                            `}
                        </table>
                    </div>
                    
                    <!-- B.2 전단연결재 강도 계산 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">B.2 전단연결재 강도 계산 (AISC I8.1)</h4>
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 10px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                            <strong>계산식:</strong> Q<sub>n</sub> = 0.5 × A<sub>sa</sub> × √(f'<sub>c</sub> × E<sub>c</sub>) ≤ A<sub>sa</sub> × F<sub>u</sub>
                        </div>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>단위</th>
                            </tr>
                            <tr>
                                <td>스터드 단면적 (A<sub>sa</sub>)</td>
                                <td class="result-value">${formatNumber(Math.PI * Math.pow(results.studDiameter / 2, 2), 2)}</td>
                                <td>mm²</td>
                            </tr>
                            <tr>
                                <td>콘크리트 탄성계수 (E<sub>c</sub>)</td>
                                <td class="result-value">${formatNumber(results.Ec, 0)}</td>
                                <td>MPa</td>
                            </tr>
                            <tr>
                                <td>전단연결재 강도 (Q<sub>n</sub>)</td>
                                <td class="result-value">${formatNumber(results.Qn, 2)}</td>
                                <td>kN</td>
                            </tr>
                            <tr>
                                <td>소요 전단연결재 강도 (ΣQ<sub>n</sub>)</td>
                                <td class="result-value">${formatNumber(results.SigmaQn, 2)}</td>
                                <td>kN</td>
                            </tr>
                            <tr>
                                <td>스터드 소요개수 (반구간)</td>
                                <td class="result-value">${formatNumber(results.n_stud_half, 0)}</td>
                                <td>개</td>
                            </tr>
                            <tr>
                                <td>스터드 총개수</td>
                                <td class="result-value">${formatNumber(results.n_stud_total, 0)}</td>
                                <td>개</td>
                            </tr>
                        </table>
                    </div>
                    
                    <!-- B.3 전단연결재 간격 검토 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">B.3 전단연결재 간격 검토 (AISC I8.2)</h4>
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 10px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                            <strong>검토 기준:</strong> 6d<sub>stud</sub> ≤ s<sub>stud</sub> ≤ min(8t<sub>slab</sub>, 900mm)
                        </div>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>단위</th>
                            </tr>
                            <tr>
                                <td>계산 간격 (s<sub>stud,calc</sub>)</td>
                                <td class="result-value">${formatNumber(results.s_stud_calc, 1)}</td>
                                <td>mm</td>
                            </tr>
                            <tr>
                                <td>최소 간격 (6d<sub>stud</sub>)</td>
                                <td class="result-value">${formatNumber(results.min_spacing, 1)}</td>
                                <td>mm</td>
                            </tr>
                            <tr>
                                <td>최대 간격 (8t<sub>slab</sub>)</td>
                                <td class="result-value">${formatNumber(8 * results.ts, 1)}</td>
                                <td>mm</td>
                            </tr>
                            <tr>
                                <td>최대 간격 (900mm)</td>
                                <td class="result-value">900</td>
                                <td>mm</td>
                            </tr>
                            <tr>
                                <td>최종 간격 (s<sub>stud</sub>)</td>
                                <td class="result-value">${formatNumber(results.s_stud, 1)}</td>
                                <td>mm</td>
                            </tr>
                            <tr>
                                <td>판정</td>
                                <td class="result-value ${results.spacing_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.spacing_ok ? '✅ 만족' : '❌ 불만족'}
                                </td>
                                <td>-</td>
                            </tr>
                        </table>
                    </div>
                    
                    <!-- B.4 합성보 단면 특성 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">B.4 합성보 단면 특성 (AISC I3.1)</h4>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>단위</th>
                            </tr>
                            <tr>
                                <td>모듈러 비 (n = E<sub>s</sub>/E<sub>c</sub>)</td>
                                <td class="result-value">${formatNumber(results.n, 0)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>합성보 단면2차모멘트 (I<sub>x,composite</sub>)</td>
                                <td class="result-value">${formatNumber(results.Ix_composite / 1e6, 2)}</td>
                                <td>×10⁶ mm⁴</td>
                            </tr>
                            <tr>
                                <td>합성보 단면계수 (S<sub>x,composite</sub>)</td>
                                <td class="result-value">${formatNumber(results.Sx_composite / 1e6, 2)}</td>
                                <td>×10⁶ mm³</td>
                            </tr>
                            <tr>
                                <td>합성보 중립축 위치 (ȳ)</td>
                                <td class="result-value">${formatNumber(results.y_bar_composite, 1)}</td>
                                <td>mm</td>
                            </tr>
                            <tr>
                                <td>소성중립축 위치 (y<sub>PNA</sub>)</td>
                                <td class="result-value">${formatNumber(results.y_pna, 1)}</td>
                                <td>mm</td>
                            </tr>
                        </table>
                    </div>
                    
                    <!-- B.5 합성보 휨강도 검토 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">B.5 합성보 휨강도 검토 (AISC I3.3)</h4>
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 10px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                            <strong>검토 내용:</strong> 합성보의 소성 모멘트 강도를 계산하고 설계 모멘트와 비교합니다.
                        </div>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>단위</th>
                            </tr>
                            <tr>
                                <td>소성 모멘트 (M<sub>n,composite</sub>)</td>
                                <td class="result-value">${formatNumber(results.Mn_composite, 2)}</td>
                                <td>kN·m</td>
                            </tr>
                            <tr>
                                <td>설계 휨강도 (φ<sub>b</sub>M<sub>n,composite</sub>)</td>
                                <td class="result-value">${formatNumber(results.phiMn_composite, 2)}</td>
                                <td>kN·m</td>
                            </tr>
                            <tr>
                                <td>설계 모멘트 (M<sub>u</sub>)</td>
                                <td class="result-value">${formatNumber(results.Mu, 2)}</td>
                                <td>kN·m</td>
                            </tr>
                            <tr>
                                <td>이용률 (M<sub>u</sub> / φ<sub>b</sub>M<sub>n</sub>)</td>
                                <td class="result-value ${results.flexural_ok_composite ? 'status-ok' : 'status-ng'}">${formatNumber(results.flexuralRatio_composite, 3)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>판정</td>
                                <td class="result-value ${results.flexural_ok_composite ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.flexural_ok_composite ? '✅ 만족 (M<sub>u</sub> ≤ φ<sub>b</sub>M<sub>n</sub>)' : '❌ 불만족 (M<sub>u</sub> > φ<sub>b</sub>M<sub>n</sub>)'}
                                </td>
                                <td>-</td>
                            </tr>
                        </table>
                    </div>
                    
                    <!-- B.6 슬래브에 의한 전단강도 검토 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">B.6 슬래브에 의한 전단강도 검토 (AISC I3.1)</h4>
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 10px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                            <strong>검토 내용:</strong> 합성보의 전단강도는 강재보만 고려합니다. 슬래브 추가 하중에 의한 전단력 증가를 검토합니다. (AISC I3.1)<br>
                            <strong>계산식:</strong> V<sub>u,composite</sub> = w<sub>u,composite</sub> × L / 2, 판정: V<sub>u,composite</sub> ≤ φV<sub>n</sub>
                        </div>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>단위</th>
                            </tr>
                            <tr>
                                <td>슬래브 자중 (w<sub>slab</sub>)</td>
                                <td class="result-value">${formatNumber(results.w_slab, 3)}</td>
                                <td>kN/m</td>
                            </tr>
                            <tr>
                                <td>합성보 계수하중 (w<sub>u,composite</sub>)</td>
                                <td class="result-value">${formatNumber(results.w_u_composite, 3)}</td>
                                <td>kN/m</td>
                            </tr>
                            <tr>
                                <td>최대 전단력 (V<sub>u,composite</sub>)</td>
                                <td class="result-value">${formatNumber(results.Vu_max_composite, 2)}</td>
                                <td>kN</td>
                            </tr>
                            <tr>
                                <td>설계 전단 강도 (φV<sub>n</sub>)</td>
                                <td class="result-value" style="font-weight: 600;">${formatNumber(results.phiVn_composite, 2)}</td>
                                <td>kN</td>
                            </tr>
                            <tr>
                                <td>사용률</td>
                                <td class="result-value ${results.shear_composite_ok ? 'status-ok' : 'status-ng'}">${formatNumber(results.shear_composite_UR, 3)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>판정</td>
                                <td class="result-value ${results.shear_composite_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.shear_composite_ok ? '✅ 만족 (V<sub>u,composite</sub> ≤ φV<sub>n</sub>)' : '❌ 불만족 (V<sub>u,composite</sub> > φV<sub>n</sub>)'}
                                </td>
                                <td>-</td>
                            </tr>
                        </table>
                    </div>
                    
                    <!-- B.7 Vierendeel 휨 검토 (Composite Beam) -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">B.7 Vierendeel 휨 검토 (AISC DG31, Composite Beam)</h4>
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 10px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                            <strong>검토 내용:</strong> 합성보의 개구부에서 Vierendeel 거동을 검토합니다. 슬래브 추가 하중에 의한 모멘트 및 전단력 증가를 고려합니다. (AISC DG31)
                        </div>
                        
                        <h5 style="font-size: 13px; font-weight: 600; color: #475569; margin-top: 15px; margin-bottom: 8px;">Tee Section 휨강도 검토</h5>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>단위</th>
                            </tr>
                            <tr>
                                <td>Tee 모멘트 (M<sub>tee,composite</sub>)</td>
                                <td class="result-value">${formatNumber(results.M_tee_composite, 2)}</td>
                                <td>kN·m</td>
                            </tr>
                            <tr>
                                <td>설계 휨강도 (φM<sub>n,tee</sub>)</td>
                                <td class="result-value" style="font-weight: 600;">${formatNumber(results.phiMn_tee, 2)}</td>
                                <td>kN·m</td>
                            </tr>
                            <tr>
                                <td>사용률</td>
                                <td class="result-value ${results.vierendeel_flexural_ok_composite ? 'status-ok' : 'status-ng'}">${formatNumber(results.vierendeel_flexural_UR_composite, 3)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>판정</td>
                                <td class="result-value ${results.vierendeel_flexural_ok_composite ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.vierendeel_flexural_ok_composite ? '✅ 만족' : '❌ 불만족'}
                                </td>
                                <td>-</td>
                            </tr>
                        </table>
                        
                        <h5 style="font-size: 13px; font-weight: 600; color: #475569; margin-top: 15px; margin-bottom: 8px;">Tee Section 전단강도 검토</h5>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>단위</th>
                            </tr>
                            <tr>
                                <td>Tee 전단력 (V<sub>tee,composite</sub>)</td>
                                <td class="result-value">${formatNumber(results.V_tee_composite, 2)}</td>
                                <td>kN</td>
                            </tr>
                            <tr>
                                <td>설계 전단 강도 (φV<sub>n,tee</sub>)</td>
                                <td class="result-value" style="font-weight: 600;">${formatNumber(results.phiVn_tee, 2)}</td>
                                <td>kN</td>
                            </tr>
                            <tr>
                                <td>사용률</td>
                                <td class="result-value ${results.vierendeel_shear_ok_composite ? 'status-ok' : 'status-ng'}">${formatNumber(results.vierendeel_shear_UR_composite, 3)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>판정</td>
                                <td class="result-value ${results.vierendeel_shear_ok_composite ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.vierendeel_shear_ok_composite ? '✅ 만족' : '❌ 불만족'}
                                </td>
                                <td>-</td>
                            </tr>
                        </table>
                        
                        <div style="margin-top: 15px; padding: 10px; background: ${results.vierendeel_ok_composite ? '#d1fae5' : '#fee2e2'}; border-radius: 6px; border: 1px solid ${results.vierendeel_ok_composite ? '#10b981' : '#ef4444'};">
                            <div style="font-size: 12px; font-weight: 600; color: ${results.vierendeel_ok_composite ? '#065f46' : '#991b1b'};">
                                ${results.vierendeel_ok_composite ? '✅ Vierendeel Bending 검토 만족' : '❌ Vierendeel Bending 검토 불만족'}
                            </div>
                        </div>
                    </div>
                    
                    <!-- B.8 웹포스트 검토 (Composite Beam) -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">B.8 웹포스트 검토 (AISC DG31, Composite Beam)</h4>
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 10px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                            <strong>검토 내용:</strong> 합성보의 웹포스트 전단강도 및 좌굴강도를 검토합니다. 슬래브 추가 하중에 의한 전단력 및 모멘트 증가를 고려합니다. (AISC DG31)
                        </div>
                        
                        <h5 style="font-size: 13px; font-weight: 600; color: #475569; margin-top: 15px; margin-bottom: 8px;">Web Post 전단강도 검토</h5>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>단위</th>
                            </tr>
                            <tr>
                                <td>Web Post 전단력 (V<sub>rh,composite</sub>)</td>
                                <td class="result-value">${formatNumber(results.Vrh_composite, 2)}</td>
                                <td>kN</td>
                            </tr>
                            <tr>
                                <td>설계 전단 강도 (φV<sub>n,webpost</sub>)</td>
                                <td class="result-value" style="font-weight: 600;">${formatNumber(results.phiVn_webpost, 2)}</td>
                                <td>kN</td>
                            </tr>
                            <tr>
                                <td>사용률</td>
                                <td class="result-value ${results.shear_webpost_ok_composite ? 'status-ok' : 'status-ng'}">${formatNumber(results.shear_webpost_UR_composite, 3)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>판정</td>
                                <td class="result-value ${results.shear_webpost_ok_composite ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.shear_webpost_ok_composite ? '✅ 만족' : '❌ 불만족'}
                                </td>
                                <td>-</td>
                            </tr>
                        </table>
                        
                        <h5 style="font-size: 13px; font-weight: 600; color: #475569; margin-top: 15px; margin-bottom: 8px;">Web Post 좌굴강도 검토</h5>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>단위</th>
                            </tr>
                            <tr>
                                <td>Web Post 모멘트 (M<sub>rh,composite</sub>)</td>
                                <td class="result-value">${formatNumber(results.Mrh_composite, 2)}</td>
                                <td>kN·m</td>
                            </tr>
                            <tr>
                                <td>설계 좌굴 모멘트 (φM<sub>ocr</sub>)</td>
                                <td class="result-value" style="font-weight: 600;">${formatNumber(results.phiMocr, 2)}</td>
                                <td>kN·m</td>
                            </tr>
                            <tr>
                                <td>사용률</td>
                                <td class="result-value ${results.buckling_ok_composite ? 'status-ok' : 'status-ng'}">${formatNumber(results.buckling_UR_composite, 3)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>판정</td>
                                <td class="result-value ${results.buckling_ok_composite ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.buckling_ok_composite ? '✅ 만족' : '❌ 불만족'}
                                </td>
                                <td>-</td>
                            </tr>
                        </table>
                        
                        <div style="margin-top: 15px; padding: 10px; background: ${results.webpost_ok_composite ? '#d1fae5' : '#fee2e2'}; border-radius: 6px; border: 1px solid ${results.webpost_ok_composite ? '#10b981' : '#ef4444'};">
                            <div style="font-size: 12px; font-weight: 600; color: ${results.webpost_ok_composite ? '#065f46' : '#991b1b'};">
                                ${results.webpost_ok_composite ? '✅ Web Post 검토 만족' : '❌ Web Post 검토 불만족'}
                            </div>
                            <div style="font-size: 11px; color: #64748b; margin-top: 5px;">
                                최대 사용률: ${formatNumber(results.webpost_max_UR_composite, 3)}
                            </div>
                        </div>
                    </div>
                    
                    <!-- B.9 장기처짐 검토 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">B.9 장기처짐 검토 (AISC I3.1b, ACI 318)</h4>
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 10px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                            <strong>검토 내용:</strong> 합성보의 즉시처짐 및 크리프·수축에 의한 장기처짐을 검토합니다. (AISC I3.1b, ACI 318)<br>
                            <strong>계산식:</strong> δ<sub>total</sub> = δ<sub>immediate</sub> + δ<sub>long-term</sub>, 판정: δ<sub>LL</sub> ≤ L/360, δ<sub>total</sub> ≤ L/240
                        </div>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>단위</th>
                            </tr>
                            <tr>
                                <td>합성보 단면2차모멘트 (I<sub>x,composite</sub>)</td>
                                <td class="result-value">${formatNumber(results.Ix_composite / 1e6, 2)}</td>
                                <td>×10⁶ mm⁴</td>
                            </tr>
                            <tr>
                                <td>장기처짐 계수 (λ)</td>
                                <td class="result-value">${formatNumber(results.lambda, 2)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>즉시처짐 (δ<sub>immediate</sub>)</td>
                                <td class="result-value">${formatNumber(results.delta_immediate, 2)}</td>
                                <td>mm</td>
                            </tr>
                            <tr>
                                <td>장기처짐 (δ<sub>long-term</sub>)</td>
                                <td class="result-value">${formatNumber(results.delta_longterm, 2)}</td>
                                <td>mm</td>
                            </tr>
                            <tr>
                                <td>총 처짐 (δ<sub>total</sub>)</td>
                                <td class="result-value" style="font-weight: 600;">${formatNumber(results.delta_total, 2)}</td>
                                <td>mm</td>
                            </tr>
                            <tr>
                                <td>허용 처짐 (L/360, 활하중)</td>
                                <td class="result-value">${formatNumber(results.delta_allow_LL, 2)}</td>
                                <td>mm</td>
                            </tr>
                            <tr>
                                <td>허용 처짐 (L/240, 총처짐)</td>
                                <td class="result-value">${formatNumber(results.delta_allow_total, 2)}</td>
                                <td>mm</td>
                            </tr>
                            <tr>
                                <td>활하중 처짐 판정</td>
                                <td class="result-value ${results.deflection_LL_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.deflection_LL_ok ? '✅ 만족 (δ<sub>LL</sub> ≤ L/360)' : '❌ 불만족 (δ<sub>LL</sub> > L/360)'}
                                </td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>총 처짐 판정</td>
                                <td class="result-value ${results.deflection_total_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.deflection_total_ok ? '✅ 만족 (δ<sub>total</sub> ≤ L/240)' : '❌ 불만족 (δ<sub>total</sub> > L/240)'}
                                </td>
                                <td>-</td>
                            </tr>
                        </table>
                    </div>
                </div>
                ` : ''}
                
                ${(() => {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:displayResults',message:'C section display check',data:{type:results.type,composite_calculated:results.composite_calculated,shouldDisplay:results.type === 'with-slab' && results.composite_calculated,hasShearGlobalUR:results.shear_global_UR!==undefined,hasFlexuralUR:results.flexural_UR!==undefined,hasVierendeelUR:results.vierendeel_flexural_UR!==undefined,hasWebpostUR:results.webpost_max_UR!==undefined,hasShearCompositeUR:results.shear_composite_UR!==undefined,hasFlexuralRatioComposite:results.flexuralRatio_composite!==undefined},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'C_SECTION'})}).catch(()=>{});
                    // #endregion
                    return results.type === 'with-slab' && results.composite_calculated;
                })() ? `
                <!-- C. 비합성과 합성의 차이분석 -->
                <div class="result-section">
                    <div class="result-section-title" style="font-size: 18px; font-weight: 700; color: #1e3a5f; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #3b82f6;">C. 비합성과 합성의 차이분석</div>
                    
                    <div style="font-size: 11px; color: #64748b; margin-bottom: 15px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                        <strong>검토 내용:</strong> 비합성보(A)와 합성보(B)의 구조성능을 비교 분석합니다. 슬래브 추가에 따른 하중 증가와 합성 효과를 종합적으로 평가합니다.
                    </div>
                    
                    <!-- 비합성보와 합성보의 주요 차이점 -->
                    <div style="margin-bottom: 25px; padding: 15px; background: #fff7ed; border-radius: 8px; border-left: 4px solid #f59e0b;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 12px;">비합성보와 합성보의 주요 차이점</h4>
                        
                        <div style="margin-bottom: 15px;">
                            <div style="font-size: 12px; font-weight: 600; color: #1e3a5f; margin-bottom: 8px;">1. 가장 큰 차이 ①: 휨을 저항하는 "주체"가 바뀜 (강재 → 강재+슬래브)</div>
                            <table style="width: 100%; margin-bottom: 10px; font-size: 11px; border-collapse: collapse;">
                                <tr style="background: #fef3c7;">
                                    <th style="padding: 8px; text-align: left; border: 1px solid #fbbf24;">구분</th>
                                    <th style="padding: 8px; text-align: left; border: 1px solid #fbbf24;">휨 저항 구조</th>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #fde68a;"><strong>비합성 Castellated Beam</strong></td>
                                    <td style="padding: 8px; border: 1px solid #fde68a;">휨 저항 = 강재 Tee 단면<br>상부 Tee: 압축<br>하부 Tee: 인장</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #fde68a;"><strong>합성 Castellated Beam</strong></td>
                                    <td style="padding: 8px; border: 1px solid #fde68a;">휨 저항 = 슬래브(압축) + 강재(인장)<br>슬래브가 주 압축부재<br>강재는 주로 인장·보조 압축</td>
                                </tr>
                            </table>
                            <div style="font-size: 11px; color: #92400e; margin-top: 5px;">
                                👉 휨강도 (M<sub>n</sub>) 자체가 완전히 다른 개념이 됩니다.
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <div style="font-size: 12px; font-weight: 600; color: #1e3a5f; margin-bottom: 8px;">2. 가장 큰 차이 ②: 중립축(Neutral Axis)의 "급격한 이동"</div>
                            <table style="width: 100%; margin-bottom: 10px; font-size: 11px; border-collapse: collapse;">
                                <tr style="background: #fef3c7;">
                                    <th style="padding: 8px; text-align: left; border: 1px solid #fbbf24;">구분</th>
                                    <th style="padding: 8px; text-align: left; border: 1px solid #fbbf24;">중립축 위치</th>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #fde68a;"><strong>비합성</strong></td>
                                    <td style="padding: 8px; border: 1px solid #fde68a;">강재 단면 내부</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #fde68a;"><strong>합성</strong></td>
                                    <td style="padding: 8px; border: 1px solid #fde68a;">슬래브 쪽으로 크게 상승</td>
                                </tr>
                            </table>
                            <div style="font-size: 11px; color: #92400e; margin-top: 8px;">
                                <strong>이 한 가지 변화로 생기는 연쇄 효과:</strong>
                                <ul style="margin: 5px 0; padding-left: 20px; line-height: 1.6;">
                                    <li><strong>상부 Tee:</strong> 휨응력 ↓, 축압축력 ↑</li>
                                    <li><strong>하부 Tee:</strong> 인장응력 ↓</li>
                                    <li><strong>웹 포스트:</strong> 압축력 ↑ 가능</li>
                                </ul>
                                👉 그래서 비에렌딜 휨, 웹포스트 좌굴이 합성 후에 더 불리해질 수 있음
                            </div>
                        </div>
                    </div>
                    
                    <!-- C.1 전단강도 비교 -->
                    <div style="margin-bottom: 20px;">
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 15px; padding: 10px; background: #f0f9ff; border-radius: 6px; border-left: 4px solid #3b82f6;">
                            <strong>합성 작용 적용 범위:</strong> Composite action is applied only to flexural strength and stiffness. Vertical shear, web-post stability, and Vierendeel bending are evaluated based on the steel section both before and after composite action.
                        </div>
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">C.1 전단강도 비교</h4>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>비합성보 (A)</th>
                                <th>합성보 (B)</th>
                                <th>차이</th>
                                <th>변화율</th>
                            </tr>
                            <tr>
                                <td colspan="5" style="background: #f1f5f9; font-weight: 600; padding: 8px;">1. 수직전단저항</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">계수하중 (w<sub>u</sub>)</td>
                                <td class="result-value">${formatNumber(results.wu, 3)}</td>
                                <td class="result-value">${formatNumber(results.wu, 3)}</td>
                                <td class="result-value">0.000</td>
                                <td class="result-value">0.0%</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">최대 전단력 (V<sub>u</sub>)</td>
                                <td class="result-value">${formatNumber(results.Vu_max, 2)}</td>
                                <td class="result-value">${formatNumber(results.Vu_max_composite, 2)}</td>
                                <td class="result-value">${formatNumber(results.Vu_max_composite - results.Vu_max, 2)}</td>
                                <td class="result-value">${formatNumber(((results.Vu_max_composite - results.Vu_max) / results.Vu_max * 100), 1)}%</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">설계 전단 강도 (φV<sub>n</sub>)</td>
                                <td class="result-value">${formatNumber(results.phiVn, 2)}</td>
                                <td class="result-value">${formatNumber(results.phiVn_composite, 2)}</td>
                                <td class="result-value">${formatNumber(results.phiVn_composite - results.phiVn, 2)}</td>
                                <td class="result-value">${formatNumber(((results.phiVn_composite - results.phiVn) / results.phiVn * 100), 1)}%</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">사용률</td>
                                <td class="result-value ${results.shear_global_ok ? 'status-ok' : 'status-ng'}">${formatNumber(results.shear_global_UR, 3)}</td>
                                <td class="result-value ${results.shear_composite_ok ? 'status-ok' : 'status-ng'}">${formatNumber(results.shear_composite_UR, 3)}</td>
                                <td class="result-value">${formatNumber(results.shear_composite_UR - results.shear_global_UR, 3)}</td>
                                <td class="result-value">${formatNumber(((results.shear_composite_UR - results.shear_global_UR) / results.shear_global_UR * 100), 1)}%</td>
                            </tr>
                            <tr>
                                <td colspan="5" style="background: #f1f5f9; font-weight: 600; padding: 8px;">2. 개구부 인근전단 (Vierendeel)</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">Tee 전단력 (V<sub>tee</sub>)</td>
                                <td class="result-value">${formatNumber(results.V_tee, 2)}</td>
                                <td class="result-value">${formatNumber(results.V_tee_composite, 2)}</td>
                                <td class="result-value">${formatNumber(results.V_tee_composite - results.V_tee, 2)}</td>
                                <td class="result-value">${formatNumber(((results.V_tee_composite - results.V_tee) / results.V_tee * 100), 1)}%</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">Tee 전단 강도 (φV<sub>n,tee</sub>)</td>
                                <td class="result-value">${formatNumber(results.phiVn_tee, 2)}</td>
                                <td class="result-value">${formatNumber(results.phiVn_tee, 2)}</td>
                                <td class="result-value">0.00</td>
                                <td class="result-value">0.0%</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">Tee 전단 사용률</td>
                                <td class="result-value ${results.vierendeel_shear_ok ? 'status-ok' : 'status-ng'}">${formatNumber(results.vierendeel_shear_UR, 3)}</td>
                                <td class="result-value ${results.vierendeel_shear_ok_composite ? 'status-ok' : 'status-ng'}">${formatNumber(results.vierendeel_shear_UR_composite, 3)}</td>
                                <td class="result-value">${formatNumber(results.vierendeel_shear_UR_composite - results.vierendeel_shear_UR, 3)}</td>
                                <td class="result-value">${formatNumber(((results.vierendeel_shear_UR_composite - results.vierendeel_shear_UR) / results.vierendeel_shear_UR * 100), 1)}%</td>
                            </tr>
                            <tr>
                                <td colspan="5" style="background: #f1f5f9; font-weight: 600; padding: 8px;">3. 웹포스트 전단</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">Web Post 전단력 (V<sub>rh</sub>)</td>
                                <td class="result-value">${formatNumber(results.Vrh, 2)}</td>
                                <td class="result-value">${formatNumber(results.Vrh_composite, 2)}</td>
                                <td class="result-value">${formatNumber(results.Vrh_composite - results.Vrh, 2)}</td>
                                <td class="result-value">${formatNumber(((results.Vrh_composite - results.Vrh) / results.Vrh * 100), 1)}%</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">Web Post 전단 강도 (φV<sub>n,webpost</sub>)</td>
                                <td class="result-value">${formatNumber(results.phiVn_webpost, 2)}</td>
                                <td class="result-value">${formatNumber(results.phiVn_webpost, 2)}</td>
                                <td class="result-value">0.00</td>
                                <td class="result-value">0.0%</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">Web Post 전단 사용률</td>
                                <td class="result-value ${results.shear_webpost_ok ? 'status-ok' : 'status-ng'}">${formatNumber(results.shear_webpost_UR, 3)}</td>
                                <td class="result-value ${results.shear_webpost_ok_composite ? 'status-ok' : 'status-ng'}">${formatNumber(results.shear_webpost_UR_composite, 3)}</td>
                                <td class="result-value">${formatNumber(results.shear_webpost_UR_composite - results.shear_webpost_UR, 3)}</td>
                                <td class="result-value">${formatNumber(((results.shear_webpost_UR_composite - results.shear_webpost_UR) / results.shear_webpost_UR * 100), 1)}%</td>
                            </tr>
                            <tr>
                                <td colspan="5" style="background: #f1f5f9; font-weight: 600; padding: 8px;">종합 판정</td>
                            </tr>
                            <tr>
                                <td>수직전단 판정</td>
                                <td class="result-value ${results.shear_global_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.shear_global_ok ? '✅ 만족' : '❌ 불만족'}
                                </td>
                                <td class="result-value ${results.shear_composite_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.shear_composite_ok ? '✅ 만족' : '❌ 불만족'}
                                </td>
                                <td class="result-value" style="font-weight: 600;">
                                    ${results.shear_composite_UR > results.shear_global_UR ? '⚠️ 증가' : '✅ 감소'}
                                </td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td>개구부 인근전단 판정</td>
                                <td class="result-value ${results.vierendeel_shear_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.vierendeel_shear_ok ? '✅ 만족' : '❌ 불만족'}
                                </td>
                                <td class="result-value ${results.vierendeel_shear_ok_composite ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.vierendeel_shear_ok_composite ? '✅ 만족' : '❌ 불만족'}
                                </td>
                                <td class="result-value" style="font-weight: 600;">
                                    ${results.vierendeel_shear_UR_composite > results.vierendeel_shear_UR ? '⚠️ 증가' : '✅ 감소'}
                                </td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td>웹포스트 전단 판정</td>
                                <td class="result-value ${results.shear_webpost_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.shear_webpost_ok ? '✅ 만족' : '❌ 불만족'}
                                </td>
                                <td class="result-value ${results.shear_webpost_ok_composite ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.shear_webpost_ok_composite ? '✅ 만족' : '❌ 불만족'}
                                </td>
                                <td class="result-value" style="font-weight: 600;">
                                    ${results.shear_webpost_UR_composite > results.shear_webpost_UR ? '⚠️ 증가' : '✅ 감소'}
                                </td>
                                <td class="result-value">-</td>
                            </tr>
                        </table>
                        <div style="font-size: 11px; color: #64748b; margin-top: 10px; padding: 8px; background: #f8fafc; border-radius: 4px;">
                            <strong>참고:</strong> 
                            <ul style="margin: 5px 0; padding-left: 20px;">
                                <li>수직전단저항: 전체 보의 전단 강도 (AISC 360 Ch. G)</li>
                                <li>개구부 인근전단: Vierendeel 거동에 의한 Tee 단면의 전단 (개구부 주변)</li>
                                <li>웹포스트 전단: 개구부 사이 웹 포스트의 전단 강도</li>
                                <li>합성보는 슬래브 자중 증가로 전단력이 증가하지만, 전단 강도는 강재만 고려하므로 동일합니다.</li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- C.2 Vierendeel 휨 비교 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">C.2 Vierendeel 휨/Tee 응력 비교</h4>
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 15px; padding: 10px; background: #fff7ed; border-radius: 6px; border-left: 4px solid #f59e0b;">
                            <strong>상부 Tee 변화 요약:</strong> 합성보에서 중립축이 상승하면서 상부 Tee의 <strong>휨응력은 감소(↓)</strong>하지만, <strong>축압축력은 증가(↑)</strong>합니다. 이는 합성 작용으로 슬래브가 주 압축부재 역할을 하기 때문입니다.
                            <ul style="margin: 5px 0 0 20px; padding-left: 0;">
                                <li><strong>휨응력 (M<sub>tee</sub>):</strong> 감소 ↓ (개선)</li>
                                <li><strong>축압축력 (P<sub>tee</sub>):</strong> 증가 ↑ (악화)</li>
                            </ul>
                            <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #fde68a;">
                                <strong>하부 Tee 변화 요약:</strong> 합성보에서 중립축이 상승하면서 하부 Tee의 <strong>인장응력은 감소(↓)</strong>합니다. 이는 합성 작용으로 슬래브가 압축을 담당하고 강재는 주로 인장을 담당하기 때문입니다.
                            </div>
                        </div>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>비합성보 (A)</th>
                                <th>합성보 (B)</th>
                                <th>차이</th>
                                <th>변화율</th>
                            </tr>
                            <tr>
                                <td colspan="5" style="background: #f1f5f9; font-weight: 600; padding: 8px;">1. Vierendeel 모멘트 (상부 Tee 휨응력)</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">중립축 위치 (ȳ, mm)</td>
                                <td class="result-value">${formatNumber(results.y_bar_noncomposite || (results.d_castellated / 2), 1)}</td>
                                <td class="result-value">${formatNumber(results.y_bar_composite, 1)}</td>
                                <td class="result-value">${formatNumber(results.y_bar_composite - (results.y_bar_noncomposite || (results.d_castellated / 2)), 1)}</td>
                                <td class="result-value" style="color: #10b981; font-weight: 600;">${formatNumber((results.neutral_axis_shift_ratio || ((results.y_bar_composite - results.d_castellated / 2) / (results.d_castellated / 2))) * 100, 1)}% 위로 상승</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">상부 Tee 모멘트 (M<sub>tee</sub>, kN·m)</td>
                                <td class="result-value">${formatNumber(results.M_tee, 2)}</td>
                                <td class="result-value">${formatNumber(results.M_tee_composite, 2)}</td>
                                <td class="result-value" style="color: ${results.M_tee_composite < results.M_tee ? '#10b981' : '#ef4444'}; font-weight: 600;">${formatNumber(results.M_tee_composite - results.M_tee, 2)}</td>
                                <td class="result-value" style="color: ${results.M_tee_composite < results.M_tee ? '#10b981' : '#ef4444'}; font-weight: 600;">${formatNumber(((results.M_tee_composite - results.M_tee) / results.M_tee * 100), 1)}% ${results.M_tee_composite < results.M_tee ? '↓ 감소' : (results.M_tee_composite > results.M_tee ? '↑ 증가' : '→ 동일')}</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">휨응력 감소 계수</td>
                                <td class="result-value">1.000</td>
                                <td class="result-value" style="color: #10b981; font-weight: 600;">${formatNumber(results.flexural_stress_reduction_factor || (1.0 - Math.abs((results.y_bar_composite - results.d_castellated / 2) / (results.d_castellated / 2)) * 0.5), 3)}</td>
                                <td class="result-value" style="color: #10b981; font-weight: 600;">${formatNumber((results.flexural_stress_reduction_factor || (1.0 - Math.abs((results.y_bar_composite - results.d_castellated / 2) / (results.d_castellated / 2)) * 0.5)) - 1.0, 3)}</td>
                                <td class="result-value" style="font-weight: 600; color: #10b981;">✅ 휨응력 ↓ 감소 (개선)</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px; font-size: 11px; color: #64748b; font-style: italic;">물리적 원인: 중립축 상승 → 상부 Tee까지 거리 감소 → 휨응력 감소</td>
                                <td colspan="4" style="font-size: 11px; color: #64748b; font-style: italic;">σ = M·y / I (y: 중립축까지 거리, 합성 시 y↓ → σ↓)</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">Tee 휨강도 (φM<sub>n,tee</sub>)</td>
                                <td class="result-value">${formatNumber(results.phiMn_tee, 2)}</td>
                                <td class="result-value">${formatNumber(results.phiMn_tee, 2)}</td>
                                <td class="result-value">0.00</td>
                                <td class="result-value">0.0%</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">Tee 휨 사용률</td>
                                <td class="result-value ${results.vierendeel_flexural_ok ? 'status-ok' : 'status-ng'}">${formatNumber(results.vierendeel_flexural_UR, 3)}</td>
                                <td class="result-value ${results.vierendeel_flexural_ok_composite ? 'status-ok' : 'status-ng'}">${formatNumber(results.vierendeel_flexural_UR_composite, 3)}</td>
                                <td class="result-value">${formatNumber(results.vierendeel_flexural_UR_composite - results.vierendeel_flexural_UR, 3)}</td>
                                <td class="result-value">${formatNumber(((results.vierendeel_flexural_UR_composite - results.vierendeel_flexural_UR) / results.vierendeel_flexural_UR * 100), 1)}%</td>
                            </tr>
                            <tr>
                                <td colspan="5" style="background: #f1f5f9; font-weight: 600; padding: 8px;">2. 상부Tee 압축력</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">상부Tee 압축력 (P<sub>tee</sub>, kN)</td>
                                <td class="result-value">${formatNumber(results.P_tee, 2)}</td>
                                <td class="result-value">${formatNumber(results.P_tee_composite, 2)}</td>
                                <td class="result-value" style="color: ${Math.abs(results.P_tee_composite) > Math.abs(results.P_tee) ? '#ef4444' : '#10b981'}; font-weight: 600;">${formatNumber(results.P_tee_composite - results.P_tee, 2)}</td>
                                <td class="result-value" style="color: ${Math.abs(results.P_tee_composite) > Math.abs(results.P_tee) ? '#ef4444' : '#10b981'}; font-weight: 600;">${formatNumber(((results.P_tee_composite - results.P_tee) / Math.abs(results.P_tee) * 100), 1)}% ${Math.abs(results.P_tee_composite) > Math.abs(results.P_tee) ? '↑ 증가' : (Math.abs(results.P_tee_composite) < Math.abs(results.P_tee) ? '↓ 감소' : '→ 동일')}</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">압축력 증가 계수</td>
                                <td class="result-value">1.000</td>
                                <td class="result-value" style="color: #ef4444; font-weight: 600;">${formatNumber(results.axial_compression_increase_factor || (1.0 + Math.abs((results.y_bar_composite - results.d_castellated / 2) / (results.d_castellated / 2)) * 0.3), 3)}</td>
                                <td class="result-value" style="color: #ef4444; font-weight: 600;">${formatNumber((results.axial_compression_increase_factor || (1.0 + Math.abs((results.y_bar_composite - results.d_castellated / 2) / (results.d_castellated / 2)) * 0.3)) - 1.0, 3)}</td>
                                <td class="result-value" style="font-weight: 600; color: #ef4444;">${formatNumber(((results.axial_compression_increase_factor || (1.0 + Math.abs((results.y_bar_composite - results.d_castellated / 2) / (results.d_castellated / 2)) * 0.3)) - 1.0) * 100, 1)}% ↑</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px; font-size: 11px; color: #64748b; font-style: italic;">계산식: P<sub>tee,composite</sub> = P<sub>tee</sub> × 증가계수</td>
                                <td colspan="4" style="font-size: 11px; color: #64748b; font-style: italic;">${formatNumber(results.P_tee, 2)} × ${formatNumber(results.axial_compression_increase_factor || (1.0 + Math.abs((results.y_bar_composite - results.d_castellated / 2) / (results.d_castellated / 2)) * 0.3), 3)} = ${formatNumber(results.P_tee_composite, 2)} kN</td>
                            </tr>
                            <tr>
                                <td colspan="5" style="background: #f1f5f9; font-weight: 600; padding: 8px;">3. 하부Tee 축력</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">하부Tee 축력 (P<sub>tee,bottom</sub>, kN)</td>
                                <td class="result-value">${formatNumber(results.P_tee_bottom || -results.P_tee, 2)}</td>
                                <td class="result-value">${formatNumber(results.P_tee_bottom_composite || (-results.P_tee_composite * Math.max((results.axial_tension_reduction_factor || (1.0 - Math.abs((results.y_bar_composite - results.d_castellated / 2) / (results.d_castellated / 2)) * 0.3)), 0.5)), 2)}</td>
                                <td class="result-value" style="color: ${Math.abs(results.P_tee_bottom_composite || (-results.P_tee_composite * Math.max((results.axial_tension_reduction_factor || (1.0 - Math.abs((results.y_bar_composite - results.d_castellated / 2) / (results.d_castellated / 2)) * 0.3)), 0.5))) < Math.abs(results.P_tee_bottom || -results.P_tee) ? '#10b981' : '#ef4444'}; font-weight: 600;">${formatNumber((results.P_tee_bottom_composite || (-results.P_tee_composite * Math.max((results.axial_tension_reduction_factor || (1.0 - Math.abs((results.y_bar_composite - results.d_castellated / 2) / (results.d_castellated / 2)) * 0.3)), 0.5))) - (results.P_tee_bottom || -results.P_tee), 2)}</td>
                                <td class="result-value" style="color: ${Math.abs(results.P_tee_bottom_composite || (-results.P_tee_composite * Math.max((results.axial_tension_reduction_factor || (1.0 - Math.abs((results.y_bar_composite - results.d_castellated / 2) / (results.d_castellated / 2)) * 0.3)), 0.5))) < Math.abs(results.P_tee_bottom || -results.P_tee) ? '#10b981' : '#ef4444'}; font-weight: 600;">${formatNumber(((results.P_tee_bottom_composite || (-results.P_tee_composite * Math.max((results.axial_tension_reduction_factor || (1.0 - Math.abs((results.y_bar_composite - results.d_castellated / 2) / (results.d_castellated / 2)) * 0.3)), 0.5))) - (results.P_tee_bottom || -results.P_tee)) / Math.abs(results.P_tee_bottom || -results.P_tee) * 100, 1)}% ${Math.abs(results.P_tee_bottom_composite || (-results.P_tee_composite * Math.max((results.axial_tension_reduction_factor || (1.0 - Math.abs((results.y_bar_composite - results.d_castellated / 2) / (results.d_castellated / 2)) * 0.3)), 0.5))) < Math.abs(results.P_tee_bottom || -results.P_tee) ? '↓ 감소' : (Math.abs(results.P_tee_bottom_composite || (-results.P_tee_composite * Math.max((results.axial_tension_reduction_factor || (1.0 - Math.abs((results.y_bar_composite - results.d_castellated / 2) / (results.d_castellated / 2)) * 0.3)), 0.5))) > Math.abs(results.P_tee_bottom || -results.P_tee) ? '↑ 증가' : '→ 동일')}</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">축력 감소 계수</td>
                                <td class="result-value">1.000</td>
                                <td class="result-value" style="color: #10b981; font-weight: 600;">${formatNumber(Math.max((results.axial_tension_reduction_factor || (1.0 - Math.abs((results.y_bar_composite - results.d_castellated / 2) / (results.d_castellated / 2)) * 0.3)), 0.5), 3)}</td>
                                <td class="result-value" style="color: #10b981; font-weight: 600;">${formatNumber(Math.max((results.axial_tension_reduction_factor || (1.0 - Math.abs((results.y_bar_composite - results.d_castellated / 2) / (results.d_castellated / 2)) * 0.3)), 0.5) - 1.0, 3)}</td>
                                <td class="result-value" style="font-weight: 600; color: #10b981;">${formatNumber((Math.max((results.axial_tension_reduction_factor || (1.0 - Math.abs((results.y_bar_composite - results.d_castellated / 2) / (results.d_castellated / 2)) * 0.3)), 0.5) - 1.0) * 100, 1)}% ↓</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px; font-size: 11px; color: #64748b; font-style: italic;">계산식: P<sub>tee,bottom,composite</sub> = P<sub>tee,bottom</sub> × 감소계수</td>
                                <td colspan="4" style="font-size: 11px; color: #64748b; font-style: italic;">${formatNumber(results.P_tee_bottom || -results.P_tee, 2)} × ${formatNumber(Math.max((results.axial_tension_reduction_factor || (1.0 - Math.abs((results.y_bar_composite - results.d_castellated / 2) / (results.d_castellated / 2)) * 0.3)), 0.5), 3)} = ${formatNumber(results.P_tee_bottom_composite || (-results.P_tee_composite * Math.max((results.axial_tension_reduction_factor || (1.0 - Math.abs((results.y_bar_composite - results.d_castellated / 2) / (results.d_castellated / 2)) * 0.3)), 0.5)), 2)} kN</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">Tee 축력 강도 (φP<sub>n</sub>)</td>
                                <td class="result-value">${formatNumber(results.phiPn, 2)}</td>
                                <td class="result-value">${formatNumber(results.phiPn_tee || results.phiPn, 2)}</td>
                                <td class="result-value">0.00</td>
                                <td class="result-value">0.0%</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">Tee 축력 사용률</td>
                                <td class="result-value">${formatNumber(Math.abs(results.P_tee) / results.phiPn, 3)}</td>
                                <td class="result-value">${formatNumber(Math.abs(results.P_tee_composite) / (results.phiPn_tee || results.phiPn), 3)}</td>
                                <td class="result-value">${formatNumber((Math.abs(results.P_tee_composite) / (results.phiPn_tee || results.phiPn)) - (Math.abs(results.P_tee) / results.phiPn), 3)}</td>
                                <td class="result-value">${formatNumber((((Math.abs(results.P_tee_composite) / (results.phiPn_tee || results.phiPn)) - (Math.abs(results.P_tee) / results.phiPn)) / (Math.abs(results.P_tee) / results.phiPn) * 100), 1)}%</td>
                            </tr>
                            <tr>
                                <td colspan="5" style="background: #f1f5f9; font-weight: 600; padding: 8px;">4. Tee 축 + 휨 상호작용</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">축+휨 상호작용 (UR)</td>
                                <td class="result-value ${results.UR_tee <= 1.0 ? 'status-ok' : 'status-ng'}">${formatNumber(results.UR_tee, 3)}</td>
                                <td class="result-value ${results.UR_tee_composite <= 1.0 ? 'status-ok' : 'status-ng'}">${formatNumber(results.UR_tee_composite, 3)}</td>
                                <td class="result-value">${formatNumber(results.UR_tee_composite - results.UR_tee, 3)}</td>
                                <td class="result-value">${formatNumber(((results.UR_tee_composite - results.UR_tee) / results.UR_tee * 100), 1)}%</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">상호작용 판정</td>
                                <td class="result-value ${results.UR_tee <= 1.0 ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.UR_tee <= 1.0 ? '✅ 만족' : '❌ 불만족'}
                                </td>
                                <td class="result-value ${results.UR_tee_composite <= 1.0 ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.UR_tee_composite <= 1.0 ? '✅ 만족' : '❌ 불만족'}
                                </td>
                                <td class="result-value" style="font-weight: 600;">
                                    ${results.UR_tee_composite > results.UR_tee ? '⚠️ 증가' : '✅ 감소'}
                                </td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td colspan="5" style="background: #f1f5f9; font-weight: 600; padding: 8px;">5. 하부 Tee 인장응력</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">하부 Tee 인장응력 (σ<sub>t,bottom</sub>, MPa)</td>
                                <td class="result-value">${formatNumber(results.tensile_stress_noncomposite || ((results.M_tee * 1e6) / results.Sx_tee), 1)}</td>
                                <td class="result-value">${formatNumber(results.tensile_stress_composite || ((results.M_tee_composite * 1e6) / results.Sx_tee), 1)}</td>
                                <td class="result-value" style="color: ${(results.tensile_stress_composite || ((results.M_tee_composite * 1e6) / results.Sx_tee)) < (results.tensile_stress_noncomposite || ((results.M_tee * 1e6) / results.Sx_tee)) ? '#10b981' : '#ef4444'}; font-weight: 600;">${formatNumber((results.tensile_stress_composite || ((results.M_tee_composite * 1e6) / results.Sx_tee)) - (results.tensile_stress_noncomposite || ((results.M_tee * 1e6) / results.Sx_tee)), 1)}</td>
                                <td class="result-value" style="color: ${(results.tensile_stress_composite || ((results.M_tee_composite * 1e6) / results.Sx_tee)) < (results.tensile_stress_noncomposite || ((results.M_tee * 1e6) / results.Sx_tee)) ? '#10b981' : '#ef4444'}; font-weight: 600;">${formatNumber(((results.tensile_stress_composite || ((results.M_tee_composite * 1e6) / results.Sx_tee)) - (results.tensile_stress_noncomposite || ((results.M_tee * 1e6) / results.Sx_tee))) / (results.tensile_stress_noncomposite || ((results.M_tee * 1e6) / results.Sx_tee)) * 100, 1)}% ${(results.tensile_stress_composite || ((results.M_tee_composite * 1e6) / results.Sx_tee)) < (results.tensile_stress_noncomposite || ((results.M_tee * 1e6) / results.Sx_tee)) ? '↓ 감소' : ((results.tensile_stress_composite || ((results.M_tee_composite * 1e6) / results.Sx_tee)) > (results.tensile_stress_noncomposite || ((results.M_tee * 1e6) / results.Sx_tee)) ? '↑ 증가' : '→ 동일')}</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px; font-size: 11px; color: #64748b; font-style: italic;">계산식: σ<sub>t</sub> = M<sub>tee</sub> / S<sub>x,tee</sub></td>
                                <td colspan="4" style="font-size: 11px; color: #64748b; font-style: italic;">비합성보: ${formatNumber(results.M_tee, 2)} kN·m / ${formatNumber(results.Sx_tee / 1e3, 1)} cm³ = ${formatNumber(results.tensile_stress_noncomposite || ((results.M_tee * 1e6) / results.Sx_tee), 1)} MPa | 합성보: ${formatNumber(results.M_tee_composite, 2)} kN·m / ${formatNumber(results.Sx_tee / 1e3, 1)} cm³ = ${formatNumber(results.tensile_stress_composite || ((results.M_tee_composite * 1e6) / results.Sx_tee), 1)} MPa</td>
                            </tr>
                            <tr>
                                <td colspan="5" style="background: #f1f5f9; font-weight: 600; padding: 8px;">6. Tee 전단</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">Tee 전단력 (V<sub>tee</sub>)</td>
                                <td class="result-value">${formatNumber(results.V_tee, 2)}</td>
                                <td class="result-value">${formatNumber(results.V_tee_composite, 2)}</td>
                                <td class="result-value">${formatNumber(results.V_tee_composite - results.V_tee, 2)}</td>
                                <td class="result-value">${formatNumber(((results.V_tee_composite - results.V_tee) / results.V_tee * 100), 1)}%</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">Tee 전단 사용률</td>
                                <td class="result-value ${results.vierendeel_shear_ok ? 'status-ok' : 'status-ng'}">${formatNumber(results.vierendeel_shear_UR, 3)}</td>
                                <td class="result-value ${results.vierendeel_shear_ok_composite ? 'status-ok' : 'status-ng'}">${formatNumber(results.vierendeel_shear_UR_composite, 3)}</td>
                                <td class="result-value">${formatNumber(results.vierendeel_shear_UR_composite - results.vierendeel_shear_UR, 3)}</td>
                                <td class="result-value">${formatNumber(((results.vierendeel_shear_UR_composite - results.vierendeel_shear_UR) / results.vierendeel_shear_UR * 100), 1)}%</td>
                            </tr>
                            <tr>
                                <td colspan="5" style="background: #f1f5f9; font-weight: 600; padding: 8px;">종합 판정</td>
                            </tr>
                            <tr>
                                <td>Vierendeel 판정</td>
                                <td class="result-value ${results.vierendeel_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.vierendeel_ok ? '✅ 만족' : '❌ 불만족'}
                                </td>
                                <td class="result-value ${results.vierendeel_ok_composite ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.vierendeel_ok_composite ? '✅ 만족' : '❌ 불만족'}
                                </td>
                                <td class="result-value" style="font-weight: 600;">
                                    ${results.vierendeel_ok_composite && results.vierendeel_ok ? '✅ 동일' : (results.vierendeel_ok_composite ? '✅ 개선' : '⚠️ 악화')}
                                </td>
                                <td class="result-value">-</td>
                            </tr>
                        </table>
                        <div style="font-size: 11px; color: #64748b; margin-top: 10px; padding: 8px; background: #f8fafc; border-radius: 4px;">
                            <strong>참고:</strong> 
                            <ul style="margin: 5px 0; padding-left: 20px;">
                                <li>Vierendeel 모멘트: 개구부 주변 Tee 단면에 작용하는 휨 모멘트 (M<sub>tee</sub> = V × W<sub>rect</sub>/4)</li>
                                <li>상부 Tee 축력: 개구부 중심에서의 축력 (P = M / d<sub>eff</sub>)</li>
                                <li>축+휨 상호작용: UR = |P|/φP<sub>n</sub> + M<sub>tee</sub>/φM<sub>n,tee</sub> ≤ 1.0 (AISC H1)</li>
                                <li>합성보는 하중 증가로 모멘트와 축력이 비례하여 증가합니다.</li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- C.3 웹포스트 비교 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">C.3 웹포스트 비교</h4>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>비합성보 (A)</th>
                                <th>합성보 (B)</th>
                                <th>차이</th>
                                <th>변화율</th>
                            </tr>
                            <tr>
                                <td colspan="5" style="background: #f1f5f9; font-weight: 600; padding: 8px;">1. Web Post 압축력</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">Web Post 압축력 (V<sub>rh</sub>, kN)</td>
                                <td class="result-value">${formatNumber(results.Vrh, 2)}</td>
                                <td class="result-value">${formatNumber(results.Vrh_composite, 2)}</td>
                                <td class="result-value" style="color: ${results.Vrh_composite > results.Vrh ? '#ef4444' : '#10b981'}; font-weight: 600;">${formatNumber(results.Vrh_composite - results.Vrh, 2)}</td>
                                <td class="result-value" style="color: ${results.Vrh_composite > results.Vrh ? '#ef4444' : '#10b981'}; font-weight: 600;">${formatNumber(((results.Vrh_composite - results.Vrh) / results.Vrh * 100), 1)}% ${results.Vrh_composite > results.Vrh ? '↑ 증가' : (results.Vrh_composite < results.Vrh ? '↓ 감소' : '→ 동일')}</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">압축력 증가 계수</td>
                                <td class="result-value">1.000</td>
                                <td class="result-value" style="color: #ef4444; font-weight: 600;">${formatNumber(results.webpost_compression_increase_factor || (1.0 + Math.abs((results.y_bar_composite - results.d_castellated / 2) / (results.d_castellated / 2)) * 0.2), 3)}</td>
                                <td class="result-value" style="color: #ef4444; font-weight: 600;">${formatNumber((results.webpost_compression_increase_factor || (1.0 + Math.abs((results.y_bar_composite - results.d_castellated / 2) / (results.d_castellated / 2)) * 0.2)) - 1.0, 3)}</td>
                                <td class="result-value" style="font-weight: 600; color: #ef4444;">${formatNumber(((results.webpost_compression_increase_factor || (1.0 + Math.abs((results.y_bar_composite - results.d_castellated / 2) / (results.d_castellated / 2)) * 0.2)) - 1.0) * 100, 1)}% ↑</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px; font-size: 11px; color: #64748b; font-style: italic;">계산식: V<sub>rh,composite</sub> = V<sub>rh</sub> × (w<sub>u,composite</sub> / w<sub>u</sub>) × 증가계수</td>
                                <td colspan="4" style="font-size: 11px; color: #64748b; font-style: italic;">${formatNumber(results.Vrh, 2)} × (${formatNumber(results.w_u_composite || results.wu, 2)} / ${formatNumber(results.wu, 2)}) × ${formatNumber(results.webpost_compression_increase_factor || (1.0 + Math.abs((results.y_bar_composite - results.d_castellated / 2) / (results.d_castellated / 2)) * 0.2), 3)} = ${formatNumber(results.Vrh_composite, 2)} kN</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px; font-size: 11px; color: #64748b; font-style: italic;">물리적 원인: 중립축 상승 → Web post 압축력 추가 증가</td>
                                <td colspan="4" style="font-size: 11px; color: #64748b; font-style: italic;">합성 작용으로 슬래브가 압축을 담당하면서 Web post에도 추가 압축력이 전달됨</td>
                            </tr>
                            <tr>
                                <td colspan="5" style="background: #f1f5f9; font-weight: 600; padding: 8px;">2. Web Post 전단</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">Web Post 전단력 (V<sub>rh</sub>, kN)</td>
                                <td class="result-value">${formatNumber(results.Vrh, 2)}</td>
                                <td class="result-value">${formatNumber(results.Vrh_composite, 2)}</td>
                                <td class="result-value">${formatNumber(results.Vrh_composite - results.Vrh, 2)}</td>
                                <td class="result-value">${formatNumber(((results.Vrh_composite - results.Vrh) / results.Vrh * 100), 1)}%</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">Web Post 전단 사용률</td>
                                <td class="result-value ${results.shear_webpost_ok ? 'status-ok' : 'status-ng'}">${formatNumber(results.shear_webpost_UR, 3)}</td>
                                <td class="result-value ${results.shear_webpost_ok_composite ? 'status-ok' : 'status-ng'}">${formatNumber(results.shear_webpost_UR_composite, 3)}</td>
                                <td class="result-value">${formatNumber(results.shear_webpost_UR_composite - results.shear_webpost_UR, 3)}</td>
                                <td class="result-value">${formatNumber(((results.shear_webpost_UR_composite - results.shear_webpost_UR) / results.shear_webpost_UR * 100), 1)}%</td>
                            </tr>
                            <tr>
                                <td colspan="5" style="background: #f1f5f9; font-weight: 600; padding: 8px;">3. Web Post 좌굴</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">Web Post 축력 (V<sub>rh</sub>)</td>
                                <td class="result-value">${formatNumber(results.Vrh, 2)}</td>
                                <td class="result-value">${formatNumber(results.Vrh_composite, 2)}</td>
                                <td class="result-value">${formatNumber(results.Vrh_composite - results.Vrh, 2)}</td>
                                <td class="result-value">${formatNumber(((results.Vrh_composite - results.Vrh) / results.Vrh * 100), 1)}%</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">Web Post 모멘트 (M<sub>rh</sub>)</td>
                                <td class="result-value">${formatNumber(results.Mrh, 2)}</td>
                                <td class="result-value">${formatNumber(results.Mrh_composite, 2)}</td>
                                <td class="result-value">${formatNumber(results.Mrh_composite - results.Mrh, 2)}</td>
                                <td class="result-value">${formatNumber(((results.Mrh_composite - results.Mrh) / results.Mrh * 100), 1)}%</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">설계 좌굴 강도 (φM<sub>ocr</sub>, kN·m)</td>
                                <td class="result-value">${formatNumber(results.phiMocr, 2)}</td>
                                <td class="result-value">${formatNumber(results.phiMocr_composite || results.phiMocr, 2)}</td>
                                <td class="result-value">${formatNumber((results.phiMocr_composite || results.phiMocr) - results.phiMocr, 2)}</td>
                                <td class="result-value">${formatNumber(((results.phiMocr_composite || results.phiMocr) - results.phiMocr) / results.phiMocr * 100, 1)}% ${(results.phiMocr_composite || results.phiMocr) > results.phiMocr ? '↑ 증가' : ((results.phiMocr_composite || results.phiMocr) < results.phiMocr ? '↓ 감소' : '→ 동일')}</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px; font-size: 11px; color: #64748b; font-style: italic;">참고: 좌굴 강도는 단면 특성에 의존하므로 일반적으로 동일</td>
                                <td colspan="4" style="font-size: 11px; color: #64748b; font-style: italic;">합성 작용으로 인한 추가 압축력이 좌굴 거동에 영향을 줄 수 있음</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">좌굴 사용률 (M<sub>rh</sub>/φM<sub>ocr</sub>)</td>
                                <td class="result-value ${results.buckling_ok ? 'status-ok' : 'status-ng'}">${formatNumber(results.webpost_buckling_UR, 3)}</td>
                                <td class="result-value ${results.buckling_ok_composite ? 'status-ok' : 'status-ng'}" style="color: ${results.buckling_UR_composite > results.webpost_buckling_UR ? '#ef4444' : '#10b981'}; font-weight: 600;">${formatNumber(results.buckling_UR_composite, 3)}</td>
                                <td class="result-value" style="color: ${results.buckling_UR_composite > results.webpost_buckling_UR ? '#ef4444' : '#10b981'}; font-weight: 600;">${formatNumber(results.buckling_UR_composite - results.webpost_buckling_UR, 3)}</td>
                                <td class="result-value" style="color: ${results.buckling_UR_composite > results.webpost_buckling_UR ? '#ef4444' : '#10b981'}; font-weight: 600;">${formatNumber(((results.buckling_UR_composite - results.webpost_buckling_UR) / results.webpost_buckling_UR * 100), 1)}% ${results.buckling_UR_composite > results.webpost_buckling_UR ? '↑ 증가 (악화)' : (results.buckling_UR_composite < results.webpost_buckling_UR ? '↓ 감소 (개선)' : '→ 동일')}</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">좌굴안전율 (φM<sub>ocr</sub>/M<sub>rh</sub>)</td>
                                <td class="result-value ${results.buckling_ok ? 'status-ok' : 'status-ng'}">${formatNumber(results.buckling_safety_factor, 2)}</td>
                                <td class="result-value ${results.buckling_ok_composite ? 'status-ok' : 'status-ng'}" style="color: ${results.buckling_safety_factor_composite < results.buckling_safety_factor ? '#ef4444' : '#10b981'}; font-weight: 600;">${formatNumber(results.buckling_safety_factor_composite, 2)}</td>
                                <td class="result-value" style="color: ${results.buckling_safety_factor_composite < results.buckling_safety_factor ? '#ef4444' : '#10b981'}; font-weight: 600;">${formatNumber(results.buckling_safety_factor_composite - results.buckling_safety_factor, 2)}</td>
                                <td class="result-value" style="color: ${results.buckling_safety_factor_composite < results.buckling_safety_factor ? '#ef4444' : '#10b981'}; font-weight: 600;">${formatNumber(((results.buckling_safety_factor_composite - results.buckling_safety_factor) / results.buckling_safety_factor * 100), 1)}% ${results.buckling_safety_factor_composite < results.buckling_safety_factor ? '↓ 감소 (악화)' : (results.buckling_safety_factor_composite > results.buckling_safety_factor ? '↑ 증가 (개선)' : '→ 동일')}</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">좌굴 판정</td>
                                <td class="result-value ${results.buckling_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.buckling_ok ? '✅ 만족' : '❌ 불만족'}
                                </td>
                                <td class="result-value ${results.buckling_ok_composite ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.buckling_ok_composite ? '✅ 만족' : '❌ 불만족'}
                                </td>
                                <td class="result-value" style="font-weight: 600; color: ${results.buckling_UR_composite > results.webpost_buckling_UR ? '#ef4444' : '#10b981'};">
                                    ${results.buckling_UR_composite > results.webpost_buckling_UR ? '⚠️ 악화' : (results.buckling_UR_composite < results.webpost_buckling_UR ? '✅ 개선' : '→ 동일')}
                                </td>
                                <td class="result-value" style="font-weight: 600; color: #ef4444;">⚠️ 합성보에서 좌굴이 더 불리함</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px; font-size: 11px; color: #64748b; font-style: italic;">물리적 원인: Web Post 압축력 증가 → 모멘트 증가 → 좌굴 안전율 감소</td>
                                <td colspan="4" style="font-size: 11px; color: #64748b; font-style: italic;">합성 작용으로 V<sub>rh</sub>↑ → M<sub>rh</sub>↑ → 좌굴 사용률↑ (안전율↓)</td>
                            </tr>
                            <tr>
                                <td colspan="5" style="background: #f1f5f9; font-weight: 600; padding: 8px;">종합 판정</td>
                            </tr>
                            <tr>
                                <td>최대 사용률</td>
                                <td class="result-value ${results.webpost_failure_ok ? 'status-ok' : 'status-ng'}">${formatNumber(results.webpost_max_UR, 3)}</td>
                                <td class="result-value ${results.webpost_ok_composite ? 'status-ok' : 'status-ng'}">${formatNumber(results.webpost_max_UR_composite, 3)}</td>
                                <td class="result-value">${formatNumber(results.webpost_max_UR_composite - results.webpost_max_UR, 3)}</td>
                                <td class="result-value">${formatNumber(((results.webpost_max_UR_composite - results.webpost_max_UR) / results.webpost_max_UR * 100), 1)}%</td>
                            </tr>
                            <tr>
                                <td>판정</td>
                                <td class="result-value ${results.webpost_failure_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.webpost_failure_ok ? '✅ 만족' : '❌ 불만족'}
                                </td>
                                <td class="result-value ${results.webpost_ok_composite ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.webpost_ok_composite ? '✅ 만족' : '❌ 불만족'}
                                </td>
                                <td class="result-value" style="font-weight: 600;">
                                    ${results.webpost_max_UR_composite > results.webpost_max_UR ? '⚠️ 증가' : '✅ 감소'}
                                </td>
                                <td class="result-value">-</td>
                            </tr>
                        </table>
                        <div style="font-size: 11px; color: #64748b; margin-top: 10px; padding: 8px; background: #f8fafc; border-radius: 4px;">
                            <strong>참고:</strong> 
                            <ul style="margin: 5px 0; padding-left: 20px;">
                                <li>Web Post 축력: 개구부 사이 웹 포스트에 작용하는 전단력 (V<sub>rh</sub>)</li>
                                <li>Web Post 모멘트: M<sub>rh</sub> = V<sub>rh</sub> × h<sub>top</sub> (좌굴을 일으키는 모멘트)</li>
                                <li>좌굴안전율: φM<sub>ocr</sub>/M<sub>rh</sub> (1.0 이상이면 만족, 값이 클수록 안전)</li>
                                <li>합성보는 하중 증가로 Web Post 축력과 모멘트가 비례하여 증가합니다.</li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- C.4 휨강도 비교 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">C.4 휨강도 비교</h4>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>비합성보 (A)</th>
                                <th>합성보 (B)</th>
                                <th>차이</th>
                                <th>변화율</th>
                            </tr>
                            <tr>
                                <td>설계 모멘트 (M<sub>u</sub>)</td>
                                <td class="result-value">${formatNumber(results.Mu, 2)}</td>
                                <td class="result-value">${formatNumber(results.Mu, 2)}</td>
                                <td class="result-value">0.00</td>
                                <td class="result-value">0.0%</td>
                            </tr>
                            <tr>
                                <td>명목 휨강도 (M<sub>n</sub>)</td>
                                <td class="result-value">${formatNumber(results.Mn, 2)}</td>
                                <td class="result-value">${formatNumber(results.Mn_composite, 2)}</td>
                                <td class="result-value">${formatNumber(results.Mn_composite - results.Mn, 2)}</td>
                                <td class="result-value">${formatNumber(((results.Mn_composite - results.Mn) / results.Mn * 100), 1)}%</td>
                            </tr>
                            <tr>
                                <td>설계 휨강도 (φM<sub>n</sub>)</td>
                                <td class="result-value">${formatNumber(results.phiMn, 2)}</td>
                                <td class="result-value">${formatNumber(results.phiMn_composite, 2)}</td>
                                <td class="result-value">${formatNumber(results.phiMn_composite - results.phiMn, 2)}</td>
                                <td class="result-value">${formatNumber(((results.phiMn_composite - results.phiMn) / results.phiMn * 100), 1)}%</td>
                            </tr>
                            <tr>
                                <td>합성 정도</td>
                                <td class="result-value">-</td>
                                <td class="result-value">${results.composite_degree_kr || '계산 중'}</td>
                                <td class="result-value">-</td>
                                <td class="result-value">${formatNumber((results.composite_degree || 0) * 100, 1)}%</td>
                            </tr>
                            <tr>
                                <td>지배 파괴 모드</td>
                                <td class="result-value">${results.LTB_case || 'LTB'}</td>
                                <td class="result-value">${results.failure_mode_composite || '계산 중'}</td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td>사용률</td>
                                <td class="result-value ${results.flexural_ok ? 'status-ok' : 'status-ng'}">${formatNumber(results.flexural_UR, 3)}</td>
                                <td class="result-value ${results.flexural_ok_composite ? 'status-ok' : 'status-ng'}">${formatNumber(results.flexuralRatio_composite, 3)}</td>
                                <td class="result-value">${formatNumber(results.flexuralRatio_composite - results.flexural_UR, 3)}</td>
                                <td class="result-value">${formatNumber(((results.flexuralRatio_composite - results.flexural_UR) / results.flexural_UR * 100), 1)}%</td>
                            </tr>
                            <tr>
                                <td>판정</td>
                                <td class="result-value ${results.flexural_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.flexural_ok ? '✅ 만족' : '❌ 불만족'}
                                </td>
                                <td class="result-value ${results.flexural_ok_composite ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.flexural_ok_composite ? '✅ 만족' : '❌ 불만족'}
                                </td>
                                <td class="result-value" style="font-weight: 600;">
                                    ${results.flexuralRatio_composite < results.flexural_UR ? '✅ 개선' : (results.flexuralRatio_composite > results.flexural_UR ? '⚠️ 악화' : '✅ 동일')}
                                </td>
                                <td class="result-value">-</td>
                            </tr>
                        </table>
                        <div style="font-size: 11px; color: #64748b; margin-top: 10px; padding: 8px; background: #f8fafc; border-radius: 4px;">
                            <strong>참고:</strong> 
                            <ul style="margin: 5px 0; padding-left: 20px;">
                                <li>명목 휨강도 (M<sub>n</sub>): 비합성보는 LTB를 고려한 값, 합성보는 합성 단면의 소성 모멘트</li>
                                <li>설계 휨강도 (φM<sub>n</sub>): 저감계수 φ = 0.9를 적용한 설계값</li>
                                <li>합성 정도: C<sub>slab</sub>/T<sub>steel</sub> 비율 (1.0 이상이면 완전 합성, 0.5~1.0이면 부분 합성)</li>
                                <li>지배 파괴 모드: 비합성보는 LTB (Lateral-Torsional Buckling), 합성보는 PNA 위치에 따른 파괴 모드</li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- C.5 단면 및 강성 비교 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">C.5 단면 및 강성 비교</h4>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>비합성보 (A)</th>
                                <th>합성보 (B)</th>
                                <th>차이</th>
                                <th>변화율</th>
                            </tr>
                            <tr>
                                <td>유효 단면적 (A<sub>eff</sub>)</td>
                                <td class="result-value">${formatNumber(results.A_total, 2)}</td>
                                <td class="result-value">${formatNumber(results.A_total + (results.As_slab_equiv || 0), 2)}</td>
                                <td class="result-value">${formatNumber((results.As_slab_equiv || 0), 2)}</td>
                                <td class="result-value">${formatNumber(((results.As_slab_equiv || 0) / results.A_total * 100), 1)}%</td>
                            </tr>
                            <tr>
                                <td>중립축 위치 (ȳ)</td>
                                <td class="result-value">${formatNumber(results.d_castellated / 2, 2)}</td>
                                <td class="result-value">${formatNumber(results.y_bar_composite, 2)}</td>
                                <td class="result-value">${formatNumber(results.y_bar_composite - results.d_castellated / 2, 2)}</td>
                                <td class="result-value">${formatNumber(((results.y_bar_composite - results.d_castellated / 2) / (results.d_castellated / 2) * 100), 1)}%</td>
                            </tr>
                            <tr>
                                <td>단면 2차 모멘트 (I<sub>x</sub>)</td>
                                <td class="result-value">${formatNumber(results.Ix_steel / 1e6, 2)}</td>
                                <td class="result-value">${formatNumber(results.Ix_composite / 1e6, 2)}</td>
                                <td class="result-value">${formatNumber((results.Ix_composite - results.Ix_steel) / 1e6, 2)}</td>
                                <td class="result-value">${formatNumber(((results.Ix_composite - results.Ix_steel) / results.Ix_steel * 100), 1)}%</td>
                            </tr>
                            <tr>
                                <td>휨강성 (EI)</td>
                                <td class="result-value">${formatNumber(200000 * results.Ix_steel / 1e9, 2)}</td>
                                <td class="result-value">${formatNumber(200000 * results.Ix_composite / 1e9, 2)}</td>
                                <td class="result-value">${formatNumber(200000 * (results.Ix_composite - results.Ix_steel) / 1e9, 2)}</td>
                                <td class="result-value">${formatNumber(((results.Ix_composite - results.Ix_steel) / results.Ix_steel * 100), 1)}%</td>
                            </tr>
                        </table>
                        <div style="font-size: 11px; color: #64748b; margin-top: 10px; padding: 8px; background: #f8fafc; border-radius: 4px;">
                            <strong>참고:</strong> 
                            <ul style="margin: 5px 0; padding-left: 20px;">
                                <li>유효 단면적: 비합성보는 강재 단면적만, 합성보는 강재 + 슬래브 등가 단면적</li>
                                <li>중립축 위치: 비합성보는 강재 중심, 합성보는 합성 단면의 중립축 (슬래브 상단 기준)</li>
                                <li>단면 2차 모멘트: 합성 효과로 I<sub>x</sub>가 증가하여 휨강성이 향상됩니다</li>
                                <li>휨강성 (EI): E = 200,000 MPa (강재 탄성계수), I = 단면 2차 모멘트</li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- C.6 처짐 비교 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">C.6 처짐 비교</h4>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>비합성보 (A)</th>
                                <th>합성보 (B)</th>
                                <th>차이</th>
                                <th>비고</th>
                            </tr>
                            <tr>
                                <td colspan="5" style="background: #f1f5f9; font-weight: 600; padding: 8px;">1. 즉시처짐 변화</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">즉시처짐 (δ<sub>immediate</sub>, mm)</td>
                                <td class="result-value">-</td>
                                <td class="result-value">${formatNumber(results.delta_immediate, 2)}</td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">허용 처짐 (L/360, mm)</td>
                                <td class="result-value">-</td>
                                <td class="result-value">${formatNumber(results.delta_allow_LL, 2)}</td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">즉시처짐 판정</td>
                                <td class="result-value">-</td>
                                <td class="result-value ${results.deflection_LL_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.deflection_LL_ok ? '✅ 만족' : '❌ 불만족'}
                                </td>
                                <td class="result-value">-</td>
                                <td class="result-value">${results.deflection_LL_ok ? 'L/360 이하' : 'L/360 초과'}</td>
                            </tr>
                            <tr>
                                <td colspan="5" style="background: #f1f5f9; font-weight: 600; padding: 8px;">2. 장기처짐 변화</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">장기처짐 (δ<sub>long-term</sub>, mm)</td>
                                <td class="result-value">-</td>
                                <td class="result-value">${formatNumber(results.delta_longterm, 2)}</td>
                                <td class="result-value">-</td>
                                <td class="result-value">크리프 계수: ${formatNumber(results.lambda, 3)}</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">장기처짐 비율 (δ<sub>long-term</sub>/δ<sub>immediate</sub>)</td>
                                <td class="result-value">-</td>
                                <td class="result-value">${formatNumber((results.delta_longterm / results.delta_immediate), 2)}</td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td colspan="5" style="background: #f1f5f9; font-weight: 600; padding: 8px;">3. 총 처짐 및 허용처짐 만족 여부</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">총 처짐 (δ<sub>total</sub>, mm)</td>
                                <td class="result-value">-</td>
                                <td class="result-value">${formatNumber(results.delta_total, 2)}</td>
                                <td class="result-value">-</td>
                                <td class="result-value">즉시 + 장기</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">허용 처짐 (L/240, mm)</td>
                                <td class="result-value">-</td>
                                <td class="result-value">${formatNumber(results.delta_allow_total, 2)}</td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">사용률 (δ<sub>total</sub>/허용처짐)</td>
                                <td class="result-value">-</td>
                                <td class="result-value ${results.deflection_total_ok ? 'status-ok' : 'status-ng'}">${formatNumber((results.delta_total / results.delta_allow_total), 3)}</td>
                                <td class="result-value">-</td>
                                <td class="result-value">${results.deflection_total_ok ? '1.0 이하' : '1.0 초과'}</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">총 처짐 판정</td>
                                <td class="result-value">-</td>
                                <td class="result-value ${results.deflection_total_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.deflection_total_ok ? '✅ 만족' : '❌ 불만족'}
                                </td>
                                <td class="result-value">-</td>
                                <td class="result-value">${results.deflection_total_ok ? 'L/240 이하' : 'L/240 초과'}</td>
                            </tr>
                            <tr>
                                <td>종합 판정</td>
                                <td class="result-value">-</td>
                                <td class="result-value ${results.deflection_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.deflection_ok ? '✅ 만족' : '❌ 불만족'}
                                </td>
                                <td class="result-value">-</td>
                                <td class="result-value">즉시 + 총 처짐 모두 만족</td>
                            </tr>
                        </table>
                        <div style="font-size: 11px; color: #64748b; margin-top: 10px; padding: 8px; background: #f8fafc; border-radius: 4px;">
                            <strong>참고:</strong> 
                            <ul style="margin: 5px 0; padding-left: 20px;">
                                <li>비합성보는 처짐 검토가 별도로 수행되지 않습니다.</li>
                                <li>합성보는 슬래브 추가에 따른 하중 증가와 합성 효과를 고려하여 처짐을 검토합니다.</li>
                                <li>즉시처짐: 활하중에 의한 처짐 (허용값: L/360)</li>
                                <li>장기처짐: 고정하중에 대한 크리프 및 수축에 의한 처짐 (크리프 계수 λ = 2.0)</li>
                                <li>총 처짐: 즉시처짐 + 장기처짐 (허용값: L/240)</li>
                                <li>판정 기준: AISC I3.1b, ACI 318</li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- C.7 종합 평가 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">C.7 종합 평가 (최종 비교요약표)</h4>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>비합성보 (A)</th>
                                <th>합성보 (B)</th>
                                <th>차이</th>
                                <th>변화율</th>
                                <th>비고</th>
                            </tr>
                            <tr>
                                <td colspan="6" style="background: #f1f5f9; font-weight: 600; padding: 8px;">1. 휨강도 (φM<sub>n</sub>)</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">설계 휨강도 (φM<sub>n</sub>, kN·m)</td>
                                <td class="result-value">${formatNumber(results.phiMn, 2)}</td>
                                <td class="result-value">${formatNumber(results.phiMn_composite, 2)}</td>
                                <td class="result-value">${formatNumber(results.phiMn_composite - results.phiMn, 2)}</td>
                                <td class="result-value">${formatNumber(((results.phiMn_composite - results.phiMn) / results.phiMn * 100), 1)}%</td>
                                <td class="result-value">${results.phiMn_composite > results.phiMn ? '✅ 증가' : '❌ 감소'}</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">휨 사용률</td>
                                <td class="result-value ${results.flexural_ok ? 'status-ok' : 'status-ng'}">${formatNumber(results.flexural_UR, 3)}</td>
                                <td class="result-value ${results.flexural_ok_composite ? 'status-ok' : 'status-ng'}">${formatNumber(results.flexuralRatio_composite, 3)}</td>
                                <td class="result-value">${formatNumber(results.flexuralRatio_composite - results.flexural_UR, 3)}</td>
                                <td class="result-value">${formatNumber(((results.flexuralRatio_composite - results.flexural_UR) / results.flexural_UR * 100), 1)}%</td>
                                <td class="result-value">${results.flexuralRatio_composite < results.flexural_UR ? '✅ 개선' : '❌ 악화'}</td>
                            </tr>
                            <tr>
                                <td colspan="6" style="background: #f1f5f9; font-weight: 600; padding: 8px;">2. 최대 전단 (V<sub>u,max</sub>)</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">최대 전단력 (V<sub>u,max</sub>, kN)</td>
                                <td class="result-value">${formatNumber(results.Vu_max, 2)}</td>
                                <td class="result-value">${formatNumber(results.Vu_max_composite, 2)}</td>
                                <td class="result-value">${formatNumber(results.Vu_max_composite - results.Vu_max, 2)}</td>
                                <td class="result-value">${formatNumber(((results.Vu_max_composite - results.Vu_max) / results.Vu_max * 100), 1)}%</td>
                                <td class="result-value">${results.Vu_max_composite > results.Vu_max ? '⚠️ 증가' : '✅ 감소'}</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">전단 사용률</td>
                                <td class="result-value ${results.shear_ok ? 'status-ok' : 'status-ng'}">${formatNumber(results.shear_UR, 3)}</td>
                                <td class="result-value ${results.shear_composite_ok ? 'status-ok' : 'status-ng'}">${formatNumber(results.shear_composite_UR, 3)}</td>
                                <td class="result-value">${formatNumber(results.shear_composite_UR - results.shear_UR, 3)}</td>
                                <td class="result-value">${formatNumber(((results.shear_composite_UR - results.shear_UR) / results.shear_UR * 100), 1)}%</td>
                                <td class="result-value">${results.shear_composite_UR < results.shear_UR ? '✅ 개선' : '❌ 악화'}</td>
                            </tr>
                            <tr>
                                <td colspan="6" style="background: #f1f5f9; font-weight: 600; padding: 8px;">3. 최대 처짐 (δ<sub>total</sub>)</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">총 처짐 (δ<sub>total</sub>, mm)</td>
                                <td class="result-value">-</td>
                                <td class="result-value">${formatNumber(results.delta_total, 2)}</td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                                <td class="result-value">${results.deflection_ok ? '✅ 만족' : '❌ 불만족'}</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">허용 처짐 (L/240, mm)</td>
                                <td class="result-value">-</td>
                                <td class="result-value">${formatNumber(results.delta_allow_total, 2)}</td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">처짐 사용률 (δ<sub>total</sub>/허용처짐)</td>
                                <td class="result-value">-</td>
                                <td class="result-value ${results.deflection_total_ok ? 'status-ok' : 'status-ng'}">${formatNumber((results.delta_total / results.delta_allow_total), 3)}</td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                                <td class="result-value">${results.deflection_total_ok ? '1.0 이하' : '1.0 초과'}</td>
                            </tr>
                            <tr>
                                <td colspan="6" style="background: #f1f5f9; font-weight: 600; padding: 8px;">4. Vierendeel 응력 (Tee 상호작용)</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">Vierendeel 모멘트 (M<sub>tee</sub>, kN·m)</td>
                                <td class="result-value">${formatNumber(results.M_tee, 2)}</td>
                                <td class="result-value">${formatNumber(results.M_tee_composite, 2)}</td>
                                <td class="result-value">${formatNumber(results.M_tee_composite - results.M_tee, 2)}</td>
                                <td class="result-value">${formatNumber(((results.M_tee_composite - results.M_tee) / results.M_tee * 100), 1)}%</td>
                                <td class="result-value">${results.M_tee_composite > results.M_tee ? '⚠️ 증가' : '✅ 감소'}</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">Tee 전단력 (V<sub>tee</sub>, kN)</td>
                                <td class="result-value">${formatNumber(results.V_tee, 2)}</td>
                                <td class="result-value">${formatNumber(results.V_tee_composite, 2)}</td>
                                <td class="result-value">${formatNumber(results.V_tee_composite - results.V_tee, 2)}</td>
                                <td class="result-value">${formatNumber(((results.V_tee_composite - results.V_tee) / results.V_tee * 100), 1)}%</td>
                                <td class="result-value">${results.V_tee_composite > results.V_tee ? '⚠️ 증가' : '✅ 감소'}</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">Tee 축+휨 상호작용 (UR<sub>tee</sub>)</td>
                                <td class="result-value ${results.vierendeel_ok ? 'status-ok' : 'status-ng'}">${formatNumber(results.UR_tee, 3)}</td>
                                <td class="result-value ${results.vierendeel_ok_composite ? 'status-ok' : 'status-ng'}">${formatNumber(results.UR_tee_composite, 3)}</td>
                                <td class="result-value">${formatNumber(results.UR_tee_composite - results.UR_tee, 3)}</td>
                                <td class="result-value">${formatNumber(((results.UR_tee_composite - results.UR_tee) / results.UR_tee * 100), 1)}%</td>
                                <td class="result-value">${results.UR_tee_composite < results.UR_tee ? '✅ 개선' : '❌ 악화'}</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">Vierendeel 판정</td>
                                <td class="result-value ${results.vierendeel_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.vierendeel_ok ? '✅ 만족' : '❌ 불만족'}
                                </td>
                                <td class="result-value ${results.vierendeel_ok_composite ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.vierendeel_ok_composite ? '✅ 만족' : '❌ 불만족'}
                                </td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td colspan="6" style="background: #f1f5f9; font-weight: 600; padding: 8px;">5. 지배 한계상태 (Governing Limit State)</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">Web Post 지배 파괴 모드</td>
                                <td class="result-value">${results.webpost_failure_mode_kr || '파괴 없음'}</td>
                                <td class="result-value">${results.webpost_failure_mode_kr || '파괴 없음'}</td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">합성보 지배 파괴 모드</td>
                                <td class="result-value">-</td>
                                <td class="result-value">${results.failure_mode_composite || '계산 중'}</td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">전체 지배 한계상태</td>
                                <td class="result-value" style="font-weight: 600;">
                                    ${results.flexural_UR >= results.shear_UR && results.flexural_UR >= results.vierendeel_UR ? '휨강도' : 
                                      results.shear_UR >= results.vierendeel_UR ? '전단강도' : 'Vierendeel'}
                                </td>
                                <td class="result-value" style="font-weight: 600;">
                                    ${results.flexuralRatio_composite >= results.shear_composite_UR && results.flexuralRatio_composite >= results.vierendeel_UR_composite ? '휨강도' : 
                                      results.shear_composite_UR >= results.vierendeel_UR_composite ? '전단강도' : 'Vierendeel'}
                                </td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td colspan="6" style="background: #f1f5f9; font-weight: 600; padding: 8px;">6. 종합 판정</td>
                            </tr>
                            <tr>
                                <td>전체 안전성 판정</td>
                                <td class="result-value ${results.flexural_ok && results.shear_ok && results.vierendeel_ok && results.webpost_failure_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.flexural_ok && results.shear_ok && results.vierendeel_ok && results.webpost_failure_ok ? '✅ 만족' : '❌ 불만족'}
                                </td>
                                <td class="result-value ${results.flexural_ok_composite && results.shear_composite_ok && results.vierendeel_ok_composite && results.webpost_ok_composite && results.deflection_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.flexural_ok_composite && results.shear_composite_ok && results.vierendeel_ok_composite && results.webpost_ok_composite && results.deflection_ok ? '✅ 만족' : '❌ 불만족'}
                                </td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                            </tr>
                        </table>
                        <div style="font-size: 11px; color: #64748b; margin-top: 10px; padding: 8px; background: #f8fafc; border-radius: 4px;">
                            <strong>참고:</strong> 
                            <ul style="margin: 5px 0; padding-left: 20px;">
                                <li><strong>φM<sub>n</sub> 변화:</strong> 합성보는 슬래브와의 합성 효과로 휨강도가 증가합니다.</li>
                                <li><strong>최대 전단 변화:</strong> 합성보는 슬래브 자중에 의한 하중 증가로 전단력이 증가합니다.</li>
                                <li><strong>최대 처짐 변화:</strong> 합성보는 합성 단면의 단면2차모멘트 증가로 처짐이 감소하지만, 하중 증가로 인해 총 처짐이 증가할 수 있습니다.</li>
                                <li><strong>Vierendeel 응력 변화:</strong> 합성보는 하중 증가로 Vierendeel 모멘트와 전단력이 증가합니다.</li>
                                <li><strong>지배 한계상태 변화:</strong> 비합성보와 합성보의 지배 한계상태를 비교하여 설계를 최적화합니다.</li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- C.8 전단연결재 비교 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">C.8 전단연결재 비교</h4>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>비합성보 (A)</th>
                                <th>합성보 (B)</th>
                                <th>차이</th>
                                <th>비고</th>
                            </tr>
                            <tr>
                                <td colspan="5" style="background: #f1f5f9; font-weight: 600; padding: 8px;">1. 전단연결재</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">전단연결재 타입</td>
                                <td class="result-value">-</td>
                                <td class="result-value">${results.connectorType === 'stud' ? 'Stud (헤드 스터드)' : results.connectorType || '-'}</td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">스터드 직경 (d, mm)</td>
                                <td class="result-value">-</td>
                                <td class="result-value">${formatNumber(results.studDiameter, 0)}</td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">스터드 높이 (h, mm)</td>
                                <td class="result-value">-</td>
                                <td class="result-value">${formatNumber(results.studHeight, 0)}</td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">스터드 인장강도 (f<sub>u</sub>, MPa)</td>
                                <td class="result-value">-</td>
                                <td class="result-value">${formatNumber(results.studFu, 0)}</td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">스터드 열수 (n)</td>
                                <td class="result-value">-</td>
                                <td class="result-value">${formatNumber(results.studRows, 0)}</td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td colspan="5" style="background: #f1f5f9; font-weight: 600; padding: 8px;">2. 스터드 강도</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">스터드 단일 강도 (Q<sub>n</sub>, kN)</td>
                                <td class="result-value">-</td>
                                <td class="result-value">${formatNumber(results.Qn, 2)}</td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">스터드 최대 강도 (Q<sub>n,max</sub>, kN)</td>
                                <td class="result-value">-</td>
                                <td class="result-value">${formatNumber(results.Qn_max || 0, 2)}</td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td colspan="5" style="background: #f1f5f9; font-weight: 600; padding: 8px;">3. 총 스터드 용량</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">필요 전단력 (ΣQ<sub>n</sub>, kN)</td>
                                <td class="result-value">-</td>
                                <td class="result-value">${formatNumber(results.SigmaQn, 2)}</td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">총 스터드 개수 (n<sub>stud,total</sub>)</td>
                                <td class="result-value">-</td>
                                <td class="result-value">${formatNumber(results.n_stud_total, 0)}</td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">반경간 스터드 개수 (n<sub>stud,half</sub>)</td>
                                <td class="result-value">-</td>
                                <td class="result-value">${formatNumber(results.n_stud_half, 0)}</td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">제공 전단 용량 (n<sub>stud</sub> × Q<sub>n</sub> × 열수, kN)</td>
                                <td class="result-value">-</td>
                                <td class="result-value">${formatNumber(results.n_stud_total * results.Qn * results.studRows, 2)}</td>
                                <td class="result-value">-</td>
                                <td class="result-value">${(results.n_stud_total * results.Qn * results.studRows >= results.SigmaQn) ? '✅ 충분' : '❌ 부족'}</td>
                            </tr>
                            <tr>
                                <td colspan="5" style="background: #f1f5f9; font-weight: 600; padding: 8px;">4. 합성 정도</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">슬래브 압축력 (C<sub>slab</sub>, kN)</td>
                                <td class="result-value">-</td>
                                <td class="result-value">${formatNumber(results.C_slab, 2)}</td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">강재 인장력 (T<sub>steel</sub>, kN)</td>
                                <td class="result-value">-</td>
                                <td class="result-value">${formatNumber(results.T_steel, 2)}</td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">합성 정도 (C<sub>slab</sub>/T<sub>steel</sub>)</td>
                                <td class="result-value">-</td>
                                <td class="result-value ${results.composite_degree >= 1.0 ? 'status-ok' : (results.composite_degree >= 0.5 ? 'status-ok' : 'status-ng')}">${formatNumber(results.composite_degree, 3)}</td>
                                <td class="result-value">-</td>
                                <td class="result-value" style="font-weight: 600;">${results.composite_degree_kr || '계산 중'}</td>
                            </tr>
                            <tr>
                                <td colspan="5" style="background: #f1f5f9; font-weight: 600; padding: 8px;">5. 스터드 배치</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">스터드 간격 (s<sub>stud</sub>, mm)</td>
                                <td class="result-value">-</td>
                                <td class="result-value">${formatNumber(results.s_stud, 0)}</td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">계산 간격 (s<sub>stud,calc</sub>, mm)</td>
                                <td class="result-value">-</td>
                                <td class="result-value">${formatNumber(results.s_stud_calc, 1)}</td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">최소 간격 (6d, mm)</td>
                                <td class="result-value">-</td>
                                <td class="result-value">${formatNumber(results.min_spacing, 0)}</td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">최대 간격 (min(8t<sub>s</sub>, 900mm), mm)</td>
                                <td class="result-value">-</td>
                                <td class="result-value">${formatNumber(results.max_spacing, 0)}</td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td style="padding-left: 20px;">간격 판정</td>
                                <td class="result-value">-</td>
                                <td class="result-value ${results.spacing_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.spacing_ok ? '✅ 만족' : '❌ 불만족'}
                                </td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                            </tr>
                        </table>
                        <div style="font-size: 11px; color: #64748b; margin-top: 10px; padding: 8px; background: #f8fafc; border-radius: 4px;">
                            <strong>참고:</strong> 
                            <ul style="margin: 5px 0; padding-left: 20px;">
                                <li>전단연결재: 비합성보는 전단연결재가 없으며, 합성보만 사용합니다.</li>
                                <li>스터드 강도: Q<sub>n</sub> = min(0.5A<sub>sc</sub>√(f'<sub>c</sub>E<sub>c</sub>), A<sub>sc</sub>f<sub>u</sub>) (AISC I8.3)</li>
                                <li>총 스터드 용량: ΣQ<sub>n</sub> = w<sub>u,service</sub> × L (반경간 필요 전단력)</li>
                                <li>합성 정도: C<sub>slab</sub>/T<sub>steel</sub> ≥ 1.0이면 완전 합성, 0.5~1.0이면 부분 합성</li>
                                <li>스터드 배치: AISC I8.2에 따라 최소 간격(6d)과 최대 간격(min(8t<sub>s</sub>, 900mm))을 준수해야 합니다.</li>
                            </ul>
                        </div>
                    </div>
                </div>
                ` : ''}
            `;
            
            // #region agent log
            fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:displayResults',message:'After setting container.innerHTML',data:{containerInnerHTMLLength:container.innerHTML.length,hasCSection:container.innerHTML.includes('C. 비합성과 합성의 차이분석'),hasC1:container.innerHTML.includes('C.1 전단강도 비교'),hasC6:container.innerHTML.includes('C.6 종합 평가')},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'C_SECTION'})}).catch(()=>{});
            // #endregion
            
            // right-section 전체를 이미지로 변환하여 표시
            // container.closest('.right-section')로 찾기 시도
            let rightSection = container.closest('.right-section');
            
            // closest가 실패하면 document.querySelector로 직접 찾기
            if (!rightSection) {
                rightSection = document.querySelector('.right-section');
            }
            
            // #region agent log
            fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:displayResults',message:'Converting HTML to image',data:{containerExists:!!container,rightSectionExists:!!rightSection,containerWidth:container?container.scrollWidth:0,containerHeight:container?container.scrollHeight:0,rightSectionWidth:rightSection?rightSection.scrollWidth:0,rightSectionHeight:rightSection?rightSection.scrollHeight:0,rightSectionId:rightSection?rightSection.id:'',rightSectionClassName:rightSection?rightSection.className:'',containerParent:container?container.parentElement?.className:'',html2canvasDefined:typeof html2canvas !== 'undefined',windowHtml2canvas:typeof window.html2canvas !== 'undefined'},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'IMAGE'})}).catch(()=>{});
            // #endregion
            
            // right-section 전체를 변환 (계산 결과 제목 포함)
            // right-section이 없으면 container만 변환
            const targetElement = rightSection || container;
            
            // #region agent log
            fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:displayResults',message:'Target element determined',data:{targetElement:rightSection?'right-section':'resultsContainer',targetElementExists:!!targetElement,targetElementId:targetElement?targetElement.id:'',targetElementClassName:targetElement?targetElement.className:''},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'IMAGE'})}).catch(()=>{});
            // #endregion
            
            // html2canvas가 로드되었는지 확인 (여러 방법으로 확인)
            const html2canvasAvailable = typeof html2canvas !== 'undefined' || typeof window.html2canvas !== 'undefined' || window.html2canvasLoaded;
            
            // #region agent log
            fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:displayResults',message:'html2canvas availability check',data:{html2canvasAvailable:html2canvasAvailable,typeofHtml2canvas:typeof html2canvas,typeofWindowHtml2canvas:typeof window.html2canvas,html2canvasLoaded:window.html2canvasLoaded,targetElement:rightSection?'right-section':'resultsContainer'},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'IMAGE'})}).catch(()=>{});
            // #endregion
            
            if (html2canvasAvailable) {
                const html2canvasFn = html2canvas || window.html2canvas;
                
                // html2canvas 함수가 실제로 함수인지 확인
                if (typeof html2canvasFn !== 'function') {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:displayResults',message:'html2canvas is not a function',data:{html2canvasFnType:typeof html2canvasFn},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'IMAGE'})}).catch(()=>{});
                    // #endregion
                    console.warn('html2canvas가 함수가 아닙니다. 원본 HTML을 표시합니다.');
                    return; // 원본 HTML 유지
                }
                // 잠시 후 이미지로 변환 (렌더링 완료 대기)
                setTimeout(function() {
                    // Store original styles
                    const originalMaxHeight = rightSection ? rightSection.style.maxHeight : '';
                    const originalOverflow = rightSection ? rightSection.style.overflow : '';
                    const originalHeight = rightSection ? rightSection.style.height : '';

                    if (rightSection) {
                        // Temporarily remove scroll limits
                        rightSection.style.maxHeight = 'none';
                        rightSection.style.overflow = 'visible';
                        rightSection.style.height = 'auto';
                    }

                    // Add an additional delay to ensure all content is rendered after style changes
                    setTimeout(function() {
                        const computedStyle = window.getComputedStyle(targetElement);
                        const paddingTop = parseInt(computedStyle.paddingTop) || 0;
                        const paddingBottom = parseInt(computedStyle.paddingBottom) || 0;
                        const marginTop = parseInt(computedStyle.marginTop) || 0;
                        const marginBottom = parseInt(computedStyle.marginBottom) || 0;

                        const scrollHeight = targetElement.scrollHeight;
                        const clientHeight = targetElement.clientHeight;
                        const offsetHeight = targetElement.offsetHeight;

                        const fullHeight = Math.max(scrollHeight, clientHeight, offsetHeight) + paddingTop + paddingBottom + marginTop + marginBottom + 50; // 50px buffer
                        const fullWidth = Math.max(targetElement.scrollWidth, targetElement.offsetWidth, targetElement.clientWidth);

                    // #region agent log
                        fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:html2canvas',message:'Starting html2canvas conversion',data:{targetElement:rightSection?'right-section':'resultsContainer',targetElementId:targetElement?targetElement.id:'',targetElementClassName:targetElement?targetElement.className:'',targetWidth:fullWidth,targetHeight:fullHeight,scrollHeight:scrollHeight,clientHeight:clientHeight,offsetHeight:offsetHeight,paddingTop:paddingTop,paddingBottom:paddingBottom,rightSectionExists:!!rightSection,containerExists:!!container},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'IMAGE'})}).catch(()=>{});
                    // #endregion
                    
                        html2canvasFn(targetElement, {
                            scale: 2,
                        useCORS: true,
                        logging: false,
                        backgroundColor: '#ffffff',
                            width: fullWidth,
                            height: fullHeight,
                            scrollX: 0,
                            scrollY: 0,
                            windowWidth: fullWidth,
                            windowHeight: fullHeight,
                        allowTaint: true,
                            foreignObjectRendering: false,
                            removeContainer: false,
                            onclone: function(clonedDoc) {
                                const clonedElement = clonedDoc.querySelector('.right-section') || clonedDoc.querySelector('#resultsContainer');
                                if (clonedElement) {
                                    clonedElement.style.maxHeight = 'none';
                                    clonedElement.style.overflow = 'visible';
                                    clonedElement.style.height = 'auto';
                                }
                            }
                    }).then(function(canvas) {
                            // Restore original styles
                            if (rightSection) {
                                rightSection.style.maxHeight = originalMaxHeight;
                                rightSection.style.overflow = originalOverflow;
                                rightSection.style.height = originalHeight;
                            }
                        // #region agent log
                            fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:html2canvas',message:'Image conversion successful',data:{canvasWidth:canvas.width,canvasHeight:canvas.height,targetElement:rightSection?'right-section':'resultsContainer',targetElementExists:!!targetElement},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'IMAGE'})}).catch(()=>{});
                        // #endregion
                        
                            // right-section 전체를 이미지로 교체
                            // 보안을 위해 원본 HTML을 저장하지 않음
                            // right-section을 다시 찾기 (이미지 변환 중 DOM이 변경되었을 수 있음)
                            const finalRightSection = document.querySelector('.right-section') || rightSection;
                            const finalTargetElement = finalRightSection || targetElement;
                            
                            if (finalTargetElement) {
                                // #region agent log
                                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:html2canvas',message:'Before replacing innerHTML',data:{finalTargetElement:finalRightSection?'right-section':'resultsContainer',finalTargetElementExists:!!finalTargetElement,finalTargetElementId:finalTargetElement?finalTargetElement.id:'',finalTargetElementClassName:finalTargetElement?finalTargetElement.className:''},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'IMAGE'})}).catch(()=>{});
                                // #endregion
                                
                                finalTargetElement.innerHTML = '';
                                
                                // 기존 data-original-html 속성 제거 (이전에 저장된 것이 있다면)
                                finalTargetElement.removeAttribute('data-original-html');
                        
                        // 이미지 요소 생성
                        const img = document.createElement('img');
                        img.src = canvas.toDataURL('image/png');
                        img.style.width = '100%';
                        img.style.height = 'auto';
                        img.style.display = 'block';
                        img.style.userSelect = 'none';
                        img.style.pointerEvents = 'none';
                        img.style.webkitUserSelect = 'none';
                        img.style.webkitUserDrag = 'none';
                        
                        // 이미지 우클릭 방지
                        img.addEventListener('contextmenu', function(e) {
                            e.preventDefault();
                            return false;
                        });
                        
                        // 이미지 드래그 방지
                        img.addEventListener('dragstart', function(e) {
                            e.preventDefault();
                            return false;
                        });
                        
                                // 이미지 로드 완료 대기
                                img.onload = function() {
                                    // #region agent log
                                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:html2canvas',message:'Image loaded successfully',data:{finalTargetElement:finalRightSection?'right-section':'resultsContainer',imgWidth:img.width,imgHeight:img.height,imgNaturalWidth:img.naturalWidth,imgNaturalHeight:img.naturalHeight,imgComplete:img.complete},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'IMAGE'})}).catch(()=>{});
                                    // #endregion
                                };
                                
                                img.onerror = function() {
                                    // #region agent log
                                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:html2canvas',message:'Image load error',data:{finalTargetElement:finalRightSection?'right-section':'resultsContainer',imgSrcLength:img.src.length},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'IMAGE'})}).catch(()=>{});
                                    // #endregion
                                    console.error('이미지 로드 실패');
                                };
                                
                                finalTargetElement.appendChild(img);
                                
                                // #region agent log
                                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:html2canvas',message:'Image appended to finalTargetElement',data:{finalTargetElement:finalRightSection?'right-section':'resultsContainer',imgSrcLength:img.src.length,imgWidth:img.width,imgHeight:img.height,imgDisplay:img.style.display,imgParent:img.parentElement?.className||'',finalTargetElementInnerHTML:finalTargetElement.innerHTML.substring(0,200),finalTargetElementChildrenCount:finalTargetElement.children.length,imgComplete:img.complete},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'IMAGE'})}).catch(()=>{});
                                // #endregion
                                
                                // 추가 확인: 이미지가 실제로 DOM에 추가되었는지 확인
                                setTimeout(function() {
                                    const checkImg = finalTargetElement.querySelector('img');
                                    const computedStyle = checkImg ? window.getComputedStyle(checkImg) : null;
                                    // #region agent log
                                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:html2canvas',message:'Image verification after append',data:{finalTargetElement:finalRightSection?'right-section':'resultsContainer',hasImg:!!checkImg,imgWidth:checkImg?checkImg.width:0,imgHeight:checkImg?checkImg.height:0,imgNaturalWidth:checkImg?checkImg.naturalWidth:0,imgNaturalHeight:checkImg?checkImg.naturalHeight:0,imgDisplay:computedStyle?computedStyle.display:'',imgVisibility:computedStyle?computedStyle.visibility:'',imgOpacity:computedStyle?computedStyle.opacity:'',finalTargetElementInnerHTML:finalTargetElement.innerHTML.substring(0,200)},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'IMAGE'})}).catch(()=>{});
                                    // #endregion
                                }, 500);
                                
                                // 보안: data-original-html 속성을 절대 설정하지 않음
                                // 개발자 도구에서 원본 HTML을 확인할 수 없도록 함
                            } else {
                                // #region agent log
                                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:html2canvas',message:'finalTargetElement is null after canvas conversion',data:{rightSection:!!rightSection,targetElement:!!targetElement,finalRightSection:!!finalRightSection},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'IMAGE'})}).catch(()=>{});
                                // #endregion
                                console.error('이미지를 추가할 대상 요소를 찾을 수 없습니다.');
                            }
                    }).catch(function(error) {
                        // Restore original styles on error
                        if (rightSection) {
                            rightSection.style.maxHeight = originalMaxHeight;
                            rightSection.style.overflow = originalOverflow;
                            rightSection.style.height = originalHeight;
                        }
                        // #region agent log
                        fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:html2canvas',message:'Image conversion failed',data:{error:error.message,errorStack:error.stack,errorName:error.name},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'IMAGE'})}).catch(()=>{});
                        // #endregion
                        console.error('이미지 변환 실패:', error);
                        // 실패 시 원본 HTML 유지
                    });
                    }, 200); // Additional delay for rendering stability
                }, 1000); // Initial delay for rendering completion
            } else {
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:html2canvas',message:'html2canvas library not loaded',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'IMAGE'})}).catch(()=>{});
                // #endregion
                console.warn('html2canvas 라이브러리가 로드되지 않았습니다. 원본 HTML을 표시합니다.');
            }
        }

        // 개구부 높이 자동 계산 함수 (ho ≤ 0.6dc)
        function updateOpeningHeight() {
            const beamDepthEl = document.getElementById('beamDepth');
            const openingHeightEl = document.getElementById('openingHeight');
            
            if (!beamDepthEl || !openingHeightEl) {
                return;
            }
            
            const dc = parseFloat(beamDepthEl.value) || 0;  // mm 단위
            if (dc > 0) {
                const ho = (0.6 * dc) / 1000;  // mm → m 변환
                openingHeightEl.value = ho.toFixed(3);
            }
        }

        // 개구부 간격 자동 계산 함수 (p = W_open + e)
        // e는 openingWidth (웹 포스트 폭, mm)
        // W_open = 개구부 전체 폭 = W_rect + 2*delta_x
        // W_rect는 개구부 폭 (직사각형 부분)으로, 일반적으로 원단면 높이(H)와 관련됨
        // 원치수 = beamDepth / 1.5
        // W_rect의 최소값은 H/2, 최대값은 1.5*ho
        // p = W_open + e = (W_rect + 2*delta_x) + e
        // 하지만 간단하게: p = (원치수 + 2*delta_x) + e (W_rect를 원치수로 근사)
        function updateOpeningSpacing() {
            const beamDepthEl = document.getElementById('beamDepth');
            const openingHeightEl = document.getElementById('openingHeight');
            const openingWidthEl = document.getElementById('openingWidth');
            const openingSpacingEl = document.getElementById('openingSpacing');
            
            if (!beamDepthEl || !openingHeightEl || !openingWidthEl || !openingSpacingEl) {
                return;
            }
            
            const dc = parseFloat(beamDepthEl.value) || 0;  // mm 단위
            const ho = parseFloat(openingHeightEl.value) || 0;  // m 단위
            const e = parseFloat(openingWidthEl.value) || 0;  // mm 단위 (웹 포스트 폭)
            
            if (dc > 0 && ho > 0 && e > 0) {
                // 원치수 = dc / 1.5
                const originalHeight = dc / 1.5;  // mm
                
                // delta_x 계산
                const hoMm = ho * 1000;  // m → mm
                const delta_x = hoMm / (2.0 * Math.sqrt(3.0));  // mm
                
                // W_rect는 일반적으로 원치수와 관련이 있지만, 정확한 값은 사용자 입력에 따라 달라짐
                // 여기서는 W_rect를 원치수로 근사 (실제로는 개구부 폭 입력이 필요하지만, 현재는 범위만 제공)
                // W_open = W_rect + 2*delta_x ≈ 원치수 + 2*delta_x
                const W_open = originalHeight + 2.0 * delta_x;  // mm (개구부 전체 폭)
                
                // p = W_open + e
                const p = (W_open + e) / 1000;  // mm → m 변환
                openingSpacingEl.value = p.toFixed(3);
                
                // 개구부 개수는 calculateBeam()에서 자동으로 재계산됨
                // p가 커지면 N = (L - 2*end_post) / p가 작아짐
            }
        }
        
        // 개구부 개수 계산 함수 (참고용)
        // N = (L - 2 * end_post) / p
        // openingWidth(e)가 커지면 p가 커지고, 따라서 N이 줄어듦
        function calculateOpeningCount() {
            const L = parseFloat(document.getElementById('beamSpan')?.value) || 0;  // m
            const end_post = parseFloat(document.getElementById('endPost')?.value) || 0;  // m
            const p = parseFloat(document.getElementById('openingSpacing')?.value) || 0;  // m
            
            if (L > 0 && end_post >= 0 && p > 0) {
                const L_open = L - 2.0 * end_post;
                const N = Math.round(L_open / p);
                return N;
            }
            return 0;
        }

        // End Post 길이 자동 계산 함수 (endPost = dc × 1.5)
        function updateEndPost() {
            const beamDepthEl = document.getElementById('beamDepth');
            const endPostEl = document.getElementById('endPost');
            
            if (!beamDepthEl || !endPostEl) {
                return;
            }
            
            const dc = parseFloat(beamDepthEl.value) || 0;  // mm 단위
            if (dc > 0) {
                const endPost = (dc * 1.5) / 1000;  // mm → m 변환 (1.5배 적용)
                endPostEl.value = endPost.toFixed(3);
            }
        }

        // 웹 포스트 폭(e) 범위 및 기본값 업데이트 함수
        // e = 웹 포스트 폭 (개구부 사이 남는 웹 두께 방향 폭)
        // 최소값: H/2 (원치수/2)
        // 최대값: 1.5 × ho
        // 기본값: 최소값
        function updateOpeningWidth() {
            const beamDepthEl = document.getElementById('beamDepth');
            const openingHeightEl = document.getElementById('openingHeight');
            const openingWidthEl = document.getElementById('openingWidth');
            const openingWidthMinEl = document.getElementById('openingWidthMin');
            const openingWidthMaxEl = document.getElementById('openingWidthMax');
            
            if (!beamDepthEl || !openingHeightEl || !openingWidthEl) {
                return;
            }
            
            const dc = parseFloat(beamDepthEl.value) || 0;  // mm 단위
            const ho = parseFloat(openingHeightEl.value) || 0;  // m 단위
            
            if (dc > 0 && ho > 0) {
                // 원치수 = dc / 1.5
                const originalHeight = dc / 1.5;  // mm
                
                // 최소값: H/2 (원치수/2)
                const eMin = Math.round(originalHeight / 2);  // mm
                
                // 최대값: 1.5 × ho (ho는 m 단위이므로 mm로 변환)
                const hoMm = ho * 1000;  // m → mm
                const eMax = Math.round(1.5 * hoMm);  // mm
                
                // 범위 표시
                if (openingWidthMinEl) {
                    openingWidthMinEl.textContent = eMin;
                }
                if (openingWidthMaxEl) {
                    openingWidthMaxEl.textContent = eMax;
                }
                
                // 입력 필드의 min, max 속성 설정
                openingWidthEl.min = eMin;
                openingWidthEl.max = eMax;
                
                // 현재 값이 범위를 벗어나면 최소값으로 설정
                const currentValue = parseFloat(openingWidthEl.value) || 0;
                if (currentValue < eMin || currentValue > eMax || currentValue === 0) {
                    openingWidthEl.value = eMin;
                }
            }
        }

        // Initialize on page load
        initializeType();
        
        // 초기 개구부 높이, 간격, End Post 및 개구부 폭, 보 자중, 슬래브 자중 계산
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                updateOpeningHeight();
                updateEndPost();
                updateSelfWeight();
                updateSlabWeight();
                // openingWidth가 업데이트된 후 openingSpacing 업데이트
                setTimeout(function() {
                    updateOpeningWidth();
                    setTimeout(updateOpeningSpacing, 10);
                }, 10);
            });
        } else {
            updateOpeningHeight();
            updateEndPost();
            updateSelfWeight();
            updateSlabWeight();
            // openingWidth가 업데이트된 후 openingSpacing 업데이트
            setTimeout(function() {
                updateOpeningWidth();
                setTimeout(updateOpeningSpacing, 10);
            }, 10);
        }
        
        // beamDepth 변경 시 개구부 높이, 간격, End Post 및 개구부 폭 자동 업데이트
        const beamDepthEl = document.getElementById('beamDepth');
        if (beamDepthEl) {
            beamDepthEl.addEventListener('input', function() {
                updateOpeningHeight();
                updateEndPost();
                // openingHeight가 업데이트된 후 openingWidth 업데이트
                setTimeout(function() {
                    updateOpeningWidth();
                    // openingWidth가 업데이트된 후 openingSpacing 업데이트
                    setTimeout(updateOpeningSpacing, 10);
                }, 10);
            });
            beamDepthEl.addEventListener('change', function() {
                updateOpeningHeight();
                updateEndPost();
                // openingHeight가 업데이트된 후 openingWidth 업데이트
                setTimeout(function() {
                    updateOpeningWidth();
                    // openingWidth가 업데이트된 후 openingSpacing 업데이트
                    setTimeout(updateOpeningSpacing, 10);
                }, 10);
            });
        }
        
        // openingHeight 변경 시 웹 포스트 폭(e) 범위 업데이트
        const openingHeightEl = document.getElementById('openingHeight');
        if (openingHeightEl) {
            openingHeightEl.addEventListener('input', updateOpeningWidth);
            openingHeightEl.addEventListener('change', updateOpeningWidth);
        }
        
        // openingWidth 변경 시 개구부 간격 자동 업데이트
        const openingWidthEl = document.getElementById('openingWidth');
        if (openingWidthEl) {
            openingWidthEl.addEventListener('input', updateOpeningSpacing);
            openingWidthEl.addEventListener('change', updateOpeningSpacing);
        }

        // 보 자중 자동 계산 함수
        // KS 섹션 선택 시: 해당 섹션의 단중(kg/m)을 하중폭으로 나눈 값 사용
        // 직접 입력 시: 단면 치수로부터 계산
        function updateSelfWeight() {
            try {
                const ksSectionSelect = document.getElementById('ksSection');
                const selectedKsSection = ksSectionSelect?.value || '';
                const B = parseFloat(document.getElementById('loadWidth')?.value) || 0;  // m
                const selfWeightElement = document.getElementById('selfWeight');

                if (!selfWeightElement || B <= 0) {
                    if (selfWeightElement && B <= 0) {
                        selfWeightElement.value = '';
                    }
                    return;
                }

                let selfWeight_kNm2 = 0;

                // KS 섹션이 선택된 경우: 해당 섹션의 단중 사용
                if (selectedKsSection && selectedKsSection !== '' && ksSections[selectedKsSection]) {
                    const section = ksSections[selectedKsSection];
                    if (section.unitWeight) {
                        // 단중(kg/m)을 kN/m로 변환: kg/m × 9.81 / 1000 = kg/m × 0.00981
                        const selfWeight_kNm = section.unitWeight * 0.00981; // kN/m
                        // 하중폭(B)으로 나눈 값 (kN/m²)
                        selfWeight_kNm2 = selfWeight_kNm / B; // kN/m²
                    }
                } else {
                    // 직접 입력 모드: 단면 치수로부터 계산
                    const d = parseFloat(document.getElementById('beamDepth')?.value) || 0;  // mm
                    const bf = parseFloat(document.getElementById('flangeWidth')?.value) || 0;  // mm
                    const tf = parseFloat(document.getElementById('flangeThickness')?.value) || 0;  // mm
                    const tw = parseFloat(document.getElementById('webThickness')?.value) || 0;  // mm

                    if (d <= 0 || bf <= 0 || tf <= 0 || tw <= 0) {
                        selfWeightElement.value = '';
                        return;
                    }

                    const hw = d - 2 * tf;
                    const area = bf * tf * 2 + hw * tw; // mm²
                    const gamma = 78.5; // kN/m³ (강재 단위중량)
                    const selfWeight_kNm = (area / 1000000) * gamma; // kN/m (철골보 자중)
                    
                    // 하중폭(B)으로 나눈 값 (kN/m²)
                    selfWeight_kNm2 = selfWeight_kNm / B; // kN/m²
                }

                // 보 자중을 하중폭으로 나눈 값 표시
                if (selfWeight_kNm2 > 0) {
                    selfWeightElement.value = selfWeight_kNm2.toFixed(3);
                } else {
                    selfWeightElement.value = '';
                }
            } catch (e) {
                console.error('[ERROR] updateSelfWeight exception:', e);
            }
        }

        // 슬래브 자중 자동계산 함수
        function updateSlabWeight() {
            try {
                const slabThicknessElement = document.getElementById('slabThickness');
                const slabWeightElement = document.getElementById('slabWeight');
                
                if (!slabThicknessElement || !slabWeightElement) {
                    return;
                }

                const ts = parseFloat(slabThicknessElement.value) || 0;
                
                // 콘크리트 단위중량: 24 kN/m³
                const gamma_concrete = 24; // kN/m³
                
                // 슬래브 자중 = (ts / 1000) * gamma_concrete (kN/m²)
                // ts는 mm 단위이므로 m로 변환 (ts / 1000)
                const slabWeight_kNm2 = (ts / 1000) * gamma_concrete;
                
                if (slabWeight_kNm2 > 0) {
                    slabWeightElement.value = slabWeight_kNm2.toFixed(3);
                } else {
                    slabWeightElement.value = '';
                }
            } catch (e) {
                console.error('[ERROR] updateSlabWeight exception:', e);
            }
        }

        // 보 자중 자동 계산을 위한 이벤트 리스너
        ['beamDepth', 'flangeWidth', 'flangeThickness', 'webThickness', 'loadWidth', 'ksSection'].forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.addEventListener('input', updateSelfWeight);
                element.addEventListener('change', updateSelfWeight);
            }
        });

        // 슬래브 자중 자동 계산을 위한 이벤트 리스너
        const slabThicknessElement = document.getElementById('slabThickness');
        if (slabThicknessElement) {
            slabThicknessElement.addEventListener('input', updateSlabWeight);
            slabThicknessElement.addEventListener('change', updateSlabWeight);
        }
        
        // Initialize KS section options
        // #region agent log
        function checkKsSectionVisibility() {
            const ksSectionSelect = document.getElementById('ksSection');
            if (!ksSectionSelect) {
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:checkKsSectionVisibility',message:'ksSection element not found in DOM',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'A'})}).catch(()=>{});
                console.error('[DEBUG] ksSection element not found in DOM');
                return;
            }
            
            const computedStyle = window.getComputedStyle(ksSectionSelect);
            const parent = ksSectionSelect.parentElement;
            const parentStyle = parent ? window.getComputedStyle(parent) : null;
            const grandParent = parent ? parent.parentElement : null;
            const grandParentStyle = grandParent ? window.getComputedStyle(grandParent) : null;
            
            const data = {
                elementExists: true,
                display: computedStyle.display,
                visibility: computedStyle.visibility,
                opacity: computedStyle.opacity,
                width: computedStyle.width,
                height: computedStyle.height,
                offsetWidth: ksSectionSelect.offsetWidth,
                offsetHeight: ksSectionSelect.offsetHeight,
                offsetTop: ksSectionSelect.offsetTop,
                offsetLeft: ksSectionSelect.offsetLeft,
                parentDisplay: parentStyle ? parentStyle.display : 'N/A',
                parentVisibility: parentStyle ? parentStyle.visibility : 'N/A',
                grandParentDisplay: grandParentStyle ? grandParentStyle.display : 'N/A',
                grandParentVisibility: grandParentStyle ? grandParentStyle.visibility : 'N/A',
                classList: Array.from(ksSectionSelect.classList),
                id: ksSectionSelect.id,
                tagName: ksSectionSelect.tagName
            };
            
            fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:checkKsSectionVisibility',message:'ksSection visibility check',data:data,timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'A'})}).catch(()=>{});
            console.log('[DEBUG] ksSection visibility check:', data);
        }
        // #endregion
        
        // #region agent log
        fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:init',message:'Initializing KS section options',data:{readyState:document.readyState},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'G'})}).catch(()=>{});
        // #endregion
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:DOMContentLoaded',message:'DOMContentLoaded fired',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'H'})}).catch(()=>{});
                console.log('[DEBUG] DOMContentLoaded fired, calling populateKsSectionOptions');
                // #endregion
                const populateResult = populateKsSectionOptions();
                console.log('[DEBUG] populateKsSectionOptions returned:', populateResult);
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:DOMContentLoaded',message:'populateKsSectionOptions result',data:{populateResult:populateResult},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'I'})}).catch(()=>{});
                // #endregion
                const ksSectionSelect = document.getElementById('ksSection');
                if (ksSectionSelect) {
                    // #region agent log
                    console.log('[DEBUG] Attaching event listener to ksSection. Options count:', ksSectionSelect.options.length);
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:DOMContentLoaded',message:'Before attaching event listener',data:{optionsCount:ksSectionSelect.options.length,selectId:ksSectionSelect.id,selectValue:ksSectionSelect.value},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'J'})}).catch(()=>{});
                    // #endregion
                    
                    // 이벤트 리스너 추가
                    ksSectionSelect.addEventListener('change', function(e) {
                        console.log('[DEBUG] ksSection change event fired. Selected value:', e.target.value);
                        onKsSectionChange();
                    });
                    
                    // 클릭 이벤트도 추가 (디버깅용)
                    ksSectionSelect.addEventListener('click', function(e) {
                        console.log('[DEBUG] ksSection click event fired. Options count:', e.target.options.length);
                        fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:click',message:'ksSection clicked',data:{optionsCount:e.target.options.length,value:e.target.value},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'O'})}).catch(()=>{});
                    });
                    
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:DOMContentLoaded',message:'Event listener attached',data:{optionsCount:ksSectionSelect.options.length},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'J'})}).catch(()=>{});
                    console.log('[DEBUG] Event listener attached to ksSection');
                    // #endregion
                } else {
                    // #region agent log
                    console.error('[ERROR] ksSectionSelect not found for event listener');
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:DOMContentLoaded',message:'ksSectionSelect not found for event listener',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'K'})}).catch(()=>{});
                    // #endregion
                }
                // #region agent log
                setTimeout(checkKsSectionVisibility, 100);
                // #endregion
            });
        } else {
            console.log('[DEBUG] Document already loaded, calling populateKsSectionOptions immediately');
            const populateResult = populateKsSectionOptions();
            console.log('[DEBUG] populateKsSectionOptions returned:', populateResult);
            // #region agent log
            fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:immediate',message:'populateKsSectionOptions result (immediate)',data:{populateResult:populateResult},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'L'})}).catch(()=>{});
            // #endregion
            const ksSectionSelect = document.getElementById('ksSection');
            if (ksSectionSelect) {
                // #region agent log
                console.log('[DEBUG] Attaching event listener to ksSection (immediate). Options count:', ksSectionSelect.options.length);
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:immediate',message:'Before attaching event listener (immediate)',data:{optionsCount:ksSectionSelect.options.length,selectId:ksSectionSelect.id,selectValue:ksSectionSelect.value},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'M'})}).catch(()=>{});
                // #endregion
                
                // 이벤트 리스너 추가
                ksSectionSelect.addEventListener('change', function(e) {
                    console.log('[DEBUG] ksSection change event fired (immediate). Selected value:', e.target.value);
                    onKsSectionChange();
                });
                
                // 클릭 이벤트도 추가 (디버깅용)
                ksSectionSelect.addEventListener('click', function(e) {
                    console.log('[DEBUG] ksSection click event fired (immediate). Options count:', e.target.options.length);
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:click',message:'ksSection clicked (immediate)',data:{optionsCount:e.target.options.length,value:e.target.value},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'P'})}).catch(()=>{});
                });
                
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:immediate',message:'Event listener attached (immediate)',data:{optionsCount:ksSectionSelect.options.length},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'M'})}).catch(()=>{});
                console.log('[DEBUG] Event listener attached to ksSection (immediate)');
                // #endregion
            } else {
                // #region agent log
                console.error('[ERROR] ksSectionSelect not found for event listener (immediate)');
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'noncomposite-castellatedbeam-calculator.html:immediate',message:'ksSectionSelect not found for event listener (immediate)',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'N'})}).catch(()=>{});
                // #endregion
            }
            // #region agent log
            setTimeout(checkKsSectionVisibility, 100);
            // #endregion
        }
    </script>
</body>
</html>
