<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Castellated Beam Design Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .calculator-wrapper {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3a5f, #2d5a87);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
        }

        .header a {
            color: rgba(255,255,255,0.9);
            text-decoration: none;
            font-size: 14px;
            padding: 8px 16px;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 6px;
            transition: all 0.3s;
        }

        .header a:hover {
            background: rgba(255,255,255,0.1);
        }

        .header .header-links {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .type-badge {
            display: inline-block;
            padding: 4px 12px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            font-size: 12px;
            margin-left: 10px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            min-height: 600px;
        }

        .left-section, .right-section {
            padding: 25px;
            max-height: calc(100vh - 100px);
            overflow-y: auto;
        }

        .left-section {
            background: #f8fafc;
            border-right: 1px solid #e2e8f0;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px 20px;
            align-content: start;
        }

        .right-section {
            background: #ffffff;
        }

        .section-title {
            font-size: 18px;
            font-weight: 700;
            color: #1e3a5f;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3b82f6;
            grid-column: 1 / -1;
        }

        .input-group {
            margin-bottom: 0;
        }
        
        .input-group.full-width {
            grid-column: 1 / -1;
        }

        .input-group label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: #475569;
            margin-bottom: 6px;
        }

        .input-field {
            width: 100%;
            padding: 10px;
            border: 2px solid #cbd5e1;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .input-field:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .calc-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
            margin-top: 20px;
        }

        .calc-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.5);
        }

        .results-container {
            display: none;
        }

        .results-container.active {
            display: block;
        }

        .result-section {
            margin-bottom: 25px;
            padding: 15px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .result-section-title {
            font-size: 16px;
            font-weight: 700;
            color: #1e3a5f;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #3b82f6;
        }

        .result-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        .result-table th,
        .result-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        .result-table th {
            background: #f1f5f9;
            font-weight: 600;
            color: #475569;
        }

        .result-value {
            font-weight: 600;
            color: #1e3a5f;
            text-align: right;
        }

        .status-ok {
            color: #10b981;
            font-weight: 700;
        }

        .status-ng {
            color: #ef4444;
            font-weight: 700;
        }

        .info-box {
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 0;
            font-size: 13px;
            color: #1e40af;
            line-height: 1.6;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .left-section {
                border-right: none;
                border-bottom: 1px solid #e2e8f0;
            }
        }
    </style>
</head>
<body>
    <div class="calculator-wrapper">
        <div class="header">
            <div>
                <h1>Castellated Beam Design Calculator
                    <span class="type-badge" id="typeBadge">Loading...</span>
                </h1>
            </div>
            <div class="header-links">
                <a href="/">← 홈으로</a>
                <a href="?type=with-slab">With top-slab 바로가기</a>
            </div>
        </div>

        <div class="main-content">
            <div class="left-section">
                <div class="section-title">입력 조건</div>
                
                <div class="info-box input-group full-width" id="typeInfo">
                    계산 방식을 확인 중...
                </div>

                <div class="input-group">
                    <label for="beamSpan">보 스팬 (L, m)</label>
                    <input type="number" id="beamSpan" class="input-field" value="13.5" step="0.1" min="0.1">
                </div>

                <div class="input-group">
                    <label for="loadWidth">하중 폭 (B, m)</label>
                    <input type="number" id="loadWidth" class="input-field" value="3.0" step="0.1" min="0.1">
                </div>

                <div class="input-group">
                    <label for="liveLoad">활하중 (qL, kN/m²)</label>
                    <input type="number" id="liveLoad" class="input-field" value="3.5" step="0.1" min="0">
                </div>

                <div class="input-group">
                    <label for="deadLoad">고정하중 (qD, kN/m²) - Super imposed Dead Load</label>
                    <input type="number" id="deadLoad" class="input-field" value="0.8" step="0.1" min="0">
                </div>

                <div class="input-group">
                    <label for="constructionLoad">가설하중 (qConst, kN/m²) - 시공하중</label>
                    <input type="number" id="constructionLoad" class="input-field" value="1.0" step="0.1" min="0">
                </div>

                <div class="input-group">
                    <label for="selfWeight">보 자중 (self_w, kN/m²) - 자동계산</label>
                    <input type="number" id="selfWeight" class="input-field" value="1.0" step="0.001" min="0" readonly style="background: #f1f5f9;">
                </div>

                <div class="input-group">
                    <label for="slabThickness">슬래브 두께 (ts, mm)</label>
                    <input type="number" id="slabThickness" class="input-field" value="135" step="1" min="0">
                </div>

                <div class="input-group">
                    <label for="steelGrade">강종</label>
                    <select id="steelGrade" class="input-field">
                        <option value="SM355" selected>SM355 (Fy = 355 MPa)</option>
                        <option value="SM420">SM420 (Fy = 420 MPa)</option>
                        <option value="SS275">SS275 (Fy = 275 MPa)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="slabWeight">슬래브 자중 (kN/m²) - 자동계산</label>
                    <input type="number" id="slabWeight" class="input-field" value="0" step="0.001" min="0" readonly style="background: #f1f5f9;">
                </div>

                <div class="section-title" style="margin-top: 20px;">원단면 치수 (H형강)</div>

                <div class="input-group full-width">
                    <label for="ksSection">KS 단면 선택</label>
                    <select id="ksSection" class="input-field" style="height: 40px;">
                        <option value="">직접 입력</option>
                    </select>
                    <div style="font-size: 11px; color: #94a3b8; margin-top: 4px;">※ KS 단면 선택 시 아래 값이 자동 입력됩니다</div>
                </div>

                <div class="input-group">
                    <label for="beamDepth">보 높이 (dc, mm) - dc = 원치수 × 1.5 (자동계산)</label>
                    <input type="number" id="beamDepth" class="input-field" value="900" step="10" min="100">
                    <div style="font-size: 11px; color: #94a3b8; margin-top: 4px;">※ KS 단면 선택 시 자동 계산됩니다 (예: H600 → 900mm)</div>
                </div>

                <div class="input-group">
                    <label for="flangeWidth">플랜지 폭 (bf, mm)</label>
                    <input type="number" id="flangeWidth" class="input-field" value="200" step="1" min="0">
                </div>

                <div class="input-group">
                    <label for="flangeThickness">플랜지 두께 (tf, mm)</label>
                    <input type="number" id="flangeThickness" class="input-field" value="17" step="1" min="0">
                </div>

                <div class="input-group">
                    <label for="webThickness">웹 두께 (tw, mm)</label>
                    <input type="number" id="webThickness" class="input-field" value="11" step="1" min="0">
                </div>

                <div class="input-group">
                    <label for="filletRadius">필렛 반경 (r, mm)</label>
                    <input type="number" id="filletRadius" class="input-field" value="18" step="1" min="0">
                    <div style="font-size: 11px; color: #94a3b8; margin-top: 4px;">※ KS 단면 선택 시 자동 입력됩니다</div>
                </div>

                <div class="section-title" style="margin-top: 20px;">개구부 정보</div>

                <div class="input-group">
                    <label for="openingHeight">개구부 높이 (ho, m) - ho ≤ 0.6dc (자동계산)</label>
                    <input type="number" id="openingHeight" class="input-field" value="0.6" step="0.01" min="0.1" readonly style="background: #f1f5f9;">
                </div>

                <div class="input-group">
                    <label for="openingSpacing">개구부 간격 (p, m) - p = W_open + e (자동계산)</label>
                    <input type="number" id="openingSpacing" class="input-field" value="0.9" step="0.01" min="0.1" readonly style="background: #f1f5f9;">
                </div>

                <div class="input-group">
                    <label for="openingAngle">개구부 각도 (θ, deg)</label>
                    <input type="number" id="openingAngle" class="input-field" value="60" step="1" min="0" max="90">
                </div>

                <div class="input-group">
                    <label for="endPost">양단 End Post 길이 (m) - endPost = dc × 1.5 (자동계산)</label>
                    <input type="number" id="endPost" class="input-field" value="0.9" step="0.01" min="0" readonly style="background: #f1f5f9;">
                </div>

                <div class="input-group full-width">
                    <label for="openingWidth">웹포스트폭 (Web Post width : e, mm) = 두 개구부 사이 남는 웹 두께 방향 폭</label>
                    <input type="number" id="openingWidth" class="input-field" value="200" step="1" min="0">
                    <div id="openingWidthRange" style="font-size: 11px; color: #64748b; margin-top: 4px;">
                        최소값(H/2)= <span id="openingWidthMin">-</span>mm ~ 최대값(1.5*ho)= <span id="openingWidthMax">-</span>mm
                    </div>
                </div>

                <button class="calc-btn input-group full-width" onclick="calculateBeam()" style="grid-column: 1 / -1;">계산하기</button>
            </div>

            <div class="right-section">
                <div class="section-title">계산 결과</div>
                <div id="resultsContainer" class="results-container">
                    <div id="noResults" style="text-align: center; padding: 60px 20px; color: #94a3b8;">
                        <p style="font-size: 16px; margin-bottom: 10px;">계산 결과가 여기에 표시됩니다</p>
                        <p style="font-size: 12px;">좌측 입력값을 입력하고 "계산하기" 버튼을 클릭하세요</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Get type from URL parameter
        const urlParams = new URLSearchParams(window.location.search);
        const beamType = urlParams.get('type') || 'without-slab';

        // KS H-beam section database (H×B×tw×tf) - 직사각형 H형강
        // 단중(kg/m) 계산 함수
        function calculateUnitWeight(d, bf, tw, tf) {
            const hw = d - 2 * tf;
            const area = bf * tf * 2 + hw * tw; // mm²
            const unitWeight = (area / 1000000) * 7850; // kg/m (강재 밀도 7850 kg/m³)
            return unitWeight;
        }

        const ksSections = {
            'H150x75x5x7': { d: 150, bf: 75, tw: 5, tf: 7, r: 8 },
            'H198x99x4.5x7': { d: 198, bf: 99, tw: 4.5, tf: 7, r: 8 },
            'H200x100x5.5x8': { d: 200, bf: 100, tw: 5.5, tf: 8, r: 8 },
            'H250x125x6x9': { d: 250, bf: 125, tw: 6, tf: 9, r: 10 },
            'H294x200x8x12': { d: 294, bf: 200, tw: 8, tf: 12, r: 13 },
            'H298x149x6.5x9': { d: 298, bf: 149, tw: 6.5, tf: 9, r: 13 },
            'H300x150x6.5x9': { d: 300, bf: 150, tw: 6.5, tf: 9, r: 13 },
            'H346x174x6x9': { d: 346, bf: 174, tw: 6, tf: 9, r: 13 },
            'H350x175x7x11': { d: 350, bf: 175, tw: 7, tf: 11, r: 13 },
            'H340x250x9x14': { d: 340, bf: 250, tw: 9, tf: 14, r: 13 },
            'H390x300x10x16': { d: 390, bf: 300, tw: 10, tf: 16, r: 18 },
            'H396x199x7x11': { d: 396, bf: 199, tw: 7, tf: 11, r: 13 },
            'H400x200x8x13': { d: 400, bf: 200, tw: 8, tf: 13, r: 13 },
            'H446x199x8x12': { d: 446, bf: 199, tw: 8, tf: 12, r: 13 },
            'H450x200x9x14': { d: 450, bf: 200, tw: 9, tf: 14, r: 18 },
            'H482x300x11x15': { d: 482, bf: 300, tw: 11, tf: 15, r: 18 },
            'H488x300x11x16': { d: 488, bf: 300, tw: 11, tf: 16, r: 18 },
            'H496x199x9x14': { d: 496, bf: 199, tw: 9, tf: 14, r: 18 },
            'H500x200x10x16': { d: 500, bf: 200, tw: 10, tf: 16, r: 18 },
            'H506x201x11x19': { d: 506, bf: 201, tw: 11, tf: 19, r: 18 },
            'H582x300x12x17': { d: 582, bf: 300, tw: 12, tf: 17, r: 18 },
            'H588x300x12x18': { d: 588, bf: 300, tw: 12, tf: 18, r: 18 },
            'H594x302x14x23': { d: 594, bf: 302, tw: 14, tf: 23, r: 22 },
            'H596x199x10x15': { d: 596, bf: 199, tw: 10, tf: 15, r: 18 },
            'H600x200x11x17': { d: 600, bf: 200, tw: 11, tf: 17, r: 18 },
            'H606x201x12x20': { d: 606, bf: 201, tw: 12, tf: 20, r: 18 },
            'H692x300x13x20': { d: 692, bf: 300, tw: 13, tf: 20, r: 22 },
            'H700x300x13x24': { d: 700, bf: 300, tw: 13, tf: 24, r: 22 },
            'H792x300x14x22': { d: 792, bf: 300, tw: 14, tf: 22, r: 22 },
            'H800x300x14x26': { d: 800, bf: 300, tw: 14, tf: 26, r: 22 },
            'H890x299x15x23': { d: 890, bf: 299, tw: 15, tf: 23, r: 22 },
            'H900x300x16x28': { d: 900, bf: 300, tw: 16, tf: 28, r: 22 },
            'H912x302x18x34': { d: 912, bf: 302, tw: 18, tf: 34, r: 22 }
        };

        // 각 단면의 단중 계산 및 저장
        Object.keys(ksSections).forEach(key => {
            const section = ksSections[key];
            section.unitWeight = calculateUnitWeight(section.d, section.bf, section.tw, section.tf);
        });

        // KS 단면 옵션 생성 함수
        function populateKsSectionOptions() {
            // #region agent log
            fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:populateKsSectionOptions',message:'populateKsSectionOptions called',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'A'})}).catch(()=>{});
            // #endregion
            try {
                const ksSectionSelect = document.getElementById('ksSection');
                if (!ksSectionSelect) {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:populateKsSectionOptions',message:'ksSection select element not found',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'B'})}).catch(()=>{});
                    // #endregion
                    console.log('[DEBUG] populateKsSectionOptions: ksSection select element not found');
                    return false;
                }
                
                if (typeof ksSections === 'undefined' || !ksSections) {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:populateKsSectionOptions',message:'ksSections is not defined',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'C'})}).catch(()=>{});
                    // #endregion
                    console.error('[ERROR] populateKsSectionOptions: ksSections is not defined');
                    return false;
                }
                
                const sectionsCount = Object.keys(ksSections).length;
                if (sectionsCount === 0) {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:populateKsSectionOptions',message:'ksSections is empty',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'D'})}).catch(()=>{});
                    // #endregion
                    console.error('[ERROR] populateKsSectionOptions: ksSections is empty');
                    return false;
                }
                
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:populateKsSectionOptions',message:'Starting to populate options',data:{sectionsCount:sectionsCount},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'E'})}).catch(()=>{});
                console.log('[DEBUG] populateKsSectionOptions: Starting to populate', sectionsCount, 'options');
                // #endregion
                
                // 모든 옵션 제거 후 직접 입력 옵션만 다시 추가
                ksSectionSelect.innerHTML = '<option value="">직접 입력</option>';
                console.log('[DEBUG] populateKsSectionOptions: Cleared and added default option');
                
                // 높이(d) 순으로 정렬
                const sortedKeys = Object.keys(ksSections).sort((a, b) => {
                    const dA = ksSections[a].d;
                    const dB = ksSections[b].d;
                    if (dA !== dB) return dA - dB;
                    // 높이가 같으면 폭(bf) 순으로 정렬
                    return ksSections[a].bf - ksSections[b].bf;
                });
                
                // 기본값 설정 (H600x200x11x17)
                const defaultSection = 'H600x200x11x17';
                
                sortedKeys.forEach(key => {
                    try {
                        const section = ksSections[key];
                        if (!section) {
                            console.warn('[WARN] Section not found for key:', key);
                            return;
                        }
                        const option = document.createElement('option');
                        option.value = key;
                        
                        // 기본값으로 선택
                        if (key === defaultSection) {
                            option.selected = true;
                        }
                        
                        // 단면명 추출 (예: "H500x200x10x16" -> "H 500×200")
                        const match = key.match(/H(\d+)x(\d+)/);
                        if (match) {
                            // 단중이 있으면 함께 표시
                            if (section.unitWeight) {
                                option.textContent = `H ${match[1]}×${match[2]} (단중: ${section.unitWeight.toFixed(1)} kg/m)`;
                            } else {
                                option.textContent = `H ${match[1]}×${match[2]}`;
                            }
                        } else {
                            // 단중이 있으면 함께 표시
                            if (section.unitWeight) {
                                option.textContent = `${key} (단중: ${section.unitWeight.toFixed(1)} kg/m)`;
                            } else {
                                option.textContent = key;
                            }
                        }
                        
                        ksSectionSelect.appendChild(option);
                    } catch (err) {
                        console.error('[ERROR] Error creating option for key:', key, err);
                    }
                });
                
                // #region agent log
                const finalOptionsCount = ksSectionSelect.options.length;
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:populateKsSectionOptions',message:'Options populated',data:{finalOptionsCount:finalOptionsCount,selectedValue:ksSectionSelect.value},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'F'})}).catch(()=>{});
                console.log('[DEBUG] populateKsSectionOptions: Completed. Total options:', finalOptionsCount, 'Selected:', ksSectionSelect.value);
                // #endregion
                
                // 기본값이 설정된 경우 관련 필드 자동 업데이트
                if (ksSections[defaultSection]) {
                    setTimeout(() => {
                        onKsSectionChange();
                    }, 100);
                }
                
                return true;
            } catch (error) {
                console.error('[ERROR] populateKsSectionOptions error:', error);
                return false;
            }
        }

        // KS 섹션 선택 시 자동 입력
        function onKsSectionChange() {
            // #region agent log
            fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:477',message:'onKsSectionChange called',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'A'})}).catch(()=>{});
            console.log('[DEBUG] onKsSectionChange called');
            // #endregion
            
            try {
                const ksSectionSelect = document.getElementById('ksSection');
                if (!ksSectionSelect) {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:482',message:'ksSectionSelect is null',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'A'})}).catch(()=>{});
                    // #endregion
                    console.error('[ERROR] ksSection element not found');
                    return;
                }
                
                const selectedValue = ksSectionSelect.value;
                console.log('[DEBUG] onKsSectionChange: selectedValue =', selectedValue);
                
                if (!selectedValue || selectedValue === '') {
                    // 직접 입력 모드
                    console.log('[DEBUG] onKsSectionChange: Direct input mode, returning');
                    return;
                }
                
                const section = ksSections[selectedValue];
                if (!section) {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:495',message:'Section not found in ksSections',data:{selectedValue:selectedValue},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'B'})}).catch(()=>{});
                    // #endregion
                    console.error('[ERROR] Section not found:', selectedValue);
                    return;
                }
                
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:500',message:'Setting section values',data:{section:section,selectedValue:selectedValue},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'C'})}).catch(()=>{});
                console.log('[DEBUG] onKsSectionChange: Setting values for section', selectedValue, section);
                // #endregion
                
                // 치수 입력 (mm 단위) - null 체크 추가
                const flangeWidthEl = document.getElementById('flangeWidth');
                const flangeThicknessEl = document.getElementById('flangeThickness');
                const webThicknessEl = document.getElementById('webThickness');
                const beamDepthEl = document.getElementById('beamDepth');
                const filletRadiusEl = document.getElementById('filletRadius');
                
                if (!flangeWidthEl) {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:510',message:'flangeWidth element is null',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'D'})}).catch(()=>{});
                    // #endregion
                    console.error('[ERROR] flangeWidth element not found');
                    return;
                }
                if (!flangeThicknessEl) {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:516',message:'flangeThickness element is null',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'D'})}).catch(()=>{});
                    // #endregion
                    console.error('[ERROR] flangeThickness element not found');
                    return;
                }
                if (!webThicknessEl) {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:522',message:'webThickness element is null',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'D'})}).catch(()=>{});
                    // #endregion
                    console.error('[ERROR] webThickness element not found');
                    return;
                }
                if (!beamDepthEl) {
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:528',message:'beamDepth element is null',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'D'})}).catch(()=>{});
                    // #endregion
                    console.error('[ERROR] beamDepth element not found');
                    return;
                }
                
                flangeWidthEl.value = section.bf;
                flangeThicknessEl.value = section.tf;
                webThicknessEl.value = section.tw;
                
                // 필렛 반경 설정
                if (filletRadiusEl && section.r) {
                    filletRadiusEl.value = section.r;
                }
                
                // 보 높이 입력 (원치수의 1.5배, mm 단위)
                // 예: H600 (600mm) → 600 × 1.5 = 900mm
                const beamDepthValue = Math.round(section.d * 1.5);
                beamDepthEl.value = beamDepthValue;
                
                // 보 자중 자동 계산
                setTimeout(updateSelfWeight, 50);
                
                // 개구부 높이 자동 계산 (ho ≤ 0.6dc)
                // dc는 mm 단위, ho는 m 단위로 표시
                const openingHeightEl = document.getElementById('openingHeight');
                if (openingHeightEl) {
                    const hoValue = (0.6 * beamDepthValue) / 1000;  // mm → m 변환
                    openingHeightEl.value = hoValue.toFixed(3);
                }
                
                // 개구부 간격은 updateOpeningSpacing()에서 자동 계산됨
                // (openingWidth가 먼저 설정되어야 함)
                setTimeout(updateOpeningSpacing, 100);
                
                // End Post 길이 자동 계산 (endPost = dc × 1.5)
                // dc는 mm 단위, endPost는 m 단위로 표시
                const endPostEl = document.getElementById('endPost');
                if (endPostEl) {
                    const endPostValue = (beamDepthValue * 1.5) / 1000;  // mm → m 변환 (1.5배 적용)
                    endPostEl.value = endPostValue.toFixed(3);
                }
                
                // 개구부 폭 범위 업데이트 (개구부 높이가 먼저 계산되어야 함)
                // updateOpeningWidth()는 beamDepth와 openingHeight 변경 시 자동 호출됨
                setTimeout(updateOpeningWidth, 50);
                
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:540',message:'Values set successfully',data:{bf:section.bf,tf:section.tf,tw:section.tw,beamDepth:beamDepthValue},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'C'})}).catch(()=>{});
                // #endregion
            } catch (error) {
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:544',message:'Error in onKsSectionChange',data:{error:error.message,stack:error.stack},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'E'})}).catch(()=>{});
                // #endregion
                console.error('[ERROR] onKsSectionChange error:', error);
                alert('단면 선택 중 오류가 발생했습니다: ' + error.message);
            }
        }

        // Update UI based on type
        function initializeType() {
            const typeBadge = document.getElementById('typeBadge');
            const typeInfo = document.getElementById('typeInfo');
            const headerH1 = document.querySelector('.header h1');

            if (beamType === 'with-slab') {
                typeBadge.textContent = 'with top-slab';
                typeInfo.innerHTML = '<strong>Castellated Beam with top-slab</strong><br>상부 슬래브가 있는 Castellated Beam 설계 계산기입니다.';
                if (headerH1) {
                    // h1의 텍스트 노드 찾기
                    for (let node of headerH1.childNodes) {
                        if (node.nodeType === 3) { // Text node
                            node.textContent = 'Castellated Beam Design Calculator ';
                            break;
                        }
                    }
                }
            } else {
                typeBadge.textContent = 'without top-slab';
                typeInfo.innerHTML = '<strong>Castellated Beam without top-slab</strong><br>상부 슬래브가 없는 Castellated Beam 설계 계산기입니다.';
                if (headerH1) {
                    // h1의 텍스트 노드 찾기
                    for (let node of headerH1.childNodes) {
                        if (node.nodeType === 3) { // Text node
                            node.textContent = 'Non Composite Castillated Beam Design Calculator ';
                            break;
                        }
                    }
                }
            }
        }

        // Format number with commas
        function formatNumber(num, decimals) {
            if (isNaN(num) || !isFinite(num)) return '-';
            return num.toFixed(decimals).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }

        // Get Fy from steel grade
        function getFy(grade) {
            const grades = {
                'SM355': 355,
                'SM420': 420,
                'SS275': 275
            };
            return grades[grade] || 355;
        }

        // Main calculation function
        function calculateBeam() {
            try {
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:669',message:'calculateBeam 함수 시작',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'A'})}).catch(()=>{});
                // #endregion
                
                // 공통 상수 정의
                const phi_b = 0.90;  // AISC 360 저감계수 (휨강도)
                const phi_v = 0.90;  // AISC 360 저감계수 (전단강도)
                
                // Get input values
                const L = parseFloat(document.getElementById('beamSpan').value) || 0;
                const B = parseFloat(document.getElementById('loadWidth').value) || 0;
                const qL = parseFloat(document.getElementById('liveLoad').value) || 0;
                const qD = parseFloat(document.getElementById('deadLoad').value) || 0;
                const qConst = parseFloat(document.getElementById('constructionLoad').value) || 0;
                const self_w = parseFloat(document.getElementById('selfWeight').value) || 0;
                const slabWeight = parseFloat(document.getElementById('slabWeight').value) || 0;
                
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:677',message:'입력값 읽기 완료',data:{qD:qD,self_w:self_w,slabWeight:slabWeight,B:B},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'B'})}).catch(()=>{});
                // #endregion
                const steelGrade = document.getElementById('steelGrade').value;
                const Fy = getFy(steelGrade);
                
                // Section dimensions (dc는 mm 단위로 입력받고, m 단위로 변환)
                const dc = (parseFloat(document.getElementById('beamDepth').value) || 0) / 1000;  // mm → m
                const bf = parseFloat(document.getElementById('flangeWidth').value) || 0;
                const tf = parseFloat(document.getElementById('flangeThickness').value) || 0;
                const tw = parseFloat(document.getElementById('webThickness').value) || 0;
                
                // Opening parameters
                const ho = parseFloat(document.getElementById('openingHeight').value) || 0;
                const p = parseFloat(document.getElementById('openingSpacing').value) || 0;
                const theta = parseFloat(document.getElementById('openingAngle').value) || 0;
                const end_post = parseFloat(document.getElementById('endPost').value) || 0;
                const e = parseFloat(document.getElementById('openingWidth').value) || 0;
                
                // Slab thickness
                const ts = parseFloat(document.getElementById('slabThickness').value) || 0;

                // Validation
                if (L <= 0 || B <= 0) {
                    alert('보 스팬과 하중 폭을 입력해주세요.');
                    return;
                }
                if (dc <= 0 || bf <= 0 || tf <= 0 || tw <= 0) {
                    alert('원단면 치수를 모두 입력해주세요.');
                    return;
                }
                if (ho <= 0 || p <= 0 || e <= 0) {
                    alert('개구부 정보를 모두 입력해주세요.');
                    return;
                }

                // Convert distributed loads to line loads (kN/m)
                // 고정하중 = Super imposed Dead Load + 보 자중 + 슬래브 자중
                const qD_total = qD + self_w + slabWeight;  // kN/m²
                const DL = qD_total * B;  // kN/m
                const LL = qL * B;  // kN/m
                
                // 보 자중을 선하중으로 변환 (결과 표시용)
                const self_w_kNm = self_w * B;  // kN/m
                
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:717',message:'고정하중 계산 확인',data:{qD:qD,self_w:self_w,slabWeight:slabWeight,qD_total:qD_total,DL:DL,B:B},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'A'})}).catch(()=>{});
                // #endregion
                
                // Total factored load (LRFD)
                // DL에 이미 보 자중과 슬래브 자중이 포함되어 있음
                const wu = 1.2 * DL + 1.6 * LL;  // kN/m

                // Construction stage calculations (시공단계 계산)
                const Es = 200000; // MPa (강재 탄성계수)
                // 시공중 고정하중: 슬래브 자중 + 철골보 자중
                const w_DL_construction = (slabWeight + self_w) * B; // kN/m
                // 시공중 활하중: Construction Load
                const w_CLL_construction = qConst * B; // kN/m
                // 시공중 계수하중 (LRFD): max[1.4*DL, 1.2*DL + 1.6*LL]
                const w_u1_construction = 1.4 * w_DL_construction; // kN/m
                const w_u2_construction = 1.2 * w_DL_construction + 1.6 * w_CLL_construction; // kN/m
                const w_u_construction = Math.max(w_u1_construction, w_u2_construction); // kN/m
                // 시공 중 소요휨강도
                const M_u_construction = w_u_construction * Math.pow(L, 2) / 8; // kN·m
                // 시공 중 소요단면2차모멘트 (처짐 제한 60mm 고려)
                const delta_allow_construction = 60; // mm (콘크리트 타설 시공성 고려)
                const I_req_construction = (5 * w_DL_construction * Math.pow(L * 1000, 4)) / (384 * Es * delta_allow_construction); // mm⁴
                
                // Castellated beam 단면2차모멘트 계산
                // Castellated beam 높이 = dc (이미 castellated beam으로 제작됨)
                const d_castellated = dc * 1000; // mm (Castellated beam 높이)
                const hw_castellated = d_castellated - 2 * tf; // mm
                
                // 필렛 반경 (r값) 가져오기
                const r = parseFloat(document.getElementById('filletRadius')?.value) || 0; // mm
                
                // Castellated beam 단면 2차 모멘트: Ix = I_flange + I_web - I_fillet (r값 고려)
                // 플랜지: (bf * tf^3) / 12 + (bf * tf) * ((d - tf) / 2)^2 (상하 각각)
                // 웹: (tw * hw^3) / 12
                const I_flange = (bf * Math.pow(tf, 3)) / 12; // 플랜지 자체 모멘트
                const A_flange = bf * tf; // 플랜지 단면적
                const y_flange = (d_castellated - tf) / 2; // 플랜지 중심까지 거리
                const I_flange_parallel = A_flange * Math.pow(y_flange, 2); // 평행축 정리
                const I_web = (tw * Math.pow(hw_castellated, 3)) / 12; // 웹 모멘트
                
                // r값을 고려한 필렛 부분 모멘트 감소 (근사 계산)
                // 필렛은 1/4 원형으로 근사, 각 모서리에서 제거되는 면적: A_fillet = r²(1 - π/4) ≈ 0.2146r²
                // 필렛 부분의 모멘트는 작지만, 보정 계수를 사용하여 근사적으로 반영
                // 일반적으로 r값이 작을 때는 영향이 미미하지만, 정확도를 위해 보정 계수 적용
                let I_fillet_correction = 0;
                if (r > 0) {
                    // 필렛 부분 면적 (4개 모서리)
                    const A_fillet_total = 4 * (r * r - Math.PI * r * r / 4); // mm²
                    // 필렛 부분의 모멘트 감소 (근사: 필렛 중심까지 거리를 평균적으로 고려)
                    const y_fillet = (d_castellated - tf) / 2; // 필렛 중심까지 거리 (플랜지 중심과 동일)
                    I_fillet_correction = A_fillet_total * Math.pow(y_fillet, 2); // mm⁴
                }
                
                const Ix_steel = I_flange * 2 + I_flange_parallel * 2 + I_web - I_fillet_correction; // mm⁴
                
                // 원단면(H형강) 단면2차모멘트 계산 (비교용)
                const d_original = d_castellated / 1.5; // mm (원단면 높이)
                const hw_original = d_original - 2 * tf; // mm
                const I_flange_original = (bf * Math.pow(tf, 3)) / 12; // 플랜지 자체 모멘트
                const A_flange_original = bf * tf; // 플랜지 단면적
                const y_flange_original = (d_original - tf) / 2; // 플랜지 중심까지 거리
                const I_flange_parallel_original = A_flange_original * Math.pow(y_flange_original, 2); // 평행축 정리
                const I_web_original = (tw * Math.pow(hw_original, 3)) / 12; // 웹 모멘트
                let I_fillet_correction_original = 0;
                if (r > 0) {
                    const A_fillet_total_original = 4 * (r * r - Math.PI * r * r / 4); // mm²
                    const y_fillet_original = (d_original - tf) / 2;
                    I_fillet_correction_original = A_fillet_total_original * Math.pow(y_fillet_original, 2); // mm⁴
                }
                const Ix_original = I_flange_original * 2 + I_flange_parallel_original * 2 + I_web_original - I_fillet_correction_original; // mm⁴
                
                // 단면적 계산 (원 beam과 castellated beam 동일)
                const A_total = bf * tf * 2 + hw_castellated * tw; // mm²
                if (r > 0) {
                    const A_fillet_total = 4 * (r * r - Math.PI * r * r / 4); // mm²
                    // 단면적에서 필렛 부분 제거는 하지 않음 (근사적으로 무시)
                }
                
                // 단면계수 계산
                const Sx_original = Ix_original / (d_original / 2); // mm³
                const Sx_castellated = Ix_steel / (d_castellated / 2); // mm³
                
                // 회전반경 계산
                const rx_original = Math.sqrt(Ix_original / A_total); // mm
                const rx_castellated = Math.sqrt(Ix_steel / A_total); // mm
                
                // Iy 계산 (Y축 단면2차모멘트)
                const Iy_flange = (tf * Math.pow(bf, 3)) / 12; // 플랜지 Y축 모멘트
                const Iy_web = (hw_castellated * Math.pow(tw, 3)) / 12; // 웹 Y축 모멘트
                const Iy_original = Iy_flange * 2 + Iy_web; // mm⁴
                const Iy_castellated = Iy_original; // Y축은 높이 변화 없으므로 동일
                const ry_original = Math.sqrt(Iy_original / A_total); // mm
                const ry_castellated = ry_original; // Y축 회전반경도 동일
                
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:809',message:'Castellated beam Ix 계산',data:{dc:dc,d_castellated:d_castellated,bf:bf,tf:tf,tw:tw,hw_castellated:hw_castellated,r:r,I_flange:I_flange,A_flange:A_flange,y_flange:y_flange,I_flange_parallel:I_flange_parallel,I_web:I_web,I_fillet_correction:I_fillet_correction,Ix_steel:Ix_steel,Ix_steel_M6:Ix_steel/1e6},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'A'})}).catch(()=>{});
                // #endregion

                // Service stage calculations (사용단계 계산)
                // 합성 전 고정하중: 슬래브 자중 + 철골보 자중
                const w_DL_service = (slabWeight + self_w) * B; // kN/m
                // 합성 후 고정하중: Dead Load (합성 후 추가 고정하중)
                const w_SIDL_service = qD * B; // kN/m
                // 합성 후 활하중: Live Load
                const w_LL_service = qL * B; // kN/m
                // 사용 중 계수하중 (LRFD): max[1.4*(DL+SIDL), 1.2*(DL+SIDL) + 1.6*LL]
                const w_u1_service = 1.4 * (w_DL_service + w_SIDL_service); // kN/m
                const w_u2_service = 1.2 * (w_DL_service + w_SIDL_service) + 1.6 * w_LL_service; // kN/m
                const w_u_service = Math.max(w_u1_service, w_u2_service); // kN/m
                // 사용 중 소요휨강도
                const M_u_service = w_u_service * Math.pow(L, 2) / 8; // kN·m
                // 사용 중 소요전단강도
                const V_u_service = w_u_service * L / 2; // kN
                // 사용 중 소요단면 2차 모멘트 (처짐 제한 L/360 고려)
                const delta_allow_service = (L * 1000) / 360; // mm (L/360)
                const I_req_service = (5 * w_LL_service * Math.pow(L * 1000, 4)) / (384 * Es * delta_allow_service); // mm⁴

                // Shear and moment functions
                function Vx(x) {
                    return 0.5 * wu * L - wu * x;
                }

                function Mx(x) {
                    return 0.5 * wu * x * (L - x);
                }

                // Calculate opening parameters
                // e = 웹 포스트 폭 (개구부 사이 남는 웹 두께 방향 폭) - 입력값
                // W_rect = 개구부 폭 (직사각형 부분) - 계산 필요
                // W_open = 개구부 전체 폭 (직사각형 + 삼각형 부분)
                // p = 개구부 간격 = W_open + e
                const delta_x = (ho * 1000.0) / (2.0 * Math.sqrt(3.0));  // mm
                // p에서 e를 빼면 W_open이 됨: W_open = p - e
                const W_open = p * 1000.0 - e;  // mm (개구부 전체 폭)
                const W_rect = W_open - 2.0 * delta_x;  // mm (개구부 폭, 직사각형 부분)
                const b_wp = e;  // mm (웹 포스트 폭 = e)

                // Number of openings
                // 웹 포스트 폭(e)이 커지면 p = W_open + e가 커지고, 따라서 N = L_open / p가 작아짐
                const L_open = L - 2.0 * end_post;
                const N = Math.round(L_open / p);
                
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:889',message:'개구부 개수 계산',data:{L:L,end_post:end_post,L_open:L_open,p:p,N:N,e:e,W_open:W_open,W_rect:W_rect,b_wp:b_wp},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'A'})}).catch(()=>{});
                // #endregion
                
                const x1 = end_post + 0.5 * p;
                const xs = [];
                for (let i = 0; i < N; i++) {
                    xs.push(x1 + i * p);
                }

                // Tee section properties (these would normally be calculated from section geometry)
                // For now, using placeholder values - these should be calculated based on actual Tee section
                const phiPn = 1553.7;  // kN (placeholder - should be calculated)
                const phiMn_tee_placeholder = 21.47;   // kN·m (placeholder - should be calculated, for opening UR calculation)
                const d_eff = 0.8379;  // m (placeholder - should be calculated)
                const h_top = 0.4189;  // m (placeholder - should be calculated)
                // Mtee 계산: 개구부 폭(W_rect)의 1/4 사용
                // Python 코드의 e는 개구부 폭을 의미하며, 웹포스트 폭(e)이 증가해도
                // 개구부 폭(W_rect)은 변하지 않으므로 UR이 안정적으로 유지됨
                const W_rect_over_4 = (W_rect / 4.0) / 1000.0;  // m (개구부 폭 사용)

                // Calculate for each opening
                const openingResults = [];
                let maxUR = 0;
                let maxURIndex = 0;
                
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:915',message:'UR 계산 시작 (수정 후: W_rect 사용)',data:{N:N,e:e,W_rect:W_rect,W_rect_over_4:W_rect_over_4,phiPn:phiPn,phiMn_tee_placeholder:phiMn_tee_placeholder,d_eff:d_eff},timestamp:Date.now(),sessionId:'debug-session',runId:'post-fix',hypothesisId:'A'})}).catch(()=>{});
                // #endregion
                
                for (let i = 0; i < xs.length; i++) {
                    const x = xs[i];
                    const V = Vx(x);
                    const M = Mx(x);
                    const P = M / d_eff;
                    // Mtee 계산: 개구부 폭(W_rect) 사용 (로그 분석 결과 올바른 방법)
                    // Python 코드의 e는 개구부 폭을 의미하며, 웹포스트 폭(e)이 증가해도
                    // 개구부 폭(W_rect)은 변하지 않으므로 UR이 안정적으로 유지됨
                    const Mtee = Math.abs(V) * W_rect_over_4;  // 개구부 폭 사용
                    const UR = Math.abs(P) / phiPn + Mtee / phiMn_tee_placeholder;
                    
                    // #region agent log
                    // 수정 후 검증을 위한 로그 (W_rect 사용)
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:957',message:'개구부별 UR 계산 (수정 후: W_rect 사용)',data:{i:i+1,x:x,V:V,M:M,P:P,e:e,W_rect:W_rect,W_open:W_open,W_rect_over_4:W_rect_over_4,Mtee:Mtee,UR:UR,phiPn:phiPn,phiMn_tee_placeholder:phiMn_tee_placeholder},timestamp:Date.now(),sessionId:'debug-session',runId:'post-fix',hypothesisId:'A'})}).catch(()=>{});
                    // #endregion
                    
                    openingResults.push({
                        i: i + 1,
                        x: x,
                        V: V,
                        M: M,
                        P: P,
                        Mtee: Mtee,
                        UR: UR
                    });
                    
                    if (UR > maxUR) {
                        maxUR = UR;
                        maxURIndex = i;
                    }
                }

                // Governing opening
                const govOpening = openingResults[maxURIndex];

                // Governing web-post (maximum dP)
                let maxDP = 0;
                let maxDPIndex = 0;
                for (let i = 1; i < openingResults.length; i++) {
                    const dP = Math.abs(openingResults[i].P - openingResults[i-1].P);
                    if (dP > maxDP) {
                        maxDP = dP;
                        maxDPIndex = i;
                    }
                }
                const Vrh = maxDP;
                const webPostPair = [openingResults[maxDPIndex - 1].i, openingResults[maxDPIndex].i];

                // Web-post buckling (DG31)
                // Mp 계산: 개구부 전체 폭(W_open) 사용
                const Mp_webpost = (0.25 * tw * Math.pow(W_open, 2) * Fy) / 1e6;  // kN·m
                const etw = e / tw;  // 웹 포스트 폭비
                const r10 = 0.408;
                const r20 = 0.437;
                let ratio;
                if (etw <= 10) {
                    ratio = r10;
                } else if (etw >= 20) {
                    ratio = r20;
                } else {
                    ratio = r10 + (r20 - r10) * ((etw - 10) / 10);
                }
                const Mocr = ratio * Mp_webpost;
                const phiMocr = phi_b * Mocr;
                const Mrh = Vrh * h_top;
                const buckling_ok = Mrh <= phiMocr;

                // ===== 1. 전단강도 및 Vierendeel 거동검토 =====
                
                // 1.1 전체 전단 강도 검토 (AISC 360 Ch. G)
                // 최대 전단력 (단순지지보)
                const Vu_max = wu * L / 2;  // kN
                
                // 전단 면적
                const Aw = d_castellated * tw;  // mm²
                
                // 전단 좌굴 계수 Cv 계산 (AISC 360 G2)
                const h_tw = hw_castellated / tw;
                const kv = 5.0;  // 웹 판재 좌굴 계수 (stiffener 없음)
                const h_tw_limit = 1.10 * Math.sqrt(kv * Es / Fy);
                
                let Cv = 1.0;
                if (h_tw <= h_tw_limit) {
                    Cv = 1.0;  // 전단 좌굴 없음
                } else {
                    const h_tw_r = 1.37 * Math.sqrt(kv * Es / Fy);
                    if (h_tw <= h_tw_r) {
                        // 비탄성 전단 좌굴
                        Cv = 1.10 * Math.sqrt(kv * Es / Fy) / h_tw;
                    } else {
                        // 탄성 전단 좌굴
                        Cv = 1.51 * kv * Es / (Math.pow(h_tw, 2) * Fy);
                    }
                }
                
                // 공칭 전단 강도 (AISC 360 G2-1)
                const Vn = 0.6 * Fy * Aw * Cv / 1000;  // kN
                
                // 설계 전단 강도 (phi_v는 함수 상단에서 선언됨)
                const phiVn = phi_v * Vn;  // kN
                
                // 전체 전단 강도 판정
                const shear_global_ok = Vu_max <= phiVn;
                const shear_global_UR = Vu_max / phiVn;  // 사용률
                
                // 1.2 Web Post 전단 강도 (DG31)
                // Web post의 전단 면적
                const Aw_webpost = e * tw;  // mm² (Web post 전단 면적)
                
                // Web post 전단 강도 (AISC 360 G2, 웹 post에 적용)
                // Web post는 짧은 구간이므로 전단 좌굴은 고려하지 않음 (보수적)
                const Vn_webpost = 0.6 * Fy * Aw_webpost / 1000;  // kN
                const phiVn_webpost = phi_v * Vn_webpost;  // kN
                
                // Web post 전단 강도 판정
                const shear_webpost_ok = Vrh <= phiVn_webpost;
                const shear_webpost_UR = Vrh / phiVn_webpost;  // 사용률
                
                // ===== 2. 전단파괴모드 검토 (Web Post Failure) =====
                
                // 2.1 Web Post 전단 파괴 모드 분석 (AISC DG31)
                // Web Post의 전단 파괴는 전단 강도와 좌굴에 의해 결정됨
                // 파괴 모드: 1) 전단 강도 파괴, 2) 좌굴 파괴
                
                // Web Post 전단 파괴 모드 판정
                // 전단 강도 파괴: Vrh > φVn_webpost
                // 좌굴 파괴: Mrh > φMocr
                const webpost_shear_failure = Vrh > phiVn_webpost;
                const webpost_buckling_failure = Mrh > phiMocr;
                
                // 지배 파괴 모드 결정
                let webpost_failure_mode = 'None';
                let webpost_failure_mode_kr = '파괴 없음';
                if (webpost_shear_failure && webpost_buckling_failure) {
                    // 두 모드 모두 파괴
                    if (shear_webpost_UR > (Mrh / phiMocr)) {
                        webpost_failure_mode = 'Shear';
                        webpost_failure_mode_kr = '전단 강도 파괴 (지배)';
                    } else {
                        webpost_failure_mode = 'Buckling';
                        webpost_failure_mode_kr = '좌굴 파괴 (지배)';
                    }
                } else if (webpost_shear_failure) {
                    webpost_failure_mode = 'Shear';
                    webpost_failure_mode_kr = '전단 강도 파괴';
                } else if (webpost_buckling_failure) {
                    webpost_failure_mode = 'Buckling';
                    webpost_failure_mode_kr = '좌굴 파괴';
                }
                
                // Web Post 안전성 종합 판정
                const webpost_failure_ok = !webpost_shear_failure && !webpost_buckling_failure;
                
                // Web Post 전단 파괴 모드별 사용률
                const webpost_shear_UR = Vrh / phiVn_webpost;
                const webpost_buckling_UR = Mrh / phiMocr;
                const webpost_max_UR = Math.max(webpost_shear_UR, webpost_buckling_UR);
                
                // Web Post 치수 검토
                // e/tw 비율 검토 (DG31 권장: e/tw ≤ 20)
                const etw_ratio = e / tw;
                const etw_limit = 20.0;
                const etw_ok = etw_ratio <= etw_limit;
                
                // Web Post 높이비 검토 (ho/e 비율, DG31 권장: ho/e ≤ 1.5)
                const ho_e_ratio = (ho * 1000) / e;  // ho는 m 단위이므로 mm로 변환
                const ho_e_limit = 1.5;
                const ho_e_ok = ho_e_ratio <= ho_e_limit;
                
                // ===== 3. 글로벌 휨강도 검토 (Overall Flexural Strength) =====
                // AISC 360 Ch. F + DG31
                
                // 3.1 검토 단면 선정
                // Opening 구간과 Solid web 구간 중 지배 구간 선정
                // Opening 구간: 개구부 중심에서의 모멘트 (지배 개구부 사용)
                const M_opening = govOpening.M;  // kN·m (Opening 구간 모멘트)
                // Solid web 구간: 개구부 사이 중간점에서의 모멘트 (최대 모멘트 구간)
                const M_solid = wu * Math.pow(L, 2) / 8;  // kN·m (단순지지보 최대 모멘트)
                // 지배 구간: 더 큰 모멘트를 받는 구간
                const M_max = Math.max(M_opening, M_solid);  // kN·m
                const governing_section = M_opening > M_solid ? 'Opening 구간' : 'Solid web 구간';
                
                // 3.2 단면 분류 (AISC 360 Table B4.1)
                // 플랜지 slenderness
                const lambda_f = bf / (2 * tf);  // 플랜지 slenderness
                const lambda_pf = 0.38 * Math.sqrt(Es / Fy);  // Compact limit
                const lambda_rf = 1.0 * Math.sqrt(Es / Fy);  // Noncompact limit
                
                const flange_compact = lambda_f <= lambda_pf;
                const flange_noncompact = lambda_f > lambda_pf && lambda_f <= lambda_rf;
                const flange_slender = lambda_f > lambda_rf;
                
                // 웹 slenderness (Castellated beam 전체 높이 기준)
                const lambda_w = hw_castellated / tw;  // 웹 slenderness
                const lambda_pw = 3.76 * Math.sqrt(Es / Fy);  // Compact limit
                const lambda_rw = 5.70 * Math.sqrt(Es / Fy);  // Noncompact limit
                
                const web_compact = lambda_w <= lambda_pw;
                const web_noncompact = lambda_w > lambda_pw && lambda_w <= lambda_rw;
                const web_slender = lambda_w > lambda_rw;
                
                // 단면 분류 결정
                let section_class = 'Compact';
                if (flange_slender || web_slender) {
                    section_class = 'Slender';
                } else if (flange_noncompact || web_noncompact) {
                    section_class = 'Noncompact';
                }
                
                // 3.3 횡비틀림좌굴 검토 (AISC 360 F2)
                // Lp, Lr 계산
                // rts (effective radius of gyration for LTB)
                const rts = Math.sqrt(Math.sqrt(Iy_castellated * Ix_steel) / (Sx_castellated / (d_castellated / 2)));  // mm (근사)
                // ho (flange center-to-center distance)
                const ho_flexural = d_castellated - tf;  // mm
                // J (torsional constant)
                const J = (2 * bf * Math.pow(tf, 3) + hw_castellated * Math.pow(tw, 3)) / 3;  // mm⁴
                // Cw (warping constant)
                const Cw = Iy_castellated * Math.pow(ho_flexural, 2) / 4;  // mm⁶
                
                // Lp (plastic LTB length)
                const Lp = 1.76 * rts * Math.sqrt(Es / Fy) / 1000;  // m
                // Lr (elastic LTB length)
                const FL = 0.7 * Fy;  // MPa (for rolled shapes)
                const Lr = 1.95 * rts * (Es / FL) * Math.sqrt((J / (Sx_castellated * ho_flexural)) + Math.sqrt(Math.pow(J / (Sx_castellated * ho_flexural), 2) + 6.76 * Math.pow(FL / Es, 2))) / 1000;  // m
                
                // Lb (unbraced length) - 보 스팬 전체 (보수적)
                const Lb = L;  // m
                
                // LTB case 결정
                let LTB_case = '';
                if (Lb <= Lp) {
                    LTB_case = 'LTB 비지배 (Lb ≤ Lp)';
                } else if (Lb <= Lr) {
                    LTB_case = '비탄성 LTB (Lp < Lb ≤ Lr)';
                } else {
                    LTB_case = '탄성 LTB (Lb > Lr)';
                }
                
                // 3.4 공칭 휨강도 산정 (AISC 360 F2)
                // 소성 단면계수 Zx 계산 (근사)
                const Zx_castellated = 1.14 * Sx_castellated;  // mm³ (근사, 일반적으로 Zx ≈ 1.14Sx)
                // Mp (plastic moment)
                const Mp_flexural = Zx_castellated * Fy / 1e6;  // kN·m
                
                // Mn 계산 (LTB case에 따라)
                let Mn = 0;
                if (Lb <= Lp) {
                    // LTB 비지배
                    Mn = Mp_flexural;  // kN·m
                } else if (Lb <= Lr) {
                    // 비탄성 LTB
                    const Cb = 1.0;  // 보수적으로 1.0 사용
                    Mn = Cb * (Mp_flexural - (Mp_flexural - 0.7 * Fy * Sx_castellated / 1e6) * ((Lb - Lp) / (Lr - Lp)));  // kN·m
                    Mn = Math.min(Mn, Mp_flexural);  // Mp를 초과할 수 없음
                } else {
                    // 탄성 LTB
                    const Cb = 1.0;  // 보수적으로 1.0 사용
                    const Fcr = (Cb * Math.PI * Math.PI * Es) / (Math.pow(Lb * 1000 / rts, 2));  // MPa
                    Mn = Fcr * Sx_castellated / 1e6;  // kN·m
                    Mn = Math.min(Mn, Mp_flexural);  // Mp를 초과할 수 없음
                }
                
                // 저감계수 (이미 함수 상단에서 선언됨)
                const phiMn = phi_b * Mn;  // kN·m
                
                // 3.5 휨강도 판정
                // 사용단계 최대 모멘트 사용
                const Mu = M_u_service;  // kN·m (사용단계 최대 모멘트)
                const flexural_ok = Mu <= phiMn;
                const flexural_UR = Mu / phiMn;  // 사용률
                
                // ===== 4. 전단 항복 및 전단 좌굴 (Gross Shear Strength) =====
                // 개구부 없는 Web 부분의 전단 항복 및 전단 좌굴 검토 (AISC 360 Ch. G)
                // 특히 지점부 인접 개구부 주의
                
                // 4.1 지점부 인접 개구부 위치 확인
                // 첫 번째 개구부와 마지막 개구부의 위치
                const firstOpeningX = xs.length > 0 ? xs[0] : 0;  // m
                const lastOpeningX = xs.length > 0 ? xs[xs.length - 1] : L;  // m
                const endPostDistance = Math.min(firstOpeningX, L - lastOpeningX);  // m (지점부에서 가장 가까운 개구부까지의 거리)
                const endPostDistance_mm = endPostDistance * 1000;  // mm
                
                // 지점부 인접 개구부 경고 여부 (DG31 권장: 지점부에서 최소 0.5d 이상 이격)
                const minEndPostDistance = 0.5 * d_castellated / 1000;  // m
                const endPostDistance_ok = endPostDistance >= minEndPostDistance;
                
                // 4.2 개구부 없는 Web 부분의 전단 강도 계산
                // Solid web 구간의 전단 면적 (개구부 없는 부분)
                const Aw_solid = d_castellated * tw;  // mm² (전체 높이 기준)
                
                // 지점부에서의 전단력 (최대 전단력)
                const Vu_end = Vu_max;  // kN
                
                // 전단 좌굴 계수 Cv 계산 (AISC 360 G2)
                // h/tw 비율
                const h_tw_solid = hw_castellated / tw;
                const kv_solid = 5.0;  // 웹 판재 좌굴 계수 (stiffener 없음)
                const h_tw_limit_solid = 1.10 * Math.sqrt(kv_solid * Es / Fy);
                const h_tw_limit_elastic = 1.37 * Math.sqrt(kv_solid * Es / Fy);
                
                let Cv_solid = 1.0;
                if (h_tw_solid <= h_tw_limit_solid) {
                    // 전단 항복 지배 (AISC 360 G2-1)
                    Cv_solid = 1.0;
                } else if (h_tw_solid <= h_tw_limit_elastic) {
                    // 전단 좌굴 (비탄성, AISC 360 G2-2)
                    Cv_solid = 1.10 * Math.sqrt(kv_solid * Es / Fy) / h_tw_solid;
                } else {
                    // 전단 좌굴 (탄성, AISC 360 G2-3)
                    Cv_solid = 1.51 * kv_solid * Es / (Fy * Math.pow(h_tw_solid, 2));
                }
                
                // 공칭 전단 강도 (AISC 360 G2-1)
                const Vn_solid = 0.6 * Fy * Aw_solid * Cv_solid / 1000;  // kN
                
                // 설계 전단 강도
                const phiVn_solid = phi_v * Vn_solid;  // kN
                
                // 4.3 전단 강도 판정
                const shear_solid_ok = Vu_end <= phiVn_solid;
                const shear_solid_UR = Vu_end / phiVn_solid;  // 사용률
                
                // 전단 항복 여부 판정
                const shear_yielding = h_tw_solid <= h_tw_limit_solid;
                const shear_buckling = h_tw_solid > h_tw_limit_solid;
                const shear_buckling_elastic = h_tw_solid > h_tw_limit_elastic;
                
                // ===== 5. 개구부 위치 제한 검토 (Geometric Limits) =====
                // AISC Design Guide 31 권장사항
                
                // 5.1 개구부 높이 검토: 0.5h ≤ ho ≤ 0.75h
                const h_total = d_castellated / 1000;  // m (전체 보 높이)
                const ho_min_limit = 0.5 * h_total;  // m
                const ho_max_limit = 0.75 * h_total;  // m
                const ho_geometric_ok = ho >= ho_min_limit && ho <= ho_max_limit;
                
                // 5.2 Web Post 폭 검토: e ≥ 0.25ho
                const e_min_limit = 0.25 * ho * 1000;  // mm (ho는 m 단위이므로 mm로 변환)
                const e_geometric_ok = e >= e_min_limit;
                
                // 5.3 지점부 개구부 이격거리 검토: ≥ 1.5h
                const endPostDistance_min_limit = 1.5 * h_total;  // m
                const endPostDistance_geometric_ok = endPostDistance >= endPostDistance_min_limit;
                
                // 종합 판정
                const geometric_limits_ok = ho_geometric_ok && e_geometric_ok && endPostDistance_geometric_ok;
                
                // 1.3 Vierendeel Bending 검토 (DG31)
                // 지배 개구부에서의 Vierendeel 거동 검토
                const V_tee = govOpening.V;  // kN (개구부 중심의 전단력)
                const M_tee = govOpening.Mtee;  // kN·m (Tee section 모멘트)
                
                // Tee section 치수
                const h_tee_web = ho * 1000;  // mm (Tee 웹 높이)
                const h_tee_total = h_tee_web + tf;  // mm (Tee 전체 높이)
                const A_tee = bf * tf + h_tee_web * tw;  // mm² (Tee 단면적)
                
                // Tee section 단면2차모멘트 (개구부 중심 기준)
                const Ix_tee = (bf * Math.pow(tf, 3)) / 12 + bf * tf * Math.pow(h_tee_web + tf/2, 2) + (tw * Math.pow(h_tee_web, 3)) / 12;  // mm⁴
                const Sx_tee = Ix_tee / (h_tee_total / 2);  // mm³
                
                // Tee section 휨강도 (AISC 360 F2, 단순화)
                // 소성 단면계수 근사
                const Zx_tee_approx = bf * tf * (h_tee_web + tf/2) + tw * Math.pow(h_tee_web, 2) / 4;  // mm³
                const Mp_tee = Zx_tee_approx * Fy / 1e6;  // kN·m
                const phiMn_tee = 0.9 * Mp_tee;  // kN·m
                
                // Tee section 전단강도
                const Aw_tee = h_tee_web * tw;  // mm² (Tee 웹 전단 면적)
                const Vn_tee = 0.6 * Fy * Aw_tee / 1000;  // kN
                const phiVn_tee = phi_v * Vn_tee;  // kN
                
                // Vierendeel Bending 판정
                const vierendeel_flexural_ok = M_tee <= phiMn_tee;
                const vierendeel_flexural_UR = M_tee / phiMn_tee;
                const vierendeel_shear_ok = V_tee <= phiVn_tee;
                const vierendeel_shear_UR = V_tee / phiVn_tee;
                const vierendeel_ok = vierendeel_flexural_ok && vierendeel_shear_ok;
                
                // Weld design
                const Fexx = 490.0;  // MPa
                const phi_w = 0.75;
                const Aw_req = (Vrh * 1000.0) / (phi_w * 0.6 * Fexx);  // mm²
                const w_req = Aw_req / (0.707 * e);  // mm
                const w_final = Math.ceil(w_req);  // mm

                // Prepare results
                const results = {
                    type: beamType,
                    L: L,
                    B: B,
                    DL: DL,
                    LL: LL,
                    self_w: self_w,  // kN/m²
                    slabWeight: slabWeight,  // kN/m²
                    self_w_kNm: self_w_kNm,  // kN/m
                    wu: wu,
                    Fy: Fy,
                    Es: Es,  // 탄성계수
                    steelGrade: steelGrade,
                    dc: dc,
                    bf: bf,
                    tf: tf,
                    tw: tw,
                    ho: ho,
                    p: p,
                    theta: theta,
                    end_post: end_post,
                    e: e,  // 웹 포스트 폭
                    delta_x: delta_x,
                    W_open: W_open,  // 개구부 전체 폭
                    W_rect: W_rect,  // 개구부 폭 (직사각형 부분)
                    b_wp: b_wp,  // 웹 포스트 폭 (= e)
                    N: N,
                    openingResults: openingResults,
                    govOpening: govOpening,
                    Vrh: Vrh,
                    webPostPair: webPostPair,
                    Mrh: Mrh,
                    Mp: Mp_webpost,
                    etw: etw,
                    ratio: ratio,
                    Mocr: Mocr,
                    phiMocr: phiMocr,
                    buckling_ok: buckling_ok,
                    w_req: w_req,
                    w_final: w_final,
                    ts: ts,
                    // 전단강도 및 Vierendeel 거동검토
                    Vu_max: Vu_max,
                    Aw: Aw,
                    h_tw: h_tw,
                    Cv: Cv,
                    Vn: Vn,
                    phiVn: phiVn,
                    shear_global_ok: shear_global_ok,
                    shear_global_UR: shear_global_UR,
                    Aw_webpost: Aw_webpost,
                    Vn_webpost: Vn_webpost,
                    phiVn_webpost: phiVn_webpost,
                    shear_webpost_ok: shear_webpost_ok,
                    shear_webpost_UR: shear_webpost_UR,
                    V_tee: V_tee,
                    M_tee: M_tee,
                    h_tee_web: h_tee_web,
                    h_tee_total: h_tee_total,
                    A_tee: A_tee,
                    Ix_tee: Ix_tee,
                    Sx_tee: Sx_tee,
                    Zx_tee_approx: Zx_tee_approx,
                    Mp_tee: Mp_tee,
                    phiMn_tee: phiMn_tee,
                    Aw_tee: Aw_tee,
                    Vn_tee: Vn_tee,
                    phiVn_tee: phiVn_tee,
                    vierendeel_flexural_ok: vierendeel_flexural_ok,
                    vierendeel_flexural_UR: vierendeel_flexural_UR,
                    vierendeel_shear_ok: vierendeel_shear_ok,
                    vierendeel_shear_UR: vierendeel_shear_UR,
                    vierendeel_ok: vierendeel_ok,
                    // 전단파괴모드 검토 (Web Post Failure)
                    webpost_shear_failure: webpost_shear_failure,
                    webpost_buckling_failure: webpost_buckling_failure,
                    webpost_failure_mode: webpost_failure_mode,
                    webpost_failure_mode_kr: webpost_failure_mode_kr,
                    webpost_failure_ok: webpost_failure_ok,
                    webpost_shear_UR: webpost_shear_UR,
                    webpost_buckling_UR: webpost_buckling_UR,
                    webpost_max_UR: webpost_max_UR,
                    etw_ratio: etw_ratio,
                    etw_limit: etw_limit,
                    etw_ok: etw_ok,
                    ho_e_ratio: ho_e_ratio,
                    ho_e_limit: ho_e_limit,
                    ho_e_ok: ho_e_ok,
                    // 글로벌 휨강도 검토
                    M_opening: M_opening,
                    M_solid: M_solid,
                    M_max: M_max,
                    governing_section: governing_section,
                    lambda_f: lambda_f,
                    lambda_pf: lambda_pf,
                    lambda_rf: lambda_rf,
                    flange_compact: flange_compact,
                    flange_noncompact: flange_noncompact,
                    flange_slender: flange_slender,
                    lambda_w: lambda_w,
                    lambda_pw: lambda_pw,
                    lambda_rw: lambda_rw,
                    web_compact: web_compact,
                    web_noncompact: web_noncompact,
                    web_slender: web_slender,
                    section_class: section_class,
                    rts: rts,
                    ho_flexural: ho_flexural,
                    J: J,
                    Cw: Cw,
                    Lp: Lp,
                    Lr: Lr,
                    Lb: Lb,
                    LTB_case: LTB_case,
                    Zx_castellated: Zx_castellated,
                    Mp_flexural: Mp_flexural,
                    Mn: Mn,
                    phi_b: phi_b,
                    phiMn: phiMn,
                    Mu: Mu,
                    flexural_ok: flexural_ok,
                    flexural_UR: flexural_UR,
                    // 전단 항복 및 전단 좌굴 (Gross Shear Strength)
                    firstOpeningX: firstOpeningX,
                    lastOpeningX: lastOpeningX,
                    endPostDistance: endPostDistance,
                    endPostDistance_mm: endPostDistance_mm,
                    minEndPostDistance: minEndPostDistance,
                    endPostDistance_ok: endPostDistance_ok,
                    Aw_solid: Aw_solid,
                    Vu_end: Vu_end,
                    h_tw_solid: h_tw_solid,
                    kv_solid: kv_solid,
                    h_tw_limit_solid: h_tw_limit_solid,
                    h_tw_limit_elastic: h_tw_limit_elastic,
                    Cv_solid: Cv_solid,
                    Vn_solid: Vn_solid,
                    phiVn_solid: phiVn_solid,
                    shear_solid_ok: shear_solid_ok,
                    shear_solid_UR: shear_solid_UR,
                    shear_yielding: shear_yielding,
                    shear_buckling: shear_buckling,
                    shear_buckling_elastic: shear_buckling_elastic,
                    phi_v: phi_v,  // 저감계수 (전단강도)
                    // 개구부 위치 제한 검토 (Geometric Limits)
                    h_total: h_total,
                    ho_min_limit: ho_min_limit,
                    ho_max_limit: ho_max_limit,
                    ho_geometric_ok: ho_geometric_ok,
                    e_min_limit: e_min_limit,
                    e_geometric_ok: e_geometric_ok,
                    endPostDistance_min_limit: endPostDistance_min_limit,
                    endPostDistance_geometric_ok: endPostDistance_geometric_ok,
                    geometric_limits_ok: geometric_limits_ok,
                    // Construction stage results
                    qConst: qConst,
                    w_DL_construction: w_DL_construction,
                    w_CLL_construction: w_CLL_construction,
                    w_u1_construction: w_u1_construction,
                    w_u2_construction: w_u2_construction,
                    w_u_construction: w_u_construction,
                    M_u_construction: M_u_construction,
                    I_req_construction: I_req_construction,
                    Ix_steel: Ix_steel,
                    delta_allow_construction: delta_allow_construction,
                    // Section properties
                    d_original: d_original,
                    Ix_original: Ix_original,
                    Sx_original: Sx_original,
                    rx_original: rx_original,
                    Iy_original: Iy_original,
                    ry_original: ry_original,
                    d_castellated: d_castellated,
                    Sx_castellated: Sx_castellated,
                    rx_castellated: rx_castellated,
                    Iy_castellated: Iy_castellated,
                    ry_castellated: ry_castellated,
                    A_total: A_total,
                    // Service stage results
                    w_DL_service: w_DL_service,
                    w_SIDL_service: w_SIDL_service,
                    w_LL_service: w_LL_service,
                    w_u1_service: w_u1_service,
                    w_u2_service: w_u2_service,
                    w_u_service: w_u_service,
                    M_u_service: M_u_service,
                    V_u_service: V_u_service,
                    I_req_service: I_req_service,
                    delta_allow_service: delta_allow_service
                };

                displayResults(results);
            } catch (error) {
                console.error('Calculation error:', error);
                alert('계산 중 오류가 발생했습니다: ' + error.message);
            }
        }

        // Display results
        function displayResults(results) {
            const container = document.getElementById('resultsContainer');
            const noResults = document.getElementById('noResults');

            if (!container) return;

            container.classList.add('active');
            if (noResults) {
                noResults.style.display = 'none';
            }

            // Create opening results table
            let openingTableRows = '';
            results.openingResults.forEach(op => {
                const urStatus = op.UR <= 1.0 ? 'status-ok' : 'status-ng';
                openingTableRows += `
                    <tr>
                        <td>${op.i}</td>
                        <td>${formatNumber(op.x, 2)}</td>
                        <td>${formatNumber(op.V, 2)}</td>
                        <td>${formatNumber(op.M, 2)}</td>
                        <td>${formatNumber(op.P, 2)}</td>
                        <td>${formatNumber(op.Mtee, 2)}</td>
                        <td class="result-value ${urStatus}">${formatNumber(op.UR, 3)}</td>
                    </tr>
                `;
            });

            // #region agent log - Debug NG display
            fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:1108',message:'displayResults called',data:{shear_webpost_ok:results.shear_webpost_ok,buckling_ok:results.buckling_ok,webpost_failure_ok:results.webpost_failure_ok},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'A'})}).catch(()=>{});
            // #endregion
            
            container.innerHTML = `
                <!-- 1. 전단강도 및 Vierendeel 거동검토 -->
                <div class="result-section">
                    <div class="result-section-title" style="font-size: 18px; font-weight: 700; color: #1e3a5f; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #3b82f6;">1. 전단강도 및 Vierendeel 거동검토</div>
                    
                    <!-- 1.1 전체 전단 강도 검토 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">1.1 전체 전단 강도 검토 (AISC 360 Ch. G)</h4>
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 10px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                            <strong>검토 내용:</strong> Castellated beam의 전체 전단 강도를 검토합니다. (AISC 360 Ch. G)<br>
                            <strong>계산식:</strong> V<sub>n</sub> = 0.6F<sub>y</sub>A<sub>w</sub>C<sub>v</sub>, 판정: V<sub>u</sub> ≤ φV<sub>n</sub> (φ = 0.90)
                        </div>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>단위</th>
                            </tr>
                            <tr>
                                <td>최대 전단력 (V<sub>u</sub>)</td>
                                <td class="result-value">${formatNumber(results.Vu_max, 2)}</td>
                                <td>kN</td>
                            </tr>
                            <tr>
                                <td>전단 면적 (A<sub>w</sub>)</td>
                                <td class="result-value">${formatNumber(results.Aw, 1)}</td>
                                <td>mm²</td>
                            </tr>
                            <tr>
                                <td>h/t<sub>w</sub></td>
                                <td class="result-value">${formatNumber(results.h_tw, 2)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>전단 좌굴 계수 (C<sub>v</sub>)</td>
                                <td class="result-value">${formatNumber(results.Cv, 3)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>공칭 전단 강도 (V<sub>n</sub>)</td>
                                <td class="result-value">${formatNumber(results.Vn, 2)}</td>
                                <td>kN</td>
                            </tr>
                            <tr>
                                <td>설계 전단 강도 (φV<sub>n</sub>)</td>
                                <td class="result-value" style="font-weight: 600;">${formatNumber(results.phiVn, 2)}</td>
                                <td>kN</td>
                            </tr>
                            <tr>
                                <td>사용률</td>
                                <td class="result-value ${results.shear_global_ok ? 'status-ok' : 'status-ng'}">${formatNumber(results.shear_global_UR, 3)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>판정</td>
                                <td class="result-value ${results.shear_global_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.shear_global_ok ? '✅ 만족 (V<sub>u</sub> ≤ φV<sub>n</sub>)' : '❌ 불만족 (V<sub>u</sub> > φV<sub>n</sub>)'}
                                </td>
                                <td>-</td>
                            </tr>
                        </table>
                    </div>
                    
                    <!-- 1.2 Web Post 전단 강도 검토 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">1.2 Web Post 전단 강도 검토 (AISC DG31)</h4>
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 10px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                            <strong>검토 내용:</strong> Web Post의 전단 강도를 검토합니다. (AISC DG31)<br>
                            <strong>계산식:</strong> V<sub>n,webpost</sub> = 0.6F<sub>y</sub>A<sub>w,webpost</sub>, 판정: V<sub>rh</sub> ≤ φV<sub>n,webpost</sub>
                        </div>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>단위</th>
                            </tr>
                            <tr>
                                <td>Web Post 전단력 (V<sub>rh</sub>)</td>
                                <td class="result-value">${formatNumber(results.Vrh, 2)}</td>
                                <td>kN</td>
                            </tr>
                            <tr>
                                <td>Web Post 전단 면적 (A<sub>w,webpost</sub>)</td>
                                <td class="result-value">${formatNumber(results.Aw_webpost, 1)}</td>
                                <td>mm²</td>
                            </tr>
                            <tr>
                                <td>공칭 전단 강도 (V<sub>n,webpost</sub>)</td>
                                <td class="result-value">${formatNumber(results.Vn_webpost, 2)}</td>
                                <td>kN</td>
                            </tr>
                            <tr>
                                <td>설계 전단 강도 (φV<sub>n,webpost</sub>)</td>
                                <td class="result-value" style="font-weight: 600;">${formatNumber(results.phiVn_webpost, 2)}</td>
                                <td>kN</td>
                            </tr>
                            <tr>
                                <td>사용률</td>
                                <td class="result-value ${results.shear_webpost_ok ? 'status-ok' : 'status-ng'}">${formatNumber(results.shear_webpost_UR, 3)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>판정</td>
                                <td class="result-value ${results.shear_webpost_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.shear_webpost_ok ? '✅ 만족 (V<sub>rh</sub> ≤ φV<sub>n,webpost</sub>)' : '❌ 불만족 (V<sub>rh</sub> > φV<sub>n,webpost</sub>)'}
                                </td>
                                <td>-</td>
                            </tr>
                        </table>
                    </div>
                    
                    <!-- 1.3 Vierendeel Bending 검토 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">1.3 Vierendeel Bending 검토 (AISC DG31)</h4>
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 10px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                            <strong>검토 내용:</strong> Opening 상·하부 Tee section의 Vierendeel 거동을 검토합니다. (AISC DG31 Section 3.1)<br>
                            <strong>검토 항목:</strong> Tee section의 휨강도 및 전단강도 검토
                        </div>
                        
                        <h5 style="font-size: 13px; font-weight: 600; color: #475569; margin-top: 15px; margin-bottom: 8px;">Tee Section 휨강도 검토</h5>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>단위</th>
                            </tr>
                            <tr>
                                <td>Tee 모멘트 (M<sub>tee</sub>)</td>
                                <td class="result-value">${formatNumber(results.M_tee, 2)}</td>
                                <td>kN·m</td>
                            </tr>
                            <tr>
                                <td>Tee 단면적 (A<sub>tee</sub>)</td>
                                <td class="result-value">${formatNumber(results.A_tee, 1)}</td>
                                <td>mm²</td>
                            </tr>
                            <tr>
                                <td>Tee 단면2차모멘트 (I<sub>x,tee</sub>)</td>
                                <td class="result-value">${formatNumber(results.Ix_tee / 1e6, 2)}</td>
                                <td>×10⁶ mm⁴</td>
                            </tr>
                            <tr>
                                <td>Tee 단면계수 (S<sub>x,tee</sub>)</td>
                                <td class="result-value">${formatNumber(results.Sx_tee / 1e3, 1)}</td>
                                <td>×10³ mm³</td>
                            </tr>
                            <tr>
                                <td>소성 단면계수 (Z<sub>x,tee</sub>)</td>
                                <td class="result-value">${formatNumber(results.Zx_tee_approx / 1e3, 1)}</td>
                                <td>×10³ mm³</td>
                            </tr>
                            <tr>
                                <td>소성 모멘트 (M<sub>p,tee</sub>)</td>
                                <td class="result-value">${formatNumber(results.Mp_tee, 2)}</td>
                                <td>kN·m</td>
                            </tr>
                            <tr>
                                <td>설계 휨강도 (φM<sub>n,tee</sub>)</td>
                                <td class="result-value" style="font-weight: 600;">${formatNumber(results.phiMn_tee, 2)}</td>
                                <td>kN·m</td>
                            </tr>
                            <tr>
                                <td>사용률</td>
                                <td class="result-value ${results.vierendeel_flexural_ok ? 'status-ok' : 'status-ng'}">${formatNumber(results.vierendeel_flexural_UR, 3)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>판정</td>
                                <td class="result-value ${results.vierendeel_flexural_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.vierendeel_flexural_ok ? '✅ 만족 (M<sub>tee</sub> ≤ φM<sub>n,tee</sub>)' : '❌ 불만족 (M<sub>tee</sub> > φM<sub>n,tee</sub>)'}
                                </td>
                                <td>-</td>
                            </tr>
                        </table>
                        
                        <h5 style="font-size: 13px; font-weight: 600; color: #475569; margin-top: 15px; margin-bottom: 8px;">Tee Section 전단강도 검토</h5>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>단위</th>
                            </tr>
                            <tr>
                                <td>Tee 전단력 (V<sub>tee</sub>)</td>
                                <td class="result-value">${formatNumber(results.V_tee, 2)}</td>
                                <td>kN</td>
                            </tr>
                            <tr>
                                <td>Tee 웹 전단 면적 (A<sub>w,tee</sub>)</td>
                                <td class="result-value">${formatNumber(results.Aw_tee, 1)}</td>
                                <td>mm²</td>
                            </tr>
                            <tr>
                                <td>공칭 전단 강도 (V<sub>n,tee</sub>)</td>
                                <td class="result-value">${formatNumber(results.Vn_tee, 2)}</td>
                                <td>kN</td>
                            </tr>
                            <tr>
                                <td>설계 전단 강도 (φV<sub>n,tee</sub>)</td>
                                <td class="result-value" style="font-weight: 600;">${formatNumber(results.phiVn_tee, 2)}</td>
                                <td>kN</td>
                            </tr>
                            <tr>
                                <td>사용률</td>
                                <td class="result-value ${results.vierendeel_shear_ok ? 'status-ok' : 'status-ng'}">${formatNumber(results.vierendeel_shear_UR, 3)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>판정</td>
                                <td class="result-value ${results.vierendeel_shear_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.vierendeel_shear_ok ? '✅ 만족 (V<sub>tee</sub> ≤ φV<sub>n,tee</sub>)' : '❌ 불만족 (V<sub>tee</sub> > φV<sub>n,tee</sub>)'}
                                </td>
                                <td>-</td>
                            </tr>
                        </table>
                        
                        <div style="margin-top: 15px; padding: 10px; background: ${results.vierendeel_ok ? '#d1fae5' : '#fee2e2'}; border-radius: 6px; border: 1px solid ${results.vierendeel_ok ? '#10b981' : '#ef4444'};">
                            <div style="font-size: 12px; font-weight: 600; color: ${results.vierendeel_ok ? '#065f46' : '#991b1b'};">
                                ${results.vierendeel_ok ? '✅ Vierendeel Bending 검토 만족' : '❌ Vierendeel Bending 검토 불만족'}
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 2. 전단파괴모드 검토 (Web Post Failure) -->
                <div class="result-section">
                    <div class="result-section-title" style="font-size: 18px; font-weight: 700; color: #1e3a5f; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #3b82f6;">2. 전단파괴모드 검토 (Web Post Failure)</div>
                    
                    <div style="font-size: 11px; color: #64748b; margin-bottom: 15px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                        <strong>검토 내용:</strong> Web Post의 전단 파괴 모드를 분석하고 검토합니다. (AISC DG31)<br>
                        <strong>파괴 모드:</strong> 1) 전단 강도 파괴 (V<sub>rh</sub> > φV<sub>n,webpost</sub>), 2) 좌굴 파괴 (M<sub>rh</sub> > φM<sub>ocr</sub>)
                    </div>
                    
                    <!-- 2.1 Web Post 전단 파괴 모드 분석 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">2.1 Web Post 전단 파괴 모드 분석</h4>
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 10px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                            <strong>검토 내용:</strong> Web Post의 전단 강도 파괴와 좌굴 파괴를 각각 검토하여 지배 파괴 모드를 결정합니다. (AISC DG31)
                        </div>
                        
                        <table class="result-table">
                            <tr>
                                <th>검토 항목</th>
                                <th>소요값</th>
                                <th>설계값</th>
                                <th>사용률</th>
                                <th>판정</th>
                            </tr>
                            <tr>
                                <td>전단 강도 파괴</td>
                                <td class="result-value">V<sub>rh</sub> = ${formatNumber(results.Vrh, 2)}</td>
                                <td class="result-value">φV<sub>n,webpost</sub> = ${formatNumber(results.phiVn_webpost, 2)}</td>
                                <td class="result-value ${results.shear_webpost_ok ? 'status-ok' : 'status-ng'}">${formatNumber(results.webpost_shear_UR, 3)}</td>
                                <td class="result-value ${results.shear_webpost_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.shear_webpost_ok ? '✅ OK' : '❌ NG'}
                                    ${!results.shear_webpost_ok ? '<div style="font-size: 10px; color: #ef4444; margin-top: 4px;">Web Post 보강필요</div>' : ''}
                                </td>
                            </tr>
                            <tr>
                                <td>좌굴 파괴</td>
                                <td class="result-value">M<sub>rh</sub> = ${formatNumber(results.Mrh, 2)}</td>
                                <td class="result-value">φM<sub>ocr</sub> = ${formatNumber(results.phiMocr, 2)}</td>
                                <td class="result-value ${results.buckling_ok ? 'status-ok' : 'status-ng'}">${formatNumber(results.webpost_buckling_UR, 3)}</td>
                                <td class="result-value ${results.buckling_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.buckling_ok ? '✅ OK' : '❌ NG'}
                                    ${!results.buckling_ok ? '<div style="font-size: 10px; color: #ef4444; margin-top: 4px;">Web Post 보강필요</div>' : ''}
                                </td>
                            </tr>
                        </table>
                        
                        <div style="margin-top: 15px; padding: 15px; background: ${results.webpost_failure_ok ? '#d1fae5' : '#fee2e2'}; border-radius: 8px; border: 2px solid ${results.webpost_failure_ok ? '#10b981' : '#ef4444'};">
                            <div style="font-size: 14px; font-weight: 700; color: ${results.webpost_failure_ok ? '#065f46' : '#991b1b'}; margin-bottom: 10px; text-align: center;">
                                ${results.webpost_failure_ok ? '✅ Web Post 안전' : '❌ Web Post 파괴'}
                            </div>
                            <div style="font-size: 12px; color: ${results.webpost_failure_ok ? '#065f46' : '#991b1b'}; text-align: center;">
                                지배 파괴 모드: <strong>${results.webpost_failure_mode_kr}</strong>
                            </div>
                            <div style="font-size: 11px; color: ${results.webpost_failure_ok ? '#065f46' : '#991b1b'}; text-align: center; margin-top: 8px;">
                                최대 사용률: ${formatNumber(results.webpost_max_UR, 3)}
                            </div>
                        </div>
                    </div>
                    
                    <!-- 2.2 Web Post 치수 검토 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">2.2 Web Post 치수 검토 (AISC DG31 권장사항)</h4>
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 10px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                            <strong>검토 내용:</strong> Web Post의 치수 비율을 검토하여 적정성을 확인합니다. (AISC DG31)<br>
                            <strong>권장 기준:</strong> e/t<sub>w</sub> ≤ 20, h<sub>o</sub>/e ≤ 1.5
                        </div>
                        
                        <table class="result-table">
                            <tr>
                                <th>검토 항목</th>
                                <th>계산값</th>
                                <th>권장 기준</th>
                                <th>판정</th>
                            </tr>
                            <tr>
                                <td>e/t<sub>w</sub> 비율</td>
                                <td class="result-value">${formatNumber(results.etw_ratio, 2)}</td>
                                <td class="result-value">≤ ${formatNumber(results.etw_limit, 1)}</td>
                                <td class="result-value ${results.etw_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.etw_ok ? '✅ OK' : '❌ NG'}
                                </td>
                            </tr>
                            <tr>
                                <td>h<sub>o</sub>/e 비율</td>
                                <td class="result-value">${formatNumber(results.ho_e_ratio, 2)}</td>
                                <td class="result-value">≤ ${formatNumber(results.ho_e_limit, 1)}</td>
                                <td class="result-value ${results.ho_e_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.ho_e_ok ? '✅ OK' : '❌ NG'}
                                </td>
                            </tr>
                        </table>
                        
                        <div style="margin-top: 10px; padding: 10px; background: #f1f5f9; border-radius: 4px;">
                            <div style="font-size: 12px; color: #64748b; line-height: 1.6;">
                                <strong>참고:</strong> Web Post 치수 비율이 권장 기준을 초과하면 전단 강도나 좌굴 강도가 저하될 수 있습니다. 필요시 Web Post 폭(e)을 증가시키거나 웹 두께(t<sub>w</sub>)를 증가시켜야 합니다.
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 3. 글로벌 휨강도 검토 (Overall Flexural Strength) -->
                <div class="result-section">
                    <div class="result-section-title" style="font-size: 18px; font-weight: 700; color: #1e3a5f; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #3b82f6;">3. 글로벌 휨강도 검토 (Overall Flexural Strength)</div>
                    
                    <div style="font-size: 11px; color: #64748b; margin-bottom: 15px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                        <strong>검토 내용:</strong> Castellated beam의 전체 휨강도를 검토합니다. (AISC 360 Ch. F + DG31)<br>
                        <strong>검토 항목:</strong> 검토 단면 선정, 단면 분류, 횡비틀림좌굴 검토, 공칭 휨강도 산정, 휨강도 판정
                    </div>
                    
                    <!-- 3.1 검토 단면 선정 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">3.1 검토 단면 선정</h4>
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 10px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                            <strong>검토 내용:</strong> Opening 구간과 Solid web 구간 중 더 큰 모멘트를 받는 지배 구간을 선정합니다. (AISC 360 Ch. F)
                        </div>
                        <table class="result-table">
                            <tr>
                                <th>구간</th>
                                <th>모멘트</th>
                                <th>단위</th>
                            </tr>
                            <tr>
                                <td>Opening 구간 (지배 개구부)</td>
                                <td class="result-value">${formatNumber(results.M_opening, 2)}</td>
                                <td>kN·m</td>
                            </tr>
                            <tr>
                                <td>Solid web 구간 (최대 모멘트)</td>
                                <td class="result-value">${formatNumber(results.M_solid, 2)}</td>
                                <td>kN·m</td>
                            </tr>
                            <tr>
                                <td style="font-weight: 600;">지배 구간</td>
                                <td class="result-value" style="font-weight: 600; color: #3b82f6;">${results.governing_section}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td style="font-weight: 600;">최대 모멘트 (M<sub>max</sub>)</td>
                                <td class="result-value" style="font-weight: 600;">${formatNumber(results.M_max, 2)}</td>
                                <td>kN·m</td>
                            </tr>
                        </table>
                    </div>
                    
                    <!-- 3.2 단면 분류 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">3.2 단면 분류 (AISC 360 Table B4.1)</h4>
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 10px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                            <strong>검토 내용:</strong> 플랜지 및 웹의 slenderness를 계산하여 단면을 Compact, Noncompact, Slender로 분류합니다. (AISC 360 Table B4.1)
                        </div>
                        
                        <h5 style="font-size: 13px; font-weight: 600; color: #475569; margin-top: 15px; margin-bottom: 8px;">플랜지 Slenderness</h5>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>기준</th>
                                <th>판정</th>
                            </tr>
                            <tr>
                                <td>λ<sub>f</sub> = b<sub>f</sub>/(2t<sub>f</sub>)</td>
                                <td class="result-value">${formatNumber(results.lambda_f, 2)}</td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td>λ<sub>pf</sub> = 0.38√(E/F<sub>y</sub>)</td>
                                <td class="result-value">${formatNumber(results.lambda_pf, 2)}</td>
                                <td class="result-value">Compact limit</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td>λ<sub>rf</sub> = 1.0√(E/F<sub>y</sub>)</td>
                                <td class="result-value">${formatNumber(results.lambda_rf, 2)}</td>
                                <td class="result-value">Noncompact limit</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td>플랜지 분류</td>
                                <td class="result-value ${results.flange_compact ? 'status-ok' : (results.flange_noncompact ? '' : 'status-ng')}" style="font-weight: 600;">
                                    ${results.flange_compact ? '✅ Compact' : (results.flange_noncompact ? '⚠️ Noncompact' : '❌ Slender')}
                                </td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                            </tr>
                        </table>
                        
                        <h5 style="font-size: 13px; font-weight: 600; color: #475569; margin-top: 15px; margin-bottom: 8px;">웹 Slenderness</h5>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>기준</th>
                                <th>판정</th>
                            </tr>
                            <tr>
                                <td>λ<sub>w</sub> = h<sub>w</sub>/t<sub>w</sub></td>
                                <td class="result-value">${formatNumber(results.lambda_w, 2)}</td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td>λ<sub>pw</sub> = 3.76√(E/F<sub>y</sub>)</td>
                                <td class="result-value">${formatNumber(results.lambda_pw, 2)}</td>
                                <td class="result-value">Compact limit</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td>λ<sub>rw</sub> = 5.70√(E/F<sub>y</sub>)</td>
                                <td class="result-value">${formatNumber(results.lambda_rw, 2)}</td>
                                <td class="result-value">Noncompact limit</td>
                                <td class="result-value">-</td>
                            </tr>
                            <tr>
                                <td>웹 분류</td>
                                <td class="result-value ${results.web_compact ? 'status-ok' : (results.web_noncompact ? '' : 'status-ng')}" style="font-weight: 600;">
                                    ${results.web_compact ? '✅ Compact' : (results.web_noncompact ? '⚠️ Noncompact' : '❌ Slender')}
                                </td>
                                <td class="result-value">-</td>
                                <td class="result-value">-</td>
                            </tr>
                        </table>
                        
                        <div style="margin-top: 15px; padding: 10px; background: ${results.section_class === 'Compact' ? '#d1fae5' : (results.section_class === 'Noncompact' ? '#fef3c7' : '#fee2e2')}; border-radius: 6px; border: 1px solid ${results.section_class === 'Compact' ? '#10b981' : (results.section_class === 'Noncompact' ? '#f59e0b' : '#ef4444')};">
                            <div style="font-size: 12px; font-weight: 600; color: ${results.section_class === 'Compact' ? '#065f46' : (results.section_class === 'Noncompact' ? '#92400e' : '#991b1b')}; text-align: center;">
                                단면 분류: <strong>${results.section_class}</strong>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 3.3 횡비틀림좌굴 검토 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">3.3 횡비틀림좌굴 검토 (AISC 360 F2)</h4>
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 10px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                            <strong>검토 내용:</strong> 횡비틀림좌굴(LTB) 길이 L<sub>p</sub>, L<sub>r</sub>을 산정하고 L<sub>b</sub>와 비교하여 LTB case를 결정합니다. (AISC 360 F2)
                        </div>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>단위</th>
                            </tr>
                            <tr>
                                <td>r<sub>ts</sub> (effective radius of gyration)</td>
                                <td class="result-value">${formatNumber(results.rts, 1)}</td>
                                <td>mm</td>
                            </tr>
                            <tr>
                                <td>h<sub>o</sub> (flange center-to-center)</td>
                                <td class="result-value">${formatNumber(results.ho_flexural, 1)}</td>
                                <td>mm</td>
                            </tr>
                            <tr>
                                <td>J (torsional constant)</td>
                                <td class="result-value">${formatNumber(results.J / 1e6, 2)}</td>
                                <td>×10⁶ mm⁴</td>
                            </tr>
                            <tr>
                                <td>C<sub>w</sub> (warping constant)</td>
                                <td class="result-value">${formatNumber(results.Cw / 1e12, 2)}</td>
                                <td>×10¹² mm⁶</td>
                            </tr>
                            <tr>
                                <td>L<sub>p</sub> (plastic LTB length)</td>
                                <td class="result-value">${formatNumber(results.Lp, 2)}</td>
                                <td>m</td>
                            </tr>
                            <tr>
                                <td>L<sub>r</sub> (elastic LTB length)</td>
                                <td class="result-value">${formatNumber(results.Lr, 2)}</td>
                                <td>m</td>
                            </tr>
                            <tr>
                                <td>L<sub>b</sub> (unbraced length)</td>
                                <td class="result-value">${formatNumber(results.Lb, 2)}</td>
                                <td>m</td>
                            </tr>
                            <tr>
                                <td style="font-weight: 600;">LTB Case</td>
                                <td class="result-value" style="font-weight: 600; color: #3b82f6;">${results.LTB_case}</td>
                                <td>-</td>
                            </tr>
                        </table>
                    </div>
                    
                    <!-- 3.4 공칭 휨강도 산정 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">3.4 공칭 휨강도 산정 (AISC 360 F2)</h4>
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 10px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                            <strong>검토 내용:</strong> LTB case에 따라 공칭 휨강도 M<sub>n</sub>을 산정합니다. (AISC 360 F2)<br>
                            <strong>계산식:</strong> LTB 비지배: M<sub>n</sub> = M<sub>p</sub>, 비탄성 LTB: M<sub>n</sub> = C<sub>b</sub>[M<sub>p</sub> - (M<sub>p</sub> - 0.7F<sub>y</sub>S<sub>x</sub>)((L<sub>b</sub> - L<sub>p</sub>)/(L<sub>r</sub> - L<sub>p</sub>))], 탄성 LTB: M<sub>n</sub> = F<sub>cr</sub>S<sub>x</sub>
                        </div>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>단위</th>
                            </tr>
                            <tr>
                                <td>Z<sub>x</sub> (소성 단면계수)</td>
                                <td class="result-value">${formatNumber(results.Zx_castellated / 1e3, 1)}</td>
                                <td>×10³ mm³</td>
                            </tr>
                            <tr>
                                <td>M<sub>p</sub> (소성 모멘트)</td>
                                <td class="result-value">${formatNumber(results.Mp_flexural, 2)}</td>
                                <td>kN·m</td>
                            </tr>
                            <tr>
                                <td>M<sub>n</sub> (공칭 휨강도)</td>
                                <td class="result-value" style="font-weight: 600;">${formatNumber(results.Mn, 2)}</td>
                                <td>kN·m</td>
                            </tr>
                            <tr>
                                <td>φ<sub>b</sub> (저감계수)</td>
                                <td class="result-value">${formatNumber(results.phi_b, 2)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>φ<sub>b</sub>M<sub>n</sub> (설계 휨강도)</td>
                                <td class="result-value" style="font-weight: 600; color: #3b82f6;">${formatNumber(results.phiMn, 2)}</td>
                                <td>kN·m</td>
                            </tr>
                        </table>
                    </div>
                    
                    <!-- 3.5 휨강도 판정 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">3.5 휨강도 판정 (AISC 360 F2)</h4>
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 10px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                            <strong>검토 내용:</strong> 소요 휨모멘트와 설계 휨강도를 비교하여 휨강도를 판정합니다. (AISC 360 F2)<br>
                            <strong>판정 기준:</strong> M<sub>u</sub> ≤ φ<sub>b</sub>M<sub>n</sub>
                        </div>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>단위</th>
                            </tr>
                            <tr>
                                <td>소요 휨모멘트 (M<sub>u</sub>)</td>
                                <td class="result-value">${formatNumber(results.Mu, 2)}</td>
                                <td>kN·m</td>
                            </tr>
                            <tr>
                                <td>설계 휨강도 (φ<sub>b</sub>M<sub>n</sub>)</td>
                                <td class="result-value" style="font-weight: 600;">${formatNumber(results.phiMn, 2)}</td>
                                <td>kN·m</td>
                            </tr>
                            <tr>
                                <td>사용률</td>
                                <td class="result-value ${results.flexural_ok ? 'status-ok' : 'status-ng'}">${formatNumber(results.flexural_UR, 3)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>판정</td>
                                <td class="result-value ${results.flexural_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.flexural_ok ? '✅ 만족 (M<sub>u</sub> ≤ φ<sub>b</sub>M<sub>n</sub>)' : '❌ 불만족 (M<sub>u</sub> > φ<sub>b</sub>M<sub>n</sub>)'}
                                </td>
                                <td>-</td>
                            </tr>
                        </table>
                    </div>
                </div>
                
                <!-- 4. 전단 항복 및 전단 좌굴 (Gross Shear Strength) -->
                <div class="result-section">
                    <div class="result-section-title" style="font-size: 18px; font-weight: 700; color: #1e3a5f; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #3b82f6;">4. 전단 항복 및 전단 좌굴 (Gross Shear Strength)</div>
                    
                    <div style="font-size: 11px; color: #64748b; margin-bottom: 15px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                        <strong>검토 내용:</strong> 개구부 없는 Web 부분의 전단 항복 및 전단 좌굴을 검토합니다. (AISC 360 Ch. G)<br>
                        <strong>주의사항:</strong> 특히 지점부 인접 개구부에 주의해야 합니다. (DG31 권장: 지점부에서 최소 0.5d 이상 이격)
                    </div>
                    
                    <!-- 4.1 지점부 인접 개구부 위치 확인 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">4.1 지점부 인접 개구부 위치 확인</h4>
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 10px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                            <strong>검토 내용:</strong> 지점부에서 가장 가까운 개구부까지의 거리를 확인합니다. (DG31 권장: 지점부에서 최소 0.5d 이상 이격)
                        </div>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>단위</th>
                            </tr>
                            <tr>
                                <td>첫 번째 개구부 위치</td>
                                <td class="result-value">${formatNumber(results.firstOpeningX, 2)}</td>
                                <td>m</td>
                            </tr>
                            <tr>
                                <td>마지막 개구부 위치</td>
                                <td class="result-value">${formatNumber(results.lastOpeningX, 2)}</td>
                                <td>m</td>
                            </tr>
                            <tr>
                                <td>지점부에서 가장 가까운 개구부까지의 거리</td>
                                <td class="result-value">${formatNumber(results.endPostDistance_mm, 1)}</td>
                                <td>mm</td>
                            </tr>
                            <tr>
                                <td>최소 권장 거리 (0.5d)</td>
                                <td class="result-value">${formatNumber(results.minEndPostDistance * 1000, 1)}</td>
                                <td>mm</td>
                            </tr>
                            <tr>
                                <td>판정</td>
                                <td class="result-value ${results.endPostDistance_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.endPostDistance_ok ? '✅ 만족 (거리 ≥ 0.5d)' : '⚠️ 주의 필요 (거리 < 0.5d)'}
                                </td>
                                <td>-</td>
                            </tr>
                        </table>
                    </div>
                    
                    <!-- 4.2 개구부 없는 Web 부분의 전단 강도 계산 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">4.2 개구부 없는 Web 부분의 전단 강도 계산 (AISC 360 Ch. G)</h4>
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 10px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                            <strong>검토 내용:</strong> Solid web 구간의 전단 항복 및 전단 좌굴을 검토합니다. (AISC 360 Ch. G)<br>
                            <strong>계산식:</strong> V<sub>n</sub> = 0.6F<sub>y</sub>A<sub>w</sub>C<sub>v</sub>, C<sub>v</sub>는 h/t<sub>w</sub> 비율에 따라 결정
                        </div>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>단위</th>
                            </tr>
                            <tr>
                                <td>전단 면적 (A<sub>w</sub>)</td>
                                <td class="result-value">${formatNumber(results.Aw_solid, 1)}</td>
                                <td>mm²</td>
                            </tr>
                            <tr>
                                <td>지점부 전단력 (V<sub>u</sub>)</td>
                                <td class="result-value">${formatNumber(results.Vu_end, 2)}</td>
                                <td>kN</td>
                            </tr>
                            <tr>
                                <td>h/t<sub>w</sub> 비율</td>
                                <td class="result-value">${formatNumber(results.h_tw_solid, 2)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>k<sub>v</sub> (웹 판재 좌굴 계수)</td>
                                <td class="result-value">${formatNumber(results.kv_solid, 1)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>전단 항복 한계 (1.10√(k<sub>v</sub>E/F<sub>y</sub>))</td>
                                <td class="result-value">${formatNumber(results.h_tw_limit_solid, 2)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>전단 좌굴 탄성 한계 (1.37√(k<sub>v</sub>E/F<sub>y</sub>))</td>
                                <td class="result-value">${formatNumber(results.h_tw_limit_elastic, 2)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>전단 좌굴 계수 (C<sub>v</sub>)</td>
                                <td class="result-value">${formatNumber(results.Cv_solid, 3)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>전단 거동 모드</td>
                                <td class="result-value ${results.shear_yielding ? 'status-ok' : (results.shear_buckling_elastic ? 'status-ng' : '')}" style="font-weight: 600;">
                                    ${results.shear_yielding ? '✅ 전단 항복 지배' : (results.shear_buckling_elastic ? '❌ 전단 좌굴 (탄성)' : '⚠️ 전단 좌굴 (비탄성)')}
                                </td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>공칭 전단 강도 (V<sub>n</sub>)</td>
                                <td class="result-value" style="font-weight: 600;">${formatNumber(results.Vn_solid, 2)}</td>
                                <td>kN</td>
                            </tr>
                            <tr>
                                <td>φ<sub>v</sub> (저감계수)</td>
                                <td class="result-value">${formatNumber(results.phi_v, 2)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>설계 전단 강도 (φ<sub>v</sub>V<sub>n</sub>)</td>
                                <td class="result-value" style="font-weight: 600; color: #3b82f6;">${formatNumber(results.phiVn_solid, 2)}</td>
                                <td>kN</td>
                            </tr>
                        </table>
                    </div>
                    
                    <!-- 4.3 전단좌굴 검토 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">4.3 전단좌굴 검토 (AISC 360 G2)</h4>
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 10px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                            <strong>검토 내용:</strong> 웹의 h/t<sub>w</sub> 비율에 따른 전단 좌굴 계수 C<sub>v</sub>를 계산하고 전단 거동 모드를 판정합니다. (AISC 360 G2)<br>
                            <strong>관련 식:</strong><br>
                            • 전단 항복 지배: h/t<sub>w</sub> ≤ 1.10√(k<sub>v</sub>E/F<sub>y</sub>) → C<sub>v</sub> = 1.0 (AISC 360 G2-1)<br>
                            • 전단 좌굴 (비탄성): 1.10√(k<sub>v</sub>E/F<sub>y</sub>) < h/t<sub>w</sub> ≤ 1.37√(k<sub>v</sub>E/F<sub>y</sub>) → C<sub>v</sub> = 1.10√(k<sub>v</sub>E/F<sub>y</sub>)/(h/t<sub>w</sub>) (AISC 360 G2-2)<br>
                            • 전단 좌굴 (탄성): h/t<sub>w</sub> > 1.37√(k<sub>v</sub>E/F<sub>y</sub>) → C<sub>v</sub> = 1.51k<sub>v</sub>E/(F<sub>y</sub>(h/t<sub>w</sub>)²) (AISC 360 G2-3)
                        </div>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>단위</th>
                            </tr>
                            <tr>
                                <td>h/t<sub>w</sub> 비율</td>
                                <td class="result-value">${formatNumber(results.h_tw_solid, 2)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>k<sub>v</sub> (웹 판재 좌굴 계수)</td>
                                <td class="result-value">${formatNumber(results.kv_solid, 1)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>전단 항복 한계<br>1.10√(k<sub>v</sub>E/F<sub>y</sub>)</td>
                                <td class="result-value">${formatNumber(results.h_tw_limit_solid, 2)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>전단 좌굴 탄성 한계<br>1.37√(k<sub>v</sub>E/F<sub>y</sub>)</td>
                                <td class="result-value">${formatNumber(results.h_tw_limit_elastic, 2)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>전단 좌굴 계수 (C<sub>v</sub>)</td>
                                <td class="result-value" style="font-weight: 600;">${formatNumber(results.Cv_solid, 3)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>전단 거동 모드</td>
                                <td class="result-value ${results.shear_yielding ? 'status-ok' : (results.shear_buckling_elastic ? 'status-ng' : '')}" style="font-weight: 600;">
                                    ${results.shear_yielding ? '✅ 전단 항복 지배<br><span style="font-size: 10px; color: #64748b;">(C<sub>v</sub> = 1.0, AISC 360 G2-1)</span>' : (results.shear_buckling_elastic ? '❌ 전단 좌굴 (탄성)<br><span style="font-size: 10px; color: #64748b;">(C<sub>v</sub> = 1.51k<sub>v</sub>E/(F<sub>y</sub>(h/t<sub>w</sub>)²), AISC 360 G2-3)</span>' : '⚠️ 전단 좌굴 (비탄성)<br><span style="font-size: 10px; color: #64748b;">(C<sub>v</sub> = 1.10√(k<sub>v</sub>E/F<sub>y</sub>)/(h/t<sub>w</sub>), AISC 360 G2-2)</span>')}
                                </td>
                                <td>-</td>
                            </tr>
                        </table>
                        <div style="margin-top: 15px; padding: 10px; background: #f1f5f9; border-radius: 4px; border-left: 3px solid #64748b;">
                            <div style="font-size: 11px; color: #475569; line-height: 1.6;">
                                <strong>계산 과정:</strong><br>
                                ${results.shear_yielding ? 
                                    `h/t<sub>w</sub> = ${formatNumber(results.h_tw_solid, 2)} ≤ ${formatNumber(results.h_tw_limit_solid, 2)} (전단 항복 한계)<br>
                                    → 전단 항복 지배, C<sub>v</sub> = 1.0` :
                                    (results.shear_buckling_elastic ?
                                        `h/t<sub>w</sub> = ${formatNumber(results.h_tw_solid, 2)} > ${formatNumber(results.h_tw_limit_elastic, 2)} (전단 좌굴 탄성 한계)<br>
                                        → 전단 좌굴 (탄성)<br>
                                        C<sub>v</sub> = 1.51 × ${formatNumber(results.kv_solid, 1)} × ${formatNumber(results.Es, 0)} / (${formatNumber(results.Fy, 0)} × ${formatNumber(results.h_tw_solid, 2)}²) = ${formatNumber(results.Cv_solid, 3)}` :
                                        `${formatNumber(results.h_tw_limit_solid, 2)} < h/t<sub>w</sub> = ${formatNumber(results.h_tw_solid, 2)} ≤ ${formatNumber(results.h_tw_limit_elastic, 2)}<br>
                                        → 전단 좌굴 (비탄성)<br>
                                        C<sub>v</sub> = 1.10 × √(${formatNumber(results.kv_solid, 1)} × ${formatNumber(results.Es, 0)} / ${formatNumber(results.Fy, 0)}) / ${formatNumber(results.h_tw_solid, 2)} = ${formatNumber(results.Cv_solid, 3)}`
                                    )
                                }
                            </div>
                        </div>
                    </div>
                    
                    <!-- 4.4 전단 강도 판정 -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">4.4 전단 강도 판정 (AISC 360 Ch. G)</h4>
                        <div style="font-size: 11px; color: #64748b; margin-bottom: 10px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                            <strong>검토 내용:</strong> 소요 전단력과 설계 전단 강도를 비교하여 전단 강도를 판정합니다. (AISC 360 Ch. G)<br>
                            <strong>판정 기준:</strong> V<sub>u</sub> ≤ φ<sub>v</sub>V<sub>n</sub>
                        </div>
                        <table class="result-table">
                            <tr>
                                <th>항목</th>
                                <th>값</th>
                                <th>단위</th>
                            </tr>
                            <tr>
                                <td>소요 전단력 (V<sub>u</sub>)</td>
                                <td class="result-value">${formatNumber(results.Vu_end, 2)}</td>
                                <td>kN</td>
                            </tr>
                            <tr>
                                <td>설계 전단 강도 (φ<sub>v</sub>V<sub>n</sub>)</td>
                                <td class="result-value" style="font-weight: 600;">${formatNumber(results.phiVn_solid, 2)}</td>
                                <td>kN</td>
                            </tr>
                            <tr>
                                <td>사용률</td>
                                <td class="result-value ${results.shear_solid_ok ? 'status-ok' : 'status-ng'}">${formatNumber(results.shear_solid_UR, 3)}</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>판정</td>
                                <td class="result-value ${results.shear_solid_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                    ${results.shear_solid_ok ? '✅ 만족 (V<sub>u</sub> ≤ φ<sub>v</sub>V<sub>n</sub>)' : '❌ 불만족 (V<sub>u</sub> > φ<sub>v</sub>V<sub>n</sub>)'}
                                </td>
                                <td>-</td>
                            </tr>
                        </table>
                    </div>
                </div>
                
                <!-- 5. 개구부 위치 제한 검토 (Geometric Limits) -->
                <div class="result-section">
                    <div class="result-section-title" style="font-size: 18px; font-weight: 700; color: #1e3a5f; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #3b82f6;">5. 개구부 위치 제한 검토 (Geometric Limits)</div>
                    
                    <div style="font-size: 11px; color: #64748b; margin-bottom: 15px; padding: 8px; background: #f8fafc; border-radius: 4px; border-left: 3px solid #3b82f6;">
                        <strong>검토 내용:</strong> AISC Design Guide 31 권장사항에 따른 개구부 위치 제한을 검토합니다.<br>
                        <strong>검토 항목:</strong> 개구부 높이, Web Post 폭, 지점부 개구부 이격거리
                    </div>
                    
                    <table class="result-table" style="margin-bottom: 20px;">
                        <tr>
                            <th style="width: 35%;">검토 항목</th>
                            <th style="width: 20%;">계산값</th>
                            <th style="width: 20%;">권장 기준</th>
                            <th style="width: 25%;">판정</th>
                        </tr>
                        <tr>
                            <td><strong>개구부 높이</strong><br>0.5h ≤ h<sub>o</sub> ≤ 0.75h</td>
                            <td class="result-value">${formatNumber(results.ho * 1000, 1)} mm<br>(${formatNumber(results.ho, 3)} m)</td>
                            <td class="result-value">${formatNumber(results.ho_min_limit * 1000, 1)} ~ ${formatNumber(results.ho_max_limit * 1000, 1)} mm<br>(${formatNumber(results.ho_min_limit, 3)} ~ ${formatNumber(results.ho_max_limit, 3)} m)</td>
                            <td class="result-value ${results.ho_geometric_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                ${results.ho_geometric_ok ? '✅ 적합' : '❌ 부적합'}
                            </td>
                        </tr>
                        <tr>
                            <td><strong>Web Post 폭</strong><br>e ≥ 0.25h<sub>o</sub></td>
                            <td class="result-value">${formatNumber(results.e, 1)} mm</td>
                            <td class="result-value">≥ ${formatNumber(results.e_min_limit, 1)} mm</td>
                            <td class="result-value ${results.e_geometric_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                ${results.e_geometric_ok ? '✅ 적합' : '❌ 부적합'}
                            </td>
                        </tr>
                        <tr>
                            <td><strong>지점부 개구부 이격거리</strong><br>≥ 1.5h</td>
                            <td class="result-value">${formatNumber(results.endPostDistance_mm, 1)} mm<br>(${formatNumber(results.endPostDistance, 3)} m)</td>
                            <td class="result-value">≥ ${formatNumber(results.endPostDistance_min_limit * 1000, 1)} mm<br>(≥ ${formatNumber(results.endPostDistance_min_limit, 3)} m)</td>
                            <td class="result-value ${results.endPostDistance_geometric_ok ? 'status-ok' : 'status-ng'}" style="font-weight: 600;">
                                ${results.endPostDistance_geometric_ok ? '✅ 적합' : '❌ 부적합'}
                            </td>
                        </tr>
                    </table>
                    
                    <div style="margin-top: 15px; padding: 10px; background: ${results.geometric_limits_ok ? '#d1fae5' : '#fee2e2'}; border-radius: 6px; border: 1px solid ${results.geometric_limits_ok ? '#10b981' : '#ef4444'};">
                        <div style="font-size: 12px; font-weight: 600; color: ${results.geometric_limits_ok ? '#065f46' : '#991b1b'}; text-align: center;">
                            종합 판정: <strong>${results.geometric_limits_ok ? '✅ 모든 항목 적합' : '❌ 일부 항목 부적합'}</strong>
                        </div>
                    </div>
                </div>
                
                <!-- 6. 입력 조건 -->
                <div class="result-section">
                    <div class="result-section-title">6. 입력 조건</div>
                    <table class="result-table">
                        <tr>
                            <th>항목</th>
                            <th>값</th>
                            <th>단위</th>
                        </tr>
                        <tr>
                            <td>계산 타입</td>
                            <td class="result-value">${results.type === 'with-slab' ? 'with top-slab' : 'without top-slab'}</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td>보 스팬 (L)</td>
                            <td class="result-value">${formatNumber(results.L, 2)}</td>
                            <td>m</td>
                        </tr>
                        <tr>
                            <td>하중 폭 (B)</td>
                            <td class="result-value">${formatNumber(results.B, 2)}</td>
                            <td>m</td>
                        </tr>
                        <tr>
                            <td>고정하중 (DL)</td>
                            <td class="result-value">${formatNumber(results.DL, 2)}</td>
                            <td>kN/m</td>
                        </tr>
                        <tr>
                            <td>활하중 (LL)</td>
                            <td class="result-value">${formatNumber(results.LL, 2)}</td>
                            <td>kN/m</td>
                        </tr>
                        <tr>
                            <td>보 자중 (self_w)</td>
                            <td class="result-value">${formatNumber(results.self_w, 3)}</td>
                            <td>kN/m²</td>
                        </tr>
                        <tr>
                            <td>보 자중 (self_w × B)</td>
                            <td class="result-value">${formatNumber(results.self_w_kNm, 2)}</td>
                            <td>kN/m</td>
                        </tr>
                        <tr>
                            <td>계수하중 (wu)<br><span style="font-size: 11px; color: #64748b; font-weight: normal;">LRFD: 1.2D + 1.6L</span></td>
                            <td class="result-value">${formatNumber(results.wu, 2)}</td>
                            <td>kN/m</td>
                        </tr>
                        <tr>
                            <td>강종</td>
                            <td class="result-value">${results.steelGrade} (Fy = ${results.Fy} MPa)</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td>원단면</td>
                            <td class="result-value">H${(results.dc*1000).toFixed(0)}×${results.bf}×${results.tw}×${results.tf}</td>
                            <td>-</td>
                        </tr>
                        ${results.type === 'with-slab' ? `
                        <tr>
                            <td>슬래브 두께 (ts)</td>
                            <td class="result-value">${formatNumber(results.ts, 0)}</td>
                            <td>mm</td>
                        </tr>
                        ` : ''}
                        <tr>
                            <td>개구부 높이 (ho)</td>
                            <td class="result-value">${formatNumber(results.ho, 2)}</td>
                            <td>m</td>
                        </tr>
                    </table>
                </div>

                <!-- 원단면 Section Properties -->
                <div class="result-section">
                    <div class="result-section-title">7. 원단면 (H형강) Section Properties</div>
                    <table class="result-table">
                        <tr>
                            <th>항목</th>
                            <th>값</th>
                            <th>단위</th>
                        </tr>
                        <tr>
                            <td>높이 (d)</td>
                            <td class="result-value">${formatNumber(results.d_original, 1)}</td>
                            <td>mm</td>
                        </tr>
                        <tr>
                            <td>단면적 (A)</td>
                            <td class="result-value">${formatNumber(results.A_total, 1)}</td>
                            <td>mm²</td>
                        </tr>
                        <tr>
                            <td>단면2차모멘트 (Ix)</td>
                            <td class="result-value">${formatNumber(results.Ix_original / 1e6, 2)}</td>
                            <td>×10⁶ mm⁴</td>
                        </tr>
                        <tr>
                            <td>단면2차모멘트 (Iy)</td>
                            <td class="result-value">${formatNumber(results.Iy_original / 1e6, 2)}</td>
                            <td>×10⁶ mm⁴</td>
                        </tr>
                        <tr>
                            <td>단면계수 (Sx)</td>
                            <td class="result-value">${formatNumber(results.Sx_original / 1e3, 1)}</td>
                            <td>×10³ mm³</td>
                        </tr>
                        <tr>
                            <td>회전반경 (rx)</td>
                            <td class="result-value">${formatNumber(results.rx_original, 1)}</td>
                            <td>mm</td>
                        </tr>
                        <tr>
                            <td>회전반경 (ry)</td>
                            <td class="result-value">${formatNumber(results.ry_original, 1)}</td>
                            <td>mm</td>
                        </tr>
                    </table>
                </div>

                <!-- Castellated Beam Section Properties -->
                <div class="result-section">
                    <div class="result-section-title">8. Castellated Beam Section Properties</div>
                    <table class="result-table">
                        <tr>
                            <th>항목</th>
                            <th>값</th>
                            <th>단위</th>
                        </tr>
                        <tr>
                            <td>높이 (dc)</td>
                            <td class="result-value">${formatNumber(results.d_castellated, 1)}</td>
                            <td>mm</td>
                        </tr>
                        <tr>
                            <td>단면적 (A)</td>
                            <td class="result-value">${formatNumber(results.A_total, 1)}</td>
                            <td>mm²</td>
                        </tr>
                        <tr>
                            <td>단면2차모멘트 (Ix)</td>
                            <td class="result-value">${formatNumber(results.Ix_steel / 1e6, 2)}</td>
                            <td>×10⁶ mm⁴</td>
                        </tr>
                        <tr>
                            <td>단면2차모멘트 (Iy)</td>
                            <td class="result-value">${formatNumber(results.Iy_castellated / 1e6, 2)}</td>
                            <td>×10⁶ mm⁴</td>
                        </tr>
                        <tr>
                            <td>단면계수 (Sx)</td>
                            <td class="result-value">${formatNumber(results.Sx_castellated / 1e3, 1)}</td>
                            <td>×10³ mm³</td>
                        </tr>
                        <tr>
                            <td>회전반경 (rx)</td>
                            <td class="result-value">${formatNumber(results.rx_castellated, 1)}</td>
                            <td>mm</td>
                        </tr>
                        <tr>
                            <td>회전반경 (ry)</td>
                            <td class="result-value">${formatNumber(results.ry_castellated, 1)}</td>
                            <td>mm</td>
                        </tr>
                    </table>
                </div>

                <!-- 2. 개구부별 계산 결과 -->
                <div class="result-section">
                    <div class="result-section-title">9. 개구부별 계산 결과</div>
                    <div style="overflow-x: auto;">
                        <table class="result-table">
                            <thead>
                                <tr>
                                    <th>i</th>
                                    <th>x (m)</th>
                                    <th>V(x) (kN)</th>
                                    <th>M(x) (kN·m)</th>
                                    <th>P_i (kN)</th>
                                    <th>M_tee,i (kN·m)</th>
                                    <th>UR_i</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${openingTableRows}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 3. 지배 개구부 -->
                <div class="result-section">
                    <div class="result-section-title">10. 지배 개구부 (Governing Opening)</div>
                    <table class="result-table">
                        <tr>
                            <th>항목</th>
                            <th>값</th>
                            <th>단위</th>
                        </tr>
                        <tr>
                            <td>개구부 번호 (i)</td>
                            <td class="result-value">${results.govOpening.i}</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td>위치 (x)</td>
                            <td class="result-value">${formatNumber(results.govOpening.x, 2)}</td>
                            <td>m</td>
                        </tr>
                        <tr>
                            <td>전단력 V(x)</td>
                            <td class="result-value">${formatNumber(results.govOpening.V, 2)}</td>
                            <td>kN</td>
                        </tr>
                        <tr>
                            <td>모멘트 M(x)</td>
                            <td class="result-value">${formatNumber(results.govOpening.M, 2)}</td>
                            <td>kN·m</td>
                        </tr>
                        <tr>
                            <td>축력 P_i</td>
                            <td class="result-value">${formatNumber(results.govOpening.P, 2)}</td>
                            <td>kN</td>
                        </tr>
                        <tr>
                            <td>Tee 모멘트 M_tee,i</td>
                            <td class="result-value">${formatNumber(results.govOpening.Mtee, 2)}</td>
                            <td>kN·m</td>
                        </tr>
                        <tr>
                            <td>이용률 UR_i</td>
                            <td class="result-value ${results.govOpening.UR <= 1.0 ? 'status-ok' : 'status-ng'}">${formatNumber(results.govOpening.UR, 3)}</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td>검토 결과</td>
                            <td class="result-value ${results.govOpening.UR <= 1.0 ? 'status-ok' : 'status-ng'}">
                                ${results.govOpening.UR <= 1.0 ? '✅ 만족' : '❌ 불만족'}
                            </td>
                            <td>-</td>
                        </tr>
                    </table>
                </div>

                <!-- 4. 지배 Web-Post -->
                <div class="result-section">
                    <div class="result-section-title">11. 지배 Web-Post (Governing Web-Post)</div>
                    <table class="result-table">
                        <tr>
                            <th>항목</th>
                            <th>값</th>
                            <th>단위</th>
                        </tr>
                        <tr>
                            <td>Web-Post 쌍</td>
                            <td class="result-value">${results.webPostPair[0]} - ${results.webPostPair[1]}</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td>전단력 V_rh</td>
                            <td class="result-value">${formatNumber(results.Vrh, 2)}</td>
                            <td>kN</td>
                        </tr>
                        <tr>
                            <td>모멘트 M_rh</td>
                            <td class="result-value">${formatNumber(results.Mrh, 2)}</td>
                            <td>kN·m</td>
                        </tr>
                    </table>
                </div>

                <!-- 5. Web-Post Buckling 검토 (DG31) -->
                <div class="result-section">
                    <div class="result-section-title">12. Web-Post Buckling 검토 (AISC DG31)</div>
                    <table class="result-table">
                        <tr>
                            <th>항목</th>
                            <th>값</th>
                            <th>단위</th>
                        </tr>
                        <tr>
                            <td>소성 모멘트 (Mp)</td>
                            <td class="result-value">${formatNumber(results.Mp, 2)}</td>
                            <td>kN·m</td>
                        </tr>
                        <tr>
                            <td>e/tw</td>
                            <td class="result-value">${formatNumber(results.etw, 2)}</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td>비율 (ratio)</td>
                            <td class="result-value">${formatNumber(results.ratio, 3)}</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td>좌굴 모멘트 (Mocr)</td>
                            <td class="result-value">${formatNumber(results.Mocr, 2)}</td>
                            <td>kN·m</td>
                        </tr>
                        <tr>
                            <td>설계 좌굴 모멘트 (φMocr)</td>
                            <td class="result-value">${formatNumber(results.phiMocr, 2)}</td>
                            <td>kN·m</td>
                        </tr>
                        <tr>
                            <td>소요 모멘트 (M_rh)</td>
                            <td class="result-value">${formatNumber(results.Mrh, 2)}</td>
                            <td>kN·m</td>
                        </tr>
                        <tr>
                            <td>검토 결과</td>
                            <td class="result-value ${results.buckling_ok ? 'status-ok' : 'status-ng'}">
                                ${results.buckling_ok ? '✅ 만족' : '❌ 불만족'}
                            </td>
                            <td>-</td>
                        </tr>
                    </table>
                </div>

                <!-- 7. 가설하중 검토 -->
                <div class="result-section">
                    <div class="result-section-title" style="font-size: 18px; font-weight: 700; color: #1e3a5f; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #cbd5e1;">13. 작용하중단계별 소요강도 및 소요단면 2차 모멘트</div>
                    <div class="result-section-title">13.1 시공단계의 소요강도 및 소요단면 2차 모멘트</div>
                    <div style="font-size: 12px; color: #64748b; margin-bottom: 15px; padding: 8px; background: #f1f5f9; border-radius: 4px;">
                        간격 ${formatNumber(results.B, 1)}m의 보에 대한 선형등분포하중을 산정하여 작용하중단계별 소요휨강도, 소요전단강도, 소요단면 2차 모멘트를 구한다.
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">1) 선형등분포하중</h4>
                        <div style="font-size: 12px; color: #475569; line-height: 1.8; font-family: 'Courier New', monospace; background: #f8fafc; padding: 12px; border-radius: 6px; border: 1px solid #e2e8f0;">
                            <div>시공중 고정하중: w_DL = (${formatNumber(results.slabWeight || 0, 2)} + ${formatNumber(results.self_w, 2)})(${formatNumber(results.B, 2)}) = ${formatNumber(results.w_DL_construction, 2)} kN/m</div>
                            <div>시공중 활하중: w_CLL = (${formatNumber(results.qConst || 0, 2)})(${formatNumber(results.B, 2)}) = ${formatNumber(results.w_CLL_construction, 3)} kN/m</div>
                            <div style="margin-top: 12px; font-weight: 600;">시공중 계수하중:</div>
                            <div style="margin-left: 20px;">w_u1 = 1.4DL = 1.4(${formatNumber(results.w_DL_construction, 3)}) = ${formatNumber(results.w_u1_construction, 3)} kN/m</div>
                            <div style="margin-left: 20px;">w_u2 = 1.2DL + 1.6LL = 1.2(${formatNumber(results.w_DL_construction, 3)}) + 1.6(${formatNumber(results.w_CLL_construction, 3)}) = ${formatNumber(results.w_u2_construction, 3)} kN/m</div>
                            <div style="margin-left: 20px; font-weight: 600;">∴ w_u = max.[w_u1, w_u2] = ${formatNumber(results.w_u_construction, 3)} kN/m</div>
                        </div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">2) 시공 중 강재보의 소요휨강도</h4>
                        <div style="font-size: 12px; color: #475569; line-height: 1.8; font-family: 'Courier New', monospace; background: #f8fafc; padding: 12px; border-radius: 6px; border: 1px solid #e2e8f0;">
                            <div>시공 중 소요휨강도: M_u = (w_u × l²) / 8 = (${formatNumber(results.w_u_construction, 3)})(${formatNumber(results.L, 2)})² / 8 = ${formatNumber(results.M_u_construction, 2)} kN·m</div>
                        </div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 10px;">3) 시공 중 강재보의 소요단면2차모멘트</h4>
                        <div style="font-size: 12px; color: #475569; line-height: 1.8; font-family: 'Courier New', monospace; background: #f8fafc; padding: 12px; border-radius: 6px; border: 1px solid #e2e8f0;">
                            <div>시공 중 강재보의 처짐은 콘크리트 타설의 시공성을 고려하여 ${formatNumber(results.delta_allow_construction, 0)}mm로 제한한다.</div>
                            <div style="margin-top: 8px;">시공 중 소요단면2차모멘트: I_req = (5 × w_DL × l⁴) / (384 × E × Δ)</div>
                            <div style="margin-left: 20px;">I_req = (5 × ${formatNumber(results.w_DL_construction, 3)} × ${formatNumber(results.L * 1000, 0)}⁴) / (384 × ${formatNumber(200000 / 1000, 0)} × ${formatNumber(results.delta_allow_construction, 0)})</div>
                            <div style="margin-left: 20px;">I_req = ${formatNumber(results.I_req_construction / 1e6, 2)} × 10⁶ mm⁴</div>
                            <div style="margin-top: 8px; font-size: 11px; color: #64748b; font-style: italic;">※ 시공단계에서 이미 Castellated beam으로 제작되었으므로, Castellated beam의 단면2차모멘트를 사용합니다.</div>
                        </div>
                    </div>

                    <table class="result-table">
                        <tr>
                            <th>항목</th>
                            <th>값</th>
                            <th>단위</th>
                        </tr>
                        <tr>
                            <td>시공중 고정하중 (w_DL)</td>
                            <td class="result-value">${formatNumber(results.w_DL_construction, 3)}</td>
                            <td>kN/m</td>
                        </tr>
                        <tr>
                            <td>시공중 활하중 (w_CLL)</td>
                            <td class="result-value">${formatNumber(results.w_CLL_construction, 3)}</td>
                            <td>kN/m</td>
                        </tr>
                        <tr>
                            <td>시공중 계수하중 (w_u)</td>
                            <td class="result-value">${formatNumber(results.w_u_construction, 3)}</td>
                            <td>kN/m</td>
                        </tr>
                        <tr>
                            <td>시공 중 소요휨강도 (M_u)</td>
                            <td class="result-value">${formatNumber(results.M_u_construction, 2)}</td>
                            <td>kN·m</td>
                        </tr>
                        <tr>
                            <td>시공 중 소요단면2차모멘트 (I_req)</td>
                            <td class="result-value">${formatNumber(results.I_req_construction / 1e6, 2)}</td>
                            <td>×10⁶ mm⁴</td>
                        </tr>
                        <tr>
                            <td>강재보 단면2차모멘트 (Ix_steel)<br><span style="font-size: 11px; color: #64748b; font-weight: normal;">Castellated beam</span></td>
                            <td class="result-value">${formatNumber(results.Ix_steel / 1e6, 2)}</td>
                            <td>×10⁶ mm⁴</td>
                        </tr>
                        <tr>
                            <td>처짐 제한 (시공성 고려)</td>
                            <td class="result-value">${formatNumber(results.delta_allow_construction, 0)}</td>
                            <td>mm</td>
                        </tr>
                    </table>
                    ${results.Ix_steel < results.I_req_construction ? 
                        '<div class="warning-box"><strong>⚠️ 주의:</strong> 시공단계 소요단면2차모멘트를 만족하지 않습니다. 단면을 크게 하거나 보 스팬을 줄여주세요.</div>' : 
                        '<div style="background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; padding: 12px; margin-top: 15px; font-size: 12px; color: #065f46;"><strong>✅ 확인:</strong> 시공단계 소요단면2차모멘트를 만족합니다.</div>'}
                </div>

                <!-- 6. 용접 설계 -->
                <div class="result-section">
                    <div class="result-section-title">14. 용접 설계</div>
                    <table class="result-table">
                        <tr>
                            <th>항목</th>
                            <th>값</th>
                            <th>단위</th>
                        </tr>
                        <tr>
                            <td>필요 용접 면적 (Aw_req)</td>
                            <td class="result-value">${formatNumber((results.Vrh * 1000.0) / (0.75 * 0.6 * 490.0), 2)}</td>
                            <td>mm²</td>
                        </tr>
                        <tr>
                            <td>필요 용접 크기 (w_req)</td>
                            <td class="result-value">${formatNumber(results.w_req, 2)}</td>
                            <td>mm</td>
                        </tr>
                        <tr>
                            <td>최종 용접 크기 (w_final)</td>
                            <td class="result-value">${results.w_final}</td>
                            <td>mm</td>
                        </tr>
                    </table>
                </div>
            `;
        }

        // 개구부 높이 자동 계산 함수 (ho ≤ 0.6dc)
        function updateOpeningHeight() {
            const beamDepthEl = document.getElementById('beamDepth');
            const openingHeightEl = document.getElementById('openingHeight');
            
            if (!beamDepthEl || !openingHeightEl) {
                return;
            }
            
            const dc = parseFloat(beamDepthEl.value) || 0;  // mm 단위
            if (dc > 0) {
                const ho = (0.6 * dc) / 1000;  // mm → m 변환
                openingHeightEl.value = ho.toFixed(3);
            }
        }

        // 개구부 간격 자동 계산 함수 (p = W_open + e)
        // e는 openingWidth (웹 포스트 폭, mm)
        // W_open = 개구부 전체 폭 = W_rect + 2*delta_x
        // W_rect는 개구부 폭 (직사각형 부분)으로, 일반적으로 원단면 높이(H)와 관련됨
        // 원치수 = beamDepth / 1.5
        // W_rect의 최소값은 H/2, 최대값은 1.5*ho
        // p = W_open + e = (W_rect + 2*delta_x) + e
        // 하지만 간단하게: p = (원치수 + 2*delta_x) + e (W_rect를 원치수로 근사)
        function updateOpeningSpacing() {
            const beamDepthEl = document.getElementById('beamDepth');
            const openingHeightEl = document.getElementById('openingHeight');
            const openingWidthEl = document.getElementById('openingWidth');
            const openingSpacingEl = document.getElementById('openingSpacing');
            
            if (!beamDepthEl || !openingHeightEl || !openingWidthEl || !openingSpacingEl) {
                return;
            }
            
            const dc = parseFloat(beamDepthEl.value) || 0;  // mm 단위
            const ho = parseFloat(openingHeightEl.value) || 0;  // m 단위
            const e = parseFloat(openingWidthEl.value) || 0;  // mm 단위 (웹 포스트 폭)
            
            if (dc > 0 && ho > 0 && e > 0) {
                // 원치수 = dc / 1.5
                const originalHeight = dc / 1.5;  // mm
                
                // delta_x 계산
                const hoMm = ho * 1000;  // m → mm
                const delta_x = hoMm / (2.0 * Math.sqrt(3.0));  // mm
                
                // W_rect는 일반적으로 원치수와 관련이 있지만, 정확한 값은 사용자 입력에 따라 달라짐
                // 여기서는 W_rect를 원치수로 근사 (실제로는 개구부 폭 입력이 필요하지만, 현재는 범위만 제공)
                // W_open = W_rect + 2*delta_x ≈ 원치수 + 2*delta_x
                const W_open = originalHeight + 2.0 * delta_x;  // mm (개구부 전체 폭)
                
                // p = W_open + e
                const p = (W_open + e) / 1000;  // mm → m 변환
                openingSpacingEl.value = p.toFixed(3);
                
                // 개구부 개수는 calculateBeam()에서 자동으로 재계산됨
                // p가 커지면 N = (L - 2*end_post) / p가 작아짐
            }
        }
        
        // 개구부 개수 계산 함수 (참고용)
        // N = (L - 2 * end_post) / p
        // openingWidth(e)가 커지면 p가 커지고, 따라서 N이 줄어듦
        function calculateOpeningCount() {
            const L = parseFloat(document.getElementById('beamSpan')?.value) || 0;  // m
            const end_post = parseFloat(document.getElementById('endPost')?.value) || 0;  // m
            const p = parseFloat(document.getElementById('openingSpacing')?.value) || 0;  // m
            
            if (L > 0 && end_post >= 0 && p > 0) {
                const L_open = L - 2.0 * end_post;
                const N = Math.round(L_open / p);
                return N;
            }
            return 0;
        }

        // End Post 길이 자동 계산 함수 (endPost = dc × 1.5)
        function updateEndPost() {
            const beamDepthEl = document.getElementById('beamDepth');
            const endPostEl = document.getElementById('endPost');
            
            if (!beamDepthEl || !endPostEl) {
                return;
            }
            
            const dc = parseFloat(beamDepthEl.value) || 0;  // mm 단위
            if (dc > 0) {
                const endPost = (dc * 1.5) / 1000;  // mm → m 변환 (1.5배 적용)
                endPostEl.value = endPost.toFixed(3);
            }
        }

        // 웹 포스트 폭(e) 범위 및 기본값 업데이트 함수
        // e = 웹 포스트 폭 (개구부 사이 남는 웹 두께 방향 폭)
        // 최소값: H/2 (원치수/2)
        // 최대값: 1.5 × ho
        // 기본값: 최소값
        function updateOpeningWidth() {
            const beamDepthEl = document.getElementById('beamDepth');
            const openingHeightEl = document.getElementById('openingHeight');
            const openingWidthEl = document.getElementById('openingWidth');
            const openingWidthMinEl = document.getElementById('openingWidthMin');
            const openingWidthMaxEl = document.getElementById('openingWidthMax');
            
            if (!beamDepthEl || !openingHeightEl || !openingWidthEl) {
                return;
            }
            
            const dc = parseFloat(beamDepthEl.value) || 0;  // mm 단위
            const ho = parseFloat(openingHeightEl.value) || 0;  // m 단위
            
            if (dc > 0 && ho > 0) {
                // 원치수 = dc / 1.5
                const originalHeight = dc / 1.5;  // mm
                
                // 최소값: H/2 (원치수/2)
                const eMin = Math.round(originalHeight / 2);  // mm
                
                // 최대값: 1.5 × ho (ho는 m 단위이므로 mm로 변환)
                const hoMm = ho * 1000;  // m → mm
                const eMax = Math.round(1.5 * hoMm);  // mm
                
                // 범위 표시
                if (openingWidthMinEl) {
                    openingWidthMinEl.textContent = eMin;
                }
                if (openingWidthMaxEl) {
                    openingWidthMaxEl.textContent = eMax;
                }
                
                // 입력 필드의 min, max 속성 설정
                openingWidthEl.min = eMin;
                openingWidthEl.max = eMax;
                
                // 현재 값이 범위를 벗어나면 최소값으로 설정
                const currentValue = parseFloat(openingWidthEl.value) || 0;
                if (currentValue < eMin || currentValue > eMax || currentValue === 0) {
                    openingWidthEl.value = eMin;
                }
            }
        }

        // Initialize on page load
        initializeType();
        
        // 초기 개구부 높이, 간격, End Post 및 개구부 폭, 보 자중, 슬래브 자중 계산
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                updateOpeningHeight();
                updateEndPost();
                updateSelfWeight();
                updateSlabWeight();
                // openingWidth가 업데이트된 후 openingSpacing 업데이트
                setTimeout(function() {
                    updateOpeningWidth();
                    setTimeout(updateOpeningSpacing, 10);
                }, 10);
            });
        } else {
            updateOpeningHeight();
            updateEndPost();
            updateSelfWeight();
            updateSlabWeight();
            // openingWidth가 업데이트된 후 openingSpacing 업데이트
            setTimeout(function() {
                updateOpeningWidth();
                setTimeout(updateOpeningSpacing, 10);
            }, 10);
        }
        
        // beamDepth 변경 시 개구부 높이, 간격, End Post 및 개구부 폭 자동 업데이트
        const beamDepthEl = document.getElementById('beamDepth');
        if (beamDepthEl) {
            beamDepthEl.addEventListener('input', function() {
                updateOpeningHeight();
                updateEndPost();
                // openingHeight가 업데이트된 후 openingWidth 업데이트
                setTimeout(function() {
                    updateOpeningWidth();
                    // openingWidth가 업데이트된 후 openingSpacing 업데이트
                    setTimeout(updateOpeningSpacing, 10);
                }, 10);
            });
            beamDepthEl.addEventListener('change', function() {
                updateOpeningHeight();
                updateEndPost();
                // openingHeight가 업데이트된 후 openingWidth 업데이트
                setTimeout(function() {
                    updateOpeningWidth();
                    // openingWidth가 업데이트된 후 openingSpacing 업데이트
                    setTimeout(updateOpeningSpacing, 10);
                }, 10);
            });
        }
        
        // openingHeight 변경 시 웹 포스트 폭(e) 범위 업데이트
        const openingHeightEl = document.getElementById('openingHeight');
        if (openingHeightEl) {
            openingHeightEl.addEventListener('input', updateOpeningWidth);
            openingHeightEl.addEventListener('change', updateOpeningWidth);
        }
        
        // openingWidth 변경 시 개구부 간격 자동 업데이트
        const openingWidthEl = document.getElementById('openingWidth');
        if (openingWidthEl) {
            openingWidthEl.addEventListener('input', updateOpeningSpacing);
            openingWidthEl.addEventListener('change', updateOpeningSpacing);
        }

        // 보 자중 자동 계산 함수
        // KS 섹션 선택 시: 해당 섹션의 단중(kg/m)을 하중폭으로 나눈 값 사용
        // 직접 입력 시: 단면 치수로부터 계산
        function updateSelfWeight() {
            try {
                const ksSectionSelect = document.getElementById('ksSection');
                const selectedKsSection = ksSectionSelect?.value || '';
                const B = parseFloat(document.getElementById('loadWidth')?.value) || 0;  // m
                const selfWeightElement = document.getElementById('selfWeight');

                if (!selfWeightElement || B <= 0) {
                    if (selfWeightElement && B <= 0) {
                        selfWeightElement.value = '';
                    }
                    return;
                }

                let selfWeight_kNm2 = 0;

                // KS 섹션이 선택된 경우: 해당 섹션의 단중 사용
                if (selectedKsSection && selectedKsSection !== '' && ksSections[selectedKsSection]) {
                    const section = ksSections[selectedKsSection];
                    if (section.unitWeight) {
                        // 단중(kg/m)을 kN/m로 변환: kg/m × 9.81 / 1000 = kg/m × 0.00981
                        const selfWeight_kNm = section.unitWeight * 0.00981; // kN/m
                        // 하중폭(B)으로 나눈 값 (kN/m²)
                        selfWeight_kNm2 = selfWeight_kNm / B; // kN/m²
                    }
                } else {
                    // 직접 입력 모드: 단면 치수로부터 계산
                    const d = parseFloat(document.getElementById('beamDepth')?.value) || 0;  // mm
                    const bf = parseFloat(document.getElementById('flangeWidth')?.value) || 0;  // mm
                    const tf = parseFloat(document.getElementById('flangeThickness')?.value) || 0;  // mm
                    const tw = parseFloat(document.getElementById('webThickness')?.value) || 0;  // mm

                    if (d <= 0 || bf <= 0 || tf <= 0 || tw <= 0) {
                        selfWeightElement.value = '';
                        return;
                    }

                    const hw = d - 2 * tf;
                    const area = bf * tf * 2 + hw * tw; // mm²
                    const gamma = 78.5; // kN/m³ (강재 단위중량)
                    const selfWeight_kNm = (area / 1000000) * gamma; // kN/m (철골보 자중)
                    
                    // 하중폭(B)으로 나눈 값 (kN/m²)
                    selfWeight_kNm2 = selfWeight_kNm / B; // kN/m²
                }

                // 보 자중을 하중폭으로 나눈 값 표시
                if (selfWeight_kNm2 > 0) {
                    selfWeightElement.value = selfWeight_kNm2.toFixed(3);
                } else {
                    selfWeightElement.value = '';
                }
            } catch (e) {
                console.error('[ERROR] updateSelfWeight exception:', e);
            }
        }

        // 슬래브 자중 자동계산 함수
        function updateSlabWeight() {
            try {
                const slabThicknessElement = document.getElementById('slabThickness');
                const slabWeightElement = document.getElementById('slabWeight');
                
                if (!slabThicknessElement || !slabWeightElement) {
                    return;
                }

                const ts = parseFloat(slabThicknessElement.value) || 0;
                
                // 콘크리트 단위중량: 24 kN/m³
                const gamma_concrete = 24; // kN/m³
                
                // 슬래브 자중 = (ts / 1000) * gamma_concrete (kN/m²)
                // ts는 mm 단위이므로 m로 변환 (ts / 1000)
                const slabWeight_kNm2 = (ts / 1000) * gamma_concrete;
                
                if (slabWeight_kNm2 > 0) {
                    slabWeightElement.value = slabWeight_kNm2.toFixed(3);
                } else {
                    slabWeightElement.value = '';
                }
            } catch (e) {
                console.error('[ERROR] updateSlabWeight exception:', e);
            }
        }

        // 보 자중 자동 계산을 위한 이벤트 리스너
        ['beamDepth', 'flangeWidth', 'flangeThickness', 'webThickness', 'loadWidth', 'ksSection'].forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.addEventListener('input', updateSelfWeight);
                element.addEventListener('change', updateSelfWeight);
            }
        });

        // 슬래브 자중 자동 계산을 위한 이벤트 리스너
        const slabThicknessElement = document.getElementById('slabThickness');
        if (slabThicknessElement) {
            slabThicknessElement.addEventListener('input', updateSlabWeight);
            slabThicknessElement.addEventListener('change', updateSlabWeight);
        }
        
        // Initialize KS section options
        // #region agent log
        function checkKsSectionVisibility() {
            const ksSectionSelect = document.getElementById('ksSection');
            if (!ksSectionSelect) {
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:checkKsSectionVisibility',message:'ksSection element not found in DOM',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'A'})}).catch(()=>{});
                console.error('[DEBUG] ksSection element not found in DOM');
                return;
            }
            
            const computedStyle = window.getComputedStyle(ksSectionSelect);
            const parent = ksSectionSelect.parentElement;
            const parentStyle = parent ? window.getComputedStyle(parent) : null;
            const grandParent = parent ? parent.parentElement : null;
            const grandParentStyle = grandParent ? window.getComputedStyle(grandParent) : null;
            
            const data = {
                elementExists: true,
                display: computedStyle.display,
                visibility: computedStyle.visibility,
                opacity: computedStyle.opacity,
                width: computedStyle.width,
                height: computedStyle.height,
                offsetWidth: ksSectionSelect.offsetWidth,
                offsetHeight: ksSectionSelect.offsetHeight,
                offsetTop: ksSectionSelect.offsetTop,
                offsetLeft: ksSectionSelect.offsetLeft,
                parentDisplay: parentStyle ? parentStyle.display : 'N/A',
                parentVisibility: parentStyle ? parentStyle.visibility : 'N/A',
                grandParentDisplay: grandParentStyle ? grandParentStyle.display : 'N/A',
                grandParentVisibility: grandParentStyle ? grandParentStyle.visibility : 'N/A',
                classList: Array.from(ksSectionSelect.classList),
                id: ksSectionSelect.id,
                tagName: ksSectionSelect.tagName
            };
            
            fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:checkKsSectionVisibility',message:'ksSection visibility check',data:data,timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'A'})}).catch(()=>{});
            console.log('[DEBUG] ksSection visibility check:', data);
        }
        // #endregion
        
        // #region agent log
        fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:init',message:'Initializing KS section options',data:{readyState:document.readyState},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'G'})}).catch(()=>{});
        // #endregion
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:DOMContentLoaded',message:'DOMContentLoaded fired',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'H'})}).catch(()=>{});
                console.log('[DEBUG] DOMContentLoaded fired, calling populateKsSectionOptions');
                // #endregion
                const populateResult = populateKsSectionOptions();
                console.log('[DEBUG] populateKsSectionOptions returned:', populateResult);
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:DOMContentLoaded',message:'populateKsSectionOptions result',data:{populateResult:populateResult},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'I'})}).catch(()=>{});
                // #endregion
                const ksSectionSelect = document.getElementById('ksSection');
                if (ksSectionSelect) {
                    // #region agent log
                    console.log('[DEBUG] Attaching event listener to ksSection. Options count:', ksSectionSelect.options.length);
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:DOMContentLoaded',message:'Before attaching event listener',data:{optionsCount:ksSectionSelect.options.length,selectId:ksSectionSelect.id,selectValue:ksSectionSelect.value},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'J'})}).catch(()=>{});
                    // #endregion
                    
                    // 이벤트 리스너 추가
                    ksSectionSelect.addEventListener('change', function(e) {
                        console.log('[DEBUG] ksSection change event fired. Selected value:', e.target.value);
                        onKsSectionChange();
                    });
                    
                    // 클릭 이벤트도 추가 (디버깅용)
                    ksSectionSelect.addEventListener('click', function(e) {
                        console.log('[DEBUG] ksSection click event fired. Options count:', e.target.options.length);
                        fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:click',message:'ksSection clicked',data:{optionsCount:e.target.options.length,value:e.target.value},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'O'})}).catch(()=>{});
                    });
                    
                    // #region agent log
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:DOMContentLoaded',message:'Event listener attached',data:{optionsCount:ksSectionSelect.options.length},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'J'})}).catch(()=>{});
                    console.log('[DEBUG] Event listener attached to ksSection');
                    // #endregion
                } else {
                    // #region agent log
                    console.error('[ERROR] ksSectionSelect not found for event listener');
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:DOMContentLoaded',message:'ksSectionSelect not found for event listener',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'K'})}).catch(()=>{});
                    // #endregion
                }
                // #region agent log
                setTimeout(checkKsSectionVisibility, 100);
                // #endregion
            });
        } else {
            console.log('[DEBUG] Document already loaded, calling populateKsSectionOptions immediately');
            const populateResult = populateKsSectionOptions();
            console.log('[DEBUG] populateKsSectionOptions returned:', populateResult);
            // #region agent log
            fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:immediate',message:'populateKsSectionOptions result (immediate)',data:{populateResult:populateResult},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'L'})}).catch(()=>{});
            // #endregion
            const ksSectionSelect = document.getElementById('ksSection');
            if (ksSectionSelect) {
                // #region agent log
                console.log('[DEBUG] Attaching event listener to ksSection (immediate). Options count:', ksSectionSelect.options.length);
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:immediate',message:'Before attaching event listener (immediate)',data:{optionsCount:ksSectionSelect.options.length,selectId:ksSectionSelect.id,selectValue:ksSectionSelect.value},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'M'})}).catch(()=>{});
                // #endregion
                
                // 이벤트 리스너 추가
                ksSectionSelect.addEventListener('change', function(e) {
                    console.log('[DEBUG] ksSection change event fired (immediate). Selected value:', e.target.value);
                    onKsSectionChange();
                });
                
                // 클릭 이벤트도 추가 (디버깅용)
                ksSectionSelect.addEventListener('click', function(e) {
                    console.log('[DEBUG] ksSection click event fired (immediate). Options count:', e.target.options.length);
                    fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:click',message:'ksSection clicked (immediate)',data:{optionsCount:e.target.options.length,value:e.target.value},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'P'})}).catch(()=>{});
                });
                
                // #region agent log
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:immediate',message:'Event listener attached (immediate)',data:{optionsCount:ksSectionSelect.options.length},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'M'})}).catch(()=>{});
                console.log('[DEBUG] Event listener attached to ksSection (immediate)');
                // #endregion
            } else {
                // #region agent log
                console.error('[ERROR] ksSectionSelect not found for event listener (immediate)');
                fetch('http://127.0.0.1:7242/ingest/f6b33b86-5eb3-41dd-83f7-9e0a0382507b',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'castellated-beam-calculator.html:immediate',message:'ksSectionSelect not found for event listener (immediate)',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'N'})}).catch(()=>{});
                // #endregion
            }
            // #region agent log
            setTimeout(checkKsSectionVisibility, 100);
            // #endregion
        }
    </script>
</body>
</html>
