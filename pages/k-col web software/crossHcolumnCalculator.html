<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>SRC(Cross H) Design Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; /* Fallback */
            min-height: 100dvh;
            padding: 5px;
        }

        .calculator-wrapper {
            max-width: 1100px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        /* Ìó§Îçî */
        .header {
            background: linear-gradient(135deg, #1e3a5f, #2d5a87);
            color: white;
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header a {
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            font-size: 13px;
            padding: 6px 12px;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 4px;
            transition: all 0.2s;
        }

        .header a:hover {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        .header h1 {
            font-size: 20px;
            font-weight: 500;
        }

        .header-right {
            display: flex;
            gap: 8px;
        }

        .type-btn {
            padding: 8px 20px;
            border: 2px solid rgba(255,255,255,0.5);
            background: transparent;
            color: white;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .type-btn.active, .type-btn:hover {
            background: white;
            color: #1e3a5f;
            border-color: white;
        }

        /* Î©îÏù∏ Ïª®ÌÖêÏ∏† */
        .main-content {
            display: grid;
            grid-template-columns: 500px 1fr;
            gap: 0;
        }

        /* Ï¢åÏ∏°: Îã®Î©¥ÎèÑ + ÏπòÏàò */
        .left-section {
            background: #f8fafc;
            padding: 20px 20px 0 20px;
            border-right: 1px solid #e2e8f0;
            overflow-y: auto;
            max-height: calc(100vh - 80px);
        }

        /* ÏÇ¨Ïö©ÏÑ§Î™ÖÏÑú Ìå®ÎÑê */
        .user-guide-panel {
            background: linear-gradient(135deg, #fff5e6 0%, #ffe8cc 100%);
            border: 2px solid #f6ad55;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(246, 173, 85, 0.2);
        }

        .user-guide-panel-title {
            font-size: 16px;
            font-weight: 700;
            color: #c05621;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-guide-panel-title::before {
            content: 'üìñ';
            font-size: 18px;
        }

        .user-guide-content {
            font-size: 13px;
            color: #744210;
            line-height: 1.6;
        }

        .user-guide-content ul {
            margin: 8px 0;
            padding-left: 20px;
        }

        .user-guide-content li {
            margin: 4px 0;
        }

        .user-guide-link {
            display: inline-block;
            margin-top: 10px;
            padding: 8px 16px;
            background: #f6ad55;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .user-guide-link:hover {
            background: #ed8936;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(246, 173, 85, 0.4);
        }

        .section-title {
            font-size: 14px;
            font-weight: 600;
            color: #1e3a5f;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 16px;
            background: #667eea;
            border-radius: 2px;
        }

        .diagram-container {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
            position: relative;
        }

        .section-image {
            max-width: 100%;
            height: auto;
            max-height: 200px;
            display: block;
            margin: 0 auto;
        }

        .diagram-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
            font-size: 11px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .legend-box {
            width: 12px;
            height: 12px;
            border: 1px solid #666;
            border-radius: 2px;
            flex-shrink: 0;
        }

        .legend-major {
            background: #22c55e;
        }

        .legend-minor {
            background: #3b82f6;
        }

        .copy-btn {
            width: 100%;
            padding: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            margin-bottom: 15px;
            transition: transform 0.2s;
        }

        .copy-btn:hover {
            transform: translateY(-1px);
        }

        /* Í∞ÑÌé∏Í≥ÑÏÇ∞ Î≤ÑÌäº Ïª®ÌÖåÏù¥ÎÑà */
        .quick-calc-buttons {
            display: flex;
            gap: 8px;
            margin-top: 15px;
            width: 100%;
        }

        .quick-calc-btn {
            flex: 1;
            padding: 8px 14px;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        }

        .quick-calc-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.5);
        }

        .quick-calc-btn:active {
            transform: translateY(0);
        }

        /* Í∞ÑÌé∏Í≥ÑÏÇ∞ Ï∂úÎ†• ÏòÅÏó≠ */
        .quick-calc-output {
            width: 100%;
            max-width: 459px;
            max-height: 35px;
            margin-top: 8px;
            padding: 6px 10px;
            background: linear-gradient(135deg, #f0f4ff, #e8f4f8);
            border: 1px solid #667eea;
            border-radius: 6px;
            font-size: 11px;
            color: #1e3a5f;
            overflow: hidden;
            display: none;
            box-sizing: border-box;
        }

        .quick-calc-output.active {
            display: block;
        }

        .quick-calc-output-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
            white-space: nowrap;
            overflow-x: auto;
            overflow-y: hidden;
        }

        .quick-calc-output-content::-webkit-scrollbar {
            height: 3px;
        }

        .quick-calc-output-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .quick-calc-output-content::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 3px;
        }

        .quick-calc-result-item {
            display: flex;
            align-items: center;
            gap: 4px;
            flex-shrink: 0;
        }

        .quick-calc-result-label {
            font-weight: 600;
            color: #4a5568;
        }

        .quick-calc-result-value {
            font-weight: 700;
            color: #1e3a5f;
        }

        .quick-calc-result-value.ok {
            color: #10b981;
        }

        .quick-calc-result-value.ng {
            color: #ef4444;
        }

        .dimensions-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .dim-box {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 12px;
        }

        .dim-box h4 {
            font-size: 12px;
            color: #667eea;
            margin-bottom: 10px;
            text-align: center;
            font-weight: 600;
        }

        .dim-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
            font-size: 11px;
        }

        .dim-row label {
            color: #666;
            font-weight: 500;
        }

        .dim-row input {
            width: 45px;
            padding: 4px 6px;
            border: 1px solid #ddd;
            border-radius: 3px;
            text-align: right;
            font-size: 11px;
        }

        .dim-row input:focus {
            outline: none;
            border-color: #667eea;
        }

        .dim-row select {
            width: 100px;
            padding: 4px 6px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 11px;
            background: white;
            cursor: pointer;
        }

        .dim-row select:focus {
            outline: none;
            border-color: #667eea;
        }

        .dim-row .unit {
            font-size: 10px;
            color: #999;
            width: 20px;
        }

        /* Ïö∞Ï∏°: ÌååÎùºÎØ∏ÌÑ∞ Í∑∏Î¶¨Îìú */
        .right-section {
            padding: 20px;
        }

        .params-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .param-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 8px;
        }

        .param-card.full-width {
            grid-column: 1 / -1;
        }

        .param-title {
            font-size: 12px;
            font-weight: 600;
            color: #1e3a5f;
            margin-bottom: 6px;
            padding-bottom: 4px;
            border-bottom: 2px solid #667eea;
        }

        .param-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .param-row label {
            font-size: 12px;
            color: #555;
        }

        .param-row .input-group {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .param-row input {
            width: 80px;
            padding: 4px 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: right;
            font-size: 11px;
        }

        .param-row input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .param-row select {
            padding: 4px 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 11px;
            background: white;
        }

        .param-row .unit {
            font-size: 11px;
            color: #888;
            min-width: 35px;
        }

        .param-grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .param-grid-3 .item {
            text-align: center;
        }

        .param-grid-3 label {
            display: block;
            font-size: 11px;
            color: #666;
            margin-bottom: 4px;
        }

        .param-grid-3 input {
            width: 100%;
            padding: 4px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
            font-size: 11px;
        }

        .load-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .load-grid .param-row {
            margin-bottom: 0;
        }

        .load-grid input {
            width: 60px;
        }

        /* Ïö¥ÏòÅÏûê Control ÏòÅÏó≠ */
        .operator-control-section {
            background: linear-gradient(135deg, #fff7ed, #fef3c7);
            border: 2px solid #f59e0b;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(245, 158, 11, 0.15);
        }

        .operator-control-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #f59e0b;
        }

        .operator-control-header h3 {
            margin: 0;
            font-size: 16px;
            font-weight: 700;
            color: #92400e;
            flex: 1;
        }

        .operator-control-header .icon {
            font-size: 20px;
        }

        .operator-control-header .operator-header-left {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .operator-control-header .operator-header-right {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 4px;
        }

        .operator-control-header .operator-email {
            font-size: 11px;
            color: #6b7280;
            font-weight: 500;
        }

        .operator-control-header .operator-status {
            font-size: 12px;
            font-weight: 600;
        }

        .operator-control-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 8px;
            width: 100%;
        }

        .operator-control-btn {
            width: 100%;
            padding: 12px;
            background: #1e3a5f;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            box-sizing: border-box;
            text-align: center;
            white-space: normal;
            line-height: 1.4;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .operator-control-btn:hover {
            background: #2d5a87;
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        .operator-control-btn.primary {
            background: #6b7280;
        }

        .operator-control-btn.primary:hover {
            background: #4b5563;
        }

        .operator-control-btn.secondary {
            background: #3b82f6;
        }

        .operator-control-btn.secondary:hover {
            background: #2563eb;
        }

        .operator-control-btn.success {
            background: #38a169;
        }

        .operator-control-btn.success:hover {
            background: #2f855a;
        }

        /* ÌïòÎã® Ïï°ÏÖò */
        .action-bar {
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
            padding: 10px 0 0 0;
            display: flex;
            gap: 8px;
            margin-top: 10px;
            margin-bottom: 0;
            width: 100%;
        }

        .action-btn {
            width: 100%;
            padding: 14px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            white-space: normal;
            line-height: 1.4;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            text-align: center;
            transition: all 0.2s;
            box-sizing: border-box;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .action-btn.primary {
            background: #6b7280;
            color: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .action-btn.primary:hover {
            background: #4b5563;
            transform: translateY(-1px);
        }

        .action-btn.secondary {
            background: #9ca3af;
            color: white;
            border: none;
        }

        .action-btn.secondary:hover {
            background: #6b7280;
        }

        #rolled-cross-h-btn {
            background: #3b82f6 !important;
        }

        #rolled-cross-h-btn:hover {
            background: #2563eb !important;
        }

        .beam-type-btns {
            display: contents;
        }

        .beam-type-btn {
            width: 100%;
            padding: 12px;
            background: #1e3a5f;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            transition: background 0.2s;
            box-sizing: border-box;
        }

        .beam-type-btn:hover {
            background: #2d5a87;
        }

        #auto-find-section-btn {
            background: #38a169 !important;
        }

        #auto-find-section-btn:hover {
            background: #2f855a !important;
        }

        /* Í∏∞Ï°¥ action-btn Ïä§ÌÉÄÏùº Ïú†ÏßÄ (ÏùºÎ∞ò ÏÇ¨Ïö©ÏûêÏö©) */
        .action-bar .action-btn {
            flex: 1;
        }

        /* Ìï¥ÏÑù Í≤∞Í≥º Î∞ïÏä§ (Ïö∞Ï∏° ÏÑπÏÖò ÎÇ¥Î∂Ä) */
        .results-box {
            background: linear-gradient(135deg, #f0f4ff, #e8f4f8);
            border: 2px solid #667eea;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .results-box .param-title {
            border-bottom-color: #667eea;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .result-item {
            background: white;
            border-radius: 6px;
            padding: 10px;
            border: 1px solid #e2e8f0;
        }

        .result-name {
            font-size: 11px;
            font-weight: 600;
            color: #1e3a5f;
            margin-bottom: 5px;
        }

        .result-check {
            font-size: 10px;
            color: #555;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .result-val {
            font-weight: 600;
            color: #333;
        }

        .result-status {
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 9px;
            font-weight: 500;
            margin-left: auto;
        }

        .result-status.pending {
            background: #fef3c7;
            color: #92400e;
        }

        .result-status.ok {
            background: #d1fae5;
            color: #065f46;
        }

        .result-status.ng {
            background: #fee2e2;
            color: #991b1b;
        }

        /* Multi Column Calculation Sheet */
        .multi-column-sheet {
            background: #ffffff;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
            flex-shrink: 0;
        }

        .multi-column-table-container {
            overflow-x: auto;
            overflow-y: visible;
            margin-top: 8px;
            width: 100%;
        }

        .multi-column-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 11px;
            min-width: 500px;
            table-layout: fixed;
        }

        .multi-column-table thead {
            background: #f8fafc;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .multi-column-table th {
            padding: 8px 6px;
            text-align: center;
            font-weight: 600;
            color: #1e3a5f;
            border: 1px solid #e2e8f0;
            background: #f8fafc;
            font-size: 11px;
            width: 18%;
        }
        
        .multi-column-table th:first-child {
            width: 10%;
        }

        .multi-column-table td {
            padding: 6px;
            text-align: center;
            border: 1px solid #e2e8f0;
            width: 18%;
        }
        
        .multi-column-table td:first-child {
            width: 10%;
        }

        .multi-column-table tbody tr:hover {
            background: #f8fafc;
        }

        .multi-column-table input {
            width: 100%;
            padding: 4px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
            font-size: 11px;
        }

        .multi-column-table input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
        }

        .multi-column-table .column-number {
            font-weight: 600;
            color: #1e3a5f;
            background: #f8fafc;
        }

        .multi-column-table .result-cell {
            font-weight: 500;
            color: #555;
        }

        /* Multi Column Execution Bar */
        .multi-column-execution-bar {
            display: flex;
            justify-content: center;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #e2e8f0;
        }

        .multi-column-execution-btn {
            width: 100%;
            max-width: 400px;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .multi-column-execution-btn:hover {
            background: linear-gradient(135deg, #5568d3, #6b3fa0);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }

        .multi-column-execution-btn:active {
            transform: translateY(0);
        }

        /* NAME ÏûÖÎ†• */
        .name-input-row {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }

        .name-input-row label {
            font-size: 12px;
            color: #666;
            font-weight: 500;
        }

        .name-input-row input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
        }
    </style>
    <!-- SheetJS for Excel file handling -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
    <div class="calculator-wrapper">
        <!-- Ìó§Îçî -->
        <div class="header">
            <div class="header-left">
                <a href="../../index.html">‚Üê ÌôàÏúºÎ°ú</a>
                <h1>SRC(Cross H) Design Calculator</h1>
            </div>
            <div class="header-right">
                <button class="type-btn active" data-type="kcol">Rolled H</button>
                <button class="type-btn" data-type="posh">Pos-H / Built-UP H</button>
            </div>
        </div>
            
        <!-- Î©îÏù∏ Ïª®ÌÖêÏ∏† -->
        <div class="main-content">
            <!-- Ï¢åÏ∏°: Îã®Î©¥ÎèÑ + ÏπòÏàò -->
            <div class="left-section">
                <!-- ÏÇ¨Ïö©ÏÑ§Î™ÖÏÑú Ìå®ÎÑê -->
                <div class="user-guide-panel">
                    <div class="user-guide-panel-title">2. Íµ¨Ï°∞ Í≥ÑÏÇ∞</div>
                    <div class="user-guide-content">
                        <p style="margin-bottom: 12px;"><strong>K-COL Íµ¨Ï°∞ Í≥ÑÏÇ∞ Í∏∞Îä•</strong>ÏùÄ <span style="color: #c05621; font-weight: 600;">Cross H</span>Ìòï Îã®Î©¥Ïùò Íµ¨Ï°∞ ÏÑ§Í≥ÑÎ•º ÏûêÎèôÌôîÌïòÏó¨ Ï†ïÌôïÌïú Íµ¨Ï°∞ Í≥ÑÏÇ∞ÏùÑ ÏàòÌñâÌï©ÎãàÎã§.</p>
                        
                        <div style="margin: 12px 0; padding: 10px; background: rgba(255,255,255,0.6); border-radius: 6px; border-left: 3px solid #f6ad55;">
                            <strong style="color: #c05621;">Ï£ºÏöî Í∏∞Îä•:</strong>
                            <ul style="margin: 6px 0 0 0; padding-left: 20px;">
                                <li><strong>Í∞ÑÌé∏ Í≥ÑÏÇ∞:</strong> 1-ColumnÏóê ÎåÄÌïú Îπ†Î•∏ Íµ¨Ï°∞ Í≥ÑÏÇ∞ ÏàòÌñâ</li>
                                <li><strong>Multi Column Execution:</strong> Ïó¨Îü¨ Í∏∞Îë•Ïóê ÎåÄÌïú ÏùºÍ¥Ñ Í≥ÑÏÇ∞</li>
                                <li><strong>Auto Find Section:</strong> ÏµúÏ†Å Îã®Î©¥ ÏûêÎèô ÌÉêÏÉâ</li>
                                <li><strong>Auto Distributed Column Load:</strong> Í∏∞Îë•ÏûêÎèôÎ©¥Ï†ÅÎ∂ÑÎã¥Ïú® Í≥ÑÏÇ∞</li>
                            </ul>
                        </div>

                        <div style="margin: 12px 0; padding: 10px; background: rgba(255,255,255,0.6); border-radius: 6px; border-left: 3px solid #f6ad55;">
                            <strong style="color: #c05621;">ÏÇ¨Ïö© Î∞©Î≤ï:</strong>
                            <ol style="margin: 6px 0 0 0; padding-left: 20px;">
                                <li>Îã®Î©¥ ÌÉÄÏûÖ ÏÑ†ÌÉù (Rolled H ÎòêÎäî Pos-H / Built-UP H)</li>
                                <li>Cross HÌòï Îã®Î©¥Ïùò ÏπòÏàò ÏûÖÎ†• (H1, B1, tw1, tf1, H2, B2, tw2, tf2 Îì±)</li>
                                <li>Í∞ïÏû¨ Îì±Í∏â Î∞è Ïû¨Î£å ÌäπÏÑ± ÏÑ§Ï†ï</li>
                                <li>Ï¢åÍµ¥ Í∏∏Ïù¥ Í≥ÑÏàò(Kx, Ky, Kz) Î∞è ÎπÑÏßÄÏßÄ Í∏∏Ïù¥(Lx, Ly, Lb) ÏûÖÎ†•</li>
                                <li>ÏÑ§Í≥Ñ ÌïòÏ§ë ÏûÖÎ†• (Ï∂ïÎ†•, Ìú®Î™®Î©òÌä∏, Ï†ÑÎã®Î†• Îì±)</li>
                                <li><strong>"Í∞ÑÌé∏Í≥ÑÏÇ∞(1-Column)"</strong> Î≤ÑÌäº ÌÅ¥Î¶≠</li>
                            </ol>
                        </div>

                        <div style="margin-top: 12px; padding: 8px; background: rgba(246, 173, 85, 0.1); border-radius: 6px; font-size: 12px; color: #744210;">
                            <strong>üí° Tip:</strong> Ïó¨Îü¨ Í∏∞Îë• Í≥ÑÏÇ∞ÏùÄ <strong>"Multi Column Execution"</strong> Î≤ÑÌäºÏùÑ ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî.
                        </div>

                        <div style="margin-top: 12px; padding: 10px; background: rgba(102, 126, 234, 0.1); border-radius: 6px; border-left: 3px solid #667eea; font-size: 12px; color: #1e3a5f;">
                            <strong style="color: #667eea;">Í≥†Í∏â Í∏∞Îä•:</strong>
                            <div style="margin-top: 6px; line-height: 1.8;">
                                <div><strong>A.F.SÍ∏∞Îä•:</strong> ÏµúÏ†Å Îã®Î©¥ ÏûêÎèô ÌÉêÏÉâ</div>
                                <div><strong>A.D.CÍ∏∞Îä•:</strong> Í∏∞Îë•ÏûêÎèôÎ©¥Ï†ÅÎ∂ÑÎã¥Ïú® Í≥ÑÏÇ∞</div>
                                <div><strong>SRC(Cross H) Îã®Î©¥Í≥ÑÏÇ∞</strong></div>
                                <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(102, 126, 234, 0.2); color: #c05621; font-weight: 600;">
                                    <strong>Special Mode</strong>Î°ú Ïö¥ÏòÅÏûêÏóêÍ≤å ÏßÅÏ†ëÎ¨∏Ïùò Î∞îÎûçÎãàÎã§.
                                </div>
                            </div>
                        </div>

                        <a href="k-col-user-guide.html#structure-calculation" target="_blank" class="user-guide-link">üìò Ï†ÑÏ≤¥ ÏÇ¨Ïö©ÏÑ§Î™ÖÏÑú Î≥¥Í∏∞</a>
                    </div>
                </div>
                
                <div class="section-title">Section Dimensions</div>
                
                <div class="name-input-row">
                    <label>NAME</label>
                    <input type="text" value="K-COL" id="projectName">
                </div>
                
                <div class="diagram-container">
                    <img src="../../assets/images/2H-section.png" alt="Cross H Column Îã®Î©¥ÎèÑ" class="section-image">
                    <div class="diagram-legend">
                        <div class="legend-item">
                            <div class="legend-box legend-major"></div>
                            <span>Major (H1)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-box legend-minor"></div>
                            <span>Minor (H2)</span>
                        </div>
                    </div>
                </div>
                
                <button class="copy-btn" onclick="copyMajorToMinor()">
                    Major ‚Üî Minor Îã®Î©¥ ÎèôÏùº Ï†ÅÏö©
                </button>
                
                <div class="dimensions-container">
                    <div class="dim-box">
                        <h4>Major (H1)</h4>
                        <div class="dim-row">
                            <label>H1</label>
                            <div id="H1Container">
                                <select id="H1">
                                    <option value="400">H400x200</option>
                                    <option value="450">H450x200</option>
                                    <option value="500" selected>H500x200</option>
                                    <option value="506">H506x201</option>
                                    <option value="600">H600x200</option>
                                    <option value="606">H606x201</option>
                                    <option value="582">H582x300</option>
                                    <option value="588">H588x300</option>
                                    <option value="692">H692x300</option>
                                    <option value="700">H700x300</option>
                                    <option value="800">H800x300</option>
                                    <option value="900">H900x300</option>
                                    <option value="912">H912x302</option>
                                </select>
                            </div>
                            <span class="unit">mm</span>
                        </div>
                        <div class="dim-row">
                            <label>B1</label>
                            <input type="text" value="200" id="B1">
                            <span class="unit">mm</span>
                        </div>
                        <div class="dim-row">
                            <label>tw1</label>
                            <input type="text" value="8" id="tw1">
                            <span class="unit">mm</span>
                        </div>
                        <div class="dim-row">
                            <label>tf1</label>
                            <input type="text" value="13" id="tf1">
                            <span class="unit">mm</span>
                        </div>
                        <div class="dim-row">
                            <label>r1</label>
                            <input type="text" value="18" id="r1">
                            <span class="unit">mm</span>
                        </div>
                    </div>
                    
                    <div class="dim-box">
                        <h4>Minor (H2)</h4>
                        <div class="dim-row">
                            <label>H2</label>
                            <div id="H2Container">
                                <select id="H2">
                                    <option value="400">H400x200</option>
                                    <option value="450" selected>H450x200</option>
                                    <option value="500">H500x200</option>
                                    <option value="506">H506x201</option>
                                    <option value="600">H600x200</option>
                                    <option value="606">H606x201</option>
                                    <option value="582">H582x300</option>
                                    <option value="588">H588x300</option>
                                    <option value="692">H692x300</option>
                                    <option value="700">H700x300</option>
                                    <option value="800">H800x300</option>
                                    <option value="900">H900x300</option>
                                    <option value="912">H912x302</option>
                                </select>
                            </div>
                            <span class="unit">mm</span>
                        </div>
                        <div class="dim-row">
                            <label>B2</label>
                            <input type="text" value="200" id="B2">
                            <span class="unit">mm</span>
                        </div>
                        <div class="dim-row">
                            <label>tw2</label>
                            <input type="text" value="9" id="tw2">
                            <span class="unit">mm</span>
                        </div>
                        <div class="dim-row">
                            <label>tf2</label>
                            <input type="text" value="14" id="tf2">
                            <span class="unit">mm</span>
                        </div>
                        <div class="dim-row">
                            <label>r2</label>
                            <input type="text" value="18" id="r2">
                            <span class="unit">mm</span>
                    </div>
                </div>
            </div>
            
                <!-- Îã®Î©¥Ï†Å As ÌëúÌòÑ -->
                <div id="section-area-display" style="margin-bottom: 8px; font-size: 14px; color: #4a5568; text-align: center;">Îã®Î©¥Ï†Å :  mm¬≤  |  Îã®Ï§ë :  kg/m</div>
                
                <!-- Í∞ÑÌé∏ Í≥ÑÏÇ∞ Î≤ÑÌäº -->
                <div class="quick-calc-buttons">
                    <button class="quick-calc-btn" onclick="quickCalculate()">
                        ‚ö° Í∞ÑÌé∏Í≥ÑÏÇ∞(1-Column)
                    </button>
                </div>
                
                <!-- Í∞ÑÌé∏Í≥ÑÏÇ∞ Ï∂úÎ†• ÏòÅÏó≠ -->
                <div id="quickCalcOutput" class="quick-calc-output">
                    <div class="quick-calc-output-content" id="quickCalcOutputContent">
                        <!-- Í≤∞Í≥ºÍ∞Ä Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú ÌëúÏãúÎê©ÎãàÎã§ -->
                    </div>
                </div>
                
                <!-- Ïö¥ÏòÅÏûê Control ÏòÅÏó≠ -->
                <div class="operator-control-section" id="operatorControlSection">
                    <div class="operator-control-header">
                        <div class="operator-header-left">
                            <span class="icon">‚öôÔ∏è</span>
                            <h3>Ïö¥ÏòÅÏûê Control</h3>
                        </div>
                        <div class="operator-header-right">
                            <span class="operator-email" id="operatorEmail"></span>
                            <span class="operator-status" id="operatorStatus"></span>
                        </div>
                    </div>
                    <div class="operator-control-grid" id="operatorControlGrid">
                        <a href="Cross-H-Column-Calculation-Data1.html" class="operator-control-btn primary" onclick="return checkOperatorAccessAndNavigate(event, 'Cross-H-Column-Calculation-Data1.html');">
                            üìÑ Ï†ÑÏ≤¥Í≥ÑÏÇ∞ÏÑú<br>(1-Column)
                        </a>
                        <button class="operator-control-btn success" id="auto-find-section-btn" data-requires="column" data-onclick="window.location.href='protected/auto-find-section.html'" onclick="return checkOperatorAccess(function() { window.location.href='protected/auto-find-section.html'; }, event);">
                            A.F.S. Function<br>RH / BH
                        </button>
                        <button class="operator-control-btn" data-requires="column" data-onclick="alert('SRC(Cross H) Í∏∞Îä•ÏùÄ Ï§ÄÎπÑ Ï§ëÏûÖÎãàÎã§.');" onclick="return checkOperatorAccess(function() { alert('SRC(Cross H) Í∏∞Îä•ÏùÄ Ï§ÄÎπÑ Ï§ëÏûÖÎãàÎã§.'); }, event);">
                            SRC<br>(Cross H)
                        </button>
                        <button class="operator-control-btn secondary" id="rolled-cross-h-btn" onclick="return checkOperatorAccess(openColumnPlanInput, event);">
                            A. D. C. Function<br>Top Down
                        </button>
                    </div>
                </div>

                <!-- ÌïòÎã® Ïï°ÏÖò Î∞î (ÏùºÎ∞ò ÏÇ¨Ïö©ÏûêÏö© - ÌïÑÏöîÏãú Ï∂îÍ∞Ä Í∏∞Îä•) -->
                <div class="action-bar">
                    <!-- ÏùºÎ∞ò ÏÇ¨Ïö©ÏûêÏö© Î≤ÑÌäºÏù¥ ÌïÑÏöîÌïòÎ©¥ Ïó¨Í∏∞Ïóê Ï∂îÍ∞Ä -->
                </div>
                    </div>
                    
            <!-- Ïö∞Ï∏°: ÌååÎùºÎØ∏ÌÑ∞ -->
            <div class="right-section">
                <div class="params-grid">
                    <!-- Steel Material -->
                    <div class="param-card">
                        <div class="param-title">Steel Material</div>
                        <div class="param-row">
                            <label>Grade</label>
                            <select id="steelGrade">
                                <option>SS275</option>
                                <option>SS355</option>
                                <option selected>SM355</option>
                                <option>SM420</option>
                            </select>
                        </div>
                        <div class="param-row">
                            <label>Fy</label>
                            <div class="input-group">
                                <input type="text" value="355" id="Fy">
                            <span class="unit">MPa</span>
                        </div>
                    </div>
                        <div class="param-row">
                            <label>E</label>
                            <div class="input-group">
                                <input type="text" value="210,000" id="E">
                            <span class="unit">MPa</span>
                            </div>
                        </div>
                        <div class="param-row">
                            <label>ŒΩ</label>
                            <div class="input-group">
                                <input type="text" value="0.3" id="nu">
                                <span class="unit"></span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Effective Length Factor -->
                    <div class="param-card">
                        <div class="param-title">Effective Length Factor</div>
                        <div class="param-grid-3">
                            <div class="item">
                                <label>Kx</label>
                                <input type="text" value="0.8" id="Kx">
                        </div>
                            <div class="item">
                                <label>Ky</label>
                                <input type="text" value="0.8" id="Ky">
                            </div>
                            <div class="item">
                                <label>Kz</label>
                                <input type="text" value="0.8" id="Kz">
                            </div>
                        </div>
                        <div class="param-row" style="margin-top: 12px; justify-content: space-between;">
                            <label style="flex: 1; white-space: nowrap;">Cb (Lateral Buckling)</label>
                            <div class="input-group" style="margin-left: auto;">
                                <input type="text" value="1" id="Cb" style="width: 50px; text-align: center;">
                    </div>
                </div>
            </div>
            
                    <!-- Unbraced Length -->
                    <div class="param-card">
                        <div class="param-title">Unbraced Length</div>
                        <div class="param-row">
                            <label>Lx</label>
                            <div class="input-group">
                                <input type="text" value="4.5" id="Lx">
                                <span class="unit">m</span>
                            </div>
                        </div>
                        <div class="param-row">
                            <label>Ly</label>
                            <div class="input-group">
                                <input type="text" value="4.5" id="Ly">
                                <span class="unit">m</span>
                            </div>
                        </div>
                        <div class="param-row">
                            <label>Lb</label>
                            <div class="input-group">
                                <input type="text" value="4.5" id="Lb">
                                <span class="unit">m</span>
                    </div>
                </div>
            </div>
            
                    <!-- Design Load -->
                    <div class="param-card">
                        <div class="param-title">Design Load</div>
                        <div class="param-row">
                            <label>Pu (Axial)</label>
                            <div class="input-group">
                                <input type="text" value="7,561" id="Pu">
                                <span class="unit">kN</span>
                        </div>
                        </div>
                        <div class="load-grid" style="margin-top: 8px;">
                            <div class="param-row">
                                <label>Mux</label>
                                <div class="input-group">
                                    <input type="text" value="0" id="Mux">
                                    <span class="unit">kN¬∑m</span>
                        </div>
                    </div>
                            <div class="param-row">
                                <label>Muy</label>
                                <div class="input-group">
                                    <input type="text" value="0" id="Muy">
                                    <span class="unit">kN¬∑m</span>
                </div>
            </div>
                            <div class="param-row">
                                <label>Vux</label>
                                <div class="input-group">
                                    <input type="text" value="0" id="Vux">
                                    <span class="unit">kN</span>
                        </div>
                    </div>
                            <div class="param-row">
                                <label>Vuy</label>
                                <div class="input-group">
                                    <input type="text" value="0" id="Vuy">
                                <span class="unit">kN</span>
                                </div>
                            </div>
                            </div>
                        </div>
                    </div>
                    
                <!-- Ìï¥ÏÑù Í≤∞Í≥º (Ïö∞Ï∏° ÏÑπÏÖò ÎÇ¥Î∂Ä) -->
                <div class="results-box">
                    <div class="param-title">üìä 1-Column Calculation Results</div>
                    <div class="results-grid">
                        <div class="result-item">
                            <div class="result-name">Compressive</div>
                            <div class="result-check">
                                <span>Pu/œÜPn = </span>
                                <span class="result-val">-</span>
                                <span class="result-status pending">ÎåÄÍ∏∞</span>
                            </div>
                        </div>
                        <div class="result-item">
                            <div class="result-name">Bending X</div>
                            <div class="result-check">
                                <span>Mux/œÜMnx = </span>
                                <span class="result-val">-</span>
                                <span class="result-status pending">ÎåÄÍ∏∞</span>
                            </div>
                        </div>
                        <div class="result-item">
                            <div class="result-name">Bending Y</div>
                            <div class="result-check">
                                <span>Muy/œÜMny = </span>
                                <span class="result-val">-</span>
                                <span class="result-status pending">ÎåÄÍ∏∞</span>
                            </div>
                        </div>
                        <div class="result-item">
                            <div class="result-name">P-M-M</div>
                            <div class="result-check">
                                <span>Combined = </span>
                                <span class="result-val">-</span>
                                <span class="result-status pending">ÎåÄÍ∏∞</span>
                            </div>
                        </div>
                        <div class="result-item">
                            <div class="result-name">Shear X</div>
                            <div class="result-check">
                                <span>Vux/œÜVnx = </span>
                                <span class="result-val">-</span>
                                <span class="result-status pending">ÎåÄÍ∏∞</span>
                    </div>
                </div>
                        <div class="result-item">
                            <div class="result-name">Shear Y</div>
                            <div class="result-check">
                                <span>Vuy/œÜVny = </span>
                                <span class="result-val">-</span>
                                <span class="result-status pending">ÎåÄÍ∏∞</span>
            </div>
        </div>
                    </div>
        </div>
        
                <!-- Multi Column Calculation Sheet -->
                <div class="multi-column-sheet">
                    <div class="param-title">üìã Multi Column Calculation Sheet</div>
                    <div class="multi-column-table-container">
                        <table class="multi-column-table">
                            <thead>
                                <tr>
                                    <th>Col. no</th>
                                    <th>Pu</th>
                                    <th>Mux</th>
                                    <th>Muy</th>
                                    <th>Compressive</th>
                                    <th>P-M-M</th>
                                </tr>
                            </thead>
                            <tbody id="multiColumnTableBody">
                                <!-- JavaScriptÎ°ú ÎèôÏ†Å ÏÉùÏÑ± (6Í∞ú Í∏∞Îë•) -->
                            </tbody>
                        </table>
        </div>
                    <div class="multi-column-execution-bar">
                        <button class="multi-column-execution-btn" onclick="executeMultiColumnCalculation()">
                            ‚ö° Multi Column Execution
                        </button>
    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function copyMajorToMinor() {
            document.getElementById('H2').value = document.getElementById('H1').value;
            document.getElementById('B2').value = document.getElementById('B1').value;
            document.getElementById('tw2').value = document.getElementById('tw1').value;
            document.getElementById('tf2').value = document.getElementById('tf1').value;
            document.getElementById('r2').value = document.getElementById('r1').value;
        }

        // Ï†ÑÏ≤¥ Í≥ÑÏÇ∞ÏÑú Î≥¥Í∏∞ ÌÅ¥Î¶≠ Ïãú ÏûÖÎ†• Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
        function saveInputData() {
            const inputData = {
                // Section Dimensions
                H1: parseFloat(document.getElementById('H1').value),
                B1: parseFloat(document.getElementById('B1').value),
                tw1: parseFloat(document.getElementById('tw1').value),
                tf1: parseFloat(document.getElementById('tf1').value),
                r1: parseFloat(document.getElementById('r1').value),
                H2: parseFloat(document.getElementById('H2').value),
                B2: parseFloat(document.getElementById('B2').value),
                tw2: parseFloat(document.getElementById('tw2').value),
                tf2: parseFloat(document.getElementById('tf2').value),
                r2: parseFloat(document.getElementById('r2').value),
                // Material
                steelGrade: document.getElementById('steelGrade').value,
                Fy: parseFloat(document.getElementById('Fy').value.replace(/,/g, '')),
                E: parseFloat(document.getElementById('E').value.replace(/,/g, '')),
                nu: parseFloat(document.getElementById('nu').value),
                // Unbraced Length
                Lx: parseFloat(document.getElementById('Lx').value),
                Ly: parseFloat(document.getElementById('Ly').value),
                Lb: parseFloat(document.getElementById('Lb').value),
                // Effective Length Factor
                Kx: parseFloat(document.getElementById('Kx').value),
                Ky: parseFloat(document.getElementById('Ky').value),
                Kz: parseFloat(document.getElementById('Kz').value),
                // Cb
                Cb: parseFloat(document.getElementById('Cb').value),
                // Design Load
                Pu: parseFloat(document.getElementById('Pu').value.replace(/,/g, '')),
                Mux: parseFloat(document.getElementById('Mux').value),
                Muy: parseFloat(document.getElementById('Muy').value),
                Vux: parseFloat(document.getElementById('Vux').value),
                Vuy: parseFloat(document.getElementById('Vuy').value),
                // Name
                name: document.getElementById('projectName') ? document.getElementById('projectName').value : 'K-COL'
            };
            localStorage.setItem('kcolInputData', JSON.stringify(inputData));
        }

        // Î°úÍ∑∏Ïù∏ ÏÉÅÌÉú ÌôïÏù∏
        function checkLoginStatus() {
            const loginData = JSON.parse(localStorage.getItem('kcolLoginData')) || null;
            if (loginData && loginData.isLoggedIn) {
                // Î°úÍ∑∏Ïù∏ ÎßåÎ£å ÏãúÍ∞Ñ ÌôïÏù∏ (24ÏãúÍ∞Ñ)
                const now = new Date().getTime();
                if (now - loginData.loginTime < 24 * 60 * 60 * 1000) {
                    return true;
                } else {
                    // ÎßåÎ£åÎêú Í≤ΩÏö∞ Î°úÍ∑∏Ïù∏ Ï†ïÎ≥¥ Ï†úÍ±∞
                    localStorage.removeItem('kcolLoginData');
                }
            }
            return false;
        }

        // Î°úÍ∑∏Ïù∏ Î™®Îã¨ ÌëúÏãú
        function showLoginModal() {
            const modal = document.getElementById('loginModal');
            if (modal) {
                modal.style.display = 'flex';
                document.getElementById('loginUserId').focus();
            }
        }

        // Î°úÍ∑∏Ïù∏ Î™®Îã¨ Îã´Í∏∞
        function closeLoginModal() {
            const modal = document.getElementById('loginModal');
            if (modal) {
                modal.style.display = 'none';
                document.getElementById('loginUserId').value = '';
                document.getElementById('loginPassword').value = '';
                document.getElementById('loginError').textContent = '';
            }
        }

        // Î°úÍ∑∏Ïù∏ Ï≤òÎ¶¨
        function handleLogin() {
            const userId = document.getElementById('loginUserId').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!userId || !password) {
                document.getElementById('loginError').textContent = 'IDÏôÄ ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.';
                return;
            }

            // Í∞ÑÎã®Ìïú Ïù∏Ï¶ù (Ïã§Ï†úÎ°úÎäî ÏÑúÎ≤Ñ API Ìò∏Ï∂ú ÌïÑÏöî)
            const loginData = {
                isLoggedIn: true,
                userId: userId,
                loginTime: new Date().getTime()
            };
            localStorage.setItem('kcolLoginData', JSON.stringify(loginData));

            closeLoginModal();
            // Î°úÍ∑∏Ïù∏ ÌõÑ PDF Ï∂úÎ†• Í≥ÑÏÜç ÏßÑÌñâ
            proceedWithPrintCalculationSheet();
        }

        // PDF Ï∂úÎ†• ÏßÑÌñâ (Î°úÍ∑∏Ïù∏ ÌõÑ)
        function proceedWithPrintCalculationSheet() {
            // Î®ºÏ†Ä ÏûÖÎ†• Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
            saveInputData();
            
            // Í≥ÑÏÇ∞ÏÑú ÌÜµÌï© Ïù∏ÏáÑ ÌéòÏù¥ÏßÄÎ•º ÏÉà Ï∞ΩÏóêÏÑú Ïó¥Í≥† Ïù∏ÏáÑ
            const printWindow = window.open('Cross-H-Column-Print.html', '_blank');
            
            // ÌéòÏù¥ÏßÄ Î°úÎìú ÏôÑÎ£å ÌõÑ Ïù∏ÏáÑ ÎåÄÌôîÏÉÅÏûê ÌëúÏãú
            if (printWindow) {
                printWindow.onload = function() {
                    setTimeout(function() {
                        printWindow.print();
                    }, 800);
                };
            }
        }

        // Rolled Cross H Auto Find Section Ïã§Ìñâ
        function printCalculationSheet() {
            // Built-UP Î™®ÎìúÏù∏ÏßÄ ÌôïÏù∏
            if (isPosModeActive()) {
                alert('Rolled Cross H Auto Find SectionÏùÄ Built-UP Î™®ÎìúÏóêÏÑú ÏÇ¨Ïö©Ìï† Ïàò ÏóÜÏäµÎãàÎã§.\n\nRolled H Î™®ÎìúÎ•º ÏÑ†ÌÉùÌïú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            // Rolled H Î™®ÎìúÏù∏ Í≤ΩÏö∞ Auto Find Section ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô
            window.location.href = 'auto-find-section.html';
        }

        // Í∏∞Î≥∏ Í∏∞Îë•Î≤àÌò∏ Î∞è Ï¢åÌëú Ï¥àÍ∏∞Ìôî Ìï®Ïàò
        // ÌòÑÏû¨ Í∏∞Îë•Î≤àÌò∏Î•º Í∏∞Î≥∏Í∞íÏúºÎ°ú Ï†ÄÏû•
        function saveCurrentAsDefault() {
            try {
                const currentCoords = localStorage.getItem('columnCoordinates');
                if (!currentCoords) {
                    alert('Ï†ÄÏû•Ìï† Í∏∞Îë•Î≤àÌò∏ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.\n\nÎ®ºÏ†Ä ÏóëÏÖÄÏùÑ ÏóÖÎ°úÎìúÌïòÍ±∞ÎÇò Í∏∞Îë•Î≤àÌò∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }
                
                const coords = JSON.parse(currentCoords);
                if (Object.keys(coords).length === 0) {
                    alert('Ï†ÄÏû•Ìï† Í∏∞Îë•Î≤àÌò∏ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.\n\nÎ®ºÏ†Ä ÏóëÏÖÄÏùÑ ÏóÖÎ°úÎìúÌïòÍ±∞ÎÇò Í∏∞Îë•Î≤àÌò∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }
                
                // ÌòÑÏû¨ Ï¢åÌëú Îç∞Ïù¥ÌÑ∞Î•º Í∏∞Î≥∏Í∞íÏúºÎ°ú Ï†ÄÏû•
                localStorage.setItem('defaultColumnCoordinates', currentCoords);
                console.log('ÌòÑÏû¨ Í∏∞Îë•Î≤àÌò∏Î•º Í∏∞Î≥∏Í∞íÏúºÎ°ú Ï†ÄÏû• ÏôÑÎ£å:', coords);
                
                const count = Object.keys(coords).length;
                alert(`ÌòÑÏû¨ ${count}Í∞úÏùò Í∏∞Îë•Î≤àÌò∏Í∞Ä Í∏∞Î≥∏Í∞íÏúºÎ°ú Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.\n\nÎã§ÏùåÎ∂ÄÌÑ∞ Ï¥àÍ∏∞Ìôî Ïãú Ïù¥ ÏÑ§Ï†ïÏù¥ ÏÇ¨Ïö©Îê©ÎãàÎã§.`);
            } catch (error) {
                console.error('Í∏∞Î≥∏Í∞í Ï†ÄÏû• Ïò§Î•ò:', error);
                alert('Í∏∞Î≥∏Í∞í Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + (error.message || String(error)));
            }
        }

        // Í∏∞Î≥∏Í∞í Ï¢åÌëú Í∞ÄÏ†∏Ïò§Í∏∞ (Ï†ÄÏû•Îêú Í∏∞Î≥∏Í∞íÏù¥ ÏûàÏúºÎ©¥ ÏÇ¨Ïö©, ÏóÜÏúºÎ©¥ ÌïòÎìúÏΩîÎî©Îêú Í∏∞Î≥∏Í∞í)
        function getDefaultCoordinates() {
            // Ï†ÄÏû•Îêú Í∏∞Î≥∏Í∞í ÌôïÏù∏
            const savedDefault = localStorage.getItem('defaultColumnCoordinates');
            if (savedDefault) {
                try {
                    const coords = JSON.parse(savedDefault);
                    if (Object.keys(coords).length > 0) {
                        console.log('Ï†ÄÏû•Îêú Í∏∞Î≥∏Í∞í ÏÇ¨Ïö©:', coords);
                        return coords;
                    }
                } catch (e) {
                    console.warn('Ï†ÄÏû•Îêú Í∏∞Î≥∏Í∞í Î°úÎìú Ïã§Ìå®:', e);
                }
            }
            
            // ÌïòÎìúÏΩîÎî©Îêú Í∏∞Î≥∏Í∞í (Ï†ÄÏû•Îêú Í∏∞Î≥∏Í∞íÏù¥ ÏóÜÏùÑ ÎïåÎßå ÏÇ¨Ïö©)
            return {
                'KC1': { 
                    left: 0, 
                    top: 0, 
                    originalName: 'KC1',
                    no: 1
                },
                'KC2': { 
                    left: 0, 
                    top: 10000, 
                    originalName: 'KC2',
                    no: 2
                },
                'KC3': { 
                    left: 10000, 
                    top: 10000, 
                    originalName: 'KC3',
                    no: 3
                },
                'KC4': { 
                    left: 10000, 
                    top: 0, 
                    originalName: 'KC4',
                    no: 4
                },
                'KC2-2': { 
                    left: 3000, 
                    top: 3000, 
                    originalName: 'KC2',
                    no: 5
                },
                'KC3-2': { 
                    left: 6000, 
                    top: 6000, 
                    originalName: 'KC3',
                    no: 6
                }
            };
        }

        function initializeDefaultColumns() {
            // localStorageÏóê Ï†ÄÏû•Îêú Ï¢åÌëú Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏
            const savedCoords = localStorage.getItem('columnCoordinates');
            
            // Ïù¥ÎØ∏ Ï†ÄÏû•Îêú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏûàÏúºÎ©¥ Í∏∞Î≥∏Í∞í ÏÑ§Ï†ïÌïòÏßÄ ÏïäÏùå
            if (savedCoords) {
                try {
                    const coords = JSON.parse(savedCoords);
                    if (Object.keys(coords).length > 0) {
                        console.log('Í∏∞Ï°¥ Ï¢åÌëú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏûàÏäµÎãàÎã§. Í∏∞Î≥∏Í∞íÏùÑ ÏÑ§Ï†ïÌïòÏßÄ ÏïäÏäµÎãàÎã§.');
                        return;
                    }
                } catch (e) {
                    console.warn('Ï†ÄÏû•Îêú Ï¢åÌëú Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®:', e);
                }
            }
            
            // Í∏∞Î≥∏Í∞í Í∞ÄÏ†∏Ïò§Í∏∞ (Ï†ÄÏû•Îêú Í∏∞Î≥∏Í∞í ÎòêÎäî ÌïòÎìúÏΩîÎî©Îêú Í∏∞Î≥∏Í∞í)
            const defaultCoordinates = getDefaultCoordinates();
            
            // localStorageÏóê Ï¢åÌëú Ï†ïÎ≥¥ Ï†ÄÏû•
            localStorage.setItem('columnCoordinates', JSON.stringify(defaultCoordinates));
            console.log('Í∏∞Î≥∏Í∞í Í∏∞Îë• ÏÑ§Ï†ï ÏôÑÎ£å:', defaultCoordinates);
        }

        // Í∏∞Îë• Î©¥Ï†ÅÎ∞∞Î∂Ñ ÏûêÎèôÏÇ∞Ï†ï ÏùºÍ≥†Î¶¨Ï¶ò Î™®Îã¨ Ïó¥Í∏∞
        function openColumnPlanInput() {
            // Î™®Îã¨Ïù¥ Ïù¥ÎØ∏ Ï°¥Ïû¨ÌïòÎäîÏßÄ ÌôïÏù∏
            let modal = document.getElementById('columnPlanInputModal');
            if (!modal) {
                // Î™®Îã¨ HTML ÏÉùÏÑ±
                const modalHTML = `
                    <div id="columnPlanInputModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; overflow-y: auto;">
                        <div style="position: relative; max-width: 900px; margin: 50px auto; background: white; border-radius: 12px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); padding: 30px;">
                            <button onclick="closeColumnPlanInput()" style="position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 24px; color: #999; cursor: pointer; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;">&times;</button>
                            <h2 style="margin-bottom: 20px; color: #1e3a5f; font-size: 24px; text-align: center;">A.D.C Function</h2>
                            
                            <!-- ÏïàÎÇ¥ÏÑú Ìå®ÎÑê -->
                            <details style="margin-bottom: 20px; border: 2px solid #667eea; border-radius: 8px; background: linear-gradient(135deg, #f0f4ff 0%, #e8f4f8 100%);">
                                <summary style="cursor: pointer; padding: 15px 20px; font-size: 16px; font-weight: 600; color: #1e3a5f; user-select: none; list-style: none; display: flex; align-items: center; gap: 10px;">
                                    <span style="font-size: 20px;">üìñ</span>
                                    <span>Ïô∏Î∂ÄÏ¢åÌëú Ìò∏Ï∂ú ÏÇ¨Ïö©ÏïàÎÇ¥ÏÑú (User Guide for External Coordinate Extraction)</span>
                                    <span style="margin-left: auto; font-size: 12px; color: #667eea; font-weight: 500;">ÌÅ¥Î¶≠ÌïòÏó¨ ÌéºÏπòÍ∏∞</span>
                                </summary>
                                <div style="padding: 20px; background: white; border-top: 2px solid #667eea;">
                                    <div style="max-height: 500px; overflow-y: auto;">
                                        <!-- NOTE: AutoCAD Îç∞Ïù¥ÌÑ∞ Ï∂îÏ∂ú Ï†àÏ∞® (ÌïúÍ∏Ä/ÏòÅÎ¨∏) -->
                                        <div style="margin-bottom: 30px; background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 3px solid #f59e0b; border-radius: 8px; padding: 20px; box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);">
                                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                                                <span style="font-size: 28px;">üìã</span>
                                                <h3 style="margin: 0; color: #92400e; font-size: 20px; font-weight: 700; letter-spacing: 0.5px;">
                                                    NOTE
                                                </h3>
                                            </div>
                                            
                                            <!-- ÌïúÍ∏Ä Î≤ÑÏ†Ñ -->
                                            <div style="margin-bottom: 25px;">
                                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                                                    <span style="font-size: 18px; font-weight: 600; color: #92400e;">üá∞üá∑</span>
                                                    <h4 style="margin: 0; color: #78350f; font-size: 16px; font-weight: 600;">ÌïúÍ∏Ä Î≤ÑÏ†Ñ</h4>
                                                </div>
                                                <p style="margin: 0 0 15px 0; color: #78350f; font-size: 15px; font-weight: 600; line-height: 1.6;">
                                                    AutoCAD Í∏∞Îë•Î™Ö Î∞è Ï¢åÌëúÍ∞í ÏóëÏÖÄ Ï∂îÏ∂ú Ï†àÏ∞®
                                                </p>
                                                <div style="background: white; border-left: 4px solid #f59e0b; padding: 15px; border-radius: 4px;">
                                                    <ol style="margin: 0; padding-left: 20px; color: #78350f; line-height: 1.9; font-size: 14px;">
                                                        <li style="margin-bottom: 12px;">
                                                            <strong>Í∏∞Îë•ÏùÄ Î∏îÎ°ù(Block)ÏúºÎ°ú Ï†ïÏùòÎêòÏñ¥Ïïº ÌïòÎ©∞,</strong><br>
                                                            <span style="color: #92400e; font-size: 13px; margin-left: 10px;">
                                                            Í∞Å Í∏∞Îë• Î∏îÎ°ùÏóêÎäî Í∏∞Îë•Î™ÖÏùÑ ÎÇòÌÉÄÎÇ¥Îäî ÏÜçÏÑ±(Attribute)Ïù¥ Ìè¨Ìï®ÎêòÏñ¥Ïïº ÌïúÎã§<br>
                                                            (Ïòà: COLUMN_NAME = KC1, KC2, ‚Ä¶).
                                                            </span>
                                                        </li>
                                                        <li style="margin-bottom: 12px;">
                                                            <strong>DATAEXTRACTION Î™ÖÎ†πÏùÑ Ïã§ÌñâÌïòÏó¨</strong><br>
                                                            <span style="color: #92400e; font-size: 13px; margin-left: 10px;">
                                                            ÏÉàÎ°úÏö¥ Îç∞Ïù¥ÌÑ∞ Ï∂îÏ∂ú ÌååÏùº(*.dxe)ÏùÑ ÏÉùÏÑ±ÌïòÍ≥†, ÎèÑÎ©¥ ÎÇ¥ Í∏∞Îë• Î∏îÎ°ùÎßå ÏÑ†ÌÉùÌïúÎã§.
                                                            </span>
                                                        </li>
                                                        <li style="margin-bottom: 12px;">
                                                            <strong>Í∞ùÏ≤¥ Ïú†Ìòï ÏÑ†ÌÉù Îã®Í≥ÑÏóêÏÑú</strong><br>
                                                            <span style="color: #92400e; font-size: 13px; margin-left: 10px;">
                                                            <strong>Block Reference</strong>Îßå ÌôúÏÑ±ÌôîÌïòÍ≥†, Í∏∞ÌÉÄ Í∞ùÏ≤¥ Ïú†ÌòïÏùÄ Î™®Îëê ÎπÑÌôúÏÑ±ÌôîÌïúÎã§.
                                                            </span>
                                                        </li>
                                                        <li style="margin-bottom: 12px;">
                                                            <strong>Ï∂îÏ∂ú ÏÜçÏÑ± ÏÑ†ÌÉù Îã®Í≥ÑÏóêÏÑú Îã§Ïùå Ìï≠Î™©ÏùÑ Î∞òÎìúÏãú ÏÑ†ÌÉùÌïúÎã§.</strong><br>
                                                            <span style="color: #92400e; font-size: 13px; margin-left: 10px;">
                                                            ‚Ä¢ Block Name<br>
                                                            ‚Ä¢ Í∏∞Îë•Î™Ö ÏÜçÏÑ±(Attribute, Ïòà: COLUMN_NAME)<br>
                                                            ‚Ä¢ Position X, Position Y (Position ZÎäî ÏÑ†ÌÉùÏÇ¨Ìï≠Ïù¥Î©∞, ÏãúÏä§ÌÖúÏóêÏÑúÎäî X, YÎßå ÏÇ¨Ïö©)
                                                            </span>
                                                        </li>
                                                        <li style="margin-bottom: 12px;">
                                                            <strong>"ÎèôÏùº Ìñâ Í≤∞Ìï©(Combine identical rows)" ÏòµÏÖòÏùÄ Ìï¥Ï†úÌïòÏó¨</strong><br>
                                                            <span style="color: #92400e; font-size: 13px; margin-left: 10px;">
                                                            Í∏∞Îë• 1Í∞úÎãπ 1ÌñâÏù¥ ÏÉùÏÑ±ÎêòÎèÑÎ°ù ÏÑ§Ï†ïÌïúÎã§.
                                                            </span>
                                                        </li>
                                                        <li style="margin-bottom: 12px;">
                                                            <strong>Ï∂îÏ∂ú Í≤∞Í≥ºÎäî</strong><br>
                                                            <span style="color: #92400e; font-size: 13px; margin-left: 10px;">
                                                            <strong>Excel(.xlsx)</strong> ÌòïÏãùÏùò Ïô∏Î∂Ä ÌååÏùºÎ°ú Ï∂úÎ†•ÌïúÎã§.<br>
                                                            <span style="color: #dc2626; font-weight: 600;">‚Äª Ïù¥ ÏãúÏä§ÌÖúÏùÄ Excel(.xlsx, .xls) ÌååÏùºÎßå ÏßÄÏõêÌï©ÎãàÎã§. CSV ÌòïÏãùÏùÄ ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÏäµÎãàÎã§.</span>
                                                            </span>
                                                        </li>
                                                        <li style="margin-bottom: 0;">
                                                            <strong>ÏµúÏ¢Ö ÏóëÏÖÄ ÌååÏùºÏóêÎäî</strong><br>
                                                            <span style="color: #92400e; font-size: 13px; margin-left: 10px;">
                                                            Í∞Å Í∏∞Îë•Ïùò Ïù¥Î¶ÑÍ≥º Ï†àÎåÄÏ¢åÌëú(X, Y, Z)Í∞Ä Ìñâ Îã®ÏúÑÎ°ú Ï†ïÎ¶¨ÎêòÏñ¥ Ï∂úÎ†•ÎêúÎã§.<br>
                                                            <span style="color: #dc2626; font-weight: 600;">‚Äª Ïù¥ ÏãúÏä§ÌÖúÏùÄ ÌèâÎ©¥ÎèÑÏù¥ÎØÄÎ°ú X, Y Ï¢åÌëúÎßå ÏÇ¨Ïö©ÎêòÎ©∞, Z Ï¢åÌëúÎäî ÏûêÎèôÏúºÎ°ú Î¨¥ÏãúÎê©ÎãàÎã§.</span>
                                                            </span>
                                                        </li>
                                                    </ol>
                                                </div>
                                            </div>
                                            
                                            <!-- ÏòÅÎ¨∏ Î≤ÑÏ†Ñ -->
                                            <div style="border-top: 2px solid #fbbf24; padding-top: 25px;">
                                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                                                    <span style="font-size: 18px; font-weight: 600; color: #92400e;">üá∫üá∏</span>
                                                    <h4 style="margin: 0; color: #78350f; font-size: 16px; font-weight: 600;">English Version</h4>
                                                </div>
                                                <p style="margin: 0 0 15px 0; color: #78350f; font-size: 15px; font-weight: 600; line-height: 1.6;">
                                                    Procedure for Extracting Column Name and Coordinates from AutoCAD to Excel
                                                </p>
                                                <div style="background: white; border-left: 4px solid #f59e0b; padding: 15px; border-radius: 4px;">
                                                    <ol style="margin: 0; padding-left: 20px; color: #78350f; line-height: 1.9; font-size: 14px;">
                                                        <li style="margin-bottom: 12px;">
                                                            <strong>Column objects shall be defined as Blocks.</strong><br>
                                                            <span style="color: #92400e; font-size: 13px; margin-left: 10px;">
                                                            Each column block shall include an Attribute representing the column name (e.g., COLUMN_NAME = KC1, KC2, ‚Ä¶).
                                                            </span>
                                                        </li>
                                                        <li style="margin-bottom: 12px;">
                                                            <strong>Execute the DATAEXTRACTION command.</strong><br>
                                                            <span style="color: #92400e; font-size: 13px; margin-left: 10px;">
                                                            Create a new data extraction file (*.dxe) and select only column blocks in the drawing.
                                                            </span>
                                                        </li>
                                                        <li style="margin-bottom: 12px;">
                                                            <strong>Filter the object type.</strong><br>
                                                            <span style="color: #92400e; font-size: 13px; margin-left: 10px;">
                                                            In the object selection stage, enable <strong>Block Reference</strong> only.
                                                            </span>
                                                        </li>
                                                        <li style="margin-bottom: 12px;">
                                                            <strong>Select extraction properties.</strong><br>
                                                            <span style="color: #92400e; font-size: 13px; margin-left: 10px;">
                                                            The following properties shall be checked:<br>
                                                            ‚Ä¢ Block Name<br>
                                                            ‚Ä¢ Column Name Attribute (e.g., COLUMN_NAME)<br>
                                                            ‚Ä¢ Position X, Position Y (Position Z is optional; only X, Y are used in this system)
                                                            </span>
                                                        </li>
                                                        <li style="margin-bottom: 12px;">
                                                            <strong>Disable row combination.</strong><br>
                                                            <span style="color: #92400e; font-size: 13px; margin-left: 10px;">
                                                            The option <strong>"Combine identical rows"</strong> shall be turned <strong>OFF</strong> to ensure one row per column.
                                                            </span>
                                                        </li>
                                                        <li style="margin-bottom: 12px;">
                                                            <strong>Export the data.</strong><br>
                                                            <span style="color: #92400e; font-size: 13px; margin-left: 10px;">
                                                            Output the extracted data to an external file in <strong>Excel (.xlsx)</strong> format.<br>
                                                            <span style="color: #dc2626; font-weight: 600;">‚Äª This system only supports Excel (.xlsx, .xls) files. CSV format is not supported.</span>
                                                            </span>
                                                        </li>
                                                        <li style="margin-bottom: 0;">
                                                            <strong>Result.</strong><br>
                                                            <span style="color: #92400e; font-size: 13px; margin-left: 10px;">
                                                            The exported Excel file shall contain one row per column, including the column name and its global coordinates.<br>
                                                            <span style="color: #dc2626; font-weight: 600;">‚Äª This system is for 2D plan views, so only X, Y coordinates are used; Z coordinate is automatically ignored.</span>
                                                            </span>
                                                        </li>
                                                    </ol>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- ÏµúÏ¢Ö ÏóëÏÖÄ Í≤∞Í≥º ÏòàÏãú -->
                                        <div style="margin-bottom: 30px; background: #f0f9ff; border: 2px solid #0ea5e9; border-radius: 8px; padding: 20px;">
                                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                                                <span style="font-size: 24px; font-weight: 700; color: #0ea5e9; background: white; width: 32px; height: 32px; border-radius: 6px; display: flex; align-items: center; justify-content: center;">‚ëß</span>
                                                <h3 style="margin: 0; color: #0c4a6e; font-size: 18px; font-weight: 700;">
                                                    ÏµúÏ¢Ö ÏóëÏÖÄ Í≤∞Í≥º ÏòàÏãú
                                                </h3>
                                            </div>
                                            <div style="background: white; border: 1px solid #bae6fd; border-radius: 6px; padding: 15px; margin-bottom: 12px;">
                                                <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                                                    <thead>
                                                        <tr style="background: #0ea5e9; color: white;">
                                                            <th style="padding: 10px; border: 1px solid #0284c7; text-align: center; font-weight: 600;">Block Name</th>
                                                            <th style="padding: 10px; border: 1px solid #0284c7; text-align: center; font-weight: 600;">COLUMN_NAME</th>
                                                            <th style="padding: 10px; border: 1px solid #0284c7; text-align: center; font-weight: 600;">X</th>
                                                            <th style="padding: 10px; border: 1px solid #0284c7; text-align: center; font-weight: 600;">Y</th>
                                                            <th style="padding: 10px; border: 1px solid #0284c7; text-align: center; font-weight: 600;">Z</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr>
                                                            <td style="padding: 10px; border: 1px solid #e2e8f0; text-align: center; background: white;">COLUMN</td>
                                                            <td style="padding: 10px; border: 1px solid #e2e8f0; text-align: center; background: white; font-weight: 600;">KC1</td>
                                                            <td style="padding: 10px; border: 1px solid #e2e8f0; text-align: center; background: white;">12500</td>
                                                            <td style="padding: 10px; border: 1px solid #e2e8f0; text-align: center; background: white;">3200</td>
                                                            <td style="padding: 10px; border: 1px solid #e2e8f0; text-align: center; background: white; color: #94a3b8;">0</td>
                                                        </tr>
                                                        <tr>
                                                            <td style="padding: 10px; border: 1px solid #e2e8f0; text-align: center; background: white;">COLUMN</td>
                                                            <td style="padding: 10px; border: 1px solid #e2e8f0; text-align: center; background: white; font-weight: 600;">KC2</td>
                                                            <td style="padding: 10px; border: 1px solid #e2e8f0; text-align: center; background: white;">13500</td>
                                                            <td style="padding: 10px; border: 1px solid #e2e8f0; text-align: center; background: white;">3200</td>
                                                            <td style="padding: 10px; border: 1px solid #e2e8f0; text-align: center; background: white; color: #94a3b8;">0</td>
                                                        </tr>
                                                        <tr>
                                                            <td style="padding: 10px; border: 1px solid #e2e8f0; text-align: center; background: white;">COLUMN</td>
                                                            <td style="padding: 10px; border: 1px solid #e2e8f0; text-align: center; background: white; font-weight: 600;">KC3</td>
                                                            <td style="padding: 10px; border: 1px solid #e2e8f0; text-align: center; background: white;">14500</td>
                                                            <td style="padding: 10px; border: 1px solid #e2e8f0; text-align: center; background: white;">3200</td>
                                                            <td style="padding: 10px; border: 1px solid #e2e8f0; text-align: center; background: white; color: #94a3b8;">0</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                            <div style="background: #e0f2fe; border-left: 4px solid #0ea5e9; padding: 12px; border-radius: 4px;">
                                                <p style="margin: 0; color: #075985; font-size: 12px; line-height: 1.6;">
                                                    <strong>üí° Ï∞∏Í≥†:</strong><br>
                                                    ‚Ä¢ AutoCADÏóêÏÑú Ï∂îÏ∂úÌïú ÏóëÏÖÄ ÌååÏùºÏùÄ ÏúÑÏôÄ Í∞ôÏùÄ ÌòïÏãùÏûÖÎãàÎã§.<br>
                                                    ‚Ä¢ <strong>COLUMN_NAME</strong> Ïª¨ÎüºÏùò Í∞í(KC1, KC2, KC3)Ïù¥ Í∏∞Îë•Î≤àÌò∏Î°ú Ïù∏ÏãùÎê©ÎãàÎã§.<br>
                                                    ‚Ä¢ <strong>X, Y</strong> Ï¢åÌëúÎßå ÏÇ¨Ïö©ÎêòÎ©∞, <strong>Z</strong> Ï¢åÌëúÎäî ÏûêÎèôÏúºÎ°ú Î¨¥ÏãúÎê©ÎãàÎã§.<br>
                                                    ‚Ä¢ <strong>Block Name</strong> Ïª¨ÎüºÏùÄ ÏÑ†ÌÉùÏÇ¨Ìï≠Ïù¥Î©∞, Í∏∞Îë•Î≤àÌò∏ Ïù∏ÏãùÏóê ÏÇ¨Ïö©ÎêòÏßÄ ÏïäÏäµÎãàÎã§.
                                                </p>
                                            </div>
                                        </div>
                                        
                                        <!-- 1. Í∏∞Î≥∏ ÏÇ¨Ïö©Î≤ï -->
                                        <div style="margin-bottom: 25px;">
                                            <h3 style="color: #1e3a5f; font-size: 18px; font-weight: 600; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 2px solid #667eea; display: flex; align-items: center; gap: 8px;">
                                                <span>1Ô∏è‚É£</span> Í∏∞Î≥∏ ÏÇ¨Ïö©Î≤ï
                                            </h3>
                                            <ol style="margin: 0; padding-left: 20px; color: #4a5568; line-height: 1.8; font-size: 14px;">
                                                <li style="margin-bottom: 8px;"><strong>ÏóëÏÖÄ Îã§Ïö¥Î°úÎìú</strong> Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ Í∏∞Î≥∏ ÌÖúÌîåÎ¶øÏùÑ Îã§Ïö¥Î°úÎìúÌï©ÎãàÎã§.</li>
                                                <li style="margin-bottom: 8px;">ÏóëÏÖÄ ÌååÏùºÏóê <strong>Í∏∞Îë•Î≤àÌò∏</strong>ÏôÄ <strong>X, Y Ï¢åÌëú</strong>Î•º ÏûÖÎ†•Ìï©ÎãàÎã§.</li>
                                                <li style="margin-bottom: 8px;"><strong>ÏóëÏÖÄ ÏóÖÎ°úÎìú</strong> Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ ÌååÏùºÏùÑ ÏóÖÎ°úÎìúÌï©ÎãàÎã§.</li>
                                                <li style="margin-bottom: 8px;">ÏÉÅÎã®Ïùò <strong>Ï¢åÌëú ÏãúÍ∞ÅÌôî</strong> ÎßµÏóêÏÑú Í∏∞Îë• ÏúÑÏπòÎ•º ÌôïÏù∏Ìï©ÎãàÎã§.</li>
                                                <li style="margin-bottom: 8px;">Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏûàÎã§Î©¥ <strong>Í∏∞Îë•ÌèâÎ©¥ÎèÑ Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú</strong>Î•º ÌÜµÌï¥ Ïù¥ÎØ∏ÏßÄ ÏúÑÏóê ÎßàÏª§Î•º ÌëúÏãúÌï† Ïàò ÏûàÏäµÎãàÎã§.</li>
                                            </ol>
                                        </div>
                                        
                                        <!-- 2. ÏóëÏÖÄ ÌòïÏãù -->
                                        <div style="margin-bottom: 25px;">
                                            <h3 style="color: #1e3a5f; font-size: 18px; font-weight: 600; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 2px solid #667eea; display: flex; align-items: center; gap: 8px;">
                                                <span>2Ô∏è‚É£</span> ÏóëÏÖÄ ÌååÏùº ÌòïÏãù
                                            </h3>
                                            <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px; padding: 15px; margin-bottom: 12px;">
                                                <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                                                    <thead>
                                                        <tr style="background: #667eea; color: white;">
                                                            <th style="padding: 10px; border: 1px solid #5568d3; text-align: center; font-weight: 600;">No.</th>
                                                            <th style="padding: 10px; border: 1px solid #5568d3; text-align: center; font-weight: 600;">Í∏∞Îë•Î≤àÌò∏</th>
                                                            <th style="padding: 10px; border: 1px solid #5568d3; text-align: center; font-weight: 600;">X Ï¢åÌëú(%)</th>
                                                            <th style="padding: 10px; border: 1px solid #5568d3; text-align: center; font-weight: 600;">Y Ï¢åÌëú(%)</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr>
                                                            <td style="padding: 10px; border: 1px solid #e2e8f0; text-align: center; background: white;">1</td>
                                                            <td style="padding: 10px; border: 1px solid #e2e8f0; text-align: center; background: white; font-weight: 600;">KC1</td>
                                                            <td style="padding: 10px; border: 1px solid #e2e8f0; text-align: center; background: white;">0</td>
                                                            <td style="padding: 10px; border: 1px solid #e2e8f0; text-align: center; background: white;">0</td>
                                                        </tr>
                                                        <tr>
                                                            <td style="padding: 10px; border: 1px solid #e2e8f0; text-align: center; background: white;">2</td>
                                                            <td style="padding: 10px; border: 1px solid #e2e8f0; text-align: center; background: white; font-weight: 600;">KC2</td>
                                                            <td style="padding: 10px; border: 1px solid #e2e8f0; text-align: center; background: white;">0</td>
                                                            <td style="padding: 10px; border: 1px solid #e2e8f0; text-align: center; background: white;">10000</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                            <div style="background: #fff5e6; border-left: 4px solid #f59e0b; padding: 12px; border-radius: 4px; margin-top: 12px;">
                                                <p style="margin: 0; color: #92400e; font-size: 13px; line-height: 1.6;">
                                                    <strong>üí° Ï∞∏Í≥†:</strong><br>
                                                    ‚Ä¢ Ïª¨ÎüºÎ™ÖÏùÄ <strong>"Í∏∞Îë•Î≤àÌò∏"</strong>, <strong>"Auto Name"</strong>, <strong>"Name"</strong> Îì±ÏúºÎ°ú Ïù∏ÏãùÎê©ÎãàÎã§.<br>
                                                    ‚Ä¢ X, Y Ï¢åÌëúÎäî <strong>ÌçºÏÑºÌä∏(0-100)</strong> ÎòêÎäî <strong>ÌôïÏû•Í∞í(0-10000)</strong>ÏúºÎ°ú ÏûÖÎ†• Í∞ÄÎä•Ìï©ÎãàÎã§.<br>
                                                    ‚Ä¢ Ï¢åÌëúÍ∞Ä ÏóÜÏúºÎ©¥ Í∏∞Î≥∏Í∞í(0, 0)ÏúºÎ°ú ÏÑ§Ï†ïÎê©ÎãàÎã§.
                                                </p>
                                            </div>
                                        </div>
                                        
                                        <!-- 3. Ï¢åÌëú ÏãúÍ∞ÅÌôî -->
                                        <div style="margin-bottom: 25px;">
                                            <h3 style="color: #1e3a5f; font-size: 18px; font-weight: 600; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 2px solid #667eea; display: flex; align-items: center; gap: 8px;">
                                                <span>3Ô∏è‚É£</span> Ï¢åÌëú ÏãúÍ∞ÅÌôî Îßµ
                                            </h3>
                                            <ul style="margin: 0; padding-left: 20px; color: #4a5568; line-height: 1.8; font-size: 14px;">
                                                <li style="margin-bottom: 8px;">ÏóëÏÖÄ ÏóÖÎ°úÎìú ÌõÑ <strong>Ï¢åÌëú ÏãúÍ∞ÅÌôî</strong> ÎßµÏóê Í∏∞Îë• ÏúÑÏπòÍ∞Ä ÏûêÎèôÏúºÎ°ú ÌëúÏãúÎê©ÎãàÎã§.</li>
                                                <li style="margin-bottom: 8px;">Îπ®Í∞Ñ ÏõêÌòï ÎßàÏª§Îäî Í∏∞Îë• ÏúÑÏπòÎ•º ÎÇòÌÉÄÎÉÖÎãàÎã§.</li>
                                                <li style="margin-bottom: 8px;">ÎßàÏª§ ÏúÑÏùò Í≤ÄÏùÄ ÎùºÎ≤®Ïóê Í∏∞Îë•Î≤àÌò∏Í∞Ä ÌëúÏãúÎê©ÎãàÎã§.</li>
                                                <li style="margin-bottom: 8px;">Îßµ ÌïòÎã®Ïóê ÌòÑÏû¨ Ï¢åÌëú Î≤îÏúÑÍ∞Ä ÌëúÏãúÎê©ÎãàÎã§.</li>
                                                <li style="margin-bottom: 8px;">Ï¢åÌëúÍ∞íÏóê Îî∞Îùº ÏûêÎèôÏúºÎ°ú ÌôïÎåÄ/Ï∂ïÏÜåÎêòÏñ¥ ÌëúÏãúÎê©ÎãàÎã§.</li>
                                            </ul>
                                        </div>
                                        
                                        <!-- 4. AutoCADÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Ï∂îÏ∂ú -->
                                        <div style="margin-bottom: 25px;">
                                            <h3 style="color: #1e3a5f; font-size: 18px; font-weight: 600; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 2px solid #667eea; display: flex; align-items: center; gap: 8px;">
                                                <span>üìê</span> AutoCADÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Ï∂îÏ∂úÌïòÍ∏∞
                                            </h3>
                                            <div style="background: #e0f2fe; border-left: 4px solid #0ea5e9; padding: 15px; border-radius: 4px;">
                                                <p style="margin: 0; color: #0c4a6e; font-size: 14px; line-height: 1.8;">
                                                    AutoCADÏóêÏÑú Îç∞Ïù¥ÌÑ∞Î•º Ï∂îÏ∂úÌïòÎäî ÏûêÏÑ∏Ìïú Ï†àÏ∞®Îäî ÏúÑÏùò <strong style="color: #075985;">NOTE ÏÑπÏÖò</strong>ÏùÑ Ï∞∏Í≥†ÌïòÏÑ∏Ïöî.<br>
                                                    DATAEXTRACTION Î™ÖÎ†πÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ Í∏∞Îë• Î∏îÎ°ùÏùò Ïù¥Î¶ÑÍ≥º Ï¢åÌëúÎ•º Excel ÌååÏùºÎ°ú ÎÇ¥Î≥¥ÎÇº Ïàò ÏûàÏäµÎãàÎã§.
                                                </p>
                                            </div>
                                        </div>
                                        
                                        <!-- 5. Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú -->
                                        <div style="margin-bottom: 25px;">
                                            <h3 style="color: #1e3a5f; font-size: 18px; font-weight: 600; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 2px solid #667eea; display: flex; align-items: center; gap: 8px;">
                                                <span>5Ô∏è‚É£</span> Í∏∞Îë•ÌèâÎ©¥ÎèÑ Ïù¥ÎØ∏ÏßÄ (ÏÑ†ÌÉùÏÇ¨Ìï≠)
                                            </h3>
                                            <ul style="margin: 0; padding-left: 20px; color: #4a5568; line-height: 1.8; font-size: 14px;">
                                                <li style="margin-bottom: 8px;">Ïã§Ï†ú Í±¥Î¨ºÏùò Í∏∞Îë•ÌèâÎ©¥ÎèÑ Ïù¥ÎØ∏ÏßÄÎ•º ÏóÖÎ°úÎìúÌï† Ïàò ÏûàÏäµÎãàÎã§.</li>
                                                <li style="margin-bottom: 8px;">Ïù¥ÎØ∏ÏßÄ ÏúÑÏóê Í∏∞Îë• ÏúÑÏπòÍ∞Ä Îπ®Í∞Ñ ÎßàÏª§Î°ú ÌëúÏãúÎê©ÎãàÎã§.</li>
                                                <li style="margin-bottom: 8px;">Ïù¥ÎØ∏ÏßÄ ÏóÜÏù¥ÎèÑ Ï¢åÌëú ÏãúÍ∞ÅÌôî ÎßµÏúºÎ°ú Ï∂©Î∂ÑÌûà ÌôïÏù∏ Í∞ÄÎä•Ìï©ÎãàÎã§.</li>
                                                <li style="margin-bottom: 8px;">ÏßÄÏõê ÌòïÏãù: JPG, PNG, GIF Îì± ÏùºÎ∞ò Ïù¥ÎØ∏ÏßÄ ÌååÏùº</li>
                                            </ul>
                                        </div>
                                        
                                        <!-- 6. Í∏∞Îë• ÏÉÅÌÉú ÌôïÏù∏ -->
                                        <div style="margin-bottom: 25px;">
                                            <h3 style="color: #1e3a5f; font-size: 18px; font-weight: 600; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 2px solid #667eea; display: flex; align-items: center; gap: 8px;">
                                                <span>5Ô∏è‚É£</span> Í∏∞Îë• ÏÉÅÌÉú ÌôïÏù∏
                                            </h3>
                                            <ul style="margin: 0; padding-left: 20px; color: #4a5568; line-height: 1.8; font-size: 14px;">
                                                <li style="margin-bottom: 8px;"><strong>Í∏∞Îë• Í∞úÏàò</strong>: ÌòÑÏû¨ Î°úÎìúÎêú Í∏∞Îë•Ïùò Ï¥ù Í∞úÏàòÍ∞Ä ÌëúÏãúÎê©ÎãàÎã§.</li>
                                                <li style="margin-bottom: 8px;"><strong>Í∏∞Îë• Î™©Î°ù</strong>: Í∏∞Îë•Î≤àÌò∏ÏôÄ X, Y Ï¢åÌëúÎ•º ÌÖåÏù¥Î∏îÎ°ú ÌôïÏù∏Ìï† Ïàò ÏûàÏäµÎãàÎã§.</li>
                                                <li style="margin-bottom: 8px;">ÏóëÏÖÄ ÏóÖÎ°úÎìú ÌõÑ Ï¶âÏãú ÏóÖÎç∞Ïù¥Ìä∏Îê©ÎãàÎã§.</li>
                                            </ul>
                                        </div>
                                        
                                        <!-- 7. Ï£ºÏùòÏÇ¨Ìï≠ -->
                                        <div style="margin-bottom: 0;">
                                            <h3 style="color: #1e3a5f; font-size: 18px; font-weight: 600; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 2px solid #667eea; display: flex; align-items: center; gap: 8px;">
                                                <span>‚ö†Ô∏è</span> Ï£ºÏùòÏÇ¨Ìï≠
                                            </h3>
                                            <div style="background: #fee2e2; border-left: 4px solid #ef4444; padding: 12px; border-radius: 4px;">
                                                <ul style="margin: 0; padding-left: 20px; color: #991b1b; line-height: 1.8; font-size: 13px;">
                                                    <li style="margin-bottom: 6px;">ÏóëÏÖÄ ÌååÏùºÏùò Ï≤´ Î≤àÏß∏ ÌñâÏùÄ Ìó§Îçî(Ïª¨ÎüºÎ™Ö)Ïó¨Ïïº Ìï©ÎãàÎã§.</li>
                                                    <li style="margin-bottom: 6px;">Í∏∞Îë•Î≤àÌò∏Îäî Ï§ëÎ≥µÎêòÏßÄ ÏïäÎèÑÎ°ù Ï£ºÏùòÌïòÏÑ∏Ïöî.</li>
                                                    <li style="margin-bottom: 6px;">Ï¢åÌëúÍ∞íÏùÄ Ïà´ÏûêÎßå ÏûÖÎ†•ÌïòÏÑ∏Ïöî (ÌÖçÏä§Ìä∏ ÏûÖÎ†• Ïãú Î¨¥ÏãúÎê©ÎãàÎã§).</li>
                                                    <li style="margin-bottom: 6px;">ÏóëÏÖÄ ÌååÏùºÏùÑ ÏàòÏ†ïÌïú ÌõÑ Îã§Ïãú ÏóÖÎ°úÎìúÌïòÎ©¥ Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞Í∞Ä ÎçÆÏñ¥ÏîåÏõåÏßëÎãàÎã§.</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </details>
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; color: #4a5568; font-weight: 600; font-size: 16px;">üìç Ï¢åÌëú ÏãúÍ∞ÅÌôî</label>
                                <div style="border: 2px solid #e2e8f0; border-radius: 8px; padding: 15px; background: #f9fafb; margin-bottom: 10px;">
                                    <div id="columnMapView" style="width: 100%; height: 400px; background: white; border: 1px solid #cbd5e0; border-radius: 6px; position: relative; overflow: hidden;">
                                        <canvas id="columnMapCanvas" style="width: 100%; height: 100%; display: block;"></canvas>
                                        <div id="columnMapMarkers" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 5;"></div>
                                    </div>
                                    <p style="margin: 10px 0 0 0; color: #718096; font-size: 11px; text-align: center;">
                                        <span style="color: #667eea; font-weight: 600;">‚Äª</span> ÏóëÏÖÄÏùÑ ÏóÖÎ°úÎìúÌïòÎ©¥ Ï¢åÌëúÍ∞Ä ÏûêÎèôÏúºÎ°ú ÌëúÏãúÎê©ÎãàÎã§.
                                    </p>
                                </div>
                                <details style="margin-top: 10px;">
                                    <summary style="cursor: pointer; color: #718096; font-size: 13px; user-select: none; padding: 8px; border: 1px solid #e2e8f0; border-radius: 4px; background: #f7fafc;">
                                        üì∑ Í∏∞Îë•ÌèâÎ©¥ÎèÑ Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú (ÏÑ†ÌÉùÏÇ¨Ìï≠)
                                    </summary>
                                    <div style="border: 2px dashed #cbd5e0; border-radius: 8px; padding: 20px; text-align: center; background: #f7fafc; margin-top: 10px;">
                                        <input type="file" id="columnPlanFile" accept="image/*" style="display: none;" onchange="handleColumnPlanFile(this)">
                                        <button onclick="document.getElementById('columnPlanFile').click()" style="background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 14px;">Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú</button>
                                        <p id="columnPlanFileName" style="margin-top: 10px; color: #718096; font-size: 12px;"></p>
                                        <div id="columnPlanPreview" style="margin-top: 15px; display: none; position: relative;">
                                            <div style="position: relative; display: inline-block;">
                                                <img id="columnPlanImage" src="" alt="Í∏∞Îë•ÌèâÎ©¥ÎèÑ ÎØ∏Î¶¨Î≥¥Í∏∞" style="max-width: 100%; max-height: 400px; border-radius: 4px; display: block;">
                                                <div id="columnMarkers" style="position: absolute; top: 0; left: 0; pointer-events: none; z-index: 5;"></div>
                                            </div>
                                        </div>
                                    </div>
                                </details>
                            </div>
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 12px; color: #4a5568; font-weight: 600; font-size: 16px;">Í∏∞Îë•Î≤àÌò∏ Î∞è Ï¢åÌëú ÏûÖÎ†• (ÏóëÏÖÄ)</label>
                                <div style="background: #f7fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 20px; margin-bottom: 15px;">
                                    <div style="display: flex; gap: 10px; margin-bottom: 15px; justify-content: center; flex-wrap: wrap;">
                                        <button onclick="exportColumnNumbersToExcel()" style="padding: 12px 24px; background: #38a169; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600; transition: background 0.2s;">
                                            üì• ÏóëÏÖÄ Îã§Ïö¥Î°úÎìú
                                        </button>
                                        <button onclick="exportColumnNumbersToCSV()" style="padding: 12px 24px; background: #10b981; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600; transition: background 0.2s;">
                                            üìÑ CSV Îã§Ïö¥Î°úÎìú
                                        </button>
                                        <label for="columnNumberExcelInput" style="padding: 12px 24px; background: #f59e0b; color: white; border-radius: 6px; cursor: pointer; font-size: 14px; display: inline-block; font-weight: 600; transition: background 0.2s;">
                                            üèóÔ∏è ÏóëÏÖÄ ÏóÖÎ°úÎìú (Í∏∞Îë•Î≤àÌò∏ + Ï¢åÌëú)
                                        </label>
                                        <button onclick="saveCurrentAsDefault()" style="padding: 12px 24px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600; transition: background 0.2s;">
                                            üíæ Í∏∞Î≥∏Í∞íÏúºÎ°ú Ï†ÄÏû•
                                        </button>
                                    </div>
                                    <input type="file" id="columnNumberExcelInput" accept=".xlsx,.xls" style="display: none;" onchange="importColumnNumbersFromExcel(event)">
                                    <div id="columnStatusInfo" style="margin-top: 15px; padding: 15px; background: #e8f4f8; border-radius: 6px; border-left: 4px solid #667eea;">
                                        <p id="columnCountDisplay" style="margin: 0 0 12px 0; color: #1e3a5f; font-size: 14px; font-weight: 600;">
                                            üìä ÌòÑÏû¨ Í∏∞Îë• Í∞úÏàò: <span id="columnCountValue" style="color: #667eea; font-size: 16px;">0</span>Í∞ú
                                        </p>
                                        <div id="columnListDisplay" style="max-height: 150px; overflow-y: auto; background: white; border-radius: 4px; padding: 10px; border: 1px solid #cbd5e0;">
                                            <p style="margin: 0; color: #718096; font-size: 12px; text-align: center;" id="columnListText">ÏóëÏÖÄÏùÑ ÏóÖÎ°úÎìúÌïòÎ©¥ Í∏∞Îë• Î™©Î°ùÏù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§.</p>
                                        </div>
                                        <div style="margin-top: 15px; padding-top: 15px; border-top: 2px solid #cbd5e0;">
                                            <div style="margin-bottom: 12px;">
                                                <label style="display: block; margin-bottom: 8px; color: #4a5568; font-weight: 600; font-size: 13px;">
                                                    üìç Í≤ΩÍ≥Ñ Í∏∞Îë• ÏÑ†ÌÉù (4Í∞ú)
                                                </label>
                                                <div id="boundaryColumnSelector" style="max-height: 120px; overflow-y: auto; background: white; border: 1px solid #cbd5e0; border-radius: 4px; padding: 8px; font-size: 11px;">
                                                    <p style="margin: 0; color: #718096; text-align: center; font-size: 11px;">ÏóëÏÖÄÏùÑ ÏóÖÎ°úÎìúÌïòÎ©¥ Í∏∞Îë• Î™©Î°ùÏù¥ ÌëúÏãúÎê©ÎãàÎã§.</p>
                                                </div>
                                                <div style="margin-top: 8px; font-size: 10px; color: #718096;">
                                                    ÏÑ†ÌÉùÎêú Í≤ΩÍ≥Ñ Í∏∞Îë•: <span id="selectedBoundaryCount" style="color: #667eea; font-weight: 600;">0</span>/4
                                                </div>
                                            </div>
                                            <button onclick="calculateColumnAreaDistribution()" style="width: 100%; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);">
                                                üìê Î©¥Ï†ÅÎ∂ÑÎã¥Ïú® Í≥ÑÏÇ∞
                                            </button>
                                        </div>
                                        <div id="areaDistributionResult" style="margin-top: 15px; display: none; background: white; border-radius: 4px; padding: 15px; border: 1px solid #cbd5e0;">
                                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                                <h4 style="margin: 0; color: #1e3a5f; font-size: 14px; font-weight: 600;">Î©¥Ï†ÅÎ∂ÑÎã¥Ïú® Í≤∞Í≥º</h4>
                                                <button onclick="exportAreaDistributionToExcel()" style="padding: 6px 12px; background: #10b981; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: 600; display: flex; align-items: center; gap: 4px;">
                                                    üì• ÏóëÏÖÄ Ï†ÄÏû•
                                                </button>
                                            </div>
                                            <div id="areaDistributionTable" style="max-height: 200px; overflow-y: auto;"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div style="display: flex; gap: 10px; justify-content: center; margin-top: 30px;">
                                <button onclick="saveColumnPlanInput()" style="background: #667eea; color: white; border: none; padding: 12px 30px; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: 600;">Ï†ÄÏû•</button>
                                <button onclick="closeColumnPlanInput()" style="background: #e2e8f0; color: #4a5568; border: none; padding: 12px 30px; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: 600;">Ï∑®ÏÜå</button>
                            </div>
                        </div>
                    </div>
                `;
                document.body.insertAdjacentHTML('beforeend', modalHTML);
                modal = document.getElementById('columnPlanInputModal');
                
                // Î™®Îã¨ ÏÉùÏÑ± ÌõÑ Í∏∞Î≥∏Í∞í Ï¥àÍ∏∞Ìôî
                initializeDefaultColumns();
                
                // Ï†ÄÏû•Îêú Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏûàÏúºÎ©¥ Î°úÎìú
                try {
                    const savedData = localStorage.getItem('columnPlanInputData');
                    if (savedData) {
                        const data = JSON.parse(savedData);
                        if (data.imageData) {
                            const preview = document.getElementById('columnPlanPreview');
                            const img = document.getElementById('columnPlanImage');
                            const fileName = document.getElementById('columnPlanFileName');
                            if (img && preview) {
                                img.src = data.imageData;
                                preview.style.display = 'block';
                                if (fileName && data.fileName) {
                                    fileName.textContent = data.fileName;
                                }
                                // Ïù¥ÎØ∏ÏßÄ Î°úÎìú ÌõÑ ÎßàÏª§ ÌëúÏãú
                                img.onload = function() {
                                    setTimeout(function() {
                                        console.log('Ï†ÄÏû•Îêú Ïù¥ÎØ∏ÏßÄ Î°úÎìú ÏôÑÎ£å, ÎßàÏª§ Í∑∏Î¶¨Í∏∞ ÏãúÎèÑ');
                                        renderColumnMarkers();
                                    }, 300);
                                };
                                if (img.complete && img.naturalWidth > 0) {
                                    setTimeout(function() {
                                        console.log('Ï†ÄÏû•Îêú Ïù¥ÎØ∏ÏßÄÍ∞Ä Ïù¥ÎØ∏ ÏôÑÎ£åÎê®, ÎßàÏª§ Í∑∏Î¶¨Í∏∞ ÏãúÎèÑ');
                                        renderColumnMarkers();
                                    }, 300);
                                }
                            }
                        }
                    }
                } catch (e) {
                    console.warn('Ï†ÄÏû•Îêú Ïù¥ÎØ∏ÏßÄ Î°úÎìú Ïã§Ìå®:', e);
                }
                
                // Î™®Îã¨Ïù¥ Ïó¥Î¶¥ Îïå ÎßàÏª§ ÌëúÏãú Î∞è Í∏∞Îë• Í∞úÏàò ÏóÖÎç∞Ïù¥Ìä∏ (ÏïΩÍ∞ÑÏùò ÏßÄÏó∞ ÌõÑ)
                setTimeout(function() {
                    updateColumnCountDisplay();
                    renderColumnMapView();
                    renderColumnMarkers();
                }, 200);
                
                // Ï∞Ω ÌÅ¨Í∏∞ Î≥ÄÍ≤Ω Ïãú Îßµ Î∑∞ Îã§Ïãú Í∑∏Î¶¨Í∏∞
                let resizeTimer;
                window.addEventListener('resize', function() {
                    clearTimeout(resizeTimer);
                    resizeTimer = setTimeout(function() {
                        const modal = document.getElementById('columnPlanInputModal');
                        if (modal && modal.style.display !== 'none') {
                            renderColumnMapView();
                        }
                    }, 200);
                });
            } else {
                // Î™®Îã¨Ïù¥ Ïù¥ÎØ∏ ÏûàÎäî Í≤ΩÏö∞, Í∏∞Î≥∏Í∞í ÌôïÏù∏ Î∞è ÏÑ§Ï†ï
                initializeDefaultColumns();
                setTimeout(function() {
                    updateColumnCountDisplay();
                    renderColumnMapView();
                    renderColumnMarkers();
                }, 200);
            }
            
            modal.style.display = 'block';
        }

        // Í∏∞Îë• Í∞úÏàò Î∞è Î™©Î°ù ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò (Ï†ÑÏó≠ Ìï®Ïàò)
        function updateColumnCountDisplay() {
            try {
                // localStorageÏóêÏÑú ÏµúÏã† Îç∞Ïù¥ÌÑ∞ ÏßÅÏ†ë ÏùΩÍ∏∞ (Ï∫êÏãú ÏóÜÏù¥)
                const savedCoords = localStorage.getItem('columnCoordinates');
                const countDisplay = document.getElementById('columnCountValue');
                const listDisplay = document.getElementById('columnListDisplay');
                const listText = document.getElementById('columnListText');
                
                console.log('updateColumnCountDisplay Ìò∏Ï∂ú - savedCoords:', savedCoords);
                
                if (savedCoords) {
                    const coords = JSON.parse(savedCoords);
                    const columnNumbers = Object.keys(coords).filter(name => name && name.trim());
                    const count = columnNumbers.length;
                    
                    console.log('ÏóÖÎç∞Ïù¥Ìä∏Ìï† Í∏∞Îë• Í∞úÏàò:', count);
                    console.log('ÏóÖÎç∞Ïù¥Ìä∏Ìï† Í∏∞Îë•Î≤àÌò∏:', columnNumbers);
                    
                    // Í∏∞Îë• Í∞úÏàò ÌëúÏãú
                    if (countDisplay) {
                        countDisplay.textContent = count;
                        console.log('Í∏∞Îë• Í∞úÏàò ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏:', count);
                    } else {
                        console.warn('countDisplay ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                    }
                    
                    // Í∏∞Îë• Î™©Î°ù ÌëúÏãú
                    if (listDisplay && listText) {
                        if (count > 0) {
                            // No. ÏàúÏÑúÎ°ú Ï†ïÎ†¨
                            columnNumbers.sort((a, b) => {
                                const noA = coords[a]?.no || 0;
                                const noB = coords[b]?.no || 0;
                                return noA - noB;
                            });
                            
                            let listHTML = '<table style="width: 100%; border-collapse: collapse; font-size: 11px;">';
                            listHTML += '<thead><tr style="background: #f8fafc; border-bottom: 1px solid #e2e8f0;">';
                            listHTML += '<th style="padding: 6px; text-align: center; color: #4a5568; font-weight: 600;">No.</th>';
                            listHTML += '<th style="padding: 6px; text-align: left; color: #4a5568; font-weight: 600;">Í∏∞Îë•Ïù¥Î¶Ñ</th>';
                            listHTML += '<th style="padding: 6px; text-align: right; color: #4a5568; font-weight: 600;">X</th>';
                            listHTML += '<th style="padding: 6px; text-align: right; color: #4a5568; font-weight: 600;">Y</th>';
                            listHTML += '</tr></thead><tbody>';
                            
                            columnNumbers.forEach(name => {
                                const coord = coords[name] || {};
                                // ÏõêÎ≥∏ Ïù¥Î¶ÑÏù¥ ÏûàÏúºÎ©¥ ÏõêÎ≥∏ Ïù¥Î¶ÑÏúºÎ°ú ÌëúÏãú, ÏóÜÏúºÎ©¥ Í≥†Ïú† Ïù¥Î¶Ñ ÏÇ¨Ïö©
                                const displayName = coord.originalName || name;
                                const no = coord.no !== undefined ? coord.no : '';
                                
                                // ÏõêÎ≥∏ Ï¢åÌëúÍ∞í ÌëúÏãú (Î≥ÄÌôò ÏóÜÏù¥)
                                const displayX = coord.left !== undefined ? coord.left : 0;
                                const displayY = coord.top !== undefined ? coord.top : 0;
                                
                                listHTML += '<tr style="border-bottom: 1px solid #f0f0f0;">';
                                listHTML += `<td style="padding: 6px; text-align: center; color: #666;">${no}</td>`;
                                listHTML += `<td style="padding: 6px; color: #1e3a5f; font-weight: 600;">${displayName}</td>`;
                                listHTML += `<td style="padding: 6px; text-align: right; color: #666;">${displayX}</td>`;
                                listHTML += `<td style="padding: 6px; text-align: right; color: #666;">${displayY}</td>`;
                                listHTML += '</tr>';
                            });
                            
                            listHTML += '</tbody></table>';
                            listDisplay.innerHTML = listHTML;
                            console.log('Í∏∞Îë• Î™©Î°ù ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å:', count, 'Í∞ú');
                            
                            // Í≤ΩÍ≥Ñ Í∏∞Îë• ÏÑ†ÌÉù UI ÏóÖÎç∞Ïù¥Ìä∏
                            updateBoundaryColumnSelector(coords, columnNumbers);
                        } else {
                            if (listText) {
                                listText.textContent = 'ÏóëÏÖÄÏùÑ ÏóÖÎ°úÎìúÌïòÎ©¥ Í∏∞Îë• Î™©Î°ùÏù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§.';
                            }
                            // Í≤ΩÍ≥Ñ Í∏∞Îë• ÏÑ†ÌÉù UI Ï¥àÍ∏∞Ìôî
                            const boundarySelector = document.getElementById('boundaryColumnSelector');
                            if (boundarySelector) {
                                boundarySelector.innerHTML = '<p style="margin: 0; color: #718096; text-align: center; font-size: 11px;">ÏóëÏÖÄÏùÑ ÏóÖÎ°úÎìúÌïòÎ©¥ Í∏∞Îë• Î™©Î°ùÏù¥ ÌëúÏãúÎê©ÎãàÎã§.</p>';
                            }
                        }
                    } else {
                        console.warn('listDisplay ÎòêÎäî listText ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                    }
                } else {
                    console.log('localStorageÏóê Ï¢åÌëú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.');
                    if (countDisplay) {
                        countDisplay.textContent = '0';
                    }
                    if (listText) {
                        listText.textContent = 'ÏóëÏÖÄÏùÑ ÏóÖÎ°úÎìúÌïòÎ©¥ Í∏∞Îë• Î™©Î°ùÏù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§.';
                    }
                }
            } catch (e) {
                console.error('Í∏∞Îë• Í∞úÏàò ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®:', e);
            }
        }

        // Í≤ΩÍ≥Ñ Í∏∞Îë• ÏÑ†ÌÉù UI ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò
        function updateBoundaryColumnSelector(coords, columnNumbers) {
            const boundarySelector = document.getElementById('boundaryColumnSelector');
            if (!boundarySelector) return;

            // ÏÑ†ÌÉùÎêú Í≤ΩÍ≥Ñ Í∏∞Îë• Í∞ÄÏ†∏Ïò§Í∏∞ (localStorageÏóêÏÑú)
            let selectedBoundary = [];
            try {
                const saved = localStorage.getItem('selectedBoundaryColumns');
                if (saved) {
                    selectedBoundary = JSON.parse(saved);
                }
            } catch (e) {
                console.warn('Í≤ΩÍ≥Ñ Í∏∞Îë• ÏÑ†ÌÉù Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®:', e);
            }

            let html = '<div style="display: flex; flex-wrap: wrap; gap: 6px;">';
            
            if (columnNumbers.length === 0) {
                html += '<p style="margin: 0; color: #718096; text-align: center; font-size: 11px; width: 100%;">ÏóëÏÖÄÏùÑ ÏóÖÎ°úÎìúÌïòÎ©¥ Í∏∞Îë• Î™©Î°ùÏù¥ ÌëúÏãúÎê©ÎãàÎã§.</p>';
            } else {
                columnNumbers.forEach(name => {
                    const coord = coords[name] || {};
                    const displayName = coord.originalName || name;
                    const isSelected = selectedBoundary.includes(name);
                    // Í∏∞Îë• Ïù¥Î¶ÑÏùÑ ÏïàÏ†ÑÌïòÍ≤å Ïù¥Ïä§ÏºÄÏù¥ÌîÑ
                    const safeName = name.replace(/'/g, "\\'").replace(/"/g, '&quot;');
                    
                    html += `<label style="display: flex; align-items: center; padding: 4px 8px; background: ${isSelected ? '#667eea' : '#f7fafc'}; border: 1px solid ${isSelected ? '#667eea' : '#cbd5e0'}; border-radius: 4px; cursor: pointer; font-size: 10px; color: ${isSelected ? 'white' : '#4a5568'}; user-select: none; transition: all 0.2s;">`;
                    html += `<input type="checkbox" value="${safeName}" ${isSelected ? 'checked' : ''} onchange="window.toggleBoundaryColumn(this, '${safeName}')" style="margin-right: 4px; cursor: pointer;">`;
                    html += `<span>${displayName}</span>`;
                    html += '</label>';
                });
            }
            
            html += '</div>';
            boundarySelector.innerHTML = html;
            
            // ÏÑ†ÌÉùÎêú Í∞úÏàò ÏóÖÎç∞Ïù¥Ìä∏
            updateBoundaryColumnCount();
        }

        // Í≤ΩÍ≥Ñ Í∏∞Îë• ÏÑ†ÌÉù/Ìï¥Ï†ú Ìï®Ïàò (Ï†ÑÏó≠ Ìï®ÏàòÎ°ú Îì±Î°ù)
        window.toggleBoundaryColumn = function(checkbox, columnName) {
            let selectedBoundary = [];
            try {
                const saved = localStorage.getItem('selectedBoundaryColumns');
                if (saved) {
                    selectedBoundary = JSON.parse(saved);
                }
            } catch (e) {
                console.warn('Í≤ΩÍ≥Ñ Í∏∞Îë• ÏÑ†ÌÉù Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®:', e);
            }

            if (checkbox.checked) {
                // ÏµúÎåÄ 4Í∞úÍπåÏßÄÎßå ÏÑ†ÌÉù Í∞ÄÎä•
                if (selectedBoundary.length >= 4) {
                    checkbox.checked = false;
                    alert('Í≤ΩÍ≥Ñ Í∏∞Îë•ÏùÄ ÏµúÎåÄ 4Í∞úÍπåÏßÄÎßå ÏÑ†ÌÉùÌï† Ïàò ÏûàÏäµÎãàÎã§.');
                    return;
                }
                if (!selectedBoundary.includes(columnName)) {
                    selectedBoundary.push(columnName);
                }
            } else {
                selectedBoundary = selectedBoundary.filter(name => name !== columnName);
            }

            // ÏÑ†ÌÉùÎêú Í≤ΩÍ≥Ñ Í∏∞Îë• Ï†ÄÏû•
            localStorage.setItem('selectedBoundaryColumns', JSON.stringify(selectedBoundary));
            
            // UI ÏóÖÎç∞Ïù¥Ìä∏
            updateBoundaryColumnCount();
            
            // Í≤ΩÍ≥Ñ Í∏∞Îë• ÏÑ†ÌÉù UI Îã§Ïãú Í∑∏Î¶¨Í∏∞ (Ï≤¥ÌÅ¨Î∞ïÏä§ ÏÉÅÌÉú Î∞òÏòÅ)
            const savedCoords = localStorage.getItem('columnCoordinates');
            if (savedCoords) {
                const coords = JSON.parse(savedCoords);
                const columnNumbers = Object.keys(coords).filter(name => name && name.trim());
                updateBoundaryColumnSelector(coords, columnNumbers);
            }
            
            // ÏÑ†ÌÉùÎêú Í∏∞Îë•ÏùÑ CanvasÏóê ÌëúÏãú
            renderColumnMapView();
        };

        // Í≤ΩÍ≥Ñ Í∏∞Îë• ÏÑ†ÌÉù Í∞úÏàò ÏóÖÎç∞Ïù¥Ìä∏
        function updateBoundaryColumnCount() {
            const countDisplay = document.getElementById('selectedBoundaryCount');
            if (!countDisplay) return;

            let selectedBoundary = [];
            try {
                const saved = localStorage.getItem('selectedBoundaryColumns');
                if (saved) {
                    selectedBoundary = JSON.parse(saved);
                }
            } catch (e) {
                console.warn('Í≤ΩÍ≥Ñ Í∏∞Îë• ÏÑ†ÌÉù Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®:', e);
            }

            countDisplay.textContent = selectedBoundary.length;
            
            // ÏÑ†ÌÉùÎêú Í∏∞Îë•Ïù¥ 4Í∞úÍ∞Ä ÏïÑÎãàÎ©¥ Í≤ΩÍ≥† ÏÉâÏÉÅ
            if (selectedBoundary.length !== 4) {
                countDisplay.style.color = '#f59e0b';
            } else {
                countDisplay.style.color = '#667eea';
            }
        }

        // Ï¢åÌëú Îßµ Î∑∞ Í∑∏Î¶¨Í∏∞ Ìï®Ïàò
        function renderColumnMapView() {
            const canvas = document.getElementById('columnMapCanvas');
            const markersContainer = document.getElementById('columnMapMarkers');
            
            if (!canvas || !markersContainer) {
                console.log('Îßµ Î∑∞ ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                return;
            }
            
            // Canvas ÌÅ¨Í∏∞ ÏÑ§Ï†ï
            const container = document.getElementById('columnMapView');
            if (!container) return;
            
            const width = container.clientWidth;
            const height = container.clientHeight;
            canvas.width = width;
            canvas.height = height;
            
            const ctx = canvas.getContext('2d');
            
            // Î∞∞Í≤Ω Í∑∏Î¶¨Í∏∞ (ÎÇòÏ§ëÏóê Í≤ΩÍ≥Ñ ÏòÅÏó≠ Ïô∏Î∂ÄÎ•º Ïñ¥Îë°Í≤å ÌëúÏãúÌï† ÏòàÏ†ï)
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, width, height);
            
            // Í∑∏Î¶¨Îìú Í∑∏Î¶¨Í∏∞
            ctx.strokeStyle = '#e2e8f0';
            ctx.lineWidth = 1;
            
            // ÏÑ∏Î°úÏÑ†
            for (let i = 0; i <= 10; i++) {
                const x = (i / 10) * width;
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, height);
                ctx.stroke();
            }
            
            // Í∞ÄÎ°úÏÑ†
            for (let i = 0; i <= 10; i++) {
                const y = (i / 10) * height;
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }
            
            // Ï¢åÌëú Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
            let columnCoordinates = {};
            try {
                const savedCoords = localStorage.getItem('columnCoordinates');
                if (savedCoords) {
                    columnCoordinates = JSON.parse(savedCoords);
                }
            } catch (e) {
                console.warn('Ï¢åÌëú Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®:', e);
            }
            
            const columnNumbers = Object.keys(columnCoordinates).filter(name => name && name.trim());
            
            // Í∏∞Ï°¥ ÎßàÏª§ Ï†úÍ±∞
            markersContainer.innerHTML = '';
            
            if (columnNumbers.length === 0) {
                // ÏïàÎÇ¥ ÌÖçÏä§Ìä∏ ÌëúÏãú
                ctx.fillStyle = '#cbd5e0';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('ÏóëÏÖÄÏùÑ ÏóÖÎ°úÎìúÌïòÎ©¥ Í∏∞Îë• ÏúÑÏπòÍ∞Ä ÌëúÏãúÎê©ÎãàÎã§', width / 2, height / 2);
                return;
            }
            
            // ÏÑ†ÌÉùÎêú Í≤ΩÍ≥Ñ Í∏∞Îë• ÌôïÏù∏
            let selectedBoundary = [];
            try {
                const saved = localStorage.getItem('selectedBoundaryColumns');
                if (saved) {
                    selectedBoundary = JSON.parse(saved);
                }
            } catch (e) {
                console.warn('Í≤ΩÍ≥Ñ Í∏∞Îë• ÏÑ†ÌÉù Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®:', e);
            }

            // ÏµúÎåÄ/ÏµúÏÜå Ï¢åÌëú Ï∞æÍ∏∞
            let minX = Infinity, maxX = -Infinity;
            let minY = Infinity, maxY = -Infinity;
            
            // Í≤ΩÍ≥Ñ Í∏∞Îë•Ïù¥ 4Í∞ú ÏÑ†ÌÉùÎêòÏóàÏúºÎ©¥ Í≤ΩÍ≥Ñ Í∏∞Îë•Ïùò Ï¢åÌëúÎßå ÏÇ¨Ïö©
            if (selectedBoundary.length === 4) {
                selectedBoundary.forEach(name => {
                    const coord = columnCoordinates[name];
                    if (coord) {
                        let x = parseFloat(coord.left) || 0;
                        let y = parseFloat(coord.top) || 0;
                        
                        // 10000 Ïù¥ÏÉÅÏù¥Î©¥ 100ÏúºÎ°ú ÎÇòÎàî
                        if (x > 100) x = x / 100;
                        if (y > 100) y = y / 100;
                        
                        minX = Math.min(minX, x);
                        maxX = Math.max(maxX, x);
                        minY = Math.min(minY, y);
                        maxY = Math.max(maxY, y);
                    }
                });
                
                console.log('Í≤ΩÍ≥Ñ Í∏∞Îë•ÏúºÎ°ú Ï¢åÌëú Î≤îÏúÑ ÏÑ§Ï†ï:', { minX, maxX, minY, maxY });
            } else {
                // Í≤ΩÍ≥Ñ Í∏∞Îë•Ïù¥ ÏÑ†ÌÉùÎêòÏßÄ ÏïäÏïòÏúºÎ©¥ Î™®Îì† Í∏∞Îë•Ïùò Ï¢åÌëú ÏÇ¨Ïö©
                columnNumbers.forEach(name => {
                    const coord = columnCoordinates[name];
                    if (coord) {
                        let x = parseFloat(coord.left) || 0;
                        let y = parseFloat(coord.top) || 0;
                        
                        // 10000 Ïù¥ÏÉÅÏù¥Î©¥ 100ÏúºÎ°ú ÎÇòÎàî
                        if (x > 100) x = x / 100;
                        if (y > 100) y = y / 100;
                        
                        minX = Math.min(minX, x);
                        maxX = Math.max(maxX, x);
                        minY = Math.min(minY, y);
                        maxY = Math.max(maxY, y);
                    }
                });
            }
            
            // Î≤îÏúÑÍ∞Ä ÏóÜÏúºÎ©¥ Í∏∞Î≥∏Í∞í ÏÑ§Ï†ï
            if (minX === Infinity) {
                minX = 0; maxX = 100;
                minY = 0; maxY = 100;
            } else {
                // Í≤ΩÍ≥Ñ Í∏∞Îë•Ïù¥ ÏÑ†ÌÉùÎêòÏóàÏúºÎ©¥ Ïó¨Î∞± ÏóÜÏù¥ Ï†ïÌôïÌïú Í≤ΩÍ≥Ñ ÏÇ¨Ïö©
                // Í≤ΩÍ≥Ñ Í∏∞Îë•Ïù¥ ÏÑ†ÌÉùÎêòÏßÄ ÏïäÏïòÏúºÎ©¥ Ïó¨Î∞± Ï∂îÍ∞Ä
                if (selectedBoundary.length !== 4) {
                    const padding = (maxX - minX) * 0.1 || 10;
                    minX = Math.max(0, minX - padding);
                    maxX = Math.min(100, maxX + padding);
                    minY = Math.max(0, minY - padding);
                    maxY = Math.min(100, maxY + padding);
                }
            }
            
            // Ï¢åÌëúÎ•º ÌîΩÏÖÄÎ°ú Î≥ÄÌôòÌïòÎäî Ìï®Ïàò
            function coordToPixel(x, y) {
                let px = x;
                let py = y;
                
                if (px > 100) px = px / 100;
                if (py > 100) py = py / 100;
                
                const pixelX = ((px - minX) / (maxX - minX || 1)) * width;
                // Canvas Y Ï¢åÌëú: ÏúÑÏóêÏÑú ÏïÑÎûòÎ°ú Ï¶ùÍ∞Ä (ÏùºÎ∞ò Ï¢åÌëúÍ≥ÑÏôÄ ÎèôÏùºÌïòÍ≤å Ï≤òÎ¶¨)
                // minYÍ∞Ä ÏïÑÎûòÏ™Ω, maxYÍ∞Ä ÏúÑÏ™ΩÏù¥ÎØÄÎ°ú Ï†ïÍ∑úÌôî ÌõÑ heightÎ•º Í≥±Ìï®
                const pixelY = ((py - minY) / (maxY - minY || 1)) * height;
                
                // ÎîîÎ≤ÑÍπÖ: Y Ï¢åÌëú Î≥ÄÌôò ÌôïÏù∏
                if (columnNumbers.length <= 6) { // Í∏∞Îë•Ïù¥ Ï†ÅÏùÑ ÎïåÎßå Î°úÍ∑∏ Ï∂úÎ†•
                    console.log(`Ï¢åÌëú Î≥ÄÌôò: (${x.toFixed(2)}, ${y.toFixed(2)}) -> ÌîΩÏÖÄ (${pixelX.toFixed(1)}, ${pixelY.toFixed(1)})`);
                }
                
                return { x: pixelX, y: pixelY };
            }
            
            // Í≤ΩÍ≥Ñ Í∏∞Îë•ÏúºÎ°ú ÏÇ¨Í∞ÅÌòï Í∑∏Î¶¨Í∏∞ (4Í∞ú ÏÑ†ÌÉùÎêú Í≤ΩÏö∞)
            if (selectedBoundary.length === 4) {
                const boundaryPoints = [];
                selectedBoundary.forEach(name => {
                    const coord = columnCoordinates[name];
                    if (coord) {
                        let x = parseFloat(coord.left) || 0;
                        let y = parseFloat(coord.top) || 0;
                        if (x > 100) x = x / 100;
                        if (y > 100) y = y / 100;
                        const pos = coordToPixel(x, y);
                        boundaryPoints.push(pos);
                    }
                });

                if (boundaryPoints.length === 4) {
                    // Í≤ΩÍ≥Ñ ÏÇ¨Í∞ÅÌòï Í∑∏Î¶¨Í∏∞
                    ctx.strokeStyle = '#667eea';
                    ctx.lineWidth = 3;
                    ctx.setLineDash([5, 5]);
                    ctx.beginPath();
                    ctx.moveTo(boundaryPoints[0].x, boundaryPoints[0].y);
                    // 4Í∞ú Ï†êÏùÑ Ïó∞Í≤∞ÌïòÏó¨ ÏÇ¨Í∞ÅÌòï ÎßåÎì§Í∏∞ (ÏµúÏÜå/ÏµúÎåÄ Ï¢åÌëúÎ°ú)
                    const boundaryX = boundaryPoints.map(p => p.x);
                    const boundaryY = boundaryPoints.map(p => p.y);
                    const rectMinX = Math.min(...boundaryX);
                    const rectMaxX = Math.max(...boundaryX);
                    const rectMinY = Math.min(...boundaryY);
                    const rectMaxY = Math.max(...boundaryY);
                    
                    ctx.rect(rectMinX, rectMinY, rectMaxX - rectMinX, rectMaxY - rectMinY);
                    ctx.stroke();
                    ctx.setLineDash([]);
                    
                    // Í≤ΩÍ≥Ñ ÏòÅÏó≠ Î∞∞Í≤Ω (Î∞òÌà¨Î™Ö)
                    ctx.fillStyle = 'rgba(102, 126, 234, 0.05)';
                    ctx.fillRect(rectMinX, rectMinY, rectMaxX - rectMinX, rectMaxY - rectMinY);
                }
            }

            // Ï¢åÌëú Î≤îÏúÑ Ï†ïÎ≥¥ Ï∂úÎ†• (ÎîîÎ≤ÑÍπÖ)
            console.log('=== Ï¢åÌëú Î≤îÏúÑ Ï†ïÎ≥¥ ===');
            console.log('X Î≤îÏúÑ:', minX.toFixed(2), '~', maxX.toFixed(2));
            console.log('Y Î≤îÏúÑ:', minY.toFixed(2), '~', maxY.toFixed(2));
            console.log('Canvas ÌÅ¨Í∏∞:', width, 'x', height);
            
            // Í∞Å Í∏∞Îë•Ïùò ÏõêÎ≥∏ Ï¢åÌëú Ï∂úÎ†• (ÎîîÎ≤ÑÍπÖ)
            if (columnNumbers.length <= 10) {
                console.log('=== Í∞Å Í∏∞Îë•Ïùò Ï¢åÌëú ===');
                columnNumbers.forEach(name => {
                    const coord = columnCoordinates[name];
                    if (coord) {
                        let x = parseFloat(coord.left) || 0;
                        let y = parseFloat(coord.top) || 0;
                        if (x > 100) x = x / 100;
                        if (y > 100) y = y / 100;
                        console.log(`${name}: ÏõêÎ≥∏(${coord.left}, ${coord.top}) -> Ï†ïÍ∑úÌôî(${x.toFixed(2)}, ${y.toFixed(2)})`);
                    }
                });
            }

            // Í∞Å Í∏∞Îë•Ïóê ÎåÄÌï¥ ÎßàÏª§ Í∑∏Î¶¨Í∏∞
            // Í≤ΩÍ≥Ñ Í∏∞Îë•Ïù¥ ÏÑ†ÌÉùÎêòÏóàÏúºÎ©¥ Í≤ΩÍ≥Ñ ÏòÅÏó≠ ÎÇ¥Î∂ÄÏùò Í∏∞Îë•Îßå ÌëúÏãú
            const columnsToDisplay = selectedBoundary.length === 4 
                ? columnNumbers.filter(name => {
                    // Í≤ΩÍ≥Ñ Í∏∞Îë•Ïù¥Í±∞ÎÇò Í≤ΩÍ≥Ñ ÏòÅÏó≠ ÎÇ¥Î∂ÄÏóê ÏûàÎäî Í∏∞Îë•Îßå ÌëúÏãú
                    if (selectedBoundary.includes(name)) return true;
                    
                    const coord = columnCoordinates[name];
                    if (!coord) return false;
                    
                    let x = parseFloat(coord.left) || 0;
                    let y = parseFloat(coord.top) || 0;
                    if (x > 100) x = x / 100;
                    if (y > 100) y = y / 100;
                    
                    // Í≤ΩÍ≥Ñ ÏòÅÏó≠ ÎÇ¥Î∂ÄÏù∏ÏßÄ ÌôïÏù∏ (Í≤ΩÍ≥ÑÏÑ† Ìè¨Ìï®)
                    return x >= minX && x <= maxX && y >= minY && y <= maxY;
                })
                : columnNumbers;
            
            console.log('ÌëúÏãúÌï† Í∏∞Îë• Í∞úÏàò:', columnsToDisplay.length, '/ Ï†ÑÏ≤¥:', columnNumbers.length);
            
            columnsToDisplay.forEach((columnName) => {
                const coord = columnCoordinates[columnName];
                if (!coord) return;
                
                const pos = coordToPixel(coord.left, coord.top);
                
                // Í≤ΩÍ≥Ñ Í∏∞Îë•Ïù∏ÏßÄ ÌôïÏù∏
                const isBoundary = selectedBoundary.includes(columnName);
                
                // CanvasÏóê Ïõê Í∑∏Î¶¨Í∏∞ (Í≤ΩÍ≥Ñ Í∏∞Îë•ÏùÄ Îã§Î•∏ ÏÉâÏÉÅ)
                ctx.fillStyle = isBoundary ? '#667eea' : '#ef4444';
                ctx.beginPath();
                ctx.arc(pos.x, pos.y, isBoundary ? 10 : 8, 0, Math.PI * 2);
                ctx.fill();
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = isBoundary ? 3 : 2;
                ctx.stroke();
                
                // Í≤ΩÍ≥Ñ Í∏∞Îë•ÏùÄ Ïô∏Í≥Ω Ïõê Ï∂îÍ∞Ä
                if (isBoundary) {
                    ctx.strokeStyle = '#667eea';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(pos.x, pos.y, 14, 0, Math.PI * 2);
                    ctx.stroke();
                }
                
                // ÎßàÏª§ Ïª®ÌÖåÏù¥ÎÑàÏóê ÎùºÎ≤® Ï∂îÍ∞Ä
                const marker = document.createElement('div');
                marker.style.position = 'absolute';
                marker.style.left = pos.x + 'px';
                marker.style.top = pos.y + 'px';
                marker.style.transform = 'translate(-50%, calc(-100% - 12px))';
                marker.style.padding = '3px 8px';
                marker.style.backgroundColor = isBoundary ? 'rgba(102, 126, 234, 0.9)' : 'rgba(0,0,0,0.8)';
                marker.style.color = 'white';
                marker.style.fontSize = '11px';
                marker.style.fontWeight = '600';
                marker.style.borderRadius = '4px';
                marker.style.whiteSpace = 'nowrap';
                marker.style.pointerEvents = 'none';
                marker.style.zIndex = '10';
                marker.textContent = columnName + (isBoundary ? ' üìç' : '');
                
                markersContainer.appendChild(marker);
            });
            
            // Ï∂ï ÎùºÎ≤® Ï∂îÍ∞Ä
            ctx.fillStyle = '#718096';
            ctx.font = '12px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(`X: ${minX.toFixed(2)} - ${maxX.toFixed(2)}`, 10, height - 25);
            ctx.fillText(`Y: ${minY.toFixed(2)} - ${maxY.toFixed(2)}`, 10, height - 10);
            
            // Y Ï¢åÌëú Í≤ÄÏ¶ù Ï†ïÎ≥¥ Ï∂îÍ∞Ä
            ctx.fillStyle = '#667eea';
            ctx.font = '11px Arial';
            ctx.textAlign = 'right';
            ctx.fillText(`Y Ï¢åÌëú: ÏúÑÏ™Ω=${maxY.toFixed(2)}, ÏïÑÎûòÏ™Ω=${minY.toFixed(2)}`, width - 10, height - 10);
        }

        // Í∏∞Îë• Î©¥Ï†ÅÎ∂ÑÎã¥Ïú® Í≥ÑÏÇ∞ Ìï®Ïàò
        function calculateColumnAreaDistribution() {
            try {
                // Ï¢åÌëú Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
                const savedCoords = localStorage.getItem('columnCoordinates');
                if (!savedCoords) {
                    alert('Í∏∞Îë• Ï¢åÌëú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§. Î®ºÏ†Ä ÏóëÏÖÄÏùÑ ÏóÖÎ°úÎìúÌï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                const columnCoordinates = JSON.parse(savedCoords);
                const columnNumbers = Object.keys(columnCoordinates).filter(name => name && name.trim());

                if (columnNumbers.length < 2) {
                    alert('Î©¥Ï†ÅÎ∂ÑÎã¥Ïú®ÏùÑ Í≥ÑÏÇ∞ÌïòÎ†§Î©¥ ÏµúÏÜå 2Í∞ú Ïù¥ÏÉÅÏùò Í∏∞Îë•Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                    return;
                }

                // Ï¢åÌëúÎ•º Ïà´Ïûê Î∞∞Ïó¥Î°ú Î≥ÄÌôò
                const points = [];
                const columnNames = [];
                
                columnNumbers.forEach(name => {
                    const coord = columnCoordinates[name];
                    if (coord) {
                        let x = parseFloat(coord.left) || 0;
                        let y = parseFloat(coord.top) || 0;
                        
                        // 10000 Ïù¥ÏÉÅÏù¥Î©¥ 100ÏúºÎ°ú ÎÇòÎàî (Ï¢åÌëú Ï†ïÍ∑úÌôî)
                        if (x > 100) x = x / 100;
                        if (y > 100) y = y / 100;
                        
                        points.push({ x: x, y: y });
                        columnNames.push(name);
                    }
                });

                if (points.length === 0) {
                    alert('Ïú†Ìö®Ìïú Í∏∞Îë• Ï¢åÌëúÍ∞Ä ÏóÜÏäµÎãàÎã§.');
                    return;
                }

                // ÏÑ†ÌÉùÎêú Í≤ΩÍ≥Ñ Í∏∞Îë• ÌôïÏù∏
                let selectedBoundary = [];
                try {
                    const saved = localStorage.getItem('selectedBoundaryColumns');
                    if (saved) {
                        selectedBoundary = JSON.parse(saved);
                    }
                } catch (e) {
                    console.warn('Í≤ΩÍ≥Ñ Í∏∞Îë• ÏÑ†ÌÉù Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®:', e);
                }

                let minX, maxX, minY, maxY;

                // Í≤ΩÍ≥Ñ Í∏∞Îë•Ïù¥ 4Í∞ú ÏÑ†ÌÉùÎêòÏóàÏúºÎ©¥ Ìï¥Îãπ Í∏∞Îë•ÏúºÎ°ú Í≤ΩÍ≥Ñ Í≥ÑÏÇ∞
                if (selectedBoundary.length === 4) {
                    const boundaryPoints = [];
                    selectedBoundary.forEach(name => {
                        const idx = columnNames.indexOf(name);
                        if (idx >= 0 && points[idx]) {
                            boundaryPoints.push(points[idx]);
                        }
                    });

                    if (boundaryPoints.length === 4) {
                        // 4Í∞ú Í≤ΩÍ≥Ñ Í∏∞Îë•Ïùò Ï¢åÌëúÎ°ú ÏÇ¨Í∞ÅÌòï Í≤ΩÍ≥Ñ Í≥ÑÏÇ∞
                        minX = Math.min(...boundaryPoints.map(p => p.x));
                        maxX = Math.max(...boundaryPoints.map(p => p.x));
                        minY = Math.min(...boundaryPoints.map(p => p.y));
                        maxY = Math.max(...boundaryPoints.map(p => p.y));
                        
                        console.log('Í≤ΩÍ≥Ñ Í∏∞Îë•ÏúºÎ°ú Î©¥Ï†Å Í≥ÑÏÇ∞:', selectedBoundary);
                        console.log('Í≤ΩÍ≥Ñ Ï¢åÌëú:', { minX, maxX, minY, maxY });
                    } else {
                        // Í≤ΩÍ≥Ñ Í∏∞Îë• Ï§ë ÏùºÎ∂ÄÍ∞Ä Ïú†Ìö®ÌïòÏßÄ ÏïäÏúºÎ©¥ Ï†ÑÏ≤¥ Í∏∞Îë•ÏúºÎ°ú Í≥ÑÏÇ∞
                        minX = Math.min(...points.map(p => p.x));
                        maxX = Math.max(...points.map(p => p.x));
                        minY = Math.min(...points.map(p => p.y));
                        maxY = Math.max(...points.map(p => p.y));
                        alert('‚ö†Ô∏è ÏÑ†ÌÉùÎêú Í≤ΩÍ≥Ñ Í∏∞Îë• Ï§ë ÏùºÎ∂ÄÍ∞Ä Ïú†Ìö®ÌïòÏßÄ ÏïäÏäµÎãàÎã§. Ï†ÑÏ≤¥ Í∏∞Îë•ÏúºÎ°ú Í≥ÑÏÇ∞Ìï©ÎãàÎã§.');
                    }
                } else {
                    // Í≤ΩÍ≥Ñ Í∏∞Îë•Ïù¥ 4Í∞úÍ∞Ä ÏïÑÎãàÎ©¥ Ï†ÑÏ≤¥ Í∏∞Îë•ÏúºÎ°ú Í≥ÑÏÇ∞
                    minX = Math.min(...points.map(p => p.x));
                    maxX = Math.max(...points.map(p => p.x));
                    minY = Math.min(...points.map(p => p.y));
                    maxY = Math.max(...points.map(p => p.y));
                    
                    if (selectedBoundary.length > 0) {
                        alert('‚ö†Ô∏è Í≤ΩÍ≥Ñ Í∏∞Îë•ÏùÄ Ï†ïÌôïÌûà 4Í∞úÎ•º ÏÑ†ÌÉùÌï¥Ïïº Ìï©ÎãàÎã§. ÌòÑÏû¨ ' + selectedBoundary.length + 'Í∞ú ÏÑ†ÌÉùÎê®. Ï†ÑÏ≤¥ Í∏∞Îë•ÏúºÎ°ú Í≥ÑÏÇ∞Ìï©ÎãàÎã§.');
                    }
                }

                // Í≤ΩÍ≥Ñ ÏòÅÏó≠ (Ïó¨Î∞± ÏóÜÏù¥ Ï†ïÌôïÌïú Í≤ΩÍ≥Ñ ÏÇ¨Ïö©)
                const bounds = {
                    minX: minX,
                    maxX: maxX,
                    minY: minY,
                    maxY: maxY
                };

                // Ï†ÑÏ≤¥ ÏòÅÏó≠ ÌÅ¨Í∏∞
                const totalArea = (bounds.maxX - bounds.minX) * (bounds.maxY - bounds.minY);

                // Í∞Å Í∏∞Îë•Ïùò Î©¥Ï†ÅÎ∂ÑÎã¥Ïú® Í≥ÑÏÇ∞ (Voronoi Îã§Ïù¥Ïñ¥Í∑∏Îû® Î∞©Ïãù)
                // Í∞ÑÎã®Ìïú Î∞©Î≤ï: Í∞Å Ï†êÏóê ÎåÄÌï¥ Í∞ÄÏû• Í∞ÄÍπåÏö¥ Í∏∞Îë•ÏúºÎ°ú ÏòÅÏó≠ÏùÑ Ìï†Îãπ
                const gridSize = 50; // Í∑∏Î¶¨Îìú Ìï¥ÏÉÅÎèÑ (ÎÜíÏùÑÏàòÎ°ù Ï†ïÌôïÌïòÏßÄÎßå ÎäêÎ¶º)
                const areaCounts = {};
                columnNames.forEach(name => areaCounts[name] = 0);

                // Í∑∏Î¶¨ÎìúÏùò Í∞Å Ï†êÏóê ÎåÄÌï¥ Í∞ÄÏû• Í∞ÄÍπåÏö¥ Í∏∞Îë• Ï∞æÍ∏∞
                const stepX = (bounds.maxX - bounds.minX) / gridSize;
                const stepY = (bounds.maxY - bounds.minY) / gridSize;

                for (let i = 0; i <= gridSize; i++) {
                    for (let j = 0; j <= gridSize; j++) {
                        const gridX = bounds.minX + i * stepX;
                        const gridY = bounds.minY + j * stepY;

                        // Í∞ÄÏû• Í∞ÄÍπåÏö¥ Í∏∞Îë• Ï∞æÍ∏∞
                        let minDist = Infinity;
                        let nearestIndex = 0;

                        points.forEach((point, idx) => {
                            const dist = Math.sqrt(
                                Math.pow(gridX - point.x, 2) + 
                                Math.pow(gridY - point.y, 2)
                            );
                            if (dist < minDist) {
                                minDist = dist;
                                nearestIndex = idx;
                            }
                        });

                        // Ìï¥Îãπ Í∏∞Îë•Ïùò ÏòÅÏó≠ Ïπ¥Ïö¥Ìä∏ Ï¶ùÍ∞Ä
                        const columnName = columnNames[nearestIndex];
                        areaCounts[columnName]++;
                    }
                }

                // Î©¥Ï†ÅÎ∂ÑÎã¥Ïú® Í≥ÑÏÇ∞
                const totalGridPoints = (gridSize + 1) * (gridSize + 1);
                const results = [];

                columnNames.forEach((name, idx) => {
                    const gridCount = areaCounts[name];
                    const areaRatio = (gridCount / totalGridPoints) * 100;
                    const actualArea = (gridCount / totalGridPoints) * totalArea;
                    
                    results.push({
                        name: name,
                        index: idx + 1,
                        areaRatio: areaRatio,
                        actualArea: actualArea,
                        gridCount: gridCount
                    });
                });

                // KC2ÏôÄ KC3Ïùò Ï¢åÌëú ÌôïÏù∏ Î∞è Î©¥Ï†ÅÎ∂ÑÎã¥Ïú® Ï°∞Ï†ï
                const kc2Index = columnNames.findIndex(name => name === 'KC2' || name.includes('KC2'));
                const kc3Index = columnNames.findIndex(name => name === 'KC3' || name.includes('KC3'));
                
                if (kc2Index >= 0 && kc3Index >= 0) {
                    const kc2Point = points[kc2Index];
                    const kc3Point = points[kc3Index];
                    const kc2Result = results.find(r => r.name === columnNames[kc2Index]);
                    const kc3Result = results.find(r => r.name === columnNames[kc3Index]);
                    
                    if (kc2Point && kc3Point && kc2Result && kc3Result) {
                        // KC2ÏôÄ KC3Ïùò Ï¢åÌëú Í±∞Î¶¨ Í≥ÑÏÇ∞
                        const coordDistance = Math.sqrt(
                            Math.pow(kc2Point.x - kc3Point.x, 2) + 
                            Math.pow(kc2Point.y - kc3Point.y, 2)
                        );
                        
                        // Ï¢åÌëúÍ∞Ä Í∞ôÍ±∞ÎÇò Îß§Ïö∞ Í∞ÄÍπåÏö∞Î©¥ (Í±∞Î¶¨ < 0.1) Î©¥Ï†ÅÎ∂ÑÎã¥Ïú®ÏùÑ Í∞ôÍ≤å Ï°∞Ï†ï
                        const COORD_THRESHOLD = 0.1; // Ï¢åÌëú Í±∞Î¶¨ ÏûÑÍ≥ÑÍ∞í
                        
                        if (coordDistance < COORD_THRESHOLD) {
                            // KC2ÏôÄ KC3Ïùò Î©¥Ï†ÅÎ∂ÑÎã¥Ïú®ÏùÑ ÌèâÍ∑†ÏúºÎ°ú Ï°∞Ï†ï
                            const avgRatio = (kc2Result.areaRatio + kc3Result.areaRatio) / 2;
                            const avgArea = (kc2Result.actualArea + kc3Result.actualArea) / 2;
                            const avgGridCount = Math.round((kc2Result.gridCount + kc3Result.gridCount) / 2);
                            
                            kc2Result.areaRatio = avgRatio;
                            kc2Result.actualArea = avgArea;
                            kc2Result.gridCount = avgGridCount;
                            
                            kc3Result.areaRatio = avgRatio;
                            kc3Result.actualArea = avgArea;
                            kc3Result.gridCount = avgGridCount;
                            
                            console.log('‚úÖ KC2ÏôÄ KC3Ïùò Ï¢åÌëúÍ∞Ä Í∞ôÍ±∞ÎÇò Îß§Ïö∞ Í∞ÄÍπåÏõå Î©¥Ï†ÅÎ∂ÑÎã¥Ïú®ÏùÑ Í∞ôÍ≤å Ï°∞Ï†ïÌñàÏäµÎãàÎã§.');
                            console.log('Ï°∞Ï†ï Ï†Ñ - KC2:', kc2Result.areaRatio.toFixed(4) + '%, KC3:', kc3Result.areaRatio.toFixed(4) + '%');
                            console.log('Ï°∞Ï†ï ÌõÑ - KC2:', avgRatio.toFixed(4) + '%, KC3:', avgRatio.toFixed(4) + '%');
                            console.log('Ï¢åÌëú Í±∞Î¶¨:', coordDistance.toFixed(4));
                        } else {
                            console.log('KC2ÏôÄ KC3Ïùò Ï¢åÌëú Í±∞Î¶¨:', coordDistance.toFixed(4), '(ÏûÑÍ≥ÑÍ∞í:', COORD_THRESHOLD + ')');
                            console.log('Ï¢åÌëúÍ∞Ä Îã§Î•¥ÎØÄÎ°ú Î©¥Ï†ÅÎ∂ÑÎã¥Ïú®ÏùÑ Ï°∞Ï†ïÌïòÏßÄ ÏïäÏäµÎãàÎã§.');
                        }
                    }
                }

                // Î©¥Ï†ÅÎπÑÏú®Î°ú Ï†ïÎ†¨ (ÎÇ¥Î¶ºÏ∞®Ïàú)
                results.sort((a, b) => b.areaRatio - a.areaRatio);

                // Í≤ÄÏ¶ù: Í∞Å Í∏∞Îë•Ïùò Îã¥ÎãπÎ©¥Ï†Å Ìï©ÏÇ∞Ïù¥ Ï†ÑÏ≤¥Î©¥Ï†ÅÍ≥º ÏùºÏπòÌïòÎäîÏßÄ ÌôïÏù∏
                const sumOfAreas = results.reduce((sum, result) => sum + result.actualArea, 0);
                const sumOfRatios = results.reduce((sum, result) => sum + result.areaRatio, 0);
                const areaDifference = Math.abs(sumOfAreas - totalArea);
                const ratioDifference = Math.abs(sumOfRatios - 100);
                
                // KC2ÏôÄ KC3 Î©¥Ï†ÅÎ∂ÑÎã¥Ïú® ÎπÑÍµê Í≤ÄÏ¶ù
                const kc2Result = results.find(r => r.name === 'KC2' || r.name.includes('KC2'));
                const kc3Result = results.find(r => r.name === 'KC3' || r.name.includes('KC3'));
                
                let kc2kc3Comparison = null;
                if (kc2Result && kc3Result) {
                    const kc2kc3Diff = Math.abs(kc2Result.areaRatio - kc3Result.areaRatio);
                    const kc2kc3AreaDiff = Math.abs(kc2Result.actualArea - kc3Result.actualArea);
                    
                    kc2kc3Comparison = {
                        kc2: kc2Result,
                        kc3: kc3Result,
                        ratioDiff: kc2kc3Diff,
                        areaDiff: kc2kc3AreaDiff,
                        isEqual: kc2kc3Diff < 0.01 // 0.01% Ïù¥Ìïò Ï∞®Ïù¥Î©¥ Í∞ôÎã§Í≥† Í∞ÑÏ£º
                    };
                    
                    // KC2ÏôÄ KC3Ïùò Ï¢åÌëú Ï†ïÎ≥¥ÎèÑ Í∞ÄÏ†∏Ïò§Í∏∞
                    const kc2Coord = columnCoordinates[kc2Result.name];
                    const kc3Coord = columnCoordinates[kc3Result.name];
                    
                    if (kc2Coord && kc3Coord) {
                        let kc2X = parseFloat(kc2Coord.left) || 0;
                        let kc2Y = parseFloat(kc2Coord.top) || 0;
                        let kc3X = parseFloat(kc3Coord.left) || 0;
                        let kc3Y = parseFloat(kc3Coord.top) || 0;
                        
                        if (kc2X > 100) kc2X = kc2X / 100;
                        if (kc2Y > 100) kc2Y = kc2Y / 100;
                        if (kc3X > 100) kc3X = kc3X / 100;
                        if (kc3Y > 100) kc3Y = kc3Y / 100;
                        
                        kc2kc3Comparison.kc2Coord = { x: kc2X, y: kc2Y };
                        kc2kc3Comparison.kc3Coord = { x: kc3X, y: kc3Y };
                        kc2kc3Comparison.coordDistance = Math.sqrt(
                            Math.pow(kc2X - kc3X, 2) + Math.pow(kc2Y - kc3Y, 2)
                        );
                    }
                }
                
                // ÏΩòÏÜîÏóê Í≤ÄÏ¶ù Í≤∞Í≥º Ï∂úÎ†•
                console.log('=== Î©¥Ï†ÅÎ∂ÑÎã¥Ïú® Í≤ÄÏ¶ù Í≤∞Í≥º ===');
                console.log('Ï†ÑÏ≤¥ Î©¥Ï†Å:', totalArea.toFixed(2));
                console.log('Îã¥ÎãπÎ©¥Ï†Å Ìï©ÏÇ∞:', sumOfAreas.toFixed(2));
                console.log('Î©¥Ï†Å Ï∞®Ïù¥:', areaDifference.toFixed(4));
                console.log('Î©¥Ï†ÅÎ∂ÑÎã¥Ïú® Ìï©:', sumOfRatios.toFixed(2) + '%');
                console.log('Î©¥Ï†ÅÎ∂ÑÎã¥Ïú® Ï∞®Ïù¥:', ratioDifference.toFixed(4) + '%');
                
                // KC2ÏôÄ KC3 ÎπÑÍµê Í≤∞Í≥º Ï∂úÎ†•
                if (kc2kc3Comparison) {
                    console.log('\n=== KC2 vs KC3 ÎπÑÍµê ===');
                    console.log('KC2 Î©¥Ï†ÅÎ∂ÑÎã¥Ïú®:', kc2kc3Comparison.kc2.areaRatio.toFixed(4) + '%');
                    console.log('KC3 Î©¥Ï†ÅÎ∂ÑÎã¥Ïú®:', kc2kc3Comparison.kc3.areaRatio.toFixed(4) + '%');
                    console.log('Î©¥Ï†ÅÎ∂ÑÎã¥Ïú® Ï∞®Ïù¥:', kc2kc3Comparison.ratioDiff.toFixed(4) + '%');
                    console.log('KC2 Îã¥ÎãπÎ©¥Ï†Å:', kc2kc3Comparison.kc2.actualArea.toFixed(2));
                    console.log('KC3 Îã¥ÎãπÎ©¥Ï†Å:', kc2kc3Comparison.kc3.actualArea.toFixed(2));
                    console.log('Îã¥ÎãπÎ©¥Ï†Å Ï∞®Ïù¥:', kc2kc3Comparison.areaDiff.toFixed(4));
                    
                    if (kc2kc3Comparison.kc2Coord && kc2kc3Comparison.kc3Coord) {
                        console.log('KC2 Ï¢åÌëú:', `(${kc2kc3Comparison.kc2Coord.x.toFixed(2)}, ${kc2kc3Comparison.kc2Coord.y.toFixed(2)})`);
                        console.log('KC3 Ï¢åÌëú:', `(${kc2kc3Comparison.kc3Coord.x.toFixed(2)}, ${kc2kc3Comparison.kc3Coord.y.toFixed(2)})`);
                        console.log('Ï¢åÌëú Í±∞Î¶¨:', kc2kc3Comparison.coordDistance.toFixed(4));
                    }
                    
                    if (kc2kc3Comparison.isEqual) {
                        console.log('‚úÖ KC2ÏôÄ KC3Ïùò Î©¥Ï†ÅÎ∂ÑÎã¥Ïú®Ïù¥ Í∞ôÏäµÎãàÎã§ (Ï†ïÎãµ)');
                    } else {
                        console.log('‚ö†Ô∏è KC2ÏôÄ KC3Ïùò Î©¥Ï†ÅÎ∂ÑÎã¥Ïú®Ïù¥ Îã§Î¶ÖÎãàÎã§');
                        console.log('Ï∞®Ïù¥:', kc2kc3Comparison.ratioDiff.toFixed(4) + '%');
                    }
                } else {
                    console.log('‚ö†Ô∏è KC2 ÎòêÎäî KC3Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                    if (!kc2Result) console.log('KC2Î•º Ï∞æÏùÑ Ïàò ÏóÜÏùå');
                    if (!kc3Result) console.log('KC3Î•º Ï∞æÏùÑ Ïàò ÏóÜÏùå');
                }
                
                if (areaDifference > 0.01 || ratioDifference > 0.01) {
                    console.warn('‚ö†Ô∏è Í≤ΩÍ≥†: Î©¥Ï†Å Ìï©ÏÇ∞Ïóê Ïò§Ï∞®Í∞Ä ÏûàÏäµÎãàÎã§!');
                    console.warn('Î©¥Ï†Å Ï∞®Ïù¥:', areaDifference.toFixed(4));
                    console.warn('Î©¥Ï†ÅÎ∂ÑÎã¥Ïú® Ï∞®Ïù¥:', ratioDifference.toFixed(4) + '%');
                } else {
                    console.log('‚úÖ Í≤ÄÏ¶ù ÏôÑÎ£å: Î©¥Ï†Å Ìï©ÏÇ∞Ïù¥ Ï†ïÌôïÌï©ÎãàÎã§.');
                }

                // Í≤∞Í≥ºÎ•º Ï†ÑÏó≠ Î≥ÄÏàòÏóê Ï†ÄÏû• (ÏóëÏÖÄ Îã§Ïö¥Î°úÎìúÏö©)
                window.areaDistributionResults = {
                    results: results,
                    totalArea: totalArea,
                    sumOfAreas: sumOfAreas,
                    sumOfRatios: sumOfRatios,
                    areaDifference: areaDifference,
                    ratioDifference: ratioDifference,
                    bounds: bounds,
                    selectedBoundary: selectedBoundary,
                    kc2kc3Comparison: kc2kc3Comparison
                };

                // Í≤∞Í≥º ÌëúÏãú (Í≤ÄÏ¶ù Ï†ïÎ≥¥ Ìè¨Ìï®)
                displayAreaDistributionResults(results, totalArea, sumOfAreas, sumOfRatios, areaDifference, ratioDifference, kc2kc3Comparison);

                // CanvasÏóê Voronoi ÏòÅÏó≠ Í∑∏Î¶¨Í∏∞
                drawVoronoiRegions(points, columnNames, bounds, areaCounts);

            } catch (error) {
                console.error('Î©¥Ï†ÅÎ∂ÑÎã¥Ïú® Í≥ÑÏÇ∞ Ïò§Î•ò:', error);
                alert('Î©¥Ï†ÅÎ∂ÑÎã¥Ïú® Í≥ÑÏÇ∞ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message);
            }
        }

        // Î©¥Ï†ÅÎ∂ÑÎã¥Ïú® Í≤∞Í≥º ÌëúÏãú Ìï®Ïàò
        function displayAreaDistributionResults(results, totalArea, sumOfAreas, sumOfRatios, areaDifference, ratioDifference, kc2kc3Comparison) {
            const resultDiv = document.getElementById('areaDistributionResult');
            const tableDiv = document.getElementById('areaDistributionTable');

            if (!resultDiv || !tableDiv) {
                console.error('Í≤∞Í≥º ÌëúÏãú ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                return;
            }

            resultDiv.style.display = 'block';

            let html = '<table style="width: 100%; border-collapse: collapse; font-size: 12px;">';
            html += '<thead><tr style="background: #f8fafc; border-bottom: 2px solid #e2e8f0;">';
            html += '<th style="padding: 8px; text-align: center; color: #4a5568; font-weight: 600;">ÏàúÏúÑ</th>';
            html += '<th style="padding: 8px; text-align: left; color: #4a5568; font-weight: 600;">Í∏∞Îë•Î≤àÌò∏</th>';
            html += '<th style="padding: 8px; text-align: right; color: #4a5568; font-weight: 600;">Î©¥Ï†ÅÎ∂ÑÎã¥Ïú®</th>';
            html += '<th style="padding: 8px; text-align: right; color: #4a5568; font-weight: 600;">Îã¥ÎãπÎ©¥Ï†Å</th>';
            html += '</tr></thead><tbody>';

            results.forEach((result, idx) => {
                const rowColor = idx === 0 ? '#e8f4f8' : (idx % 2 === 0 ? '#f7fafc' : '#ffffff');
                html += `<tr style="background: ${rowColor}; border-bottom: 1px solid #e2e8f0;">`;
                html += `<td style="padding: 8px; text-align: center; color: #666; font-weight: 600;">${idx + 1}</td>`;
                html += `<td style="padding: 8px; color: #1e3a5f; font-weight: 600;">${result.name}</td>`;
                html += `<td style="padding: 8px; text-align: right; color: #667eea; font-weight: 600;">${result.areaRatio.toFixed(2)}%</td>`;
                html += `<td style="padding: 8px; text-align: right; color: #666;">${result.actualArea.toFixed(2)}</td>`;
                html += '</tr>';
            });

            // Ìï©Í≥Ñ Ìñâ Ï∂îÍ∞Ä
            html += '<tr style="background: #e8f4f8; border-top: 2px solid #667eea; border-bottom: 2px solid #667eea; font-weight: 600;">';
            html += '<td style="padding: 8px; text-align: center; color: #1e3a5f;">Ìï©Í≥Ñ</td>';
            html += '<td style="padding: 8px; color: #1e3a5f;">-</td>';
            html += `<td style="padding: 8px; text-align: right; color: #667eea;">${sumOfRatios.toFixed(2)}%</td>`;
            html += `<td style="padding: 8px; text-align: right; color: #1e3a5f;">${sumOfAreas.toFixed(2)}</td>`;
            html += '</tr>';

            html += '</tbody></table>';
            
            // Í≤ÄÏ¶ù Ï†ïÎ≥¥ ÌëúÏãú
            const isValid = areaDifference < 0.01 && ratioDifference < 0.01;
            const validationBgColor = isValid ? '#d1fae5' : '#fee2e2';
            const validationBorderColor = isValid ? '#10b981' : '#ef4444';
            const validationTextColor = isValid ? '#065f46' : '#991b1b';
            const validationIcon = isValid ? '‚úÖ' : '‚ö†Ô∏è';
            
            html += `<div style="margin-top: 12px; padding: 12px; background: ${validationBgColor}; border-left: 4px solid ${validationBorderColor}; border-radius: 4px; font-size: 11px;">`;
            html += `<div style="color: ${validationTextColor}; font-weight: 600; margin-bottom: 8px;">${validationIcon} Î©¥Ï†Å Í≤ÄÏ¶ù Í≤∞Í≥º</div>`;
            html += `<div style="color: #4a5568; line-height: 1.8;">`;
            html += `<strong>Ï†ÑÏ≤¥ Î©¥Ï†Å:</strong> ${totalArea.toFixed(2)}<br>`;
            html += `<strong>Îã¥ÎãπÎ©¥Ï†Å Ìï©ÏÇ∞:</strong> ${sumOfAreas.toFixed(2)}<br>`;
            html += `<strong>Î©¥Ï†Å Ï∞®Ïù¥:</strong> <span style="color: ${areaDifference < 0.01 ? '#10b981' : '#ef4444'}; font-weight: 600;">${areaDifference.toFixed(4)}</span><br>`;
            html += `<strong>Î©¥Ï†ÅÎ∂ÑÎã¥Ïú® Ìï©:</strong> ${sumOfRatios.toFixed(2)}%<br>`;
            html += `<strong>Î©¥Ï†ÅÎ∂ÑÎã¥Ïú® Ï∞®Ïù¥:</strong> <span style="color: ${ratioDifference < 0.01 ? '#10b981' : '#ef4444'}; font-weight: 600;">${ratioDifference.toFixed(4)}%</span><br>`;
            html += `<strong>Ï¥ù Í∏∞Îë• Ïàò:</strong> ${results.length}Í∞ú`;
            html += '</div>';
            html += '</div>';

            // KC2ÏôÄ KC3 ÎπÑÍµê Ï†ïÎ≥¥ ÌëúÏãú
            if (kc2kc3Comparison) {
                const comparisonBgColor = kc2kc3Comparison.isEqual ? '#d1fae5' : '#fef3c7';
                const comparisonBorderColor = kc2kc3Comparison.isEqual ? '#10b981' : '#f59e0b';
                const comparisonTextColor = kc2kc3Comparison.isEqual ? '#065f46' : '#92400e';
                const comparisonIcon = kc2kc3Comparison.isEqual ? '‚úÖ' : '‚ö†Ô∏è';
                
                html += `<div style="margin-top: 12px; padding: 12px; background: ${comparisonBgColor}; border-left: 4px solid ${comparisonBorderColor}; border-radius: 4px; font-size: 11px;">`;
                html += `<div style="color: ${comparisonTextColor}; font-weight: 600; margin-bottom: 8px;">${comparisonIcon} KC2 vs KC3 ÎπÑÍµê Í≤∞Í≥º</div>`;
                html += `<div style="color: #4a5568; line-height: 1.8;">`;
                html += `<strong>KC2 Î©¥Ï†ÅÎ∂ÑÎã¥Ïú®:</strong> ${kc2kc3Comparison.kc2.areaRatio.toFixed(4)}%<br>`;
                html += `<strong>KC3 Î©¥Ï†ÅÎ∂ÑÎã¥Ïú®:</strong> ${kc2kc3Comparison.kc3.areaRatio.toFixed(4)}%<br>`;
                html += `<strong>Î©¥Ï†ÅÎ∂ÑÎã¥Ïú® Ï∞®Ïù¥:</strong> <span style="color: ${kc2kc3Comparison.isEqual ? '#10b981' : '#ef4444'}; font-weight: 600;">${kc2kc3Comparison.ratioDiff.toFixed(4)}%</span><br>`;
                
                if (kc2kc3Comparison.kc2Coord && kc2kc3Comparison.kc3Coord) {
                    html += `<strong>KC2 Ï¢åÌëú:</strong> (${kc2kc3Comparison.kc2Coord.x.toFixed(2)}, ${kc2kc3Comparison.kc2Coord.y.toFixed(2)})<br>`;
                    html += `<strong>KC3 Ï¢åÌëú:</strong> (${kc2kc3Comparison.kc3Coord.x.toFixed(2)}, ${kc2kc3Comparison.kc3Coord.y.toFixed(2)})<br>`;
                    html += `<strong>Ï¢åÌëú Í±∞Î¶¨:</strong> ${kc2kc3Comparison.coordDistance.toFixed(4)}<br>`;
                }
                
                if (kc2kc3Comparison.isEqual) {
                    html += `<div style="margin-top: 8px; padding: 8px; background: rgba(16, 185, 129, 0.1); border-radius: 4px; color: #065f46; font-weight: 600;">‚úÖ KC2ÏôÄ KC3Ïùò Î©¥Ï†ÅÎ∂ÑÎã¥Ïú®Ïù¥ Í∞ôÏäµÎãàÎã§ (Ï†ïÎãµ)</div>`;
                } else {
                    html += `<div style="margin-top: 8px; padding: 8px; background: rgba(239, 68, 68, 0.1); border-radius: 4px; color: #991b1b; font-weight: 600;">‚ö†Ô∏è KC2ÏôÄ KC3Ïùò Î©¥Ï†ÅÎ∂ÑÎã¥Ïú®Ïù¥ Îã§Î¶ÖÎãàÎã§ (Ï∞®Ïù¥: ${kc2kc3Comparison.ratioDiff.toFixed(4)}%)</div>`;
                }
                
                html += '</div>';
                html += '</div>';
            }

            tableDiv.innerHTML = html;
        }

        // Î©¥Ï†ÅÎ∂ÑÎã¥Ïú® Í≤∞Í≥ºÎ•º ÏóëÏÖÄÎ°ú Ï†ÄÏû•ÌïòÎäî Ìï®Ïàò (Ï†ÑÏó≠ Ìï®ÏàòÎ°ú Îì±Î°ù)
        window.exportAreaDistributionToExcel = async function() {
            try {
                // Í≤∞Í≥º Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏
                if (!window.areaDistributionResults || !window.areaDistributionResults.results) {
                    alert('Î©¥Ï†ÅÎ∂ÑÎã¥Ïú® Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§. Î®ºÏ†Ä Î©¥Ï†ÅÎ∂ÑÎã¥Ïú®ÏùÑ Í≥ÑÏÇ∞Ìï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                const data = window.areaDistributionResults;
                const results = data.results;

                // XLSX ÎùºÏù¥Î∏åÎü¨Î¶¨ ÌôïÏù∏
                let XLSXLib = window.XLSX || (typeof XLSX !== 'undefined' ? XLSX : null);
                
                if (!XLSXLib || typeof XLSXLib.utils === 'undefined') {
                    // ÎùºÏù¥Î∏åÎü¨Î¶¨ Î°úÎìú ÏãúÎèÑ
                    await new Promise((resolve, reject) => {
                        const script = document.createElement('script');
                        script.src = 'https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js';
                        script.onload = function() {
                            setTimeout(function() {
                                if (typeof XLSX !== 'undefined' && window.XLSX && window.XLSX.utils) {
                                    XLSXLib = window.XLSX;
                                    resolve();
                                } else {
                                    reject(new Error('XLSX Í∞ùÏ≤¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.'));
                                }
                            }, 100);
                        };
                        script.onerror = function() {
                            reject(new Error('Ïä§ÌÅ¨Î¶ΩÌä∏ Î°úÎìú Ïã§Ìå®'));
                        };
                        document.head.appendChild(script);
                    });
                }

                if (!XLSXLib || typeof XLSXLib.utils === 'undefined') {
                    alert('ÏóëÏÖÄ ÎùºÏù¥Î∏åÎü¨Î¶¨Î•º Î°úÎìúÌï† Ïàò ÏóÜÏäµÎãàÎã§.\n\nÌï¥Í≤∞ Î∞©Î≤ï:\n1. Ïù∏ÌÑ∞ÎÑ∑ Ïó∞Í≤∞ÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî\n2. ÌéòÏù¥ÏßÄÎ•º ÏÉàÎ°úÍ≥†Ïπ®Ìï¥Ï£ºÏÑ∏Ïöî (F5 ÎòêÎäî Ctrl+R)');
                    return;
                }

                // Í∏∞Ï°¥ Ï¢åÌëú Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
                let columnCoordinates = {};
                try {
                    const savedCoords = localStorage.getItem('columnCoordinates');
                    if (savedCoords) {
                        columnCoordinates = JSON.parse(savedCoords);
                        console.log('ÏóëÏÖÄ Ï†ÄÏû•Ïö© Ï¢åÌëú Îç∞Ïù¥ÌÑ∞ Î°úÎìú:', columnCoordinates);
                    }
                } catch (e) {
                    console.warn('Ï¢åÌëú Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®:', e);
                }

                // ÏóëÏÖÄ Îç∞Ïù¥ÌÑ∞ Ï§ÄÎπÑ
                const excelData = [];
                
                // Ìó§Îçî (Í∏∞Ï°¥ Ï¢åÌëú Ìè¨Ìï®)
                excelData.push(['Í∏∞Îë•Î≤àÌò∏', 'XÏ¢åÌëú', 'YÏ¢åÌëú', 'Î©¥Ï†ÅÎ∂ÑÎã¥Ïú® (%)', 'Îã¥ÎãπÎ©¥Ï†Å']);
                
                // Îç∞Ïù¥ÌÑ∞ Ìñâ (Í∏∞Ï°¥ Ï¢åÌëú Ìè¨Ìï®)
                results.forEach((result) => {
                    const coord = columnCoordinates[result.name];
                    let xCoord = '';
                    let yCoord = '';
                    
                    if (coord) {
                        // ÏõêÎûò Ï¢åÌëú Í∞í Í∑∏ÎåÄÎ°ú ÏÇ¨Ïö© (Ï†ïÍ∑úÌôîÌïòÏßÄ ÏïäÏùå)
                        // coord.leftÏôÄ coord.topÏùÄ ÏõêÎ≥∏ Í∞íÏù¥ÎØÄÎ°ú Í∑∏ÎåÄÎ°ú ÏÇ¨Ïö©
                        const originalX = coord.left;
                        const originalY = coord.top;
                        
                        // ÏõêÎûò Ï¢åÌëú Í∞í ÌôïÏù∏ Î∞è Ï∂úÎ†•
                        console.log(`Í∏∞Îë• ${result.name}: ÏõêÎûò Ï¢åÌëú X=${originalX}, Y=${originalY}`);
                        
                        // ÏõêÎûò Ï¢åÌëú Í∞íÏùÑ Í∑∏ÎåÄÎ°ú ÏÇ¨Ïö© (Ïà´ÏûêÎì† Î¨∏ÏûêÏó¥Ïù¥Îì† Í∑∏ÎåÄÎ°ú)
                        xCoord = originalX !== undefined && originalX !== null ? String(originalX) : '';
                        yCoord = originalY !== undefined && originalY !== null ? String(originalY) : '';
                    } else {
                        console.warn(`Í∏∞Îë• ${result.name}Ïùò Ï¢åÌëúÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.`);
                    }
                    
                    excelData.push([
                        result.name,
                        xCoord,
                        yCoord,
                        result.areaRatio.toFixed(2),
                        result.actualArea.toFixed(2)
                    ]);
                });
                
                // Ìï©Í≥Ñ Ìñâ
                excelData.push([
                    'Ìï©Í≥Ñ',
                    '-',
                    '-',
                    data.sumOfRatios.toFixed(2),
                    data.sumOfAreas.toFixed(2)
                ]);
                
                // Îπà Ìñâ
                excelData.push([]);
                
                // Í≤ÄÏ¶ù Ï†ïÎ≥¥
                excelData.push(['=== Î©¥Ï†Å Í≤ÄÏ¶ù Í≤∞Í≥º ===']);
                excelData.push(['Ï†ÑÏ≤¥ Î©¥Ï†Å', data.totalArea.toFixed(2)]);
                excelData.push(['Îã¥ÎãπÎ©¥Ï†Å Ìï©ÏÇ∞', data.sumOfAreas.toFixed(2)]);
                excelData.push(['Î©¥Ï†Å Ï∞®Ïù¥', data.areaDifference.toFixed(4)]);
                excelData.push(['Î©¥Ï†ÅÎ∂ÑÎã¥Ïú® Ìï©', data.sumOfRatios.toFixed(2) + '%']);
                excelData.push(['Î©¥Ï†ÅÎ∂ÑÎã¥Ïú® Ï∞®Ïù¥', data.ratioDifference.toFixed(4) + '%']);
                excelData.push(['Ï¥ù Í∏∞Îë• Ïàò', results.length + 'Í∞ú']);
                
                // Í≤ΩÍ≥Ñ Í∏∞Îë• Ï†ïÎ≥¥
                if (data.selectedBoundary && data.selectedBoundary.length === 4) {
                    excelData.push([]);
                    excelData.push(['=== Í≤ΩÍ≥Ñ Í∏∞Îë• Ï†ïÎ≥¥ ===']);
                    data.selectedBoundary.forEach((name, idx) => {
                        excelData.push([`Í≤ΩÍ≥Ñ Í∏∞Îë• ${idx + 1}`, name]);
                    });
                }
                
                // Î©îÌÉÄ Ï†ïÎ≥¥
                excelData.push([]);
                excelData.push(['=== ÏÉùÏÑ± Ï†ïÎ≥¥ ===']);
                excelData.push(['ÏÉùÏÑ± ÏùºÏãú', new Date().toLocaleString('ko-KR')]);
                excelData.push(['Í≥ÑÏÇ∞ Î∞©Î≤ï', 'Voronoi Îã§Ïù¥Ïñ¥Í∑∏Îû® (Í∑∏Î¶¨Îìú Î∞©Ïãù)']);

                // ÏõåÌÅ¨Î∂Å ÏÉùÏÑ±
                const wb = XLSXLib.utils.book_new();
                const ws = XLSXLib.utils.aoa_to_sheet(excelData);
                
                // Ïª¨Îüº ÎÑàÎπÑ ÏÑ§Ï†ï
                ws['!cols'] = [
                    { wch: 15 },  // Í∏∞Îë•Î≤àÌò∏
                    { wch: 12 },  // XÏ¢åÌëú
                    { wch: 12 },  // YÏ¢åÌëú
                    { wch: 15 },  // Î©¥Ï†ÅÎ∂ÑÎã¥Ïú®
                    { wch: 15 }   // Îã¥ÎãπÎ©¥Ï†Å
                ];
                
                // Ìó§Îçî Ìñâ Ïä§ÌÉÄÏùº (Ï≤´ Î≤àÏß∏ Ìñâ)
                const headerRange = XLSXLib.utils.decode_range(ws['!ref']);
                for (let col = headerRange.s.c; col <= headerRange.e.c; col++) {
                    const cellAddress = XLSXLib.utils.encode_cell({ r: 0, c: col });
                    if (!ws[cellAddress]) continue;
                    ws[cellAddress].s = {
                        font: { bold: true, color: { rgb: "FFFFFF" } },
                        fill: { fgColor: { rgb: "667EEA" } },
                        alignment: { horizontal: "center", vertical: "center" }
                    };
                }
                
                // Ìï©Í≥Ñ Ìñâ Ïä§ÌÉÄÏùº
                const sumRowIndex = results.length + 1;
                for (let col = 0; col < 5; col++) {
                    const cellAddress = XLSXLib.utils.encode_cell({ r: sumRowIndex, c: col });
                    if (!ws[cellAddress]) continue;
                    ws[cellAddress].s = {
                        font: { bold: true },
                        fill: { fgColor: { rgb: "E8F4F8" } }
                    };
                }
                
                // ÏãúÌä∏Î•º ÏõåÌÅ¨Î∂ÅÏóê Ï∂îÍ∞Ä
                XLSXLib.utils.book_append_sheet(wb, ws, 'Î©¥Ï†ÅÎ∂ÑÎã¥Ïú® Í≤∞Í≥º');
                
                // ÌååÏùºÎ™Ö ÏÉùÏÑ± (ÎÇ†Ïßú Ìè¨Ìï®)
                const now = new Date();
                const dateStr = now.getFullYear() + 
                              String(now.getMonth() + 1).padStart(2, '0') + 
                              String(now.getDate()).padStart(2, '0') + '_' +
                              String(now.getHours()).padStart(2, '0') +
                              String(now.getMinutes()).padStart(2, '0');
                const fileName = `Î©¥Ï†ÅÎ∂ÑÎã¥Ïú®_Í≤∞Í≥º_${dateStr}.xlsx`;
                
                // ÌååÏùº Îã§Ïö¥Î°úÎìú
                XLSXLib.writeFile(wb, fileName);
                
                console.log('ÏóëÏÖÄ ÌååÏùº Îã§Ïö¥Î°úÎìú ÏôÑÎ£å:', fileName);
                alert('ÏóëÏÖÄ ÌååÏùºÏù¥ Îã§Ïö¥Î°úÎìúÎêòÏóàÏäµÎãàÎã§.\n\nÌååÏùºÎ™Ö: ' + fileName);
                
            } catch (error) {
                console.error('ÏóëÏÖÄ Ï†ÄÏû• Ïò§Î•ò:', error);
                alert('ÏóëÏÖÄ ÌååÏùº Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§:\n\n' + error.message + '\n\nÎ∏åÎùºÏö∞Ï†Ä ÏΩòÏÜî(F12)ÏóêÏÑú ÏûêÏÑ∏Ìïú Ïò§Î•òÎ•º ÌôïÏù∏ÌïòÏÑ∏Ïöî.');
            }
        };

        // Voronoi ÏòÅÏó≠ÏùÑ CanvasÏóê Í∑∏Î¶¨Í∏∞
        function drawVoronoiRegions(points, columnNames, bounds, areaCounts) {
            const canvas = document.getElementById('columnMapCanvas');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;

            // Ï¢åÌëúÎ•º ÌîΩÏÖÄÎ°ú Î≥ÄÌôòÌïòÎäî Ìï®Ïàò
            function coordToPixel(x, y) {
                const pixelX = ((x - bounds.minX) / (bounds.maxX - bounds.minX || 1)) * width;
                const pixelY = ((y - bounds.minY) / (bounds.maxY - bounds.minY || 1)) * height;
                return { x: pixelX, y: pixelY };
            }

            // Í∑∏Î¶¨Îìú Ìï¥ÏÉÅÎèÑ
            const gridSize = 50;
            const stepX = (bounds.maxX - bounds.minX) / gridSize;
            const stepY = (bounds.maxY - bounds.minY) / gridSize;

            // Í∞Å Í∑∏Î¶¨Îìú ÏÖÄÏóê ÏÉâÏÉÅ Ìï†Îãπ
            const colors = [
                'rgba(102, 126, 234, 0.1)',   // Î≥¥ÎùºÏÉâ
                'rgba(239, 68, 68, 0.1)',     // Îπ®Í∞ÑÏÉâ
                'rgba(34, 197, 94, 0.1)',     // Ï¥àÎ°ùÏÉâ
                'rgba(251, 146, 60, 0.1)',    // Ï£ºÌô©ÏÉâ
                'rgba(59, 130, 246, 0.1)',    // ÌååÎûÄÏÉâ
                'rgba(168, 85, 247, 0.1)',    // ÏûêÏ£ºÏÉâ
            ];

            // Í∞Å Í∑∏Î¶¨Îìú ÏÖÄ Í∑∏Î¶¨Í∏∞
            for (let i = 0; i < gridSize; i++) {
                for (let j = 0; j < gridSize; j++) {
                    const gridX = bounds.minX + i * stepX;
                    const gridY = bounds.minY + j * stepY;

                    // Í∞ÄÏû• Í∞ÄÍπåÏö¥ Í∏∞Îë• Ï∞æÍ∏∞
                    let minDist = Infinity;
                    let nearestIndex = 0;

                    points.forEach((point, idx) => {
                        const dist = Math.sqrt(
                            Math.pow(gridX - point.x, 2) + 
                            Math.pow(gridY - point.y, 2)
                        );
                        if (dist < minDist) {
                            minDist = dist;
                            nearestIndex = idx;
                        }
                    });

                    // Ìï¥Îãπ ÏòÅÏó≠ ÏÉâÏÉÅÏúºÎ°ú Ïπ†ÌïòÍ∏∞
                    const color = colors[nearestIndex % colors.length];
                    const pixel1 = coordToPixel(gridX, gridY);
                    const pixel2 = coordToPixel(gridX + stepX, gridY + stepY);

                    ctx.fillStyle = color;
                    ctx.fillRect(pixel1.x, pixel1.y, pixel2.x - pixel1.x, pixel2.y - pixel1.y);
                }
            }

            // Í∏∞Îë• ÏúÑÏπò Îã§Ïãú Í∑∏Î¶¨Í∏∞ (ÏúÑÏóê ÌëúÏãú)
            points.forEach((point, idx) => {
                const pos = coordToPixel(point.x, point.y);
                ctx.fillStyle = '#ef4444';
                ctx.beginPath();
                ctx.arc(pos.x, pos.y, 8, 0, Math.PI * 2);
                ctx.fill();
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 2;
                ctx.stroke();
            });

            // ÎßàÏª§ ÎùºÎ≤® Îã§Ïãú Í∑∏Î¶¨Í∏∞
            const markersContainer = document.getElementById('columnMapMarkers');
            if (markersContainer) {
                markersContainer.innerHTML = '';
                points.forEach((point, idx) => {
                    const pos = coordToPixel(point.x, point.y);
                    const marker = document.createElement('div');
                    marker.style.position = 'absolute';
                    marker.style.left = pos.x + 'px';
                    marker.style.top = pos.y + 'px';
                    marker.style.transform = 'translate(-50%, calc(-100% - 12px))';
                    marker.style.padding = '3px 8px';
                    marker.style.backgroundColor = 'rgba(0,0,0,0.8)';
                    marker.style.color = 'white';
                    marker.style.fontSize = '11px';
                    marker.style.fontWeight = '600';
                    marker.style.borderRadius = '4px';
                    marker.style.whiteSpace = 'nowrap';
                    marker.style.pointerEvents = 'none';
                    marker.style.zIndex = '10';
                    marker.textContent = columnNames[idx];
                    markersContainer.appendChild(marker);
                });
            }
        }

        // Í∏∞Îë• ÎßàÏª§ ÌëúÏãú Ìï®Ïàò
        function renderColumnMarkers() {
            const markersContainer = document.getElementById('columnMarkers');
            const preview = document.getElementById('columnPlanPreview');
            const img = document.getElementById('columnPlanImage');
            
            if (!markersContainer || !preview) {
                console.log('ÎßàÏª§ Ïª®ÌÖåÏù¥ÎÑà ÎòêÎäî ÎØ∏Î¶¨Î≥¥Í∏∞ Ïª®ÌÖåÏù¥ÎÑàÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                return;
            }
            
            if (preview.style.display === 'none' || !img) {
                console.log('Ïù¥ÎØ∏ÏßÄÍ∞Ä ÌëúÏãúÎêòÏßÄ ÏïäÍ±∞ÎÇò Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏóÜÏäµÎãàÎã§.');
                return;
            }
            
            // Ïù¥ÎØ∏ÏßÄÍ∞Ä Î°úÎìúÎêòÏßÄ ÏïäÏïòÏúºÎ©¥ ÎåÄÍ∏∞
            if (!img.complete || img.naturalWidth === 0) {
                console.log('Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏïÑÏßÅ Î°úÎìúÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§. ÎåÄÍ∏∞ Ï§ë...');
                img.onload = function() {
                    setTimeout(renderColumnMarkers, 100);
                };
                return;
            }
            
            // Í∏∞Ï°¥ ÎßàÏª§ Ï†úÍ±∞
            markersContainer.innerHTML = '';
            
            // Ï¢åÌëú Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
            let columnCoordinates = {};
            try {
                const savedCoords = localStorage.getItem('columnCoordinates');
                if (savedCoords) {
                    columnCoordinates = JSON.parse(savedCoords);
                    console.log('Ï¢åÌëú Îç∞Ïù¥ÌÑ∞ Î°úÎìú:', columnCoordinates);
                } else {
                    console.log('Ï†ÄÏû•Îêú Ï¢åÌëú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.');
                }
            } catch (e) {
                console.warn('Ï¢åÌëú Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®:', e);
                return;
            }
            
            // Í∏∞Îë•Î≤àÌò∏ Í∞ÄÏ†∏Ïò§Í∏∞ (localStorageÏùò columnCoordinatesÏóêÏÑú)
            const columnNumbers = Object.keys(columnCoordinates).filter(name => name && name.trim());
            if (columnNumbers.length === 0) {
                console.log('Í∏∞Îë•Î≤àÌò∏Í∞Ä ÏóÜÏäµÎãàÎã§. ÏóëÏÖÄÏùÑ ÏóÖÎ°úÎìúÌïòÍ±∞ÎÇò Í∏∞Î≥∏Í∞íÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî.');
                // Í∏∞Îë• Í∞úÏàò ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
                const countDisplay = document.getElementById('columnCountValue');
                if (countDisplay) {
                    countDisplay.textContent = '0';
                }
                return;
            }
            
            console.log('Í∏∞Îë•Î≤àÌò∏:', columnNumbers);
            
            // Í∏∞Îë• Í∞úÏàò Î∞è Î™©Î°ù ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
            updateColumnCountDisplay();
            
            // Ïù¥ÎØ∏ÏßÄÏùò Ïã§Ï†ú ÌëúÏãú ÌÅ¨Í∏∞ Í∞ÄÏ†∏Ïò§Í∏∞
            const rect = img.getBoundingClientRect();
            const imgWidth = rect.width;
            const imgHeight = rect.height;
            
            console.log('Ïù¥ÎØ∏ÏßÄ ÌÅ¨Í∏∞:', imgWidth, 'x', imgHeight);
            
            // ÎßàÏª§ Ïª®ÌÖåÏù¥ÎÑà ÌÅ¨Í∏∞ ÏÑ§Ï†ï
            markersContainer.style.width = imgWidth + 'px';
            markersContainer.style.height = imgHeight + 'px';
            
            // Í∞Å Í∏∞Îë•Ïóê ÎåÄÌï¥ ÎßàÏª§ ÏÉùÏÑ±
            columnNumbers.forEach((columnName, index) => {
                const coord = columnCoordinates[columnName.trim()];
                if (!coord) {
                    console.log(`Í∏∞Îë• ${columnName.trim()}Ïùò Ï¢åÌëúÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.`);
                    return;
                }
                
                // Ï¢åÌëúÎ•º ÌîΩÏÖÄÎ°ú Î≥ÄÌôò (ÌçºÏÑºÌä∏ Í∏∞Î∞ò)
                let leftPercent = parseFloat(coord.left) || 0;
                let topPercent = parseFloat(coord.top) || 0;
                
                // 10000 Ïù¥ÏÉÅÏù¥Î©¥ 100ÏúºÎ°ú ÎÇòÎàî (Ïòà: 10000 -> 100%)
                if (leftPercent > 100) {
                    leftPercent = leftPercent / 100;
                }
                if (topPercent > 100) {
                    topPercent = topPercent / 100;
                }
                
                // ÌçºÏÑºÌä∏Î•º ÌîΩÏÖÄ ÏúÑÏπòÎ°ú Î≥ÄÌôò
                const left = (leftPercent / 100) * imgWidth;
                const top = (topPercent / 100) * imgHeight;
                
                console.log(`Í∏∞Îë• ${columnName}: Ï¢åÌëú (${coord.left}, ${coord.top}) -> ÌîΩÏÖÄ (${left.toFixed(1)}, ${top.toFixed(1)})`);
                
                // ÎßàÏª§ ÏÉùÏÑ± (Îçî ÌÅ¨Í≥† ÎààÏóê ÎùÑÍ≤å)
                const marker = document.createElement('div');
                marker.style.position = 'absolute';
                marker.style.left = left + 'px';
                marker.style.top = top + 'px';
                marker.style.width = '40px';
                marker.style.height = '40px';
                marker.style.borderRadius = '50%';
                marker.style.backgroundColor = '#dc2626'; // Îçî ÏßÑÌïú Îπ®Í∞ÑÏÉâ
                marker.style.border = '4px solid white';
                marker.style.boxShadow = '0 4px 12px rgba(0,0,0,0.7), 0 0 0 2px rgba(220, 38, 38, 0.3)';
                marker.style.transform = 'translate(-50%, -50%)';
                marker.style.cursor = 'pointer';
                marker.style.pointerEvents = 'auto';
                marker.style.zIndex = '10';
                marker.style.display = 'flex';
                marker.style.alignItems = 'center';
                marker.style.justifyContent = 'center';
                marker.title = columnName;
                
                // ÎßàÏª§ ÎÇ¥Î∂ÄÏóê Î≤àÌò∏ ÌëúÏãú (ÏûëÍ≤å)
                const markerNumber = document.createElement('span');
                markerNumber.textContent = columnName.replace(/\D/g, ''); // Ïà´ÏûêÎßå Ï∂îÏ∂ú
                markerNumber.style.color = 'white';
                markerNumber.style.fontSize = '14px';
                markerNumber.style.fontWeight = '700';
                markerNumber.style.textShadow = '0 1px 2px rgba(0,0,0,0.5)';
                marker.appendChild(markerNumber);
                
                // Í∏∞Îë•Î≤àÌò∏ ÎùºÎ≤® Ï∂îÍ∞Ä (Îçî ÌÅ¨Í≥† Î™ÖÌôïÌïòÍ≤å)
                const label = document.createElement('div');
                label.textContent = columnName;
                label.style.position = 'absolute';
                label.style.left = '50%';
                label.style.top = '100%';
                label.style.transform = 'translateX(-50%)';
                label.style.marginTop = '8px';
                label.style.padding = '5px 12px';
                label.style.backgroundColor = '#000000';
                label.style.color = '#ffffff';
                label.style.fontSize = '14px';
                label.style.fontWeight = '700';
                label.style.borderRadius = '6px';
                label.style.whiteSpace = 'nowrap';
                label.style.pointerEvents = 'none';
                label.style.zIndex = '11';
                label.style.boxShadow = '0 2px 8px rgba(0,0,0,0.4)';
                label.style.border = '2px solid #ffffff';
                
                marker.appendChild(label);
                markersContainer.appendChild(marker);
            });
            
            console.log(`Ï¥ù ${columnNumbers.length}Í∞úÏùò ÎßàÏª§Î•º ÏÉùÏÑ±ÌñàÏäµÎãàÎã§.`);
        }

        // Í∏∞Îë•ÌèâÎ©¥ÎèÑ ÌååÏùº Ï≤òÎ¶¨
        function handleColumnPlanFile(input) {
            const file = input.files[0];
            if (file) {
                document.getElementById('columnPlanFileName').textContent = file.name;
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('columnPlanPreview');
                    const img = document.getElementById('columnPlanImage');
                    img.src = e.target.result;
                    preview.style.display = 'block';
                    // Ïù¥ÎØ∏ÏßÄ Î°úÎìú ÌõÑ ÎßàÏª§ ÌëúÏãú
                    img.onload = function() {
                        setTimeout(function() {
                            console.log('Ïù¥ÎØ∏ÏßÄ Î°úÎìú ÏôÑÎ£å, ÎßàÏª§ Í∑∏Î¶¨Í∏∞ ÏãúÎèÑ');
                            renderColumnMarkers();
                        }, 300);
                    };
                    // Ïù¥ÎØ∏ÏßÄÍ∞Ä Ïù¥ÎØ∏ Î°úÎìúÎêòÏñ¥ ÏûàÎäî Í≤ΩÏö∞
                    if (img.complete && img.naturalWidth > 0) {
                        setTimeout(function() {
                            console.log('Ïù¥ÎØ∏ÏßÄÍ∞Ä Ïù¥ÎØ∏ ÏôÑÎ£åÎê®, ÎßàÏª§ Í∑∏Î¶¨Í∏∞ ÏãúÎèÑ');
                            renderColumnMarkers();
                        }, 300);
                    }
                };
                reader.readAsDataURL(file);
            }
        }

        // Í∏∞Îë•ÌèâÎ©¥ÎèÑ ÏûÖÎ†• Ï†ÄÏû•
        function saveColumnPlanInput() {
            const fileInput = document.getElementById('columnPlanFile');
            const file = fileInput.files[0];
            
            // localStorageÏóêÏÑú Í∏∞Îë•Î≤àÌò∏ Í∞ÄÏ†∏Ïò§Í∏∞
            let columnNumbers = [];
            try {
                const savedCoords = localStorage.getItem('columnCoordinates');
                if (savedCoords) {
                    const coords = JSON.parse(savedCoords);
                    columnNumbers = Object.keys(coords);
                }
            } catch (e) {
                console.warn('Í∏∞Îë•Î≤àÌò∏ Î°úÎìú Ïã§Ìå®:', e);
            }
            
            const data = {
                columnNumbers: columnNumbers.join('\n'),
                fileName: file ? file.name : null,
                timestamp: new Date().toISOString()
            };
            
            // ÌååÏùºÏù¥ ÏûàÏúºÎ©¥ base64Î°ú Ï†ÄÏû•
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    data.imageData = e.target.result;
                    localStorage.setItem('columnPlanInputData', JSON.stringify(data));
                    alert('Í∏∞Îë•ÌèâÎ©¥ÎèÑ Î∞è Í∏∞Îë•Î≤àÌò∏Í∞Ä Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.');
                    closeColumnPlanInput();
                };
                reader.readAsDataURL(file);
            } else {
                if (columnNumbers.length > 0) {
                    localStorage.setItem('columnPlanInputData', JSON.stringify(data));
                    alert('Í∏∞Îë•Î≤àÌò∏Í∞Ä Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.');
                } else {
                    alert('Ï†ÄÏû•Ìï† Í∏∞Îë•Î≤àÌò∏Í∞Ä ÏóÜÏäµÎãàÎã§. ÏóëÏÖÄÏùÑ ÏóÖÎ°úÎìúÌï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }
                closeColumnPlanInput();
            }
        }

        // Í∏∞Îë•ÌèâÎ©¥ÎèÑ ÏûÖÎ†• Î™®Îã¨ Îã´Í∏∞
        function closeColumnPlanInput() {
            const modal = document.getElementById('columnPlanInputModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        // ÏóëÏÖÄ ÌååÏùºÏóêÏÑú Í∏∞Îë•Î≤àÌò∏ Í∞ÄÏ†∏Ïò§Í∏∞ (Í∏∞Îë•Î≤àÌò∏Îßå ÏóÖÎç∞Ïù¥Ìä∏)
        async function importColumnNumbersFromExcel(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // XLSX ÎùºÏù¥Î∏åÎü¨Î¶¨ ÌôïÏù∏ Î∞è ÎåÄÍ∏∞
            let XLSXLib = window.XLSX || (typeof XLSX !== 'undefined' ? XLSX : null);
            
            if (!XLSXLib || typeof XLSXLib.read === 'undefined') {
                // ÎùºÏù¥Î∏åÎü¨Î¶¨ Î°úÎìú ÏãúÎèÑ (Î∞±ÏóÖ)
                console.log('XLSX ÎùºÏù¥Î∏åÎü¨Î¶¨ Î°úÎìú Ï§ë...');
                try {
                    // ÏßÅÏ†ë Ïä§ÌÅ¨Î¶ΩÌä∏ Î°úÎìú
                    await new Promise((resolve, reject) => {
                        const script = document.createElement('script');
                        script.src = 'https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js';
                        script.onload = function() {
                            setTimeout(function() {
                                if (typeof XLSX !== 'undefined' && window.XLSX && window.XLSX.utils) {
                                    console.log('XLSX ÎùºÏù¥Î∏åÎü¨Î¶¨ Î°úÎìú ÏÑ±Í≥µ');
                                    XLSXLib = window.XLSX;
                                    resolve();
                                } else {
                                    reject(new Error('XLSX Í∞ùÏ≤¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.'));
                                }
                            }, 100);
                        };
                        script.onerror = function() {
                            reject(new Error('Ïä§ÌÅ¨Î¶ΩÌä∏ Î°úÎìú Ïã§Ìå®'));
                        };
                        document.head.appendChild(script);
                    });
                } catch (loadError) {
                    console.error('XLSX ÎùºÏù¥Î∏åÎü¨Î¶¨ Î°úÎìú Ïã§Ìå®:', loadError);
                    alert('ÏóëÏÖÄ ÎùºÏù¥Î∏åÎü¨Î¶¨Î•º Î°úÎìúÌï† Ïàò ÏóÜÏäµÎãàÎã§.\n\nÌï¥Í≤∞ Î∞©Î≤ï:\n1. Ïù∏ÌÑ∞ÎÑ∑ Ïó∞Í≤∞ÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî\n2. Î∏åÎùºÏö∞Ï†Ä Ï∫êÏãúÎ•º ÏÇ≠Ï†úÌïòÍ≥† ÌéòÏù¥ÏßÄÎ•º ÏÉàÎ°úÍ≥†Ïπ®Ìï¥Ï£ºÏÑ∏Ïöî (Ctrl+Shift+R)\n3. Î∏åÎùºÏö∞Ï†Ä ÏΩòÏÜî(F12)ÏóêÏÑú ÏûêÏÑ∏Ìïú Ïò§Î•òÎ•º ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî\n4. Î∞©ÌôîÎ≤ΩÏù¥ÎÇò Î≥¥Ïïà ÌîÑÎ°úÍ∑∏Îû®Ïù¥ CDN Ï†ëÍ∑ºÏùÑ Ï∞®Îã®ÌïòÏßÄ ÏïäÎäîÏßÄ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî');
                    return;
                }
            }
            
            if (!XLSXLib || typeof XLSXLib.read === 'undefined') {
                alert('ÏóëÏÖÄ ÎùºÏù¥Î∏åÎü¨Î¶¨Í∞Ä Î°úÎìúÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.\n\nÌï¥Í≤∞ Î∞©Î≤ï:\n1. ÌéòÏù¥ÏßÄÎ•º ÏÉàÎ°úÍ≥†Ïπ®Ìï¥Ï£ºÏÑ∏Ïöî (F5 ÎòêÎäî Ctrl+R)\n2. Ïù∏ÌÑ∞ÎÑ∑ Ïó∞Í≤∞ÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî');
                console.error('XLSX is not defined for importColumnNumbersFromExcel');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSXLib.read(data, { type: 'array' });
                    
                    // Ï≤´ Î≤àÏß∏ ÏãúÌä∏ ÏÇ¨Ïö©
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    
                    // JSONÏúºÎ°ú Î≥ÄÌôò
                    const jsonData = XLSXLib.utils.sheet_to_json(worksheet, { header: 1, defval: '' });
                    
                    if (jsonData.length < 2) {
                        alert('ÏóëÏÖÄ ÌååÏùºÏóê Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§. Ìó§Îçî ÌñâÍ≥º ÏµúÏÜå 1Í∞úÏùò Îç∞Ïù¥ÌÑ∞ ÌñâÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                        return;
                    }
                    
                    // Ìó§Îçî ÌôïÏù∏ (Ï≤´ Î≤àÏß∏ Ìñâ)
                    const headers = jsonData[0].map(h => String(h).toLowerCase().trim());
                    const noIdx = headers.findIndex(h => h.includes('no') || h.includes('Î≤àÌò∏'));
                    // Í∏∞Îë•Î≤àÌò∏ Ïª¨Îüº Ï∞æÍ∏∞: 'Í∏∞Îë•', 'name', 'auto name', 'Ïù¥Î¶Ñ', 'Î™Ö', 'column' Îì±
                    const nameIdx = headers.findIndex(h => 
                        h.includes('Í∏∞Îë•') || 
                        h.includes('name') || 
                        h.includes('Ïù¥Î¶Ñ') || 
                        h.includes('Î™Ö') || 
                        h.includes('column') ||
                        h.includes('auto')
                    );
                    
                    // Ï¢åÌëú Ïª¨Îüº Ï∞æÍ∏∞ (ÎåÄÏÜåÎ¨∏Ïûê Î¨¥Ïãú)
                    // Ï£ºÏùò: Z Ï¢åÌëúÎäî Ï∞æÏßÄ ÏïäÏùå (ÌèâÎ©¥ÎèÑÏù¥ÎØÄÎ°ú X, YÎßå ÏÇ¨Ïö©)
                    const xIdx = headers.findIndex(h => {
                        const lower = h.toLowerCase();
                        return (lower === 'x' || lower.includes('x') || lower.includes('Í∞ÄÎ°ú') || lower.includes('left') || lower.includes('Ï¢åÌëúx')) && 
                               !lower.includes('index') && !lower.includes('idx') && !lower.includes('z');
                    });
                    const yIdx = headers.findIndex(h => {
                        const lower = h.toLowerCase();
                        return (lower === 'y' || lower.includes('y') || lower.includes('ÏÑ∏Î°ú') || lower.includes('top') || lower.includes('Ï¢åÌëúy')) && 
                               !lower.includes('type') && !lower.includes('year') && !lower.includes('z');
                    });
                    // Z Ï¢åÌëúÎäî ÏûêÎèôÏúºÎ°ú Î¨¥ÏãúÎê® (ÌèâÎ©¥ÎèÑ ÏãúÏä§ÌÖúÏù¥ÎØÄÎ°ú X, YÎßå ÌïÑÏöî)
                    
                    if (nameIdx === -1) {
                        alert('ÏóëÏÖÄ ÌååÏùºÏóê Í∏∞Îë•Î≤àÌò∏/Ïù¥Î¶Ñ Ïª¨ÎüºÏù¥ ÏóÜÏäµÎãàÎã§.\n\nÌïÑÏöîÌïú Ïª¨Îüº: "Í∏∞Îë•Î≤àÌò∏", "Auto Name", "Name" Îì±');
                        return;
                    }
                    
                    // Îç∞Ïù¥ÌÑ∞ ÌååÏã± Î∞è textareaÏóê ÏûÖÎ†•
                    const columnNumbers = [];
                    // ÏóëÏÖÄ ÏóÖÎ°úÎìú Ïãú Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞Î•º Ï¥àÍ∏∞ÌôîÌïòÍ≥† ÏóëÏÖÄ ÌååÏùºÏùò Îç∞Ïù¥ÌÑ∞Îßå ÏÇ¨Ïö©
                    // Ï§ëÎ≥µÎêú Í∏∞Îë•Î≤àÌò∏Î•º ÌóàÏö©ÌïòÍ∏∞ ÏúÑÌï¥ Î∞∞Ïó¥ ÌòïÌÉúÎ°ú Ï†ÄÏû•
                    let columnCoordinates = {};
                    let columnCoordinatesArray = []; // Î™®Îì† ÌñâÏùÑ ÏàúÏÑúÎåÄÎ°ú Ï†ÄÏû•
                    let hasCoordinates = false;
                    let nameCountMap = {}; // Í∞Å Í∏∞Îë•Î≤àÌò∏Ïùò Îì±Ïû• ÌöüÏàò Ï∂îÏ†Å
                    
                    console.log('ÏóëÏÖÄ ÌååÏùº Ï¥ù Ìñâ Ïàò:', jsonData.length);
                    console.log('Ìó§Îçî Ïù∏Îç±Ïä§ - nameIdx:', nameIdx, 'xIdx:', xIdx, 'yIdx:', yIdx);
                    
                    for (let i = 1; i < jsonData.length; i++) {
                        const row = jsonData[i];
                        if (!row || row.length === 0) {
                            console.log(`Ìñâ ${i}: Îπà Ìñâ Í±¥ÎÑàÎúÄ`);
                            continue;
                        }
                        
                        const name = nameIdx !== -1 ? String(row[nameIdx] || '').trim() : '';
                        console.log(`Ìñâ ${i}: Í∏∞Îë•Î≤àÌò∏ = "${name}"`, row);
                        
                        if (name) {
                            // Ï§ëÎ≥µÎêú Ïù¥Î¶ÑÏùÑ Í≥†Ïú†ÌïòÍ≤å ÎßåÎì§Í∏∞ (Ïòà: Ï≤´ Î≤àÏß∏ KC2 -> KC2, Îëê Î≤àÏß∏ KC2 -> KC2-2)
                            let uniqueName = name;
                            if (nameCountMap.hasOwnProperty(name)) {
                                nameCountMap[name]++;
                                uniqueName = `${name}-${nameCountMap[name]}`;
                            } else {
                                nameCountMap[name] = 1;
                                // Ï≤´ Î≤àÏß∏Îäî ÏõêÎûò Ïù¥Î¶Ñ ÏÇ¨Ïö©, Îã§ÏùåÎ∂ÄÌÑ∞Îäî Ïà´Ïûê Î∂ôÏûÑ
                            }
                            
                            console.log(`Ìñâ ${i}: ÏõêÎ≥∏ Ïù¥Î¶Ñ="${name}", Í≥†Ïú† Ïù¥Î¶Ñ="${uniqueName}", nameCountMap[${name}]=${nameCountMap[name]}`);
                            columnNumbers.push(uniqueName);
                            
                            // No. Ï†ïÎ≥¥ Î®ºÏ†Ä Ï∂îÏ∂ú
                            const no = noIdx !== -1 ? (parseInt(row[noIdx]) || (i)) : (i);
                            
                            // Ï¢åÌëúÍ∞Ä ÏûàÏúºÎ©¥ Ï†ÄÏû• (Î≤îÏúÑ Ï†úÌïú ÏóÜÏùå - 10000 Í∞ôÏùÄ ÌôïÏû•Í∞í ÌóàÏö©)
                            if (xIdx !== -1 && yIdx !== -1) {
                                const x = parseFloat(row[xIdx]);
                                const y = parseFloat(row[yIdx]);
                                
                                if (!isNaN(x) && !isNaN(y)) {
                                    // ÏùåÏàòÎßå Î∞©ÏßÄ
                                    const coordX = Math.max(0, x);
                                    const coordY = Math.max(0, y);
                                    
                                    // Í≥†Ïú† Ïù¥Î¶ÑÏúºÎ°ú Ï†ÄÏû• (Ï§ëÎ≥µ Î∞©ÏßÄ)
                                    columnCoordinates[uniqueName] = {
                                        left: coordX,
                                        top: coordY,
                                        originalName: name, // ÏõêÎ≥∏ Ïù¥Î¶ÑÎèÑ Ï†ÄÏû•
                                        no: no // No. Ï†ÄÏû•
                                    };
                                    hasCoordinates = true;
                                    console.log(`Ìñâ ${i}: ${uniqueName} (ÏõêÎ≥∏: ${name}, No.${no}) Ï¢åÌëú Ï†ÄÏû• (${coordX}, ${coordY})`);
                                } else {
                                    // Ï¢åÌëúÍ∞Ä ÏóÜÏúºÎ©¥ Í∏∞Î≥∏Í∞í 0, 0
                                    columnCoordinates[uniqueName] = {
                                        left: 0,
                                        top: 0,
                                        originalName: name,
                                        no: no // No. Ï†ÄÏû•
                                    };
                                    console.log(`Ìñâ ${i}: ${uniqueName} (ÏõêÎ≥∏: ${name}, No.${no}) Ï¢åÌëú ÏóÜÏùå, Í∏∞Î≥∏Í∞í (0, 0) Ï†ÄÏû•`);
                                }
                            } else {
                                // Ï¢åÌëú Ïª¨ÎüºÏù¥ ÏóÜÏñ¥ÎèÑ Í∏∞Îë•Î≤àÌò∏Îßå Ï†ÄÏû• (Ï¢åÌëúÎäî Í∏∞Î≥∏Í∞í 0, 0)
                                columnCoordinates[uniqueName] = {
                                    left: 0,
                                    top: 0,
                                    originalName: name,
                                    no: no // No. Ï†ÄÏû•
                                };
                                console.log(`Ìñâ ${i}: ${uniqueName} (ÏõêÎ≥∏: ${name}, No.${no}) Ï¢åÌëú Ïª¨Îüº ÏóÜÏùå, Í∏∞Î≥∏Í∞í (0, 0) Ï†ÄÏû•`);
                            }
                            
                            // Ï†ÄÏû• ÌôïÏù∏
                            if (columnCoordinates[uniqueName]) {
                                console.log(`‚úÖ Ìñâ ${i}: ${uniqueName} Ï†ÄÏû• ÌôïÏù∏Îê®`, columnCoordinates[uniqueName]);
                            } else {
                                console.error(`‚ùå Ìñâ ${i}: ${uniqueName} Ï†ÄÏû• Ïã§Ìå®!`);
                            }
                        } else {
                            console.log(`Ìñâ ${i}: Í∏∞Îë•Î≤àÌò∏Í∞Ä ÎπÑÏñ¥ÏûàÏñ¥ÏÑú Í±¥ÎÑàÎúÄ`);
                        }
                    }
                    
                    console.log('ÌååÏã± ÏôÑÎ£å - Ï≤òÎ¶¨Îêú Í∏∞Îë• Í∞úÏàò:', columnNumbers.length);
                    console.log('ÌååÏã± ÏôÑÎ£å - Í∏∞Îë•Î≤àÌò∏ Î™©Î°ù:', columnNumbers);
                    console.log('ÌååÏã± ÏôÑÎ£å - Ï¢åÌëú Í∞ùÏ≤¥:', columnCoordinates);
                    console.log('ÌååÏã± ÏôÑÎ£å - ÏóëÏÖÄ ÌååÏùº Ï¥ù Ìñâ Ïàò (Ìó§Îçî Ï†úÏô∏):', jsonData.length - 1);
                    console.log('ÌååÏã± ÏôÑÎ£å - Í∞Å ÌñâÏùò ÏÉÅÏÑ∏ Ï†ïÎ≥¥:');
                    Object.keys(columnCoordinates).forEach(key => {
                        const coord = columnCoordinates[key];
                        console.log(`  ${key}: No.${coord.no}, Ïù¥Î¶Ñ:${coord.originalName}, X:${coord.left}, Y:${coord.top}`);
                    });
                    
                    if (columnNumbers.length === 0) {
                        alert('ÏóëÏÖÄ ÌååÏùºÏóêÏÑú Ïú†Ìö®Ìïú Í∏∞Îë•Î≤àÌò∏Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                        return;
                    }
                    
                    // ÏóëÏÖÄ ÌååÏùºÏùò Ï¥ù Ìñâ ÏàòÏôÄ Ï≤òÎ¶¨Îêú Ìñâ Ïàò ÎπÑÍµê
                    const expectedRows = jsonData.length - 1; // Ìó§Îçî Ï†úÏô∏
                    if (columnNumbers.length !== expectedRows) {
                        console.warn(`Í≤ΩÍ≥†: ÏóëÏÖÄ ÌååÏùºÏóêÎäî ${expectedRows}Í∞ú ÌñâÏù¥ ÏûàÏßÄÎßå, ${columnNumbers.length}Í∞úÎßå Ï≤òÎ¶¨ÎêòÏóàÏäµÎãàÎã§.`);
                    }
                    
                    // localStorageÏóê Ï¢åÌëú Ï†ÄÏû• (Í∏∞Îë•Î≤àÌò∏ÏôÄ Ï¢åÌëú Î™®Îëê)
                    localStorage.setItem('columnCoordinates', JSON.stringify(columnCoordinates));
                    console.log('localStorage Ï†ÄÏû• ÏôÑÎ£å - Ï†ÄÏû•Îêú Îç∞Ïù¥ÌÑ∞:', JSON.stringify(columnCoordinates));
                    
                    // Ï†ÄÏû•Îêú Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏ (ÎîîÎ≤ÑÍπÖ)
                    console.log('ÏóëÏÖÄ ÏóÖÎ°úÎìú ÏôÑÎ£å - Ï†ÄÏû•Îêú Ï¢åÌëú:', columnCoordinates);
                    console.log('ÏóëÏÖÄ ÏóÖÎ°úÎìú ÏôÑÎ£å - Í∏∞Îë•Î≤àÌò∏ Í∞úÏàò:', columnNumbers.length);
                    console.log('ÏóëÏÖÄ ÏóÖÎ°úÎìú ÏôÑÎ£å - Í∏∞Îë•Î≤àÌò∏ Î™©Î°ù:', columnNumbers);
                    
                    // Ï†ÄÏû• ÏßÅÌõÑ localStorage Îã§Ïãú ÏùΩÏñ¥ÏÑú ÌôïÏù∏
                    const verifyData = localStorage.getItem('columnCoordinates');
                    if (verifyData) {
                        const verifyCoords = JSON.parse(verifyData);
                        const verifyCount = Object.keys(verifyCoords).length;
                        console.log('localStorage ÌôïÏù∏ - Ï†ÄÏû•Îêú Í∏∞Îë• Í∞úÏàò:', verifyCount);
                        console.log('localStorage ÌôïÏù∏ - Ï†ÄÏû•Îêú Í∏∞Îë•Î≤àÌò∏:', Object.keys(verifyCoords));
                    }
                    
                    // ÏóëÏÖÄ ÏóÖÎ°úÎìú ÏôÑÎ£å ÌõÑ ÌôîÎ©¥ ÎèôÍ∏∞Ìôî Í∞ïÏ†ú ÏóÖÎç∞Ïù¥Ìä∏
                    const modal = document.getElementById('columnPlanInputModal');
                    if (modal && modal.style.display !== 'none') {
                        // Ï¶âÏãú ÌôîÎ©¥ ÏóÖÎç∞Ïù¥Ìä∏ (Í∞ïÏ†ú)
                        console.log('=== ÏóëÏÖÄ ÏóÖÎ°úÎìú ÏôÑÎ£å - ÌôîÎ©¥ ÎèôÍ∏∞Ìôî ÏãúÏûë ===');
                        
                        // localStorageÏóêÏÑú Îã§Ïãú ÏùΩÏñ¥ÏÑú ÌôïÏã§ÌïòÍ≤å ÎèôÍ∏∞Ìôî
                        const freshData = localStorage.getItem('columnCoordinates');
                        if (freshData) {
                            const freshCoords = JSON.parse(freshData);
                            const freshCount = Object.keys(freshCoords).length;
                            console.log('ÎèôÍ∏∞Ìôî - localStorageÏóêÏÑú ÏùΩÏùÄ Í∏∞Îë• Í∞úÏàò:', freshCount);
                            console.log('ÎèôÍ∏∞Ìôî - localStorageÏóêÏÑú ÏùΩÏùÄ Í∏∞Îë•Î≤àÌò∏:', Object.keys(freshCoords));
                        }
                        
                        // ÌôîÎ©¥ ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò Ìò∏Ï∂ú (Ïó¨Îü¨ Î≤à Ìò∏Ï∂úÌïòÏó¨ ÌôïÏã§ÌïòÍ≤å)
                        updateColumnCountDisplay();
                        renderColumnMapView();
                        renderColumnMarkers();
                        
                        // ÏïΩÍ∞ÑÏùò ÏßÄÏó∞ ÌõÑ Îã§Ïãú ÏóÖÎç∞Ïù¥Ìä∏ (DOM ÏóÖÎç∞Ïù¥Ìä∏ ÎåÄÎπÑ)
                        setTimeout(function() {
                            console.log('ÎèôÍ∏∞Ìôî - 100ms ÌõÑ Ïû¨ÏóÖÎç∞Ïù¥Ìä∏');
                            updateColumnCountDisplay();
                            renderColumnMapView();
                            renderColumnMarkers();
                        }, 100);
                        
                        // Ï∂îÍ∞Ä ÏßÄÏó∞ ÌõÑ Ìïú Î≤à Îçî ÏóÖÎç∞Ïù¥Ìä∏ (Ïù¥ÎØ∏ÏßÄ Î°úÎî© ÎåÄÎπÑ)
                        setTimeout(function() {
                            console.log('ÎèôÍ∏∞Ìôî - 300ms ÌõÑ Ïû¨ÏóÖÎç∞Ïù¥Ìä∏');
                            updateColumnCountDisplay();
                            renderColumnMapView();
                            renderColumnMarkers();
                            
                            // ÏµúÏ¢Ö ÌôïÏù∏: ÌôîÎ©¥Ïóê ÌëúÏãúÎêú Í∞úÏàò ÌôïÏù∏
                            const finalCount = document.getElementById('columnCountValue');
                            if (finalCount) {
                                const displayCount = finalCount.textContent;
                                console.log('ÎèôÍ∏∞Ìôî ÏôÑÎ£å - ÌôîÎ©¥Ïóê ÌëúÏãúÎêú Í∏∞Îë• Í∞úÏàò:', displayCount);
                                console.log('ÎèôÍ∏∞Ìôî ÏôÑÎ£å - ÏóëÏÖÄ ÌååÏùº Ìñâ Ïàò:', expectedRows);
                                if (parseInt(displayCount) !== expectedRows) {
                                    console.warn('‚ö†Ô∏è ÎèôÍ∏∞Ìôî Î¨∏Ï†ú: ÌôîÎ©¥ ÌëúÏãú Í∞úÏàò(' + displayCount + ')ÏôÄ ÏóëÏÖÄ ÌååÏùº Ìñâ Ïàò(' + expectedRows + ')Í∞Ä ÏùºÏπòÌïòÏßÄ ÏïäÏäµÎãàÎã§.');
                                    // Ìïú Î≤à Îçî Í∞ïÏ†ú ÏóÖÎç∞Ïù¥Ìä∏
                                    updateColumnCountDisplay();
                                } else {
                                    console.log('‚úÖ ÎèôÍ∏∞Ìôî ÏÑ±Í≥µ: ÌôîÎ©¥Í≥º ÏóëÏÖÄ ÌååÏùºÏù¥ ÏùºÏπòÌï©ÎãàÎã§.');
                                }
                            }
                        }, 300);
                        
                        // ÎßàÏßÄÎßâÏúºÎ°ú Ìïú Î≤à Îçî ÏóÖÎç∞Ïù¥Ìä∏ (ÏµúÏ¢Ö ÌôïÏù∏)
                        setTimeout(function() {
                            console.log('ÎèôÍ∏∞Ìôî - 500ms ÌõÑ ÏµúÏ¢Ö ÌôïÏù∏');
                            updateColumnCountDisplay();
                        }, 500);
                    } else {
                        // Î™®Îã¨Ïù¥ Îã´ÌòÄÏûàÏñ¥ÎèÑ Í∏∞Î≥∏ ÏóÖÎç∞Ïù¥Ìä∏Îäî ÏàòÌñâ
                        updateColumnCountDisplay();
                    }
                    
                    let resultMessage = `Í∏∞Îë•Î≤àÌò∏ ${columnNumbers.length}Í∞úÎ•º Î∂àÎü¨ÏôîÏäµÎãàÎã§.\n\n${columnNumbers.slice(0, 10).join(', ')}${columnNumbers.length > 10 ? '...' : ''}`;
                    
                    if (hasCoordinates) {
                        const coordCount = columnNumbers.filter(name => columnCoordinates[name]).length;
                        resultMessage += `\n\nÏ¢åÌëú Ï†ïÎ≥¥:\n${coordCount}Í∞ú Í∏∞Îë•Ïùò Ï¢åÌëúÎ•º Ï†ÄÏû•ÌñàÏäµÎãàÎã§.\n(X, Y Ï¢åÌëúÎßå ÏÇ¨Ïö©, Z Ï¢åÌëúÎäî ÏûêÎèôÏúºÎ°ú Î¨¥ÏãúÎê®)`;
                    }
                    
                    // Z Ï¢åÌëú Ïª¨ÎüºÏù¥ ÏûàÎäîÏßÄ ÌôïÏù∏ÌïòÏó¨ ÏïàÎÇ¥
                    const zIdx = headers.findIndex(h => {
                        const lower = h.toLowerCase();
                        return (lower === 'z' || lower.includes('z')) && 
                               !lower.includes('x') && !lower.includes('y') && 
                               !lower.includes('size') && !lower.includes('zone');
                    });
                    if (zIdx !== -1) {
                        resultMessage += `\n\n‚Äª Z Ï¢åÌëú Ïª¨ÎüºÏù¥ Í∞êÏßÄÎêòÏóàÏßÄÎßå, ÌèâÎ©¥ÎèÑ ÏãúÏä§ÌÖúÏù¥ÎØÄÎ°ú X, Y Ï¢åÌëúÎßå ÏÇ¨Ïö©Îê©ÎãàÎã§.`;
                    }
                    
                    alert(resultMessage);
                } catch (error) {
                    console.error('ÏóëÏÖÄ ÌååÏùº ÏùΩÍ∏∞ Ïò§Î•ò:', error);
                    alert('ÏóëÏÖÄ ÌååÏùº ÏùΩÍ∏∞ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message);
                }
            };
            
            reader.readAsArrayBuffer(file);
            
            // ÌååÏùº ÏûÖÎ†• Ï¥àÍ∏∞Ìôî
            event.target.value = '';
        }

        // Í∏∞Îë•Î≤àÌò∏ ÏóëÏÖÄ Îã§Ïö¥Î°úÎìú
        function exportColumnNumbersToExcel() {
            // XLSX ÎùºÏù¥Î∏åÎü¨Î¶¨ ÌôïÏù∏
            const XLSXLib = window.XLSX || (typeof XLSX !== 'undefined' ? XLSX : null);
            if (!XLSXLib || typeof XLSXLib.utils === 'undefined') {
                alert('ÏóëÏÖÄ ÎùºÏù¥Î∏åÎü¨Î¶¨Í∞Ä Î°úÎìúÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.\n\nÌï¥Í≤∞ Î∞©Î≤ï:\n1. ÌéòÏù¥ÏßÄÎ•º ÏÉàÎ°úÍ≥†Ïπ®Ìï¥Ï£ºÏÑ∏Ïöî (F5 ÎòêÎäî Ctrl+R)\n2. Ïù∏ÌÑ∞ÎÑ∑ Ïó∞Í≤∞ÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî');
                return;
            }
            
            try {
                // Í∏∞Î≥∏Í∞í Í∞ÄÏ†∏Ïò§Í∏∞ (Ï†ÄÏû•Îêú Í∏∞Î≥∏Í∞í ÎòêÎäî ÌïòÎìúÏΩîÎî©Îêú Í∏∞Î≥∏Í∞í)
                const defaultCoordinates = getDefaultCoordinates();
                
                const wsData = [
                    ['No.', 'Í∏∞Îë•Î≤àÌò∏', 'X Ï¢åÌëú(%)', 'Y Ï¢åÌëú(%)']
                ];
                
                // Í∏∞Î≥∏Í∞íÏùÑ Î∞∞Ïó¥Î°ú Î≥ÄÌôòÌïòÏó¨ ÏóëÏÖÄÏóê Ï∂îÍ∞Ä (no ÏàúÏÑúÎåÄÎ°ú Ï†ïÎ†¨)
                const columnsArray = Object.keys(defaultCoordinates).map(key => {
                    const col = defaultCoordinates[key];
                    return {
                        no: col.no || 0,
                        name: col.originalName || key,
                        x: col.left || 0,
                        y: col.top || 0
                    };
                }).sort((a, b) => a.no - b.no);
                
                // Ï†ïÎ†¨Îêú ÏàúÏÑúÎåÄÎ°ú ÏóëÏÖÄ Îç∞Ïù¥ÌÑ∞Ïóê Ï∂îÍ∞Ä
                columnsArray.forEach(col => {
                    wsData.push([col.no, col.name, col.x, col.y]);
                });
                
                const ws = XLSXLib.utils.aoa_to_sheet(wsData);
                
                // Ïª¨Îüº ÎÑàÎπÑ ÏÑ§Ï†ï
                ws['!cols'] = [
                    { wch: 5 },   // No.
                    { wch: 15 },  // Í∏∞Îë•Î≤àÌò∏
                    { wch: 12 },  // X Ï¢åÌëú
                    { wch: 12 }   // Y Ï¢åÌëú
                ];
                
                const wb = XLSXLib.utils.book_new();
                XLSXLib.utils.book_append_sheet(wb, ws, 'Í∏∞Îë•Î≤àÌò∏');
                
                // ÌååÏùºÎ™Ö ÏÉùÏÑ±
                const now = new Date();
                const dateStr = `${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}${String(now.getDate()).padStart(2, '0')}_${String(now.getHours()).padStart(2, '0')}${String(now.getMinutes()).padStart(2, '0')}`;
                const fileName = `Í∏∞Îë•Î≤àÌò∏_${dateStr}.xlsx`;
                
                // Blob Î∞©ÏãùÏúºÎ°ú ÏóëÏÖÄ ÌååÏùº Îã§Ïö¥Î°úÎìú
                const wbout = XLSXLib.write(wb, { bookType: 'xlsx', type: 'array', cellStyles: false });
                const blob = new Blob([wbout], { 
                    type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' 
                });
                
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = fileName;
                a.style.display = 'none';
                document.body.appendChild(a);
                a.click();
                
                setTimeout(() => {
                    try {
                        document.body.removeChild(a);
                    } catch (e) {}
                    setTimeout(() => URL.revokeObjectURL(url), 1000);
                }, 100);
                
                alert(`Í∏∞Îë•Î≤àÌò∏ Îç∞Ïù¥ÌÑ∞Í∞Ä "${fileName}" ÌååÏùºÎ°ú Îã§Ïö¥Î°úÎìúÎêòÏóàÏäµÎãàÎã§.\n\nÌååÏùº ÌÅ¨Í∏∞: ${(blob.size / 1024).toFixed(2)} KB`);
            } catch (error) {
                console.error('ÏóëÏÖÄ Îã§Ïö¥Î°úÎìú Ïò§Î•ò:', error);
                alert('ÏóëÏÖÄ Îã§Ïö¥Î°úÎìú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + (error.message || String(error)));
            }
        }

        // Í∏∞Îë•Î≤àÌò∏ CSV Îã§Ïö¥Î°úÎìú
        function exportColumnNumbersToCSV() {
            try {
                // Í∏∞Î≥∏Í∞í Í∞ÄÏ†∏Ïò§Í∏∞ (Ï†ÄÏû•Îêú Í∏∞Î≥∏Í∞í ÎòêÎäî ÌïòÎìúÏΩîÎî©Îêú Í∏∞Î≥∏Í∞í)
                const defaultCoordinates = getDefaultCoordinates();
                
                // CSV Ìó§Îçî
                let csvContent = 'No.,Í∏∞Îë•Î≤àÌò∏,X Ï¢åÌëú(%),Y Ï¢åÌëú(%)\n';
                
                // Í∏∞Î≥∏Í∞íÏùÑ Î∞∞Ïó¥Î°ú Î≥ÄÌôòÌïòÏó¨ CSVÏóê Ï∂îÍ∞Ä (no ÏàúÏÑúÎåÄÎ°ú Ï†ïÎ†¨)
                const columnsArray = Object.keys(defaultCoordinates).map(key => {
                    const col = defaultCoordinates[key];
                    return {
                        no: col.no || 0,
                        name: col.originalName || key,
                        x: col.left || 0,
                        y: col.top || 0
                    };
                }).sort((a, b) => a.no - b.no);
                
                // Ï†ïÎ†¨Îêú ÏàúÏÑúÎåÄÎ°ú CSV Îç∞Ïù¥ÌÑ∞Ïóê Ï∂îÍ∞Ä
                columnsArray.forEach(col => {
                    // CSV ÌòïÏãù: Í∞íÏóê ÏâºÌëúÎÇò Îî∞Ïò¥ÌëúÍ∞Ä ÏûàÏúºÎ©¥ Îî∞Ïò¥ÌëúÎ°ú Í∞êÏã∏Í≥† ÎÇ¥Î∂Ä Îî∞Ïò¥ÌëúÎäî Îëê Í∞úÎ°ú
                    const escapeCSV = (value) => {
                        const str = String(value || '');
                        if (str.includes(',') || str.includes('"') || str.includes('\n')) {
                            return '"' + str.replace(/"/g, '""') + '"';
                        }
                        return str;
                    };
                    csvContent += `${col.no},${escapeCSV(col.name)},${col.x},${col.y}\n`;
                });
                
                // BOM Ï∂îÍ∞Ä (ÌïúÍ∏Ä Íπ®Ïßê Î∞©ÏßÄ)
                const BOM = '\uFEFF';
                const blob = new Blob([BOM + csvContent], { 
                    type: 'text/csv;charset=utf-8;' 
                });
                
                // ÌååÏùºÎ™Ö ÏÉùÏÑ±
                const now = new Date();
                const dateStr = `${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}${String(now.getDate()).padStart(2, '0')}_${String(now.getHours()).padStart(2, '0')}${String(now.getMinutes()).padStart(2, '0')}`;
                const fileName = `Í∏∞Îë•Î≤àÌò∏_${dateStr}.csv`;
                
                // Îã§Ïö¥Î°úÎìú
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = fileName;
                a.style.display = 'none';
                document.body.appendChild(a);
                a.click();
                
                setTimeout(() => {
                    try {
                        document.body.removeChild(a);
                    } catch (e) {}
                    setTimeout(() => URL.revokeObjectURL(url), 1000);
                }, 100);
                
                alert(`Í∏∞Îë•Î≤àÌò∏ Îç∞Ïù¥ÌÑ∞Í∞Ä "${fileName}" ÌååÏùºÎ°ú Îã§Ïö¥Î°úÎìúÎêòÏóàÏäµÎãàÎã§.\n\nÌååÏùº ÌÅ¨Í∏∞: ${(blob.size / 1024).toFixed(2)} KB\n\nCSV ÌååÏùºÏùÄ Excel, Google Sheets Îì±ÏóêÏÑú Ïó¥ Ïàò ÏûàÏäµÎãàÎã§.`);
            } catch (error) {
                console.error('CSV Îã§Ïö¥Î°úÎìú Ïò§Î•ò:', error);
                alert('CSV Îã§Ïö¥Î°úÎìú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + (error.message || String(error)));
            }
        }

        // H1/H2 ÌïÑÎìú Î™®Îìú Ï†ÑÌôò Ìï®Ïàò (select ‚Üî input)
        function switchToInputMode() {
            const h1Container = document.getElementById('H1Container');
            const h2Container = document.getElementById('H2Container');
            const h1Value = document.getElementById('H1').value;
            const h2Value = document.getElementById('H2').value;
            
            // H1ÏùÑ inputÏúºÎ°ú Î≥ÄÍ≤Ω
            h1Container.innerHTML = '<input type="text" id="H1" value="' + h1Value + '" style="width: 100px;">';
            document.getElementById('H1').addEventListener('change', function() {
                updateCrossSection();
            });
            
            // H2Î•º inputÏúºÎ°ú Î≥ÄÍ≤Ω
            h2Container.innerHTML = '<input type="text" id="H2" value="' + h2Value + '" style="width: 100px;">';
            document.getElementById('H2').addEventListener('change', function() {
                updateCrossSection();
            });
        }

        function switchToSelectMode() {
            const h1Container = document.getElementById('H1Container');
            const h2Container = document.getElementById('H2Container');
            
            // H1ÏùÑ selectÎ°ú Î≥ÄÍ≤Ω
            h1Container.innerHTML = `
                <select id="H1">
                    <option value="400">H400x200</option>
                    <option value="450">H450x200</option>
                    <option value="500" selected>H500x200</option>
                    <option value="506">H506x201</option>
                    <option value="600">H600x200</option>
                    <option value="606">H606x201</option>
                    <option value="582">H582x300</option>
                    <option value="588">H588x300</option>
                    <option value="692">H692x300</option>
                    <option value="700">H700x300</option>
                    <option value="800">H800x300</option>
                    <option value="900">H900x300</option>
                    <option value="912">H912x302</option>
                </select>`;
            document.getElementById('H1').addEventListener('change', updateH1Dimensions);
            
            // H2Î•º selectÎ°ú Î≥ÄÍ≤Ω
            h2Container.innerHTML = `
                <select id="H2">
                    <option value="400">H400x200</option>
                    <option value="450" selected>H450x200</option>
                    <option value="500">H500x200</option>
                    <option value="506">H506x201</option>
                    <option value="600">H600x200</option>
                    <option value="606">H606x201</option>
                    <option value="582">H582x300</option>
                    <option value="588">H588x300</option>
                    <option value="692">H692x300</option>
                    <option value="700">H700x300</option>
                    <option value="800">H800x300</option>
                    <option value="900">H900x300</option>
                    <option value="912">H912x302</option>
                </select>`;
            document.getElementById('H2').addEventListener('change', updateH2Dimensions);
            
            // KS ÌëúÏ§ÄÍ∞íÏúºÎ°ú ÏóÖÎç∞Ïù¥Ìä∏
            updateH1Dimensions();
            updateH2Dimensions();
        }

        // Type button toggle (Rolled H vs Pos-H / Built-UP H)
        document.querySelectorAll('.type-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.type-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                // Pos-H / Built-UP H ÏÑ†ÌÉù Ïãú: ÏßÅÏ†ë ÏûÖÎ†• Î™®Îìú, r1/r2=0
                if (this.dataset.type === 'posh') {
                    switchToInputMode();
                    document.getElementById('r1').value = 0;
                    document.getElementById('r2').value = 0;
                    updateCrossSection();
                } 
                // Rolled H ÏÑ†ÌÉù Ïãú: ÎìúÎ°≠Îã§Ïö¥ Î™®Îìú, KS ÌëúÏ§ÄÍ∞í
                else if (this.dataset.type === 'kcol') {
                    switchToSelectMode();
                }
            });
        });

        // Beam type button toggle
        // Ïö¥ÏòÅÏûê Control Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà (Í∏∞Ï°¥ beam-type-btnÍ≥º operator-control-btn Î™®Îëê ÏßÄÏõê)
        document.querySelectorAll('.beam-type-btn, .operator-control-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                // data-onclick ÏÜçÏÑ±Ïù¥ ÏûàÏúºÎ©¥ Ïã§Ìñâ
                const onclickAttr = this.getAttribute('data-onclick');
                if (onclickAttr) {
                    try {
                        eval(onclickAttr);
                    } catch (e) {
                        console.error('onclick Ïã§Ìñâ Ïò§Î•ò:', e);
                    }
                }
                
                // auto-find-section-btnÏùÄ Ï†úÏô∏ÌïòÍ≥† Î∞∞Í≤ΩÏÉâ Î≥ÄÍ≤Ω (Í∏∞Ï°¥ beam-type-btnÏö©)
                document.querySelectorAll('.beam-type-btn').forEach(b => {
                    if (b.id !== 'auto-find-section-btn') {
                        b.style.background = '#1e3a5f';
                    }
                });
                
                // operator-control-btn Ï§ë auto-find-section-btnÏù¥ ÏïÑÎãå Í≤ΩÏö∞ Î∞∞Í≤ΩÏÉâ Î≥ÄÍ≤Ω
                if (this.id !== 'auto-find-section-btn' && this.classList.contains('operator-control-btn')) {
                    // Í∏∞Î≥∏ Ïä§ÌÉÄÏùº Ïú†ÏßÄ (CSS ÌÅ¥ÎûòÏä§Î°ú Í¥ÄÎ¶¨)
                }
            });
        });

        // ===== KS ÌëúÏ§Ä HÌòïÍ∞ï ÏπòÏàò Îç∞Ïù¥ÌÑ∞ (Roll H) - ÏÇ¨Ïö© Í∑úÍ≤©Îßå =====
        const ksHBeamData = {
            // H x B : [B, tw, tf, r]
            400: { B: 200, tw: 8, tf: 13, r: 16 },     // H400x200
            450: { B: 200, tw: 9, tf: 14, r: 18 },     // H450x200 (Í∏∞Î≥∏Í∞í)
            500: { B: 200, tw: 10, tf: 16, r: 20 },    // H500x200
            506: { B: 201, tw: 11, tf: 19, r: 20 },    // H506x201
            600: { B: 200, tw: 11, tf: 17, r: 22 },    // H600x200
            606: { B: 201, tw: 12, tf: 20, r: 22 },    // H606x201
            582: { B: 300, tw: 12, tf: 17, r: 28 },    // H582x300
            588: { B: 300, tw: 12, tf: 20, r: 28 },    // H588x300
            692: { B: 300, tw: 13, tf: 20, r: 28 },    // H692x300
            700: { B: 300, tw: 13, tf: 24, r: 28 },    // H700x300
            800: { B: 300, tw: 14, tf: 26, r: 28 },    // H800x300
            900: { B: 300, tw: 16, tf: 28, r: 28 },    // H900x300
            912: { B: 302, tw: 18, tf: 34, r: 28 },    // H912x302
        };

        // Ï†ïÏ†Å Ïù¥ÎØ∏ÏßÄ ÏÇ¨Ïö©ÏúºÎ°ú Îã§Ïù¥Ïñ¥Í∑∏Îû® ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò ÎπÑÌôúÏÑ±Ìôî
        function updateCrossSection() {
            // Ï†ïÏ†Å Ïù¥ÎØ∏ÏßÄ (2H-section.png) ÏÇ¨Ïö©
        }

        // ÌòÑÏû¨ ÏÑ†ÌÉùÎêú ÌÉÄÏûÖ ÌôïÏù∏ (Rolled H or Pos-H)
        function isPosModeActive() {
            const activeBtn = document.querySelector('.type-btn.active');
            return activeBtn && activeBtn.dataset.type === 'posh';
        }

        // H1 ÏÑ†ÌÉù Ïãú ÏûêÎèôÏúºÎ°ú B1, tw1, tf1, r1 Ï±ÑÏö∞Í∏∞
        function updateH1Dimensions() {
            const h1Value = parseInt(document.getElementById('H1').value);
            if (ksHBeamData[h1Value]) {
                const data = ksHBeamData[h1Value];
                document.getElementById('B1').value = data.B;
                document.getElementById('tw1').value = data.tw;
                document.getElementById('tf1').value = data.tf;
                // Pos-H Î™®ÎìúÏóêÏÑúÎäî r1=0, K-COL Î™®ÎìúÏóêÏÑúÎäî KS ÌëúÏ§ÄÍ∞í
                document.getElementById('r1').value = isPosModeActive() ? 0 : data.r;
            }
            updateCrossSection();
        }

        // H2 ÏÑ†ÌÉù Ïãú ÏûêÎèôÏúºÎ°ú B2, tw2, tf2, r2 Ï±ÑÏö∞Í∏∞
        function updateH2Dimensions() {
            const h2Value = parseInt(document.getElementById('H2').value);
            if (ksHBeamData[h2Value]) {
                const data = ksHBeamData[h2Value];
                document.getElementById('B2').value = data.B;
                document.getElementById('tw2').value = data.tw;
                document.getElementById('tf2').value = data.tf;
                // Pos-H Î™®ÎìúÏóêÏÑúÎäî r2=0, K-COL Î™®ÎìúÏóêÏÑúÎäî KS ÌëúÏ§ÄÍ∞í
                document.getElementById('r2').value = isPosModeActive() ? 0 : data.r;
            }
            updateCrossSection();
        }

        // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Îì±Î°ù
        document.getElementById('H1').addEventListener('change', updateH1Dimensions);
        document.getElementById('H2').addEventListener('change', updateH2Dimensions);

        // B, tw, tf ÏàòÎèô Î≥ÄÍ≤Ω ÏãúÏóêÎèÑ Îã§Ïù¥Ïñ¥Í∑∏Îû® ÏóÖÎç∞Ïù¥Ìä∏
        ['B1', 'tw1', 'tf1', 'B2', 'tw2', 'tf2'].forEach(id => {
            const el = document.getElementById(id);
            if (el) el.addEventListener('change', updateCrossSection);
        });

        // Cross H Îã®Î©¥Ï†Å Í≥ÑÏÇ∞ Î∞è ÌëúÏãú Ìï®Ïàò
        function calculateAndDisplaySectionArea() {
            const h1 = parseFloat(document.getElementById('H1').value) || 500;
            const b1 = parseFloat(document.getElementById('B1').value) || 200;
            const tw1 = parseFloat(document.getElementById('tw1').value) || 8;
            const tf1 = parseFloat(document.getElementById('tf1').value) || 13;
            const r1 = parseFloat(document.getElementById('r1').value) || 18;
            
            const h2 = parseFloat(document.getElementById('H2').value) || 450;
            const b2 = parseFloat(document.getElementById('B2').value) || 200;
            const tw2 = parseFloat(document.getElementById('tw2').value) || 9;
            const tf2 = parseFloat(document.getElementById('tf2').value) || 14;
            const r2 = parseFloat(document.getElementById('r2').value) || 18;

            // Cross H Îã®Î©¥Ï†Å Í≥ÑÏÇ∞
            const hw3 = h1 - 2 * tf1;
            const hw6 = h2 - 2 * tf2;
            const ag1 = b1 * tf1;
            const ag2 = b1 * tf1;
            const ag3 = hw3 * tw1;
            const ag4 = b2 * tf2;
            const ag5 = b2 * tf2;
            const ag6 = hw6 * tw2;
            const ag7 = 4 * (r1*r1 - Math.PI * r1*r1 / 4);
            const ag8 = 4 * (r2*r2 - Math.PI * r2*r2 / 4);
            const ag9 = tw1 * tw2;
            const area = ag1 + ag2 + ag3 + ag4 + ag5 + ag6 + ag7 + ag8 - ag9;

            // Îã®Ï§ë Í≥ÑÏÇ∞ (kg/m) = Îã®Î©¥Ï†Å(mm¬≤) √ó 7.85 / 1000
            const unitWeight = area * 7.85 / 1000;
            
            // Îã®Î©¥Ï†Å Î∞è Îã®Ï§ë ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏ (Í∞ôÏùÄ rowÏóê Î∞∞Ïπò)
            const areaDisplay = document.getElementById('section-area-display');
            if (areaDisplay) {
                areaDisplay.innerHTML = `Îã®Î©¥Ï†Å : ${area.toFixed(2)} mm¬≤  |  Îã®Ï§ë : ${unitWeight.toFixed(2)} kg/m`;
            }
        }

        // ÏûÖÎ†• ÌïÑÎìú Î≥ÄÍ≤Ω Ïãú Îã®Î©¥Ï†Å ÏûêÎèô Í≥ÑÏÇ∞
        ['H1', 'B1', 'tw1', 'tf1', 'r1', 'H2', 'B2', 'tw2', 'tf2', 'r2'].forEach(id => {
            const el = document.getElementById(id);
            if (el) {
                el.addEventListener('input', calculateAndDisplaySectionArea);
                el.addEventListener('change', calculateAndDisplaySectionArea);
            }
        });

        // steelGrade Î≥ÄÍ≤Ω Ïãú Fy ÏûêÎèô ÏóÖÎç∞Ïù¥Ìä∏
        document.getElementById('steelGrade').addEventListener('change', function() {
            const grade = this.value;
            let fyValue = 355; // Í∏∞Î≥∏Í∞í
            
            if (grade === 'SS275') {
                fyValue = 275;
            } else if (grade === 'SS355') {
                fyValue = 355;
            } else if (grade === 'SM355') {
                fyValue = 355;
            } else if (grade === 'SM420') {
                fyValue = 420;
            }
            
            document.getElementById('Fy').value = fyValue;
        });

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Í∞í ÏÑ§Ï†ï
        updateH1Dimensions();
        updateH2Dimensions();
        updateCrossSection();
        calculateAndDisplaySectionArea(); // Ï¥àÍ∏∞ Îã®Î©¥Ï†Å Í≥ÑÏÇ∞

        // Í∞ÑÌé∏ Í≥ÑÏÇ∞ Ìï®Ïàò - Based on 2H.py Python code
        function quickCalculate() {
            // ===== ÏûÖÎ†•Í∞í Í∞ÄÏ†∏Ïò§Í∏∞ =====
            const h1 = parseFloat(document.getElementById('H1').value) || 500;
            const b1 = parseFloat(document.getElementById('B1').value) || 200;
            const tw1 = parseFloat(document.getElementById('tw1').value) || 8;
            const tf1 = parseFloat(document.getElementById('tf1').value) || 13;
            const r1 = parseFloat(document.getElementById('r1').value) || 18;
            
            const h2 = parseFloat(document.getElementById('H2').value) || 450;
            const b2 = parseFloat(document.getElementById('B2').value) || 200;
            const tw2 = parseFloat(document.getElementById('tw2').value) || 9;
            const tf2 = parseFloat(document.getElementById('tf2').value) || 14;
            const r2 = parseFloat(document.getElementById('r2').value) || 18;
            
            const Fy = parseFloat(document.getElementById('Fy').value.replace(/,/g, '')) || 355;
            const E = parseFloat(document.getElementById('E').value.replace(/,/g, '')) || 210000;
            const nu = parseFloat(document.getElementById('nu').value) || 0.3;
            
            const Lx = parseFloat(document.getElementById('Lx').value) * 1000 || 4500; // m to mm
            const Ly = parseFloat(document.getElementById('Ly').value) * 1000 || 4500;
            const Kx = parseFloat(document.getElementById('Kx').value) || 0.8;
            const Ky = parseFloat(document.getElementById('Ky').value) || 0.8;
            const Kz = parseFloat(document.getElementById('Kz').value) || 0.8;
            
            const Pu = parseFloat(document.getElementById('Pu').value.replace(/,/g, '')) || 7561; // kN
            const Mux = parseFloat(document.getElementById('Mux').value) || 0; // kN.m
            const Muy = parseFloat(document.getElementById('Muy').value) || 0;
            const Vux = parseFloat(document.getElementById('Vux').value) || 0; // kN
            const Vuy = parseFloat(document.getElementById('Vuy').value) || 0;

            // ===== HBeam Class calculations =====
            const hw3 = h1 - 2 * tf1;
            const hw6 = h2 - 2 * tf2;
            const d1 = h1/2 - tf1/2;
            const d4 = h2/2 - tf2/2;

            // Total section area - Cross H section
            const ag1 = b1 * tf1;
            const ag2 = b1 * tf1;
            const ag3 = hw3 * tw1;
            const ag4 = b2 * tf2;
            const ag5 = b2 * tf2;
            const ag6 = hw6 * tw2;
            const ag7 = 4 * (r1*r1 - Math.PI * r1*r1 / 4);
            const ag8 = 4 * (r2*r2 - Math.PI * r2*r2 / 4);
            const ag9 = tw1 * tw2;
            const area = ag1 + ag2 + ag3 + ag4 + ag5 + ag6 + ag7 + ag8 - ag9;

            // Second inertia moment X-axis
            const Ix1 = 1/12 * b1 * Math.pow(tf1, 3) + ag1 * Math.pow(d1, 2);
            const Ix2 = 1/12 * b1 * Math.pow(tf1, 3) + ag1 * Math.pow(d1, 2);
            const Ix3 = 1/12 * tw1 * Math.pow(hw3, 3);
            const Ix4 = 1/12 * tf2 * Math.pow(b2, 3);
            const Ix5 = 1/12 * tf2 * Math.pow(b2, 3);
            const Ix6 = 1/12 * hw6 * Math.pow(tw2, 3);
            const Ix = Ix1 + Ix2 + Ix3 + Ix4 + Ix5 + Ix6;

            // Second inertia moment Y-axis
            const Iy4 = 1/12 * b2 * Math.pow(tf2, 3) + ag4 * Math.pow(d4, 2);
            const Iy5 = 1/12 * b2 * Math.pow(tf2, 3) + ag4 * Math.pow(d4, 2);
            const Iy6 = 1/12 * tw2 * Math.pow(hw6, 3);
            const Iy1 = 1/12 * tf1 * Math.pow(b1, 3);
            const Iy2 = 1/12 * tf1 * Math.pow(b1, 3);
            const Iy3 = 1/12 * hw3 * Math.pow(tw2, 3);
            const Iy = Iy1 + Iy2 + Iy3 + Iy4 + Iy5 + Iy6;

            // Radius of gyration
            const ix = Math.sqrt(Ix / area);
            const iy = Math.sqrt(Iy / area);

            // Elastic section modulus
            const sx = Ix / (h1 / 2);
            const sy = Iy / (h2 / 2);

            // Plastic section modulus Zx
            const Zx1 = (b1 * tf1) * d1;
            const Zx2 = (b1 * tf1) * d1;
            const Zx3 = (tw1 * hw3/2) * hw3/4;
            const Zx4 = (tw1 * hw3/2) * hw3/4;
            const Zx5 = (b2*b2 * tf2 / 2);
            const Zx6 = (tw2 * hw6 / 8) * 2;
            const zx = Zx1 + Zx2 + Zx3 + Zx4 + Zx5 + Zx6;

            // Plastic section modulus Zy
            const Zy1 = (b2 * tf2) * d4;
            const Zy2 = (b2 * tf2) * d4;
            const Zy3 = (tw2 * hw6/2) * hw6/4;
            const Zy4 = (tw2 * hw6/2) * hw6/4;
            const Zy5 = (b1*b1 * tf1 / 2);
            const Zy6 = (tw1 * hw3 / 8) * 2;
            const zy = Zy1 + Zy2 + Zy3 + Zy4 + Zy5 + Zy6;

            // Torsional constant J
            const J1 = (2*b1 * Math.pow(tf1, 3) + h1*Math.pow(tw1, 3)) / 3;
            const J2 = (2*b2 * Math.pow(tf2, 3) + h2*Math.pow(tw2, 3)) / 3;
            const J = J1 + J2;

            // Warping constant Cw
            const cw = Iy * Math.pow(h1 - tf1, 2) / 4;

            // ===== Column Class calculations =====
            // Slenderness ratio
            const lambdaX = Kx * Lx / ix;
            const lambdaY = Ky * Ly / iy;
            const lambda = Math.max(lambdaX, lambdaY);

            // Flexural Buckling Stress Fe1
            const Fe1 = Math.pow(Math.PI, 2) * E / Math.pow(lambda, 2);

            // Torsional Buckling Stress Fe2
            const G = E / (2 * (1 + nu));
            const Fe2 = (Math.pow(Math.PI, 2) * E * cw / Math.pow(Kz * Lx, 2) + G * J) / (Ix + Iy);

            // Critical stress Fcr
            const Fe = Math.min(Fe1, Fe2);
            const Fcr = Math.pow(0.658, Fy / Fe) * Fy;

            // Compressive Strength phi_Pn
            const phi_c = 0.9;
            const phi_Pn = phi_c * area * Fcr / 1000; // kN

            // Flexural Strength - Mpx, Mpy
            const Mpx = Math.min(Fy * zx, 1.6 * Fy * sx) / 1000000; // kN.m
            const Mpy = Math.min(Fy * zy, 1.6 * Fy * sy) / 1000000; // kN.m
            const phi_b = 0.9;
            const phi_Mnx = phi_b * Mpx;
            const phi_Mny = phi_b * Mpy;

            // Shear Strength
            const As1 = hw3 * tw1 + 2 * tf1 * b1;
            const As2 = hw6 * tw2 + 2 * tf2 * b2;
            const Cvw = 1.0;
            const phi_vw = 1.0;
            const Vny = 0.6 * Fy * As1 * Cvw / 1000; // kN
            const Vnx = 0.6 * Fy * As2 * Cvw / 1000; // kN
            const phi_Vny = phi_vw * Vny;
            const phi_Vnx = phi_vw * Vnx;

            // ===== ÎπÑÏú® Í≥ÑÏÇ∞ (Auto Find SectionÍ≥º ÏôÑÏ†ÑÌûà ÎèôÏùºÌïú Í≥µÏãù) =====
            // Auto Find Section: ratio_comp=Pu/phi_Pn, ratio_bendX=phi_Mnx>0?Mux/phi_Mnx:0, ratio_bendY=phi_Mny>0?Muy/phi_Mny:0
            // Auto Find Section: ratio_pmm=ratio_comp>=0.2?ratio_comp+8/9*(ratio_bendX+ratio_bendY):ratio_comp/2+ratio_bendX+ratio_bendY
            const ratio_comp = Pu/phi_Pn;
            const ratio_bendX = phi_Mnx>0?Mux/phi_Mnx:0;
            const ratio_bendY = phi_Mny>0?Muy/phi_Mny:0;
            const ratio_shearX = phi_Vnx > 0 ? Vux / phi_Vnx : 0;
            const ratio_shearY = phi_Vny > 0 ? Vuy / phi_Vny : 0;

            // P-M-M Ï°∞Ìï© (Auto Find SectionÍ≥º ÎèôÏùºÌïú ÏÇºÌï≠ Ïó∞ÏÇ∞Ïûê ÌòïÏãù)
            const ratio_pmm = ratio_comp>=0.2?ratio_comp+8/9*(ratio_bendX+ratio_bendY):ratio_comp/2+ratio_bendX+ratio_bendY;

            // ÎîîÎ≤ÑÍπÖ: Í∞ÑÌé∏Í≥ÑÏÇ∞Ïãù PMM Í≥ÑÏÇ∞ ÏÉÅÏÑ∏ Î°úÍ∑∏ (Auto Find SectionÍ≥º ÎπÑÍµêÏö©)
            console.log('=== Í∞ÑÌé∏Í≥ÑÏÇ∞Ïãù PMM Í≥ÑÏÇ∞ ÏÉÅÏÑ∏ (Auto Find SectionÍ≥º ÎπÑÍµêÏö©) ===');
            console.log(`area: ${area.toFixed(2)} (ag1=${ag1}, ag2=${ag2}, ag3=${ag3}, ag4=${ag4}, ag5=${ag5}, ag6=${ag6}, ag7=${ag7.toFixed(2)}, ag8=${ag8.toFixed(2)}, ag9=${ag9})`);
            console.log(`Ix: ${Ix.toFixed(2)} (Ix1=${Ix1.toFixed(2)}, Ix2=${Ix2.toFixed(2)}, Ix3=${Ix3.toFixed(2)}, Ix4=${Ix4.toFixed(2)}, Ix5=${Ix5.toFixed(2)}, Ix6=${Ix6.toFixed(2)})`);
            console.log(`Iy: ${Iy.toFixed(2)} (Iy1=${Iy1.toFixed(2)}, Iy2=${Iy2.toFixed(2)}, Iy3=${Iy3.toFixed(2)}, Iy4=${Iy4.toFixed(2)}, Iy5=${Iy5.toFixed(2)}, Iy6=${Iy6.toFixed(2)})`);
            console.log(`sx: ${sx.toFixed(2)}, sy: ${sy.toFixed(2)}`);
            console.log(`zx: ${zx.toFixed(2)} (Zx1=${Zx1.toFixed(2)}, Zx2=${Zx2.toFixed(2)}, Zx3=${Zx3.toFixed(2)}, Zx4=${Zx4.toFixed(2)}, Zx5=${Zx5.toFixed(2)}, Zx6=${Zx6.toFixed(2)})`);
            console.log(`zy: ${zy.toFixed(2)} (Zy1=${Zy1.toFixed(2)}, Zy2=${Zy2.toFixed(2)}, Zy3=${Zy3.toFixed(2)}, Zy4=${Zy4.toFixed(2)}, Zy5=${Zy5.toFixed(2)}, Zy6=${Zy6.toFixed(2)})`);
            console.log(`J: ${J.toFixed(2)} (J1=${J1.toFixed(2)}, J2=${J2.toFixed(2)})`);
            console.log(`cw: ${cw.toFixed(2)}`);
            console.log(`lambda: ${lambda.toFixed(4)} (lambdaX=${lambdaX.toFixed(4)}, lambdaY=${lambdaY.toFixed(4)})`);
            console.log(`Fe1: ${Fe1.toFixed(2)}, Fe2: ${Fe2.toFixed(2)}, Fe: ${Fe.toFixed(2)}`);
            console.log(`Fcr: ${Fcr.toFixed(2)}`);
            console.log(`phi_Pn: ${phi_Pn.toFixed(4)} (phi_c=${phi_c}, area=${area.toFixed(2)}, Fcr=${Fcr.toFixed(2)})`);
            console.log(`Mpx: ${Mpx.toFixed(6)}, Mpy: ${Mpy.toFixed(6)}`);
            console.log(`phi_Mnx: ${phi_Mnx.toFixed(6)} (phi_b=${phi_b}, Mpx=${Mpx.toFixed(6)}), phi_Mny: ${phi_Mny.toFixed(6)} (phi_b=${phi_b}, Mpy=${Mpy.toFixed(6)})`);
            console.log(`Pu: ${Pu}, Mux: ${Mux}, Muy: ${Muy}`);
            console.log(`ratio_comp: ${ratio_comp.toFixed(6)} (Pu=${Pu}/phi_Pn=${phi_Pn.toFixed(4)})`);
            console.log(`ratio_bendX: ${ratio_bendX.toFixed(6)} (Mux=${Mux}/phi_Mnx=${phi_Mnx.toFixed(6)}), ratio_bendY: ${ratio_bendY.toFixed(6)} (Muy=${Muy}/phi_Mny=${phi_Mny.toFixed(6)})`);
            console.log(`8/9: ${(8/9).toFixed(10)}`);
            console.log(`8/9*(rBendX+rBendY): ${(8/9*(ratio_bendX+ratio_bendY)).toFixed(6)}`);
            console.log(`P-M-M: ${ratio_pmm.toFixed(6)} (Ï°∞Í±¥: ratio_comp>=0.2? ${ratio_comp>=0.2})`);

            // ===== Í≤∞Í≥º ÏóÖÎç∞Ïù¥Ìä∏ =====
            // Îã®Î©¥Ï†Å ÌëúÏãú (Ïã§ÏãúÍ∞Ñ Í≥ÑÏÇ∞ Ìï®Ïàò Ìò∏Ï∂ú)
            calculateAndDisplaySectionArea();
            
            const results = document.querySelectorAll('.result-item');
            // Compressive: ratio > 1.0Ïù¥Î©¥ N.G (Í≥ÑÏÇ∞ÏÑúÏôÄ ÏùºÏπò)
            updateResult(results[0], ratio_comp, phi_Pn, 'compressive');
            // Bending X: ratio <= 1.0Ïù¥Î©¥ O.K (Í≥ÑÏÇ∞ÏÑúÏôÄ ÏùºÏπò)
            updateResult(results[1], ratio_bendX, phi_Mnx, 'bending');
            // Bending Y: ratio <= 1.0Ïù¥Î©¥ O.K (Í≥ÑÏÇ∞ÏÑúÏôÄ ÏùºÏπò)
            updateResult(results[2], ratio_bendY, phi_Mny, 'bending');
            // P-M-M: ratio > 1.0Ïù¥Î©¥ N.G (Í≥ÑÏÇ∞ÏÑúÏôÄ ÏùºÏπò)
            updateResult(results[3], ratio_pmm, null, 'pmm');
            // Shear X: ratio <= 1.0Ïù¥Î©¥ O.K (Í≥ÑÏÇ∞ÏÑúÏôÄ ÏùºÏπò)
            updateResult(results[4], ratio_shearX, phi_Vnx, 'shear');
            // Shear Y: ratio <= 1.0Ïù¥Î©¥ O.K (Í≥ÑÏÇ∞ÏÑúÏôÄ ÏùºÏπò)
            updateResult(results[5], ratio_shearY, phi_Vny, 'shear');

            // ===== Í∞ÑÌé∏Í≥ÑÏÇ∞ Ï∂úÎ†• ÏòÅÏó≠ ÏóÖÎç∞Ïù¥Ìä∏ =====
            updateQuickCalcOutput({
                ratio_comp: ratio_comp,
                ratio_bendX: ratio_bendX,
                ratio_bendY: ratio_bendY,
                ratio_pmm: ratio_pmm,
                ratio_shearX: ratio_shearX,
                ratio_shearY: ratio_shearY,
                phi_Pn: phi_Pn,
                phi_Mnx: phi_Mnx,
                phi_Mny: phi_Mny
            });

            // ===== Í∞ÑÌé∏Í≥ÑÏÇ∞ Í≤∞Í≥ºÎ•º Ï†ÑÏó≠ Î≥ÄÏàòÏóê Ï†ÄÏû• (Í≥ÑÏÇ∞ÏÑú Ï∂úÎ†•Ïö©) =====
            window.quickCalcResults = {
                // ÏûÖÎ†•Í∞í
                h1: h1, b1: b1, tw1: tw1, tf1: tf1, r1: r1,
                h2: h2, b2: b2, tw2: tw2, tf2: tf2, r2: r2,
                Fy: Fy, E: E, nu: nu,
                Lx: Lx, Ly: Ly, Kx: Kx, Ky: Ky, Kz: Kz,
                Pu: Pu, Mux: Mux, Muy: Muy, Vux: Vux, Vuy: Vuy,
                // Í≥ÑÏÇ∞ Í≤∞Í≥º
                area: area,
                Ix: Ix, Iy: Iy,
                ix: ix, iy: iy,
                sx: sx, sy: sy,
                zx: zx, zy: zy,
                J: J, cw: cw,
                lambda: lambda, lambdaX: lambdaX, lambdaY: lambdaY,
                Fe1: Fe1, Fe2: Fe2, Fe: Fe, Fcr: Fcr,
                phi_Pn: phi_Pn,
                phi_Mnx: phi_Mnx, phi_Mny: phi_Mny,
                phi_Vnx: phi_Vnx, phi_Vny: phi_Vny,
                ratio_comp: ratio_comp,
                ratio_bendX: ratio_bendX, ratio_bendY: ratio_bendY,
                ratio_pmm: ratio_pmm,
                ratio_shearX: ratio_shearX, ratio_shearY: ratio_shearY
            };

            // ÏΩòÏÜîÏóê ÏÉÅÏÑ∏ Í≤∞Í≥º Ï∂úÎ†•
            console.log('===== Cross H Column Calculation Results =====');
            console.log(`Area: ${area.toFixed(2)} mm¬≤`);
            console.log(`Ix: ${Ix.toFixed(2)} mm‚Å¥, Iy: ${Iy.toFixed(2)} mm‚Å¥`);
            console.log(`ix: ${ix.toFixed(2)} mm, iy: ${iy.toFixed(2)} mm`);
            console.log(`Œª (slenderness): ${lambda.toFixed(2)}`);
            console.log(`Fe1: ${Fe1.toFixed(2)} MPa, Fe2: ${Fe2.toFixed(2)} MPa`);
            console.log(`Fcr: ${Fcr.toFixed(2)} MPa`);
            console.log(`œÜPn: ${phi_Pn.toFixed(2)} kN`);
            console.log(`œÜMnx: ${phi_Mnx.toFixed(2)} kN.m, œÜMny: ${phi_Mny.toFixed(2)} kN.m`);
            console.log(`œÜVnx: ${phi_Vnx.toFixed(2)} kN, œÜVny: ${phi_Vny.toFixed(2)} kN`);
        }

        function updateResult(element, ratio, capacity, type) {
            const valSpan = element.querySelector('.result-val');
            const statusSpan = element.querySelector('.result-status');
            
            if (isNaN(ratio) || !isFinite(ratio)) {
                valSpan.textContent = '-';
                statusSpan.textContent = 'N/A';
                statusSpan.className = 'result-status pending';
                return;
            }
            
            valSpan.textContent = ratio.toFixed(3);
            
            // Í≥ÑÏÇ∞ÏÑúÏôÄ ÏùºÏπòÌïòÎäî Î°úÏßÅ Ï†ÅÏö©
            // Î™®Îì† Ìï≠Î™©Ïù¥ ratio <= 1.0Ïù¥Î©¥ O.K (Í≥ÑÏÇ∞ÏÑú Î°úÏßÅÍ≥º ÎèôÏùº)
            // Compressive, P-M-M, Bending, Shear Î™®Îëê ÎèôÏùºÌïú Í∏∞Ï§Ä ÏÇ¨Ïö©
            if (ratio <= 1.0) {
                statusSpan.textContent = 'O.K';
                statusSpan.className = 'result-status ok';
            } else {
                statusSpan.textContent = 'N.G';
                statusSpan.className = 'result-status ng';
            }
        }

        // Í∞ÑÌé∏Í≥ÑÏÇ∞ Ï∂úÎ†• ÏòÅÏó≠ ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò
        function updateQuickCalcOutput(results) {
            const outputDiv = document.getElementById('quickCalcOutput');
            const contentDiv = document.getElementById('quickCalcOutputContent');
            
            if (!outputDiv || !contentDiv) return;
            
            // Í≤∞Í≥ºÍ∞Ä Ïú†Ìö®ÌïúÏßÄ ÌôïÏù∏
            const hasValidResults = Object.values(results).some(val => 
                val !== null && val !== undefined && !isNaN(val) && isFinite(val)
            );
            
            if (!hasValidResults) {
                outputDiv.classList.remove('active');
                return;
            }
            
            // Í≤∞Í≥º Ìï≠Î™© ÏÉùÏÑ±
            const items = [];
            
            // Compressive
            if (results.ratio_comp !== undefined && !isNaN(results.ratio_comp) && isFinite(results.ratio_comp)) {
                const status = results.ratio_comp <= 1.0 ? 'ok' : 'ng';
                items.push(createQuickCalcItem('ÏïïÏ∂ï', results.ratio_comp.toFixed(3), status));
            }
            
            // P-M-M
            if (results.ratio_pmm !== undefined && !isNaN(results.ratio_pmm) && isFinite(results.ratio_pmm)) {
                const status = results.ratio_pmm <= 1.0 ? 'ok' : 'ng';
                items.push(createQuickCalcItem('P-M-M', results.ratio_pmm.toFixed(3), status));
            }
            
            // Bending X
            if (results.ratio_bendX !== undefined && !isNaN(results.ratio_bendX) && isFinite(results.ratio_bendX)) {
                const status = results.ratio_bendX <= 1.0 ? 'ok' : 'ng';
                items.push(createQuickCalcItem('Ìú®X', results.ratio_bendX.toFixed(3), status));
            }
            
            // Bending Y
            if (results.ratio_bendY !== undefined && !isNaN(results.ratio_bendY) && isFinite(results.ratio_bendY)) {
                const status = results.ratio_bendY <= 1.0 ? 'ok' : 'ng';
                items.push(createQuickCalcItem('Ìú®Y', results.ratio_bendY.toFixed(3), status));
            }
            
            // Shear X
            if (results.ratio_shearX !== undefined && !isNaN(results.ratio_shearX) && isFinite(results.ratio_shearX)) {
                const status = results.ratio_shearX <= 1.0 ? 'ok' : 'ng';
                items.push(createQuickCalcItem('Ï†ÑÎã®X', results.ratio_shearX.toFixed(3), status));
            }
            
            // Shear Y
            if (results.ratio_shearY !== undefined && !isNaN(results.ratio_shearY) && isFinite(results.ratio_shearY)) {
                const status = results.ratio_shearY <= 1.0 ? 'ok' : 'ng';
                items.push(createQuickCalcItem('Ï†ÑÎã®Y', results.ratio_shearY.toFixed(3), status));
            }
            
            // ÎÇ¥Ïö© ÏóÖÎç∞Ïù¥Ìä∏
            contentDiv.innerHTML = items.join('');
            
            // Ï∂úÎ†• ÏòÅÏó≠ ÌëúÏãú
            outputDiv.classList.add('active');
        }

        // Í∞ÑÌé∏Í≥ÑÏÇ∞ Í≤∞Í≥º Ìï≠Î™© ÏÉùÏÑ± Ìï®Ïàò
        function createQuickCalcItem(label, value, status) {
            return `
                <div class="quick-calc-result-item">
                    <span class="quick-calc-result-label">${label}:</span>
                    <span class="quick-calc-result-value ${status}">${value}</span>
                </div>
            `;
        }

        // Multi Column Calculation Sheet Ï¥àÍ∏∞Ìôî (6Í∞ú Í∏∞Îë•)
        function initializeMultiColumnTable() {
            const tbody = document.getElementById('multiColumnTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = ''; // Í∏∞Ï°¥ ÎÇ¥Ïö© Ï†úÍ±∞
            
            for (let i = 1; i <= 6; i++) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="column-number">${i}</td>
                    <td><input type="text" class="multi-input" data-col="pu" data-row="${i}" value="4000" placeholder="0"></td>
                    <td><input type="text" class="multi-input" data-col="mux" data-row="${i}" placeholder="0"></td>
                    <td><input type="text" class="multi-input" data-col="muy" data-row="${i}" placeholder="0"></td>
                    <td class="result-cell" data-result="compressive" data-row="${i}">-</td>
                    <td class="result-cell" data-result="pmm" data-row="${i}">-</td>
                `;
                tbody.appendChild(row);
            }
        }
        
        // Îã®Ïùº Í∏∞Îë• Í≥ÑÏÇ∞ Ìï®Ïàò (Pu, Mux, MuyÎ•º ÌååÎùºÎØ∏ÌÑ∞Î°ú Î∞õÏùå)
        function calculateSingleColumn(Pu, Mux, Muy) {
            // ===== ÏûÖÎ†•Í∞í Í∞ÄÏ†∏Ïò§Í∏∞ =====
            const h1 = parseFloat(document.getElementById('H1').value) || 500;
            const b1 = parseFloat(document.getElementById('B1').value) || 200;
            const tw1 = parseFloat(document.getElementById('tw1').value) || 8;
            const tf1 = parseFloat(document.getElementById('tf1').value) || 13;
            const r1 = parseFloat(document.getElementById('r1').value) || 18;
            
            const h2 = parseFloat(document.getElementById('H2').value) || 450;
            const b2 = parseFloat(document.getElementById('B2').value) || 200;
            const tw2 = parseFloat(document.getElementById('tw2').value) || 9;
            const tf2 = parseFloat(document.getElementById('tf2').value) || 14;
            const r2 = parseFloat(document.getElementById('r2').value) || 18;
            
            const Fy = parseFloat(document.getElementById('Fy').value.replace(/,/g, '')) || 355;
            const E = parseFloat(document.getElementById('E').value.replace(/,/g, '')) || 210000;
            const nu = parseFloat(document.getElementById('nu').value) || 0.3;
            
            const Lx = parseFloat(document.getElementById('Lx').value) * 1000 || 4500; // m to mm
            const Ly = parseFloat(document.getElementById('Ly').value) * 1000 || 4500;
            const Kx = parseFloat(document.getElementById('Kx').value) || 0.8;
            const Ky = parseFloat(document.getElementById('Ky').value) || 0.8;
            const Kz = parseFloat(document.getElementById('Kz').value) || 0.8;

            // ===== HBeam Class calculations =====
            const hw3 = h1 - 2 * tf1;
            const hw6 = h2 - 2 * tf2;
            const d1 = h1/2 - tf1/2;
            const d4 = h2/2 - tf2/2;

            // Total section area - Cross H section
            const ag1 = b1 * tf1;
            const ag2 = b1 * tf1;
            const ag3 = hw3 * tw1;
            const ag4 = b2 * tf2;
            const ag5 = b2 * tf2;
            const ag6 = hw6 * tw2;
            const ag7 = 4 * (r1*r1 - Math.PI * r1*r1 / 4);
            const ag8 = 4 * (r2*r2 - Math.PI * r2*r2 / 4);
            const ag9 = tw1 * tw2;
            const area = ag1 + ag2 + ag3 + ag4 + ag5 + ag6 + ag7 + ag8 - ag9;

            // Second inertia moment X-axis
            const Ix1 = 1/12 * b1 * Math.pow(tf1, 3) + ag1 * Math.pow(d1, 2);
            const Ix2 = 1/12 * b1 * Math.pow(tf1, 3) + ag1 * Math.pow(d1, 2);
            const Ix3 = 1/12 * tw1 * Math.pow(hw3, 3);
            const Ix4 = 1/12 * tf2 * Math.pow(b2, 3);
            const Ix5 = 1/12 * tf2 * Math.pow(b2, 3);
            const Ix6 = 1/12 * hw6 * Math.pow(tw2, 3);
            const Ix = Ix1 + Ix2 + Ix3 + Ix4 + Ix5 + Ix6;

            // Second inertia moment Y-axis
            const Iy4 = 1/12 * b2 * Math.pow(tf2, 3) + ag4 * Math.pow(d4, 2);
            const Iy5 = 1/12 * b2 * Math.pow(tf2, 3) + ag4 * Math.pow(d4, 2);
            const Iy6 = 1/12 * tw2 * Math.pow(hw6, 3);
            const Iy1 = 1/12 * tf1 * Math.pow(b1, 3);
            const Iy2 = 1/12 * tf1 * Math.pow(b1, 3);
            const Iy3 = 1/12 * hw3 * Math.pow(tw2, 3);
            const Iy = Iy1 + Iy2 + Iy3 + Iy4 + Iy5 + Iy6;

            // Radius of gyration
            const ix = Math.sqrt(Ix / area);
            const iy = Math.sqrt(Iy / area);

            // Elastic section modulus
            const sx = Ix / (h1 / 2);
            const sy = Iy / (h2 / 2);

            // Plastic section modulus Zx
            const Zx1 = (b1 * tf1) * d1;
            const Zx2 = (b1 * tf1) * d1;
            const Zx3 = (tw1 * hw3/2) * hw3/4;
            const Zx4 = (tw1 * hw3/2) * hw3/4;
            const Zx5 = (b2*b2 * tf2 / 2);
            const Zx6 = (tw2 * hw6 / 8) * 2;
            const zx = Zx1 + Zx2 + Zx3 + Zx4 + Zx5 + Zx6;

            // Plastic section modulus Zy
            const Zy1 = (b2 * tf2) * d4;
            const Zy2 = (b2 * tf2) * d4;
            const Zy3 = (tw2 * hw6/2) * hw6/4;
            const Zy4 = (tw2 * hw6/2) * hw6/4;
            const Zy5 = (b1*b1 * tf1 / 2);
            const Zy6 = (tw1 * hw3 / 8) * 2;
            const zy = Zy1 + Zy2 + Zy3 + Zy4 + Zy5 + Zy6;

            // Torsional constant J
            const J1 = (2*b1 * Math.pow(tf1, 3) + h1*Math.pow(tw1, 3)) / 3;
            const J2 = (2*b2 * Math.pow(tf2, 3) + h2*Math.pow(tw2, 3)) / 3;
            const J = J1 + J2;

            // Warping constant Cw
            const cw = Iy * Math.pow(h1 - tf1, 2) / 4;

            // ===== Column Class calculations =====
            // Slenderness ratio
            const lambdaX = Kx * Lx / ix;
            const lambdaY = Ky * Ly / iy;
            const lambda = Math.max(lambdaX, lambdaY);

            // Flexural Buckling Stress Fe1
            const Fe1 = Math.pow(Math.PI, 2) * E / Math.pow(lambda, 2);

            // Torsional Buckling Stress Fe2
            const G = E / (2 * (1 + nu));
            const Fe2 = (Math.pow(Math.PI, 2) * E * cw / Math.pow(Kz * Lx, 2) + G * J) / (Ix + Iy);

            // Critical stress Fcr
            const Fe = Math.min(Fe1, Fe2);
            const Fcr = Math.pow(0.658, Fy / Fe) * Fy;

            // Compressive Strength phi_Pn
            const phi_c = 0.9;
            const phi_Pn = phi_c * area * Fcr / 1000; // kN

            // Flexural Strength - Mpx, Mpy
            const Mpx = Math.min(Fy * zx, 1.6 * Fy * sx) / 1000000; // kN.m
            const Mpy = Math.min(Fy * zy, 1.6 * Fy * sy) / 1000000; // kN.m
            const phi_b = 0.9;
            const phi_Mnx = phi_b * Mpx;
            const phi_Mny = phi_b * Mpy;

            // ===== ÎπÑÏú® Í≥ÑÏÇ∞ =====
            const ratio_comp = Pu / phi_Pn;
            const ratio_bendX = phi_Mnx > 0 ? Mux / phi_Mnx : 0;
            const ratio_bendY = phi_Mny > 0 ? Muy / phi_Mny : 0;

            // P-M-M Ï°∞Ìï©
            let ratio_pmm;
            if (ratio_comp >= 0.2) {
                ratio_pmm = ratio_comp + (8/9) * (ratio_bendX + ratio_bendY);
            } else {
                ratio_pmm = ratio_comp / 2 + (ratio_bendX + ratio_bendY);
            }

            return {
                compressive: ratio_comp,
                pmm: ratio_pmm
            };
        }

        // Multi Column Execution Ìï®Ïàò
        function executeMultiColumnCalculation() {
            const rows = document.querySelectorAll('#multiColumnTableBody tr');
            
            rows.forEach((row, index) => {
                const rowNum = index + 1;
                
                // Í∞Å ÌñâÏóêÏÑú Pu, Mux, Muy Í∞í ÏùΩÍ∏∞
                const puInput = row.querySelector('input[data-col="pu"]');
                const muxInput = row.querySelector('input[data-col="mux"]');
                const muyInput = row.querySelector('input[data-col="muy"]');
                
                const Pu = parseFloat(puInput.value) || 0;
                const Mux = parseFloat(muxInput.value) || 0;
                const Muy = parseFloat(muyInput.value) || 0;
                
                // Í≥ÑÏÇ∞ ÏàòÌñâ
                const results = calculateSingleColumn(Pu, Mux, Muy);
                
                // Í≤∞Í≥º Ï∂úÎ†•
                const compressiveCell = row.querySelector('[data-result="compressive"]');
                const pmmCell = row.querySelector('[data-result="pmm"]');
                
                if (compressiveCell) {
                    compressiveCell.textContent = results.compressive.toFixed(3);
                }
                if (pmmCell) {
                    pmmCell.textContent = results.pmm.toFixed(3);
                }
            });
            
            console.log('Multi Column Execution ÏôÑÎ£å');
        }
        
        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÌÖåÏù¥Î∏î Ï¥àÍ∏∞Ìôî Î∞è Í∏∞Î≥∏ Í∏∞Îë•Î≤àÌò∏ ÏÑ§Ï†ï
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                initializeMultiColumnTable();
                // Í∏∞Î≥∏ Í∏∞Îë•Î≤àÌò∏ ÏÑ§Ï†ï (Ï†ÄÏû•Îêú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÎäî Í≤ΩÏö∞ÏóêÎßå)
                const savedData = localStorage.getItem('columnPlanInputData');
                const savedCoords = localStorage.getItem('columnCoordinates');
                if (!savedData && !savedCoords) {
                    const defaultColumns = ['KC1', 'KC2', 'KC3', 'KC4', 'KC5', 'KC6'];
                    const defaultCoordinates = {
                        'KC1': { 
                            left: 0, 
                            top: 0, 
                            originalName: 'KC1',
                            no: 1
                        },
                        'KC2': { 
                            left: 0, 
                            top: 10000, 
                            originalName: 'KC2',
                            no: 2
                        },
                        'KC3': { 
                            left: 10000, 
                            top: 10000, 
                            originalName: 'KC3',
                            no: 3
                        },
                        'KC4': { 
                            left: 10000, 
                            top: 0, 
                            originalName: 'KC4',
                            no: 4
                        },
                        'KC2-2': { 
                            left: 3000, 
                            top: 3000, 
                            originalName: 'KC2',
                            no: 5
                        },
                        'KC3-2': { 
                            left: 6000, 
                            top: 6000, 
                            originalName: 'KC3',
                            no: 6
                        }
                    };
                    localStorage.setItem('columnCoordinates', JSON.stringify(defaultCoordinates));
                }
            });
        } else {
            initializeMultiColumnTable();
            addLoginModal();
            
            // Í∏∞Î≥∏ Í∏∞Îë•Î≤àÌò∏ ÏÑ§Ï†ï (Ï†ÄÏû•Îêú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÎäî Í≤ΩÏö∞ÏóêÎßå)
            const savedData = localStorage.getItem('columnPlanInputData');
            const savedCoords = localStorage.getItem('columnCoordinates');
            if (!savedData && !savedCoords) {
                const defaultColumns = ['KC1', 'KC2', 'KC3', 'KC4', 'KC5', 'KC6'];
                const defaultCoordinates = {
                    'KC1': { left: 0, top: 0 },      // Ï¢åÏÉÅ
                    'KC2': { left: 0, top: 10000 },  // Ï¢åÌïò (ÌôïÏû•)
                    'KC3': { left: 10000, top: 10000 },  // Ïö∞Ìïò (ÌôïÏû•)
                    'KC4': { left: 10000, top: 0 },     // Ïö∞ÏÉÅ (ÌôïÏû•)
                    'KC5': { left: 3000, top: 3000 },   // 5Î≤à
                    'KC6': { left: 6000, top: 6000 }   // 6Î≤à
                };
                localStorage.setItem('columnCoordinates', JSON.stringify(defaultCoordinates));
            }
            
            // Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú Îã´Í∏∞
            document.addEventListener('click', function(e) {
                const modal = document.getElementById('loginModal');
                if (modal && e.target === modal) {
                    closeLoginModal();
                }
            });
        }

        // Î°úÍ∑∏Ïù∏ Î™®Îã¨ HTML Ï∂îÍ∞Ä
        function addLoginModal() {
            // Ïù¥ÎØ∏ Î™®Îã¨Ïù¥ ÏûàÏúºÎ©¥ Ï∂îÍ∞ÄÌïòÏßÄ ÏïäÏùå
            if (document.getElementById('loginModal')) {
                return;
            }

            const modalHTML = `
                <div id="loginModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; align-items: center; justify-content: center;">
                    <div style="background: white; border-radius: 12px; padding: 30px; max-width: 400px; width: 90%; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
                        <h2 style="margin-bottom: 20px; color: #1e3a5f; font-size: 24px; text-align: center;">Î°úÍ∑∏Ïù∏</h2>
                        <p style="margin-bottom: 20px; color: #718096; font-size: 14px; text-align: center;">PDF Î≥¥Í∏∞Î•º ÏúÑÌï¥ Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.</p>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: #4a5568; font-weight: 600; font-size: 14px;">ID (ÏÇ¨ÏóÖÏûêÎ≤àÌò∏)</label>
                            <input type="text" id="loginUserId" placeholder="ÏÇ¨ÏóÖÏûêÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî" 
                                   style="width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 6px; font-size: 14px;"
                                   onkeypress="if(event.key==='Enter') handleLogin()">
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 5px; color: #4a5568; font-weight: 600; font-size: 14px;">ÎπÑÎ∞ÄÎ≤àÌò∏</label>
                            <input type="password" id="loginPassword" placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî" 
                                   style="width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 6px; font-size: 14px;"
                                   onkeypress="if(event.key==='Enter') handleLogin()">
                        </div>
                        <div id="loginError" style="color: #e53e3e; font-size: 13px; margin-bottom: 15px; min-height: 20px; text-align: center;"></div>
                        <div style="display: flex; gap: 10px;">
                            <button onclick="handleLogin()" 
                                    style="flex: 1; padding: 12px; background: #667eea; color: white; border: none; border-radius: 6px; font-size: 16px; font-weight: 600; cursor: pointer;">
                                Î°úÍ∑∏Ïù∏
                            </button>
                            <button onclick="closeLoginModal()" 
                                    style="flex: 1; padding: 12px; background: #cbd5e0; color: #4a5568; border: none; border-radius: 6px; font-size: 16px; font-weight: 600; cursor: pointer;">
                                Ï∑®ÏÜå
                            </button>
                        </div>
                        <div style="margin-top: 15px; text-align: center; font-size: 12px; color: #718096;">
                            <a href="#" style="color: #667eea; text-decoration: none;">ÌöåÏõêÍ∞ÄÏûÖ</a> | 
                            <a href="#" style="color: #667eea; text-decoration: none;">ÎπÑÎ∞ÄÎ≤àÌò∏ Ï∞æÍ∏∞</a>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }
    </script>
    <script src="../../js/auth-config.js"></script>
    <script src="../../js/auth.js"></script>
    <script src="../../js/page-usage-logger.js"></script>
    <script src="../../js/feature-guard.js"></script>
    
    <!-- Ïö¥ÏòÅÏûê Control Ï†ëÍ∑º Ï†úÏñ¥ -->
    <script>
        // Ïö¥ÏòÅÏûê Í∂åÌïú Ï≤¥ÌÅ¨ Î∞è UI ÏóÖÎç∞Ïù¥Ìä∏
        function initOperatorControl() {
            // Ïù∏Ï¶ù ÏãúÏä§ÌÖúÏù¥ Ï§ÄÎπÑÎê† ÎïåÍπåÏßÄ ÎåÄÍ∏∞
            function waitForAuth(callback, maxAttempts = 50) {
                let attempts = 0;
                function check() {
                    if (window.SDP && window.SDP.auth && typeof window.SDP.auth.isAdmin === 'function') {
                        callback();
                    } else if (attempts < maxAttempts) {
                        attempts++;
                        setTimeout(check, 100);
                    } else {
                        console.warn('Ïö¥ÏòÅÏûê Control: Ïù∏Ï¶ù ÏãúÏä§ÌÖúÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                        // Ïù∏Ï¶ù ÏãúÏä§ÌÖúÏù¥ ÏóÜÏúºÎ©¥ Ï†ëÍ∑º Ï∞®Îã®
                        disableOperatorControl('Ïù∏Ï¶ù ÏãúÏä§ÌÖú Ïò§Î•ò', null);
                    }
                }
                check();
            }

            waitForAuth(function() {
                const auth = window.SDP.auth;
                
                // Í¥ÄÎ¶¨Ïûê Í∂åÌïú ÌôïÏù∏
                auth.getSession().then(function(session) {
                    if (!session) {
                        disableOperatorControl('Î°úÍ∑∏Ïù∏ ÌïÑÏöî', null);
                        return;
                    }
                    
                    // ÌîÑÎ°úÌïÑ ÌôïÏù∏
                    auth.getProfile().then(function(profile) {
                        if (!profile) {
                            disableOperatorControl('ÌîÑÎ°úÌïÑ ÏóÜÏùå', null);
                            return;
                        }
                        
                        // Í¥ÄÎ¶¨Ïûê Í∂åÌïú ÌôïÏù∏
                        const isAdmin = auth.isAdmin();
                        if (!isAdmin) {
                            disableOperatorControl('Ïö¥ÏòÅÏûê Í∂åÌïú ÏóÜÏùå', session.user.email);
                        } else {
                            enableOperatorControl(session.user.email);
                        }
                    }).catch(function(err) {
                        console.error('ÌîÑÎ°úÌïÑ Î°úÎìú Ïò§Î•ò:', err);
                        disableOperatorControl('ÌîÑÎ°úÌïÑ Î°úÎìú Ïã§Ìå®', null);
                    });
                    }).catch(function(err) {
                        console.error('ÏÑ∏ÏÖò ÌôïÏù∏ Ïò§Î•ò:', err);
                        disableOperatorControl('ÏÑ∏ÏÖò ÌôïÏù∏ Ïã§Ìå®', null);
                    });
            });
        }

        // Ïö¥ÏòÅÏûê Control ÎπÑÌôúÏÑ±Ìôî
        function disableOperatorControl(reason, email) {
            const section = document.getElementById('operatorControlSection');
            const grid = document.getElementById('operatorControlGrid');
            const status = document.getElementById('operatorStatus');
            const emailSpan = document.getElementById('operatorEmail');
            
            if (!section || !grid || !status) return;
            
            // Ïù¥Î©îÏùº ÌëúÏãú
            if (emailSpan) {
                if (email) {
                    emailSpan.textContent = email;
                    emailSpan.style.display = 'block';
                } else {
                    emailSpan.textContent = 'sdppmo@kcol.kr';
                    emailSpan.style.display = 'block';
                }
            }
            
            // ÏÉÅÌÉú ÌëúÏãú
            status.textContent = 'üîí ' + reason;
            status.style.color = '#ef4444';
            status.style.fontSize = '12px';
            status.style.fontWeight = '600';
            
            // Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî
            const buttons = grid.querySelectorAll('.operator-control-btn');
            buttons.forEach(function(btn) {
                btn.style.opacity = '0.5';
                btn.style.cursor = 'not-allowed';
                btn.style.pointerEvents = 'none';
            });
            
            // ÏÑπÏÖò Î∞∞Í≤ΩÏÉâ Î≥ÄÍ≤Ω
            section.style.background = 'linear-gradient(135deg, #fee2e2, #fecaca)';
            section.style.borderColor = '#ef4444';
        }

        // Ïö¥ÏòÅÏûê Control ÌôúÏÑ±Ìôî
        function enableOperatorControl(email) {
            const section = document.getElementById('operatorControlSection');
            const grid = document.getElementById('operatorControlGrid');
            const status = document.getElementById('operatorStatus');
            const emailSpan = document.getElementById('operatorEmail');
            
            if (!section || !grid || !status) return;
            
            // Ïù¥Î©îÏùº ÌëúÏãú
            if (emailSpan) {
                if (email) {
                    emailSpan.textContent = email;
                } else {
                    emailSpan.textContent = 'sdppmo@kcol.kr';
                }
                emailSpan.style.display = 'block';
            }
            
            // ÏÉÅÌÉú ÌëúÏãú
            status.textContent = 'Ïö¥ÏòÅÏûê ÏäπÏù∏ÏÇ¨Ï†ÑÌïÑÏöî';
            status.style.color = '#10b981';
            status.style.fontSize = '12px';
            status.style.fontWeight = '600';
            
            // Î≤ÑÌäº ÌôúÏÑ±Ìôî
            const buttons = grid.querySelectorAll('.operator-control-btn');
            buttons.forEach(function(btn) {
                btn.style.opacity = '1';
                btn.style.cursor = 'pointer';
                btn.style.pointerEvents = 'auto';
            });
            
            // ÏÑπÏÖò Î∞∞Í≤ΩÏÉâ Î≥µÏõê
            section.style.background = 'linear-gradient(135deg, #fff7ed, #fef3c7)';
            section.style.borderColor = '#f59e0b';
        }

        // Ïö¥ÏòÅÏûê Ï†ëÍ∑º Ï≤¥ÌÅ¨ Ìï®Ïàò
        function checkOperatorAccess(callback, event) {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            // Ïù∏Ï¶ù ÏãúÏä§ÌÖú ÌôïÏù∏
            if (!window.SDP || !window.SDP.auth) {
                showOperatorAccessModal('Ïù∏Ï¶ù ÏãúÏä§ÌÖú Ïò§Î•ò', 'Ïù∏Ï¶ù ÏãúÏä§ÌÖúÏùÑ ÏÇ¨Ïö©Ìï† Ïàò ÏóÜÏäµÎãàÎã§.');
                return false;
            }
            
            const auth = window.SDP.auth;
            
            // ÏÑ∏ÏÖò ÌôïÏù∏
            auth.getSession().then(function(session) {
                if (!session) {
                    showOperatorAccessModal('Î°úÍ∑∏Ïù∏ ÌïÑÏöî', 'Ïö¥ÏòÅÏûê Control Í∏∞Îä•ÏùÑ ÏÇ¨Ïö©ÌïòÎ†§Î©¥ Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                    return;
                }
                
                // ÌîÑÎ°úÌïÑ ÌôïÏù∏
                auth.getProfile().then(function(profile) {
                    if (!profile) {
                        showOperatorAccessModal('ÌîÑÎ°úÌïÑ ÏóÜÏùå', 'ÏÇ¨Ïö©Ïûê ÌîÑÎ°úÌïÑÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                        return;
                    }
                    
                    // Í¥ÄÎ¶¨Ïûê Í∂åÌïú ÌôïÏù∏
                    const isAdmin = auth.isAdmin();
                    if (!isAdmin) {
                        showOperatorAccessModal('Ïö¥ÏòÅÏûê Í∂åÌïú ÏóÜÏùå', 'Ïù¥ Í∏∞Îä•ÏùÄ Ïö¥ÏòÅÏûê(Í¥ÄÎ¶¨Ïûê)Îßå ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§.\nÍ¥ÄÎ¶¨ÏûêÏóêÍ≤å Í∂åÌïúÏùÑ ÏöîÏ≤≠ÌïòÏÑ∏Ïöî.');
                    } else {
                        // Í∂åÌïú ÏûàÏùå - ÏΩúÎ∞± Ïã§Ìñâ
                        if (typeof callback === 'function') {
                            callback();
                        }
                    }
                }).catch(function(err) {
                    console.error('ÌîÑÎ°úÌïÑ ÌôïÏù∏ Ïò§Î•ò:', err);
                    showOperatorAccessModal('Ïò§Î•ò', 'ÌîÑÎ°úÌïÑÏùÑ ÌôïÏù∏ÌïòÎäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                });
            }).catch(function(err) {
                console.error('ÏÑ∏ÏÖò ÌôïÏù∏ Ïò§Î•ò:', err);
                showOperatorAccessModal('Ïò§Î•ò', 'ÏÑ∏ÏÖòÏùÑ ÌôïÏù∏ÌïòÎäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            });
            
            return false;
        }

        // Ïö¥ÏòÅÏûê Ï†ëÍ∑º Ï≤¥ÌÅ¨ Î∞è ÌéòÏù¥ÏßÄ Ïù¥Îèô Ìï®Ïàò (ÎßÅÌÅ¨Ïö©)
        function checkOperatorAccessAndNavigate(event, targetUrl) {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            // Ïù∏Ï¶ù ÏãúÏä§ÌÖú ÌôïÏù∏
            if (!window.SDP || !window.SDP.auth) {
                showOperatorAccessModal('Ïù∏Ï¶ù ÏãúÏä§ÌÖú Ïò§Î•ò', 'Ïù∏Ï¶ù ÏãúÏä§ÌÖúÏùÑ ÏÇ¨Ïö©Ìï† Ïàò ÏóÜÏäµÎãàÎã§.');
                return false;
            }
            
            const auth = window.SDP.auth;
            
            // ÏÑ∏ÏÖò ÌôïÏù∏
            auth.getSession().then(function(session) {
                if (!session) {
                    showOperatorAccessModal('Î°úÍ∑∏Ïù∏ ÌïÑÏöî', 'Ïö¥ÏòÅÏûê Control Í∏∞Îä•ÏùÑ ÏÇ¨Ïö©ÌïòÎ†§Î©¥ Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                    return;
                }
                
                // ÌîÑÎ°úÌïÑ ÌôïÏù∏
                auth.getProfile().then(function(profile) {
                    if (!profile) {
                        showOperatorAccessModal('ÌîÑÎ°úÌïÑ ÏóÜÏùå', 'ÏÇ¨Ïö©Ïûê ÌîÑÎ°úÌïÑÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                        return;
                    }
                    
                    // Í¥ÄÎ¶¨Ïûê Í∂åÌïú ÌôïÏù∏
                    const isAdmin = auth.isAdmin();
                    if (!isAdmin) {
                        showOperatorAccessModal('Ïö¥ÏòÅÏûê Í∂åÌïú ÏóÜÏùå', 'Ïù¥ Í∏∞Îä•ÏùÄ Ïö¥ÏòÅÏûê(Í¥ÄÎ¶¨Ïûê)Îßå ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§.\nÍ¥ÄÎ¶¨ÏûêÏóêÍ≤å Í∂åÌïúÏùÑ ÏöîÏ≤≠ÌïòÏÑ∏Ïöî.');
                    } else {
                        // Í∂åÌïú ÏûàÏùå - ÏûÖÎ†• Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• ÌõÑ ÌéòÏù¥ÏßÄ Ïù¥Îèô
                        try {
                            saveInputData();
                            console.log('ÏûÖÎ†• Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• ÏôÑÎ£å, Í≥ÑÏÇ∞ÏÑú ÌéòÏù¥ÏßÄÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§.');
                            window.location.href = targetUrl;
                        } catch (e) {
                            console.error('ÏûÖÎ†• Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• Ïò§Î•ò:', e);
                            // Ï†ÄÏû• Ïã§Ìå®Ìï¥ÎèÑ ÌéòÏù¥ÏßÄ Ïù¥Îèô
                            window.location.href = targetUrl;
                        }
                    }
                }).catch(function(err) {
                    console.error('ÌîÑÎ°úÌïÑ ÌôïÏù∏ Ïò§Î•ò:', err);
                    showOperatorAccessModal('Ïò§Î•ò', 'ÌîÑÎ°úÌïÑÏùÑ ÌôïÏù∏ÌïòÎäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                });
            }).catch(function(err) {
                console.error('ÏÑ∏ÏÖò ÌôïÏù∏ Ïò§Î•ò:', err);
                showOperatorAccessModal('Ïò§Î•ò', 'ÏÑ∏ÏÖòÏùÑ ÌôïÏù∏ÌïòÎäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            });
            
            return false;
        }

        // Ïö¥ÏòÅÏûê Ï†ëÍ∑º Í±∞Î∂Ä Î™®Îã¨ ÌëúÏãú
        function showOperatorAccessModal(title, message) {
            const existingModal = document.getElementById('operator-access-modal');
            if (existingModal) existingModal.remove();

            const modal = document.createElement('div');
            modal.id = 'operator-access-modal';
            modal.innerHTML = '\
                <div class="operator-modal-overlay">\
                    <div class="operator-modal">\
                        <div class="operator-modal-icon">üîí</div>\
                        <h3>' + title + '</h3>\
                        <p>' + message.replace(/\n/g, '<br>') + '</p>\
                        <div class="operator-modal-buttons">\
                            <button class="operator-modal-btn primary" id="operator-login-btn">Î°úÍ∑∏Ïù∏</button>\
                            <button class="operator-modal-btn secondary" id="operator-close-btn">Îã´Í∏∞</button>\
                        </div>\
                    </div>\
                </div>\
            ';

            const style = document.createElement('style');
            style.textContent = '\
                .operator-modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 99999; -webkit-backdrop-filter: blur(4px); backdrop-filter: blur(4px); }\
                .operator-modal { background: #1e2642; border-radius: 12px; padding: 28px 32px; max-width: 400px; text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }\
                .operator-modal-icon { font-size: 48px; margin-bottom: 12px; }\
                .operator-modal h3 { color: #fff; font-size: 20px; margin: 0 0 12px; }\
                .operator-modal p { color: #9ca3af; font-size: 14px; line-height: 1.6; margin: 0 0 24px; }\
                .operator-modal-buttons { display: flex; gap: 12px; justify-content: center; }\
                .operator-modal-btn { border: none; padding: 12px 24px; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: transform 0.2s; }\
                .operator-modal-btn.primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; }\
                .operator-modal-btn.secondary { background: rgba(100, 116, 139, 0.3); color: #cbd5e1; }\
                .operator-modal-btn:hover { transform: translateY(-2px); }\
            ';
            document.head.appendChild(style);
            document.body.appendChild(modal);

            modal.querySelector('#operator-login-btn').addEventListener('click', function() {
                window.location.assign('/pages/auth/login.html?redirect=' + encodeURIComponent(window.location.pathname));
            });
            modal.querySelector('#operator-close-btn').addEventListener('click', function() {
                modal.remove();
            });
            modal.querySelector('.operator-modal-overlay').addEventListener('click', function(e) {
                if (e.target === this) modal.remove();
            });
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initOperatorControl);
        } else {
            initOperatorControl();
        }
    </script>
</body>
</html>
