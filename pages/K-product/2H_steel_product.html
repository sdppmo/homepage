<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K-COLUMN ê³µì •ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #2c4a7c, #4a6fa5);
            color: white;
            padding: 20px 30px;
            padding-left: 140px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
        }

        .header-info {
            text-align: right;
            font-size: 14px;
        }

        .home-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            z-index: 10;
        }

        .home-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        /* Company Selector */
        .company-selector {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .company-selector h3 {
            margin-bottom: 15px;
            color: #2c4a7c;
        }

        .company-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .company-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            min-width: 200px;
        }

        .company-btn.yuseok {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .company-btn.jusin {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .company-btn.jinhung {
            background: linear-gradient(135deg, #27ae60, #1e8449);
            color: white;
        }

        /* Process Buttons */
        .process-btn.p1 {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }
        .process-btn.p2 {
            background: linear-gradient(135deg, #ff9800, #f57c00);
            color: white;
        }
        .process-btn.p3 {
            background: linear-gradient(135deg, #2196f3, #1976d2);
            color: white;
        }
        .process-btn.p4 {
            background: linear-gradient(135deg, #00bcd4, #0097a7);
            color: white;
        }
        .process-btn.p5 {
            background: linear-gradient(135deg, #9c27b0, #7b1fa2); /* ì›ë˜ ë§ˆì  íƒ€ */
            color: white;
        }
        .process-btn.p6 {
            background: linear-gradient(135deg, #4caf50, #388e3c);
            color: white;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .process-btn.active {
            box-shadow: 0 0 0 4px #ffd700;
            transform: scale(1.05);
        }

        .company-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .company-btn.active {
            box-shadow: 0 0 0 4px rgba(255,255,255,0.5), 0 4px 15px rgba(0,0,0,0.3);
            transform: scale(1.02);
        }

        .company-btn small {
            display: block;
            font-weight: 400;
            margin-top: 5px;
            opacity: 0.9;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-btn {
            padding: 12px 25px;
            background: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            color: #666;
        }

        .tab-btn.active {
            background: #2c4a7c;
            color: white;
        }

        .tab-btn:hover:not(.active) {
            background: #f0f0f0;
        }
        
        /* ì¼ì¼ ì…ë ¥ ë²„íŠ¼ì€ í•­ìƒ í…Œë‘ë¦¬ ìœ ì§€ */
        .company-selector .tab-btn {
            border: 1px solid #ddd;
        }
        
        .company-selector .tab-btn.active {
            border-color: #2c4a7c;
        }
        
        .company-selector .tab-btn:not(.active) {
            border-color: #ddd;
        }

        /* Content Panels */
        .panel {
            display: none;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .panel.active {
            display: block;
        }

        /* ì¢Œí‘œ ì„¤ì • ëª¨ë“œ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .coordinate-setup-btn {
            padding: 8px 16px;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        
        .coordinate-setup-btn.inactive {
            background: #ff9800 !important;
            background-color: #ff9800 !important;
        }
        
        .coordinate-setup-btn.active {
            background: #4caf50 !important;
            background-color: #4caf50 !important;
        }

        /* Input Panel */
        .input-section {
            margin-bottom: 20px;
        }

        .input-section h3 {
            margin-bottom: 15px;
            color: #2c4a7c;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }

        .date-selector {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .date-selector label {
            font-weight: 600;
            color: #555;
        }

        .date-selector input[type="date"] {
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        /* Column Grid */
        .column-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .column-item {
            position: relative;
            aspect-ratio: 1;
            border: 2px solid #ddd;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            background: #f8f9fa;
            font-size: 12px;
        }

        .column-item:hover {
            border-color: #2c4a7c;
            transform: scale(1.05);
            z-index: 10;
        }

        .column-item .col-num {
            font-weight: 700;
            font-size: 14px;
            color: #333;
        }

        .column-item .col-status {
            font-size: 10px;
            color: #666;
            margin-top: 2px;
        }

        /* Status Colors */
        .column-item.status-0 { background: #f8f9fa; border-color: #ddd; }
        .column-item.status-1 { background: #ffebee; border-color: #e74c3c; }
        .column-item.status-2 { background: #fff3e0; border-color: #ff9800; }
        .column-item.status-3 { background: #e3f2fd; border-color: #2196f3; }
        .column-item.status-4 { background: #e0f7fa; border-color: #00bcd4; }
        .column-item.status-5 { background: #fff5ff; border-color: #9c27b0; }
        .column-item.status-6 { background: #4caf50; border-color: #2e7d32; color: white; }
        .column-item.status-6 .col-num, .column-item.status-6 .col-status { color: white; }

        /* Process Legend */
        .process-legend {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }

        /* Gantt Chart */
        .gantt-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        .gantt-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 11px;
            min-width: 2000px;
        }

        .gantt-table th, .gantt-table td {
            border: 1px solid #ddd;
            padding: 4px;
            text-align: center;
            min-width: 30px;
        }

        .gantt-table th {
            background: #2c4a7c;
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .gantt-table th.col-header {
            min-width: 80px;
            background: #1a3a5c;
        }

        .gantt-table .date-header {
            font-size: 10px;
        }

        .gantt-table .weekend {
            background: #fff3e0 !important;
        }

        .gantt-table td.col-name {
            background: #f5f5f5;
            font-weight: 600;
            text-align: left;
            padding-left: 10px;
            position: sticky;
            left: 0;
            z-index: 5;
        }

        .gantt-cell {
            width: 100%;
            height: 20px;
            cursor: pointer;
        }

        .gantt-cell.p1 { background: #e74c3c; }
        .gantt-cell.p2 { background: #ff9800; }
        .gantt-cell.p3 { background: #2196f3; }
        .gantt-cell.p4 { background: #00bcd4; }
        .gantt-cell.p5 { background: #e1bee7; } /* ì§„í•œ ë§ˆì  íƒ€ - ë°°ì†¡ê³„íš */
        .gantt-cell.p5.confirmed { background: #9c27b0; } /* ì§™ì€ ë§ˆì  íƒ€ - ë°°ì†¡í™•ì¸ */
        .gantt-cell.p6 { background: #4caf50; }

        /* íœ´ë¬´ì¼ ìŠ¤íƒ€ì¼ */
        .gantt-table .holiday {
            background: #ffcdd2 !important;
            position: relative;
        }
        .gantt-table .holiday-header {
            background: #e53935 !important;
            color: white !important;
        }
        .holiday-label {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 8px;
            color: #c62828;
            white-space: nowrap;
            font-weight: bold;
        }

        /* Progress Summary */
        .progress-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 1200px) {
            .progress-summary {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .progress-summary {
                grid-template-columns: 1fr;
            }
        }

        .progress-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .progress-card h4 {
            margin-bottom: 15px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-card .company-badge {
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            color: white;
        }

        .progress-card .company-badge.yuseok { background: #e74c3c; }
        .progress-card .company-badge.jusin { background: #3498db; }
        .progress-card .company-badge.jinhung { background: #27ae60; }

        .progress-bar-container {
            margin-bottom: 10px;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 13px;
        }

        .progress-bar {
            height: 24px;
            background: #e0e0e0;
            border-radius: 12px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            border-radius: 12px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 11px;
        }

        .progress-bar-fill.p1 { background: linear-gradient(90deg, #e74c3c, #c0392b); }
        .progress-bar-fill.p2 { background: linear-gradient(90deg, #ff9800, #f57c00); }
        .progress-bar-fill.p3 { background: linear-gradient(90deg, #2196f3, #1976d2); }
        .progress-bar-fill.p4 { background: linear-gradient(90deg, #00bcd4, #0097a7); }
        .progress-bar-fill.p5 { background: linear-gradient(90deg, #fff5ff, #fef7ff); } /* ì˜…ì€ ë§ˆì  íƒ€ - ìš´ì†¡ì°¨ìˆ˜ê³„íš */
        .progress-bar-fill.p6 { background: linear-gradient(90deg, #4caf50, #388e3c); }

        /* Chart Container */
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .chart-container h3 {
            margin-bottom: 20px;
            color: #2c4a7c;
        }

        #progressChart {
            max-height: 400px;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .action-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .action-btn.primary {
            background: #2c4a7c;
            color: white;
        }

        .action-btn.secondary {
            background: #6c757d;
            color: white;
        }

        .action-btn.danger {
            background: #dc3545;
            color: white;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-content h3 {
            margin-bottom: 20px;
            color: #2c4a7c;
        }

        .modal-content .form-group {
            margin-bottom: 15px;
        }
        
        /* ë‚ ì§œ ì…ë ¥ í•„ë“œ ê°•ì œ í‘œì‹œ */
        #modal-date-group {
            display: block !important;
            visibility: visible !important;
        }
        
        #modal-work-date {
            display: block !important;
            visibility: visible !important;
            width: 100% !important;
            padding: 10px !important;
            border: 2px solid #ddd !important;
            border-radius: 8px !important;
            font-size: 14px !important;
        }

        .modal-content label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        .modal-content select, .modal-content input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        /* Process Selection Modal */
        .process-selection-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .process-selection-modal.active {
            display: flex;
        }

        .process-selection-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .process-selection-content h3 {
            margin-bottom: 15px;
            color: #e74c3c;
            font-size: 18px;
        }

        .process-selection-content p {
            margin-bottom: 20px;
            color: #555;
            line-height: 1.6;
        }

        .process-selection-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        .process-select-btn {
            flex: 1;
            padding: 15px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
        }

        .process-select-btn.p1 {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .process-select-btn.p1:hover {
            background: linear-gradient(135deg, #c0392b, #a93226);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.4);
        }

        .process-select-btn.p2 {
            background: linear-gradient(135deg, #ff9800, #f57c00);
        }

        .process-select-btn.p2:hover {
            background: linear-gradient(135deg, #f57c00, #e65100);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 152, 0, 0.4);
        }

        .process-select-btn.cancel {
            background: #6c757d;
            color: white;
        }

        .process-select-btn.cancel:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .column-grid {
                grid-template-columns: repeat(5, 1fr);
            }
            
            .company-buttons {
                flex-direction: column;
            }
            
            .company-btn {
                min-width: 100%;
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header" style="position: relative;">
            <a href="../../index.html" class="home-btn">
                <span>ğŸ </span>
                <span>í™ˆìœ¼ë¡œ</span>
            </a>
            <div>
                <h1>ğŸ—ï¸ K-COLUMN ê³µì •ê´€ë¦¬ ì‹œìŠ¤í…œ <span id="project-badge" style="margin-left:10px;font-size:12px;font-weight:800;background:rgba(255,255,255,0.18);padding:6px 10px;border-radius:999px;">PROJECT</span></h1>
                <p style="margin-top:5px;opacity:0.9;">K-COLUMN 50EA ì œì‘ ë° ì„¤ì¹˜ ê³µì •</p>
            </div>
            <div class="header-info">
                <div>ê³µì‚¬ê¸°ê°„: 2025.12.26 ~ 2026.03.15</div>
                <div style="margin-top:5px;">ì´ ê¸°ë‘¥ìˆ˜: <strong>50ê°œ</strong></div>
            </div>
        </div>

        <!-- Company Selector -->
        <div class="company-selector">
                <div style="display:flex;align-items:center;gap:15px;margin-bottom:15px;">
                    <button class="tab-btn active" onclick="showPanel('input', this)" style="margin:0;">âœï¸ ì¼ì¼ ì…ë ¥</button>
                    <p style="margin:0;color:#666;font-size:13px;">ì•„ë˜ ë°ì´í„°(1~6) ì…ë ¥ì„ ìœ„í•´ "ì¼ì¼ì…ë ¥"ì„ ë¨¼ì € í´ë¦­í•˜ê³  í•´ë‹¹ê³µì •ìœ¼ë¡œ ë“¤ì–´ê°€ì‹œê¸° ë°”ëë‹ˆë‹¤.</p>
                </div>
            <div class="company-buttons" style="display:grid;grid-template-columns:repeat(6,1fr);gap:8px;">
                <button class="company-btn process-btn p1" data-process="1" onclick="selectProcess(1)">
                    1. ì£¼ê¸°ë‘¥ì»¤íŒ…
                    <small>ìœ ì„ì² ê°•(ì¶©ì£¼ê³µì¥)</small>
                </button>
                <button class="company-btn process-btn p2" data-process="2" onclick="selectProcess(2)">
                    2. ì†Œë¶€ì¬ê°€ê³µ
                    <small>ìœ ì„ì² ê°•(ì˜¤ì°½ê³µì¥)</small>
                </button>
                <button class="company-btn process-btn p3" data-process="3" onclick="selectProcess(3)">
                    3. ì£¼ê¸°ë‘¥ì¡°ë¦½
                    <small>ìœ ì„ì² ê°•(ìŒì„±ê³µì¥)</small>
                </button>
                <button class="company-btn process-btn p4" data-process="4" onclick="selectProcess(4)">
                    4. ì†Œë¶€ì¬ì¡°ë¦½
                    <small>ìœ ì„ì² ê°•(ìŒì„±ê³µì¥)</small>
                </button>
                <button class="company-btn process-btn p5" data-process="5" onclick="selectProcess(5)">
                    5. í˜„ì¥ë°°ì†¡
                    <small>ìœ ì„ì² ê°•(ìŒì„±ê³µì¥)</small>
                </button>
                <button class="company-btn process-btn p6" data-process="6" onclick="selectProcess(6)">
                    6. í˜„ì¥ì„¤ì¹˜
                    <small>ì§„í¥ê¸°ì—…</small>
                </button>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" onclick="showPanel('overview', this)">ğŸ“Š ì „ì²´ í˜„í™©</button>
            <button class="tab-btn" onclick="showPanel('transport', this)">ğŸšš ìš´ì†¡ì°¨ìˆ˜ê³„íš</button>
            <button class="tab-btn" onclick="showPanel('gantt', this)">ğŸ“… ê³µì •í‘œ (Gantt)</button>
            <button class="tab-btn" onclick="showPanel('chart', this)">ğŸ“ˆ ì§„í–‰ë¥  ì°¨íŠ¸</button>
            <button class="tab-btn" onclick="showPanel('transportVolume', this)">ğŸ“¦ ìš´ì†¡ë¬¼ëŸ‰ì‚°ì •</button>
            <button class="tab-btn" onclick="showPanel('installation', this)">ğŸ—ï¸ í˜„ì¥ì„¤ì¹˜í˜„í™©ë„</button>
        </div>

        <!-- Overview Panel -->
        <div class="panel active" id="panel-overview">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                <h3 style="margin:0;color:#2c4a7c;">ğŸ“Š ì „ì²´ ê³µì • í˜„í™©</h3>
                <button class="action-btn" onclick="resetAllData()" style="background:#f44336;color:white;padding:8px 16px;border:none;border-radius:6px;cursor:pointer;font-weight:600;">
                    ğŸ”„ ì „ì²´ ì´ˆê¸°í™”
                </button>
            </div>
            
            <!-- Progress Summary -->
            <div class="progress-summary">
                <div class="progress-card">
                    <h4>
                        <span>1. ì£¼ê¸°ë‘¥ì»¤íŒ…</span>
                        <span class="company-badge yuseok">ìœ ì„ì² ê°•(ì¶©ì£¼ê³µì¥)</span>
                    </h4>
                    <div class="progress-bar-container">
                        <div class="progress-label">
                            <span>ì™„ë£Œ</span>
                            <span id="progress-p1-text">0 / 50</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-bar-fill p1" id="progress-p1" style="width:0%">0%</div>
                        </div>
                    </div>
                </div>

                <div class="progress-card">
                    <h4>
                        <span>2. ì†Œë¶€ì¬ê°€ê³µ</span>
                        <span class="company-badge yuseok">ìœ ì„ì² ê°•(ì˜¤ì°½ê³µì¥)</span>
                    </h4>
                    <div class="progress-bar-container">
                        <div class="progress-label">
                            <span>ì™„ë£Œ</span>
                            <span id="progress-p2-text">0 / 50</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-bar-fill p2" id="progress-p2" style="width:0%">0%</div>
                        </div>
                    </div>
                </div>

                <div class="progress-card">
                    <h4>
                        <span>3. ì£¼ê¸°ë‘¥ì¡°ë¦½</span>
                        <span class="company-badge yuseok">ìœ ì„ì² ê°•(ìŒì„±ê³µì¥)</span>
                    </h4>
                    <div class="progress-bar-container">
                        <div class="progress-label">
                            <span>ì™„ë£Œ</span>
                            <span id="progress-p3-text">0 / 50</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-bar-fill p3" id="progress-p3" style="width:0%">0%</div>
                        </div>
                    </div>
                </div>

                <div class="progress-card">
                    <h4>
                        <span>4. ì†Œë¶€ì¬ì¡°ë¦½</span>
                        <span class="company-badge yuseok">ìœ ì„ì² ê°•(ìŒì„±ê³µì¥)</span>
                    </h4>
                    <div class="progress-bar-container">
                        <div class="progress-label">
                            <span>ì™„ë£Œ</span>
                            <span id="progress-p4-text">0 / 50</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-bar-fill p4" id="progress-p4" style="width:0%">0%</div>
                        </div>
                    </div>
                </div>

                <div class="progress-card">
                    <h4>
                        <span>5. í˜„ì¥ë°°ì†¡</span>
                        <span class="company-badge yuseok">ìœ ì„ì² ê°•(ìŒì„±ê³µì¥)</span>
                    </h4>
                    <div class="progress-bar-container">
                        <div class="progress-label">
                            <span>ì™„ë£Œ</span>
                            <span id="progress-p5-text">0 / 50</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-bar-fill p5" id="progress-p5" style="width:0%">0%</div>
                        </div>
                    </div>
                </div>

                <div class="progress-card">
                    <h4>
                        <span>6. í˜„ì¥ì„¤ì¹˜</span>
                        <span class="company-badge jinhung">ì§„í¥ê¸°ì—…</span>
                    </h4>
                    <div class="progress-bar-container">
                        <div class="progress-label">
                            <span>ì™„ë£Œ</span>
                            <span id="progress-p6-text">0 / 50</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-bar-fill p6" id="progress-p6" style="width:0%">0%</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Column Status Grid -->
            <h3 style="margin:20px 0 15px;color:#2c4a7c;">ğŸ”© ê¸°ë‘¥ë³„ í˜„ì¬ ê³µì • ìƒíƒœ</h3>
            <div class="process-legend">
                <div class="legend-item"><div class="legend-color" style="background:#f8f9fa;"></div><span>ë¯¸ì°©ìˆ˜</span></div>
                <div class="legend-item"><div class="legend-color" style="background:#ffebee;"></div><span>1.ì£¼ê¸°ë‘¥ì»¤íŒ…</span></div>
                <div class="legend-item"><div class="legend-color" style="background:#fff3e0;"></div><span>2.ì†Œë¶€ì¬ê°€ê³µ</span></div>
                <div class="legend-item"><div class="legend-color" style="background:#e3f2fd;"></div><span>3.ì£¼ê¸°ë‘¥ì¡°ë¦½</span></div>
                <div class="legend-item"><div class="legend-color" style="background:#e0f7fa;"></div><span>4.ì†Œë¶€ì¬ì¡°ë¦½</span></div>
                <div class="legend-item"><div class="legend-color" style="background:#fff5ff;"></div><span>5.í˜„ì¥ë°°ì†¡</span></div>
                <div class="legend-item"><div class="legend-color" style="background:#4caf50;"></div><span>6.ì„¤ì¹˜ì™„ë£Œ</span></div>
            </div>
            <div class="column-grid" id="column-grid-overview">
                <!-- Generated by JS -->
            </div>
        </div>

        <!-- Input Panel -->
        <div class="panel" id="panel-input">
            <div class="input-section">
                <h3>âœï¸ ì¼ì¼ ê³µì • ì…ë ¥ <span id="selected-company-name" style="color:#666;font-weight:400;font-size:14px;"></span></h3>
                
                <!-- ì¤‘ë³µ ì…ë ¥ ê²½ê³  -->
                <div id="duplicate-warning" style="display:none;margin-bottom:15px;padding:12px;background:#fff3cd;border:2px solid #ff9800;border-radius:8px;color:#856404;font-size:13px;">
                    <div id="duplicate-warning-content" style="margin-bottom:10px;">
                        <!-- ì¤‘ë³µ ê²½ê³  ë©”ì‹œì§€ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                    <button onclick="deleteAllDuplicates()" style="padding:6px 12px;background:#f44336;color:white;border:none;border-radius:6px;cursor:pointer;font-weight:600;font-size:12px;">
                        ğŸ—‘ï¸ ì¤‘ë³µ í•­ëª© ëª¨ë‘ ì‚­ì œ
                    </button>
                </div>
                
                <div class="date-selector">
                    <label>ğŸ“… ì‘ì—…ì¼ì:</label>
                    <input type="date" id="work-date" onchange="loadDayData()">
                    <div id="weekday-buttons" style="display:flex;gap:8px;flex-wrap:wrap;">
                        <!-- ìš”ì¼ ë²„íŠ¼ë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ (ì§€ë‚œì£¼ 7ê°œ + ì´ë²ˆ ì£¼ 7ê°œ = ì´ 14ê°œ) -->
                    </div>
                </div>

                <div class="process-legend">
                    <div class="legend-item"><div class="legend-color" style="background:#f8f9fa;"></div><span>ë¯¸ì°©ìˆ˜</span></div>
                    <div class="legend-item"><div class="legend-color" style="background:#ffebee;"></div><span>1.ì£¼ê¸°ë‘¥ì»¤íŒ…</span></div>
                    <div class="legend-item"><div class="legend-color" style="background:#fff3e0;"></div><span>2.ì†Œë¶€ì¬ê°€ê³µ</span></div>
                    <div class="legend-item"><div class="legend-color" style="background:#e3f2fd;"></div><span>3.ì£¼ê¸°ë‘¥ì¡°ë¦½</span></div>
                    <div class="legend-item"><div class="legend-color" style="background:#e0f7fa;"></div><span>4.ì†Œë¶€ì¬ì¡°ë¦½</span></div>
                    <div class="legend-item"><div class="legend-color" style="background:#fff5ff;"></div><span>5.í˜„ì¥ë°°ì†¡</span></div>
                    <div class="legend-item"><div class="legend-color" style="background:#4caf50;"></div><span>6.ì„¤ì¹˜ì™„ë£Œ</span></div>
                </div>

                <div id="guide-stats" style="margin-bottom:10px;padding:10px;background:#e8f5e9;border-radius:6px;font-size:12px;color:#2e7d32;display:none;"></div>

                <div class="column-grid" id="column-grid-input">
                    <!-- Generated by JS -->
                </div>

                <div class="action-buttons">
                    <button class="action-btn primary" onclick="saveData()">ğŸ’¾ ì €ì¥</button>
                    <button class="action-btn secondary" onclick="exportData()">ğŸ“¥ ë‚´ë³´ë‚´ê¸°</button>
                    <label class="action-btn secondary" style="cursor:pointer;">
                        ğŸ“¤ ê°€ì ¸ì˜¤ê¸°
                        <input type="file" accept=".json" onchange="importData(event)" style="display:none;">
                    </label>
                </div>
                <p style="margin-top:15px;padding:15px;background:#e3f2fd;border-radius:8px;font-size:13px;color:#1565c0;">
                    ğŸ’¡ <strong>ì‹¤ì‹œê°„ ê³µìœ  ì„¤ì •:</strong> 3ê°œ ì—…ì²´ê°€ ê°ì ì¥ì†Œì—ì„œ ì…ë ¥í•˜ë ¤ë©´ Firebase ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.<br>
                    í˜„ì¬ ëª¨ë“œ: <span id="current-mode" style="font-weight:bold;">í™•ì¸ ì¤‘...</span>
                </p>
            </div>
        </div>

        <!-- Transport Panel -->
        <div class="panel" id="panel-transport">
            <h3 style="margin-bottom:20px;color:#2c4a7c;">ğŸšš í˜„ì¥ìš´ì†¡ì°¨ìˆ˜ê³„íšì…ë ¥</h3>
            
            <!-- ì…ë ¥ ì•ˆë‚´ì°½ -->
            <div id="transport-guide" style="margin-bottom:20px;padding:15px;background:#fff8e1;border-radius:8px;border:1px solid #ffc107;">
                <div style="margin-bottom:10px;">
                    <strong style="font-size:14px;color:#795548;">ğŸ”´ í˜„ì¥ìš´ì†¡ì°¨ìˆ˜ê³„íšì…ë ¥ : ìœ ì„ì² ê°•</strong>
                </div>
                <div style="font-size:13px;color:#795548;">
                    <div style="margin:3px 0;">â‘  í•´ë‹¹ì°¨ìˆ˜ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.</div>
                    <div style="margin:3px 0;">â‘¡ ì„ íƒí•œ ê¸°ë‘¥ì„ í´ë¦­í•©ë‹ˆë‹¤. ìƒ‰ìƒì´ ë…¹ìƒ‰ìœ¼ë¡œ ë³€ê²½ë©ë‹ˆë‹¤.</div>
                    <div style="margin:3px 0;">â‘¢ í•´ë‹¹ì°¨ìˆ˜ ê¸°ë‘¥ì„ ì„ íƒí›„ ì•„ë˜ ì €ì¥í•©ë‹ˆë‹¤.</div>
                    <div style="margin:3px 0;">â‘£ ìˆ˜ì •ì´ ë°œìƒë˜ë©´ í•´ë‹¹ì°¨ìˆ˜ì—ì„œ ì¬ì§€ì •í•˜ì—¬ ì €ì¥í•©ë‹ˆë‹¤.</div>
                    <div style="margin:3px 0;color:#d32f2f;font-weight:600;">â‘¤ ì¤‘ë³µì²´í¬ë¥¼ í†µí•´ ì…ë ¥ê¸°ë‘¥ì°¨ìˆ˜ì˜ ìµœì¢…ì¼ìë¥¼ í™•ì¸ë°”ëŒ.</div>
                </div>
            </div>
            
            <!-- ì°¨ìˆ˜ ê´€ë¦¬ ì„¹ì…˜ -->
            <div style="margin-bottom:20px;padding:15px;background:#fff;border-radius:8px;border:1px solid #e0e0e0;">
                <div style="display:flex;align-items:center;gap:15px;margin-bottom:15px;flex-wrap:wrap;">
                    <label style="font-weight:600;color:#2c4a7c;">ì°¨ìˆ˜ ê´€ë¦¬:</label>
                    <input type="number" id="transport-trip-input" min="1" value="1" style="width:80px;padding:8px;border:1px solid #ddd;border-radius:4px;">
                    <button class="action-btn primary" onclick="addTransportTrip()">â• ì°¨ìˆ˜ ì¶”ê°€</button>
                    <button class="action-btn secondary" onclick="removeTransportTrip()">â– ì°¨ìˆ˜ ì‚­ì œ</button>
                </div>
                <div style="display:flex;align-items:center;gap:15px;margin-bottom:15px;flex-wrap:wrap;padding-top:15px;border-top:1px solid #e0e0e0;">
                    <label style="font-weight:600;color:#2c4a7c;">ì°¨ìˆ˜ ë²ˆí˜¸ ìˆ˜ì •:</label>
                    <input type="number" id="transport-trip-edit-input" min="1" value="1" style="width:80px;padding:8px;border:1px solid #ddd;border-radius:4px;">
                    <button class="action-btn" onclick="editTransportTrip()" style="background:#ff9800;color:white;">âœï¸ ì°¨ìˆ˜ ë²ˆí˜¸ ë³€ê²½</button>
                    <span style="font-size:12px;color:#666;">í˜„ì¬ ì„ íƒëœ ì°¨ìˆ˜ì˜ ë²ˆí˜¸ë¥¼ ë³€ê²½í•©ë‹ˆë‹¤</span>
                </div>
                <div id="transport-trips-list" style="display:flex;flex-wrap:wrap;gap:10px;">
                    <!-- ì°¨ìˆ˜ ë²„íŠ¼ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>
            </div>

            <!-- í˜„ì¬ ì„ íƒëœ ì°¨ìˆ˜ ì •ë³´ -->
            <div id="current-trip-info" style="margin-bottom:20px;padding:15px;background:#e3f2fd;border-radius:8px;border-left:4px solid #2196f3;">
                <div style="font-weight:600;color:#1565c0;margin-bottom:10px;">
                    í˜„ì¬ ì„ íƒ: <span id="current-trip-number">-</span>ì°¨ìˆ˜
                </div>
                <div style="display:flex;align-items:center;gap:15px;flex-wrap:wrap;">
                    <div style="font-size:14px;color:#1976d2;">
                        ì„ íƒëœ ê¸°ë‘¥: <span id="selected-columns-count">0</span>ê°œ
                        <span style="margin-left:12px;">ì´ ë¬¼ëŸ‰: <span id="selected-columns-weight" style="font-weight:bold;color:#2c4a7c;">0í†¤</span></span>
                    </div>
                    <div style="display:flex;align-items:center;gap:8px;">
                        <label style="font-size:14px;color:#1976d2;font-weight:500;">ìš´ì†¡ë‚ ì§œ:</label>
                        <input type="date" id="transport-trip-date" style="padding:6px 10px;border:1px solid #90caf9;border-radius:4px;font-size:14px;" onchange="updateTransportTripDate()">
                    </div>
                </div>
            </div>

            <!-- ê¸°ë‘¥ ì„ íƒ ê·¸ë¦¬ë“œ -->
            <div style="margin-bottom:20px;">
                <div style="margin-bottom:10px;font-weight:600;color:#333;">ê¸°ë‘¥ ì„ íƒ (50ê°œ):</div>
                <div class="column-grid" id="column-grid-transport">
                    <!-- Generated by JS -->
                </div>
            </div>

            <!-- ì¤‘ë³µ ì²´í¬ ê²°ê³¼ í‘œì‹œ -->
            <div id="duplicate-check-result" style="display:none;margin-bottom:20px;padding:15px;background:#ffebee;border-radius:8px;border-left:4px solid #f44336;">
                <div style="font-weight:600;color:#c62828;margin-bottom:10px;">
                    âš ï¸ ì¤‘ë³µ ê¸°ë‘¥ ë°œê²¬
                </div>
                <div id="duplicate-info" style="font-size:13px;color:#d32f2f;">
                    <!-- ì¤‘ë³µ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>

            <!-- ì €ì¥ ë²„íŠ¼ -->
            <div style="text-align:right;">
                <button class="action-btn" onclick="checkDuplicateColumns()" style="background:#ff9800;color:white;margin-right:10px;">ğŸ” ì¤‘ë³µ ê¸°ë‘¥ ì²´í¬</button>
                <button class="action-btn primary" onclick="saveTransportPlan()">ğŸ’¾ ìš´ì†¡ì°¨ìˆ˜ê³„íš ì €ì¥</button>
                <button class="action-btn secondary" onclick="clearTransportSelection()">ğŸ”„ ì„ íƒ ì´ˆê¸°í™”</button>
            </div>
        </div>

        <!-- Gantt Panel -->
        <div class="panel" id="panel-gantt">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                <h3 style="margin:0;color:#2c4a7c;">ğŸ“… ì „ì²´ ê³µì •í‘œ (Gantt Chart)</h3>
                <button class="action-btn" onclick="enableDeleteMode()" id="delete-mode-btn" style="background:#f44336;color:white;padding:8px 16px;border:none;border-radius:6px;cursor:pointer;font-weight:600;">
                    ğŸ—‘ï¸ ë°ì´í„° ì‚­ì œ
                </button>
            </div>
            
            <div style="margin-bottom:15px;padding:10px 12px;background:#fff3e0;border-left:4px solid #ff9800;border-radius:4px;font-size:13px;color:#e65100;">
                <strong>âš ï¸ ì£¼ì˜ì‚¬í•­:</strong>
                <ul style="margin:8px 0 0 0;padding-left:20px;line-height:1.8;">
                    <li>1. ì£¼ê¸°ë‘¥ì»¤íŒ… + 2. ì†Œë¶€ì¬ê°€ê³µì´ ë™ì¼í•œ ë‚ ì§œë¥¼ 1ê°œê³µì •ë§Œ ì„ íƒí›„ ì‚­ì œê°€ëŠ¥</li>
                    <li>2. ë°ì´í„° ì‚­ì œì™„ë£Œí•˜ë©´ ë°ì´í„°ì‚­ì œì¤‘ì„ í´ë¦­í•˜ì—¬ ì¢…ë£Œí•¨.</li>
                </ul>
            </div>
            
            <div class="process-legend">
                <div class="legend-item"><div class="legend-color" style="background:#e74c3c;"></div><span>1.ì£¼ê¸°ë‘¥ì»¤íŒ…</span></div>
                <div class="legend-item"><div class="legend-color" style="background:#ff9800;"></div><span>2.ì†Œë¶€ì¬ê°€ê³µ</span></div>
                <div class="legend-item"><div class="legend-color" style="background:#2196f3;"></div><span>3.ì£¼ê¸°ë‘¥ì¡°ë¦½</span></div>
                <div class="legend-item"><div class="legend-color" style="background:#00bcd4;"></div><span>4.ì†Œë¶€ì¬ì¡°ë¦½</span></div>
                <div class="legend-item"><div class="legend-color" style="background:#fef7ff;"></div><span>5.í˜„ì¥ë°°ì†¡</span></div>
                <div class="legend-item"><div class="legend-color" style="background:#4caf50;"></div><span>6.í˜„ì¥ì„¤ì¹˜</span></div>
            </div>

            <div class="gantt-container">
                <table class="gantt-table" id="gantt-table">
                    <!-- Generated by JS -->
                </table>
            </div>
        </div>

        <!-- Chart Panel -->
        <div class="panel" id="panel-chart">
            <div class="chart-container">
                <h3>ğŸ“ˆ ì¼ë³„ ëˆ„ì  ì§„í–‰ë¥ </h3>
                <canvas id="progressChart"></canvas>
            </div>

            <div class="chart-container">
                <h3>ğŸ“Š ì—…ì²´ë³„ ê³µì • í˜„í™©</h3>
                <canvas id="companyChart"></canvas>
            </div>
        </div>

        <!-- Transport Volume Panel -->
        <div class="panel" id="panel-transportVolume">
            <h3 style="margin-bottom:16px;color:#2c4a7c;">ğŸ“¦ ìš´ì†¡ë¬¼ëŸ‰ì‚°ì •</h3>
            <div style="margin-bottom:16px;padding:12px;border:1px solid #e0e0e0;border-radius:8px;background:#f9fafb;">
                <div style="margin-bottom:8px;font-weight:600;color:#2c4a7c;">ì…ë ¥ ì•ˆë‚´ (ì—‘ì…€ ì—…ë¡œë“œ)</div>
                <div style="color:#555;font-size:13px;line-height:1.5;">
                    1) ì—‘ì…€ ì²« í–‰ì— ì•„ë˜ ìˆœì„œë¡œ í—¤ë”ë¥¼ ë„£ì–´ì£¼ì„¸ìš”: <strong>ê¸°ë‘¥ë²ˆí˜¸, ì‚¬ì´ì¦ˆ, ê¸¸ì´(mm), ì†Œë¶€ì¬ì˜ˆìƒë¬¼ëŸ‰</strong><br>
                    2) ìµœëŒ€ 50ê°œ ê¸°ë‘¥ê¹Œì§€ í‘œì‹œë©ë‹ˆë‹¤. ì¶”ê°€ ë°ì´í„°ëŠ” ë¬´ì‹œë©ë‹ˆë‹¤.<br>
                    3) ì—…ë¡œë“œ í›„ í‘œì—ì„œ ë‚´ìš©ì„ ì¦‰ì‹œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </div>
            </div>

            <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:16px;">
                <input type="file" accept=".xlsx,.xls,.csv" id="transport-volume-file" onchange="handleTransportVolumeFile(event)" style="padding:8px;border:1px solid #ccc;border-radius:6px;">
                <button class="action-btn primary" onclick="downloadTransportVolumeTemplate()">ğŸ“„ í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ</button>
                <span id="transport-volume-status" style="color:#555;font-size:13px;">íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.</span>
            </div>

            <div style="overflow-x:auto;">
                <table class="gantt-table" style="min-width:600px;">
                    <thead>
                        <tr>
                            <th style="width:80px;">ê¸°ë‘¥ë²ˆí˜¸</th>
                            <th>ì‚¬ì´ì¦ˆ</th>
                            <th>ê¸¸ì´(mm)</th>
                            <th>ì†Œë¶€ì¬ ì˜ˆìƒë¬¼ëŸ‰</th>
                        </tr>
                    </thead>
                    <tbody id="transport-volume-tbody">
                        <tr><td colspan="4" style="text-align:center;color:#888;padding:16px;">ì—‘ì…€ì„ ì—…ë¡œë“œí•˜ë©´ ì—¬ê¸°ì—ì„œ 50ê°œ ê¸°ë‘¥ ë°ì´í„°ê°€ í‘œì‹œë©ë‹ˆë‹¤.</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Installation Status Panel -->
        <div class="panel" id="panel-installation">
            <h3 style="margin-bottom:16px;color:#2c4a7c;">ğŸ—ï¸ í˜„ì¥ì„¤ì¹˜í˜„í™©ë„</h3>
            
            <!-- ê³µì •ìœ¨ í‘œì‹œ -->
            <div style="margin-bottom:20px;padding:15px;background:#fff;border-radius:8px;border:1px solid #e0e0e0;">
                <h4 style="margin-bottom:12px;color:#2c4a7c;font-size:14px;font-weight:600;">ğŸ“Š ê³µì •ìœ¨ í˜„í™©</h4>
                <div id="installation-progress-summary" style="display:grid;grid-template-columns:repeat(6,1fr);gap:10px;">
                    <!-- ê³µì •ìœ¨ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>
            </div>
            
            <!-- ì¢Œí‘œ ì„¤ì • ëª¨ë“œ í† ê¸€ -->
            <div style="margin-bottom:15px;padding:12px;background:#fff3cd;border-radius:8px;border:1px solid #ffc107;">
                <button id="coordinate-setup-btn" onclick="toggleCoordinateSetup()" class="coordinate-setup-btn inactive" style="padding:8px 16px;color:white;border:none;border-radius:6px;cursor:pointer;font-weight:600;">
                    ğŸ“ ì¢Œí‘œ ì„¤ì • ëª¨ë“œ
                </button>
                <span id="coordinate-setup-hint" style="margin-left:10px;font-size:13px;color:#856404;display:none;">
                    ì¢Œí‘œ ì„¤ì • ëª¨ë“œ: í‰ë©´ë„ ì´ë¯¸ì§€ì—ì„œ ê° ê¸°ë‘¥ ë²ˆí˜¸ ìœ„ì¹˜ë¥¼ í´ë¦­í•˜ì—¬ ì„¤ì •í•˜ì„¸ìš”.
                </span>
                <div id="coordinate-guide" style="margin-top:10px;padding:10px;background:#e8f5e9;border-radius:6px;font-size:12px;line-height:1.6;display:none;">
                    <strong>ğŸ“‹ ì‚¬ìš© ë°©ë²•:</strong><br>
                    1ï¸âƒ£ ì¢Œí‘œ ì„¤ì • ëª¨ë“œ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ í™œì„±í™”í•©ë‹ˆë‹¤<br>
                    2ï¸âƒ£ ì˜¤ë¥¸ìª½ ê¸°ë‘¥ ë²ˆí˜¸ ëª©ë¡ì—ì„œ ì¢Œí‘œë¥¼ ì„¤ì •í•  ê¸°ë‘¥ì„ í´ë¦­í•©ë‹ˆë‹¤<br>
                    3ï¸âƒ£ í‰ë©´ë„ ì´ë¯¸ì§€ì—ì„œ í•´ë‹¹ ê¸°ë‘¥ì˜ ì •í™•í•œ ìœ„ì¹˜ë¥¼ í´ë¦­í•©ë‹ˆë‹¤<br>
                    4ï¸âƒ£ ì¢Œí‘œê°€ ìë™ìœ¼ë¡œ ì €ì¥ë˜ê³  ë§ˆì»¤ê°€ í‘œì‹œë©ë‹ˆë‹¤<br>
                    <span style="color:#d32f2f;font-weight:600;">â€» ì¢Œí‘œëŠ” ìë™ ì €ì¥ë˜ë©° í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ë„ ìœ ì§€ë©ë‹ˆë‹¤</span>
                </div>
            </div>
            
            <div style="display:grid;grid-template-columns:2fr 1fr;gap:20px;margin-bottom:20px;">
                <!-- Floor Plan Image -->
                <div id="installation-floor-plan-image" style="position:relative;min-height:600px;background:#fff;border:1px solid #ccc;border-radius:8px;background-image:url('../../assets/images/floor-plan.png');background-size:contain;background-repeat:no-repeat;background-position:center;">
                    <!-- Column markers will be dynamically added here -->
                </div>
                
                <!-- Column Number List -->
                <div>
                    <h4 style="margin-bottom:12px;color:#2c4a7c;font-size:16px;">ê¸°ë‘¥ ë²ˆí˜¸ ëª©ë¡</h4>
                    <div id="installation-column-list" style="display:grid;grid-template-columns:repeat(3,1fr);gap:6px;">
                        <!-- Column number cards with status will be dynamically generated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Column Detail Modal -->
    <div class="modal" id="column-modal">
        <div class="modal-content">
            <h3>ğŸ”© ê¸°ë‘¥ <span id="modal-column-num"></span> ê³µì • ì…ë ¥</h3>
            <div class="form-group" id="modal-date-group" style="display:block !important;visibility:visible !important;margin-bottom:15px;">
                <label style="display:block;margin-bottom:5px;font-weight:600;color:#555;">ì‘ì—…ì¼ì:</label>
                <input type="date" id="modal-work-date" style="width:100% !important;padding:10px !important;border:2px solid #ddd !important;border-radius:8px !important;font-size:14px !important;display:block !important;visibility:visible !important;">
            </div>
            <div class="form-group">
                <label>í˜„ì¬ ê³µì • ìƒíƒœ:</label>
                <select id="modal-process-select">
                    <option value="0">0. ë¯¸ì°©ìˆ˜</option>
                    <option value="1">1. ì£¼ê¸°ë‘¥ì»¤íŒ… ì™„ë£Œ</option>
                    <option value="2">2. ê¸°ë‘¥ì†Œë¶€ì¬ê°€ê³µ ì™„ë£Œ</option>
                    <option value="3">3. ì£¼ê¸°ë‘¥ì¡°ë¦½ ì™„ë£Œ</option>
                    <option value="4">4. í˜„ì¥ë°°ì†¡ ì™„ë£Œ</option>
                    <option value="5">5. í˜„ì¥ì„¤ì¹˜ ì™„ë£Œ</option>
                </select>
            </div>
            <div class="form-group">
                <label>ë¹„ê³ :</label>
                <input type="text" id="modal-note" placeholder="íŠ¹ì´ì‚¬í•­ ì…ë ¥">
            </div>
            <div class="modal-buttons">
                <button class="action-btn primary" onclick="saveColumnStatus()">ì €ì¥</button>
                <button class="action-btn secondary" onclick="closeModal()">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        // âš ï¸ ì‹¤ì œ ì‚¬ìš© ì‹œ ì•„ë˜ ì„¤ì •ì„ Firebase Consoleì—ì„œ ìƒì„±í•œ í”„ë¡œì íŠ¸ ì„¤ì •ìœ¼ë¡œ êµì²´í•˜ì„¸ìš”
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT.firebaseapp.com",
            databaseURL: "https://YOUR_PROJECT-default-rtdb.firebaseio.com",
            projectId: "YOUR_PROJECT",
            storageBucket: "YOUR_PROJECT.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Firebase ì´ˆê¸°í™”
        let db = null;
        let isFirebaseEnabled = false;
        
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.database();
            isFirebaseEnabled = firebaseConfig.apiKey !== "YOUR_API_KEY";
        } catch (e) {
            console.log('Firebase ì´ˆê¸°í™” ì‹¤íŒ¨, localStorage ëª¨ë“œë¡œ ì „í™˜:', e);
        }

        // Constants
        const TOTAL_COLUMNS = 50;
        const START_DATE = new Date('2025-12-26');
        const END_DATE = new Date('2026-03-15');

        // Project scoping (6 projects)
        const urlParams = new URLSearchParams(window.location.search);
        const PROJECT_ID = (urlParams.get('project') || localStorage.getItem('kcol:lastProject') || 'P1').toString();
        localStorage.setItem('kcol:lastProject', PROJECT_ID);

        // í”„ë¡œì íŠ¸ ì´ë¦„ ë§¤í•‘
        const PROJECT_NAMES = {
            'P1': 'ì§„í¥ê¸°ì—…',
            'P2': '00í”„ë¡œì íŠ¸',
            'P3': '00í”„ë¡œì íŠ¸',
            'P4': '00í”„ë¡œì íŠ¸',
            'P5': '00í”„ë¡œì íŠ¸',
            'P6': '00í”„ë¡œì íŠ¸'
        };

        function getProjectName() {
            return PROJECT_NAMES[PROJECT_ID] || `í”„ë¡œì íŠ¸ ${PROJECT_ID}`;
        }

        function kcolKey(suffix) {
            return `kcol:${PROJECT_ID}:${suffix}`;
        }

        function kcolRef(pathSuffix) {
            // Firebase path: kcolumn/{projectId}/{suffix}
            return `kcolumn/${PROJECT_ID}/${pathSuffix}`;
        }
        
        // íœ´ë¬´ì¼ ì •ì˜ (ì„¤ë‚  ì—°íœ´)
        const HOLIDAYS = {
            '2026-02-16': 'ì„¤ë‚ íœ´ë¬´',
            '2026-02-17': 'ì„¤ë‚ íœ´ë¬´',
            '2026-02-18': 'ì„¤ë‚ íœ´ë¬´'
        };
        
        const PROCESSES = [
            { id: 1, name: 'ì£¼ê¸°ë‘¥ì»¤íŒ…', company: 'yuseok' },
            { id: 2, name: 'ê¸°ë‘¥ì†Œë¶€ì¬ê°€ê³µ', company: 'yuseok' },
            { id: 3, name: 'ì£¼ê¸°ë‘¥ì¡°ë¦½', company: 'yuseok' },
            { id: 4, name: 'ì†Œë¶€ì¬ì¡°ë¦½', company: 'yuseok' },
            { id: 5, name: 'í˜„ì¥ë°°ì†¡', company: 'yuseok' },
            { id: 6, name: 'í˜„ì¥ì„¤ì¹˜', company: 'jinhung' }
        ];

        // State
        let currentCompany = null;
        let currentProcess = null; // í˜„ì¬ ì„ íƒëœ ê³µì • (1-5)
        let selectedColumn = null;
        let editMode = false; // ìˆ˜ì • ëª¨ë“œ í™œì„±í™” ì—¬ë¶€
        let deleteMode = false; // ì‚­ì œ ëª¨ë“œ í™œì„±í™” ì—¬ë¶€
        let pendingDeleteInfo = null; // ëª¨ë‹¬ì—ì„œ ì„ íƒí•  ì‚­ì œ ì •ë³´ ì €ì¥
        let coordinateSetupMode = false; // ì¢Œí‘œ ì„¤ì • ëª¨ë“œ
        let currentColumnForSetup = null; // ì¢Œí‘œ ì„¤ì • ì¤‘ì¸ ê¸°ë‘¥ ë²ˆí˜¸
        let columnCoordinates = {}; // { columnId: { left: %, top: % } } - í‰ë©´ë„ ì¢Œí‘œ
        let columnData = {}; // { columnId: { status: 0-5, date: '2025-12-26', notes: '' } }
        let dailyData = {}; // { '2025-12-26': { 1: [columnIds completed p1], 2: [...], ... } }
        let transportPlan = {}; // { tripNumber: { columns: [columnIds], date: 'YYYY-MM-DD' } } - ì˜ˆ: { 1: { columns: [1,2,3], date: '2025-01-15' }, 2: { columns: [10,11,12], date: '2025-01-20' } }
        let deliveryConfirmed = {}; // { columnId: true/false } - ë°°ì†¡í™•ì¸ëœ ê¸°ë‘¥ (ì§™ì€ ë§ˆì  íƒ€ ìƒ‰ìƒ)
        let actualDeliveryDate = {}; // { columnId: 'YYYY-MM-DD' } - ì‹¤ì œ ë°°ì†¡ ë‚ ì§œ (ìš´ì†¡ì°¨ìˆ˜ê³„íš ë‚ ì§œì™€ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ)
        let currentTransportTrip = 1; // í˜„ì¬ ì„ íƒëœ ì°¨ìˆ˜
        let duplicateColumns = {}; // { columnId: [tripNumbers] } - ì¤‘ë³µëœ ê¸°ë‘¥ ì •ë³´
        let progressChart = null;
        let companyChart = null;
        let transportVolumeData = []; // ìš´ì†¡ ë¬¼ëŸ‰ ì‚°ì •ìš© ë°ì´í„° (ì—‘ì…€ ì—…ë¡œë“œ)
        let selectedColumns = []; // ì£¼ê¸°ë‘¥ì»¤íŒ…ì—ì„œ ì„ íƒëœ ê¸°ë‘¥ë“¤ (ë‹¤ì¤‘ ì„ íƒ)

        // Initialize
        // Status display function
        function showStatus(message, isError) {
            const statusDiv = document.createElement('div');
            statusDiv.id = 'init-status';
            statusDiv.style.cssText = 'position:fixed;top:50px;left:50%;transform:translateX(-50%);background:' + (isError ? '#f44336' : '#4caf50') + ';color:white;padding:15px 30px;border-radius:8px;font-size:16px;z-index:10001;box-shadow:0 4px 15px rgba(0,0,0,0.3);font-weight:bold;';
            statusDiv.textContent = message;
            document.body.appendChild(statusDiv);
            if (!isError) {
                setTimeout(() => statusDiv.remove(), 3000);
            }
            console.log(message);
        }

        document.addEventListener('DOMContentLoaded', function() {
            try {
                const badge = document.getElementById('project-badge');
                if (badge) badge.textContent = getProjectName();

                if (isFirebaseEnabled) {
                    setupFirebaseListeners();
                    showConnectionStatus('ğŸŸ¢ ì‹¤ì‹œê°„ ì—°ê²°ë¨ (Firebase)');
                } else {
                    loadFromLocalStorage(); // ë‚´ë¶€ì—ì„œ syncTransportToDailyData() í˜¸ì¶œë¨
                    showConnectionStatus('ğŸŸ¡ ë¡œì»¬ ì €ì¥ ëª¨ë“œ (Firebase ì„¤ì • í•„ìš”)');
                }
                setToday();
                renderWeekdayButtons(); // ìš”ì¼ ë²„íŠ¼ ë Œë”ë§
                loadTransportPlan(); // ë‚´ë¶€ì—ì„œ syncTransportToDailyData() í˜¸ì¶œë¨
                renderColumnGrid('column-grid-overview');
                renderColumnGrid('column-grid-input');
                updateProgressBars();
                // ì´ˆê¸° ë¡œë“œ ì‹œ ê³µì •í‘œë„ ë Œë”ë§í•˜ì—¬ í˜„ì¥ë°°ì†¡ ë°ì´í„° í‘œì‹œ
                if (document.getElementById('panel-gantt')) {
                    renderGanttChart();
                }
                
                // URL íŒŒë¼ë¯¸í„°ë¡œ ê³µì • ì„ íƒ (ì˜ˆ: ?process=1)
                const processParam = urlParams.get('process');
                if (processParam) {
                    const processId = parseInt(processParam);
                    if (processId >= 1 && processId <= 6) {
                        // ì•½ê°„ì˜ ì§€ì—° í›„ ê³µì • ì„ íƒ (DOMì´ ì™„ì „íˆ ë¡œë“œëœ í›„)
                        setTimeout(() => {
                            selectProcess(processId);
                        }, 100);
                    }
                }
            } catch (error) {
                console.error('Initialization error:', error);
                alert('ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì˜¤ë¥˜: ' + error.message);
            }
        });

        // ì—°ê²° ìƒíƒœ í‘œì‹œ
        function showConnectionStatus(message) {
            // ìƒíƒœ ì•Œë¦¼
            const statusDiv = document.createElement('div');
            statusDiv.style.cssText = 'position:fixed;bottom:20px;right:20px;background:#333;color:white;padding:10px 20px;border-radius:8px;font-size:12px;z-index:9999;';
            statusDiv.textContent = message;
            document.body.appendChild(statusDiv);
            setTimeout(() => statusDiv.remove(), 5000);
            
            // ëª¨ë“œ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            const modeEl = document.getElementById('current-mode');
            if (modeEl) {
                if (isFirebaseEnabled) {
                    modeEl.textContent = 'ğŸŸ¢ ì‹¤ì‹œê°„ ê³µìœ  ëª¨ë“œ (Firebase ì—°ê²°ë¨)';
                    modeEl.style.color = '#2e7d32';
                } else {
                    modeEl.textContent = 'ğŸŸ¡ ë¡œì»¬ ì €ì¥ ëª¨ë“œ (ê°™ì€ ë¸Œë¼ìš°ì €ì—ì„œë§Œ ê³µìœ )';
                    modeEl.style.color = '#f57c00';
                }
            }
        }

        // Firebase ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ
        function setupFirebaseListeners() {
            // columnData ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ
            db.ref(kcolRef('columnData')).on('value', (snapshot) => {
                columnData = snapshot.val() || {};
                renderColumnGrid('column-grid-overview');
                renderColumnGrid('column-grid-input');
                updateProgressBars();
            });

            // dailyData ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ
            db.ref(kcolRef('dailyData')).on('value', (snapshot) => {
                dailyData = snapshot.val() || {};
            });

            // transportPlan ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ
            db.ref(kcolRef('transportPlan')).on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    transportPlan = data;
                    // ìš´ì†¡ì°¨ìˆ˜ê³„íšì„ dailyDataì˜ í˜„ì¥ë°°ì†¡(process 5)ì— ë™ê¸°í™”
                    // ì´ˆê¸° ë¡œë“œì´ë¯€ë¡œ í™•ì¸ ì—†ì´ ìë™ ë™ê¸°í™”
                    syncTransportToDailyData(false);
                    if (document.getElementById('panel-transport')?.classList.contains('active')) {
                        renderTransportTrips();
                        renderTransportColumnGrid();
                        updateTransportTripInfo();
                    }
                    // í™”ë©´ ì—…ë°ì´íŠ¸
                    renderGanttChart();
                    renderColumnGrid('column-grid-overview');
                    renderColumnGrid('column-grid-input');
                    updateProgressBars();
                }
            });
        }

        // Process Selection (ê³µì •ë³„ ì„ íƒ)
        function selectProcess(processId) {
            currentProcess = processId;
            
            // ê³µì • ë³€ê²½ ì‹œ ì„ íƒëœ ê¸°ë‘¥ ì´ˆê¸°í™”
            selectedColumns = [];
            
            // í•´ë‹¹ ê³µì •ì˜ ë‹´ë‹¹ ì—…ì²´ ì„¤ì •
            const process = PROCESSES.find(p => p.id === processId);
            currentCompany = process?.company;
            
            // ë²„íŠ¼ í™œì„±í™” í‘œì‹œ
            document.querySelectorAll('.process-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.process-btn.p${processId}`).classList.add('active');
            
            const processNames = {
                1: '1. ì£¼ê¸°ë‘¥ì»¤íŒ… (ìœ ì„ì² ê°•(ì¶©ì£¼ê³µì¥))',
                2: '2. ê¸°ë‘¥ì†Œë¶€ì¬ê°€ê³µ (ìœ ì„ì² ê°•(ì˜¤ì°½ê³µì¥))',
                3: '3. ì£¼ê¸°ë‘¥ì¡°ë¦½ (ìœ ì„ì² ê°•(ìŒì„±ê³µì¥))',
                4: '4. ì†Œë¶€ì¬ì¡°ë¦½ (ìœ ì„ì² ê°•(ìŒì„±ê³µì¥))',
                5: '5. í˜„ì¥ë°°ì†¡ (ìœ ì„ì² ê°•(ìŒì„±ê³µì¥))',
                6: '6. í˜„ì¥ì„¤ì¹˜ (ì§„í¥ê¸°ì—…)'
            };
            document.getElementById('selected-company-name').textContent = '- ' + processNames[processId];
            
            // ê³µì •ë³„ ì…ë ¥ ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ
            showProcessGuide(processId);
            
            // ì¼ì¼ ì…ë ¥ íŒ¨ë„ ìë™ìœ¼ë¡œ ì—´ê¸°
            const inputPanel = document.getElementById('panel-input');
            if (inputPanel) {
                // ë‹¤ë¥¸ íŒ¨ë„ ë¹„í™œì„±í™”
                document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
                // ì¼ì¼ ì…ë ¥ íŒ¨ë„ í™œì„±í™”
                inputPanel.classList.add('active');
                
                // ë‹¤ë¥¸ íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™” (ì¼ì¼ ì…ë ¥ ë²„íŠ¼ ì œì™¸)
                document.querySelectorAll('.tabs .tab-btn').forEach(btn => btn.classList.remove('active'));
            }
            
            renderColumnGrid('column-grid-input');
        }
        
        // ëª¨ë“  ê³µì •ì—ì„œ ê¸°ë‘¥ ì„ íƒ/í•´ì œ í† ê¸€
        function toggleColumnSelection(columnId) {
            // íœ´ë¬´ì¼ ì²´í¬
            const workDate = document.getElementById('work-date')?.value;
            if (workDate && isHoliday(workDate)) {
                alert(`${getHolidayName(workDate)}\n\ní•´ë‹¹ì¼ì€ íœ´ë¬´ë¡œ ì‘ì—… ì…ë ¥ì´ ë¶ˆê°€í•©ë‹ˆë‹¤.`);
                return;
            }
            
            if (!currentProcess) {
                alert('ë¨¼ì € ì…ë ¥í•  ê³µì •ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ê° ê³µì •ë³„ë¡œ ì„ íƒ ê°€ëŠ¥í•œ ìƒíƒœ í™•ì¸
            const colData = columnData[columnId] || {};
            let status = colData.status || 0;
            
            // ì¼ì¼ì…ë ¥ì°½ì˜ ê³µì • 1-4ì—ì„œ ìš´ì†¡ì°¨ìˆ˜ê³„íšì˜ í˜„ì¥ë°°ì†¡(ê³„íš)ì´ í‘œì‹œë˜ì§€ ì•Šë„ë¡
            // ì‹¤ì œ ì™„ë£Œëœ ê³µì • ìƒíƒœë§Œ ë°˜ì˜
            if (currentProcess >= 1 && currentProcess <= 4) {
                let actualStatus = 0;
                const workDate = document.getElementById('work-date')?.value;
                
                // ëª¨ë“  ë‚ ì§œì—ì„œ ì‹¤ì œ ì™„ë£Œëœ ê³µì • í™•ì¸
                for (let date in dailyData) {
                    for (let p = 1; p <= 4; p++) {
                        const dayData = dailyData[date]?.[p];
                        if (dayData && (dayData.includes(columnId) || dayData.includes(parseInt(columnId.replace('C', ''))) || dayData.includes(columnId.replace('C', '')))) {
                            actualStatus = Math.max(actualStatus, p);
                        }
                    }
                }
                status = actualStatus;
            }
            
            // ì†Œë¶€ì¬ê°€ê³µ(process 2)ì€ ë…ë¦½ì ìœ¼ë¡œ ì„ íƒ ê°€ëŠ¥ (ì£¼ê¸°ë‘¥ì»¤íŒ… ì™„ë£Œ ì—¬ë¶€ì™€ ë¬´ê´€)
            if (currentProcess === 2) {
                // ì†Œë¶€ì¬ê°€ê³µì€ í•­ìƒ ì„ íƒ ê°€ëŠ¥ (ê²€ì¦ ì—†ìŒ)
            }
            // ì£¼ê¸°ë‘¥ì¡°ë¦½(process 3)ì€ ì£¼ê¸°ë‘¥ì»¤íŒ…(process 1) ì™„ë£Œ ìƒíƒœë§Œ í™•ì¸ (ì†Œë¶€ì¬ê°€ê³µ ì™„ë£Œ ì—¬ë¶€ì™€ ë¬´ê´€)
            else if (currentProcess === 3) {
                // ì£¼ê¸°ë‘¥ì»¤íŒ…(process 1) ì™„ë£Œ ìƒíƒœ í™•ì¸
                let hasCutting = false;
                const workDate = document.getElementById('work-date')?.value;
                
                // ëª¨ë“  ë‚ ì§œì—ì„œ ì£¼ê¸°ë‘¥ì»¤íŒ…(process 1) ì™„ë£Œ í™•ì¸
                for (let date in dailyData) {
                    if (dailyData[date] && dailyData[date][1]) {
                        const colNum = parseInt(columnId.replace('C', ''));
                        if (dailyData[date][1].includes(columnId) || 
                            dailyData[date][1].includes(colNum) || 
                            dailyData[date][1].includes(String(colNum))) {
                            hasCutting = true;
                            break;
                        }
                    }
                }
                
                // columnDataì—ì„œë„ í™•ì¸
                if (!hasCutting) {
                    const colData = columnData[columnId] || {};
                    if (colData.status >= 1) {
                        hasCutting = true;
                    }
                }
                
                if (!hasCutting) {
                    alert('ì£¼ê¸°ë‘¥ì¡°ë¦½ì„ ì…ë ¥í•˜ë ¤ë©´ ì£¼ê¸°ë‘¥ì»¤íŒ…(1ë‹¨ê³„)ì´ ì™„ë£Œëœ ê¸°ë‘¥ì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                    return;
                }
            }
            // ì†Œë¶€ì¬ì¡°ë¦½(process 4)ì€ ì£¼ê¸°ë‘¥ì»¤íŒ…(process 1), ì†Œë¶€ì¬ê°€ê³µ(process 2), ì£¼ê¸°ë‘¥ì¡°ë¦½(process 3)ì´ ëª¨ë‘ ì™„ë£Œëœ ê¸°ë‘¥ë§Œ ê°€ëŠ¥
            else if (currentProcess === 4) {
                let hasCutting = false; // ì£¼ê¸°ë‘¥ì»¤íŒ… ì™„ë£Œ ì—¬ë¶€
                let hasSubProcessing = false; // ì†Œë¶€ì¬ê°€ê³µ ì™„ë£Œ ì—¬ë¶€
                let hasMainAssembly = false; // ì£¼ê¸°ë‘¥ì¡°ë¦½ ì™„ë£Œ ì—¬ë¶€
                const colNum = parseInt(columnId.replace('C', ''));
                
                // ëª¨ë“  ë‚ ì§œì—ì„œ ì£¼ê¸°ë‘¥ì»¤íŒ…(process 1) ì™„ë£Œ í™•ì¸
                for (let date in dailyData) {
                    if (dailyData[date] && dailyData[date][1]) {
                        if (dailyData[date][1].includes(columnId) || 
                            dailyData[date][1].includes(colNum) || 
                            dailyData[date][1].includes(String(colNum))) {
                            hasCutting = true;
                            break;
                        }
                    }
                }
                
                // ëª¨ë“  ë‚ ì§œì—ì„œ ì†Œë¶€ì¬ê°€ê³µ(process 2) ì™„ë£Œ í™•ì¸
                for (let date in dailyData) {
                    if (dailyData[date] && dailyData[date][2]) {
                        if (dailyData[date][2].includes(columnId) || 
                            dailyData[date][2].includes(colNum) || 
                            dailyData[date][2].includes(String(colNum))) {
                            hasSubProcessing = true;
                            break;
                        }
                    }
                }
                
                // ëª¨ë“  ë‚ ì§œì—ì„œ ì£¼ê¸°ë‘¥ì¡°ë¦½(process 3) ì™„ë£Œ í™•ì¸
                for (let date in dailyData) {
                    if (dailyData[date] && dailyData[date][3]) {
                        if (dailyData[date][3].includes(columnId) || 
                            dailyData[date][3].includes(colNum) || 
                            dailyData[date][3].includes(String(colNum))) {
                            hasMainAssembly = true;
                            break;
                        }
                    }
                }
                
                // columnDataì—ì„œë„ í™•ì¸
                const colData = columnData[columnId] || {};
                if (!hasCutting && colData.status >= 1) {
                    hasCutting = true;
                }
                if (!hasSubProcessing && colData.status >= 2) {
                    hasSubProcessing = true;
                }
                if (!hasMainAssembly && colData.status >= 3) {
                    hasMainAssembly = true;
                }
                
                // ì™„ë£Œë˜ì§€ ì•Šì€ ê³µì • í™•ì¸
                if (!hasCutting || !hasSubProcessing || !hasMainAssembly) {
                    const missing = [];
                    if (!hasCutting) missing.push('ì£¼ê¸°ë‘¥ì»¤íŒ…(1ë‹¨ê³„)');
                    if (!hasSubProcessing) missing.push('ì†Œë¶€ì¬ê°€ê³µ(2ë‹¨ê³„)');
                    if (!hasMainAssembly) missing.push('ì£¼ê¸°ë‘¥ì¡°ë¦½(3ë‹¨ê³„)');
                    alert(`í•´ë‹¹ ê³µì •ì´ ì™„ë£Œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\n\nì†Œë¶€ì¬ì¡°ë¦½ì„ ì…ë ¥í•˜ë ¤ë©´ ${missing.join(', ')}ì´ ì™„ë£Œëœ ê¸°ë‘¥ì´ì–´ì•¼ í•©ë‹ˆë‹¤.`);
                    return;
                }
            }
            // í˜„ì¥ì„¤ì¹˜(process 6)ëŠ” í˜„ì¥ë°°ì†¡(process 5)ì—ì„œ í™•ì¸ëœ ê¸°ë‘¥ë§Œ ê°€ëŠ¥
            else if (currentProcess === 6) {
                let hasConfirmedDelivery = false;
                const workDate = document.getElementById('work-date')?.value;
                
                if (workDate && dailyData[workDate] && dailyData[workDate][5]) {
                    const colNum = parseInt(columnId.replace('C', ''));
                    if (dailyData[workDate][5].includes(columnId) || 
                        dailyData[workDate][5].includes(colNum) || 
                        dailyData[workDate][5].includes(String(colNum))) {
                        hasConfirmedDelivery = true;
                    }
                }
                
                if (!hasConfirmedDelivery) {
                    for (let date in dailyData) {
                        if (dailyData[date] && dailyData[date][5]) {
                            const colNum = parseInt(columnId.replace('C', ''));
                            if (dailyData[date][5].includes(columnId) || 
                                dailyData[date][5].includes(colNum) || 
                                dailyData[date][5].includes(String(colNum))) {
                                hasConfirmedDelivery = true;
                                break;
                            }
                        }
                    }
                }
                
                if (!hasConfirmedDelivery) {
                    alert('í˜„ì¥ì„¤ì¹˜ë¥¼ ì…ë ¥í•˜ë ¤ë©´ í˜„ì¥ë°°ì†¡(5ë‹¨ê³„)ì—ì„œ í™•ì¸ëœ ê¸°ë‘¥ì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                    return;
                }
            }
            // ë‚˜ë¨¸ì§€ ê³µì •(1, 3, 4, 5)ì€ ì´ì „ ê³µì • ì™„ë£Œ ìƒíƒœ í™•ì¸
            else {
                const requiredStatus = currentProcess - 1;
                if (status !== requiredStatus) {
                    const processNames = ['ë¯¸ì°©ìˆ˜', 'ì£¼ê¸°ë‘¥ì»¤íŒ…', 'ì†Œë¶€ì¬ê°€ê³µ', 'ì£¼ê¸°ë‘¥ì¡°ë¦½', 'ì†Œë¶€ì¬ì¡°ë¦½', 'í˜„ì¥ë°°ì†¡', 'í˜„ì¥ì„¤ì¹˜'];
                    alert(`${processNames[requiredStatus]} ì™„ë£Œ ìƒíƒœì˜ ê¸°ë‘¥ë§Œ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
                    return;
                }
            }
            
            // ì„ íƒ/í•´ì œ í† ê¸€
            const index = selectedColumns.indexOf(columnId);
            if (index > -1) {
                // ì´ë¯¸ ì„ íƒëœ ê²½ìš° - í•´ì œ
                selectedColumns.splice(index, 1);
            } else {
                // ì„ íƒë˜ì§€ ì•Šì€ ê²½ìš° - ì¶”ê°€
                selectedColumns.push(columnId);
            }
            
            // UI ì—…ë°ì´íŠ¸
            renderColumnGrid('column-grid-input');
            
            // ì„ íƒëœ ê¸°ë‘¥ ìˆ˜ í‘œì‹œ
            updateSelectedColumnsInfo();
        }
        
        // ì„ íƒëœ ê¸°ë‘¥ ì •ë³´ ì—…ë°ì´íŠ¸
        function updateSelectedColumnsInfo() {
            const statsDiv = document.getElementById('guide-stats');
            if (currentProcess && currentProcess >= 1 && currentProcess <= 6 && selectedColumns.length > 0) {
                const selectedText = selectedColumns.sort((a, b) => {
                    const numA = parseInt(a.replace('C', ''));
                    const numB = parseInt(b.replace('C', ''));
                    return numA - numB;
                }).join(', ');
                statsDiv.style.display = 'block';
                statsDiv.style.background = '#e3f2fd';
                statsDiv.style.color = '#1565c0';
                statsDiv.innerHTML = 
                    `ğŸ“‹ <strong>ì„ íƒëœ ê¸°ë‘¥ (${selectedColumns.length}ê°œ):</strong> ${selectedText}`;
            }
        }
        
        // ì„ íƒëœ ëª¨ë“  ê¸°ë‘¥ì„ í•œ ë²ˆì— ì €ì¥
        function saveSelectedColumns() {
            if (selectedColumns.length === 0) {
                alert('ì €ì¥í•  ê¸°ë‘¥ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ë‚ ì§œ í™•ì¸
            let workDate = document.getElementById('work-date')?.value;
            if (!workDate) {
                const today = new Date();
                workDate = today.toISOString().split('T')[0];
                const workDateInput = document.getElementById('work-date');
                if (workDateInput) {
                    workDateInput.value = workDate;
                }
            }
            
            // íœ´ë¬´ì¼ ì²´í¬
            if (isHoliday(workDate)) {
                alert(`${getHolidayName(workDate)}\n\ní•´ë‹¹ì¼ì€ íœ´ë¬´ë¡œ ì‘ì—… ì…ë ¥ì´ ë¶ˆê°€í•©ë‹ˆë‹¤.`);
                return;
            }
            
            if (!currentProcess) {
                alert('ê³µì •ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ì„ íƒëœ ëª¨ë“  ê¸°ë‘¥ ì €ì¥
            const savedCount = selectedColumns.length;
            const process = PROCESSES.find(p => p.id === currentProcess);
            const companyName = process?.company || 'yuseok';
            
            selectedColumns.forEach(columnId => {
                // columnData ì—…ë°ì´íŠ¸
                if (!columnData[columnId]) {
                    columnData[columnId] = {};
                }
                columnData[columnId].status = currentProcess;
                columnData[columnId].lastUpdate = workDate;
                columnData[columnId].updatedBy = companyName;
                
                // dailyData ì—…ë°ì´íŠ¸
                if (!dailyData[workDate]) {
                    dailyData[workDate] = {};
                }
                if (!dailyData[workDate][currentProcess]) {
                    dailyData[workDate][currentProcess] = [];
                }
                // ê¸°ì¡´ í•­ëª© ì œê±° í›„ ìƒˆë¡œ ì¶”ê°€ (ì¤‘ë³µ ë°©ì§€)
                dailyData[workDate][currentProcess] = dailyData[workDate][currentProcess].filter(col => col !== columnId);
                dailyData[workDate][currentProcess].push(columnId);
            });
            
            // ì €ì¥
            try {
                saveToStorage();
                showStatus(`âœ… ${savedCount}ê°œ ê¸°ë‘¥ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`, false);
            } catch (error) {
                console.error('ì €ì¥ ì˜¤ë¥˜:', error);
                alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                return;
            }
            
            // ì„ íƒ ì´ˆê¸°í™” ë° UI ì—…ë°ì´íŠ¸
            selectedColumns = [];
            renderColumnGrid('column-grid-input');
            renderColumnGrid('column-grid-overview');
            updateProgressBars();
        }
        
        // ê³µì •ë³„ ì…ë ¥ ì•ˆë‚´ ë©”ì‹œì§€
        function showProcessGuide(processId) {
            const guideMessages = {
                1: {
                    title: 'ğŸ”´ ì£¼ê¸°ë‘¥ì»¤íŒ… ì…ë ¥ ì•ˆë‚´',
                    company: 'ìœ ì„ì² ê°•(ì¶©ì£¼ê³µì¥)',
                    steps: [
                        'â‘  ì‘ì—…ì¼ìë¥¼ í™•ì¸/ì„ íƒí•©ë‹ˆë‹¤',
                        'â‘¡ ê¸ˆìƒ‰ í…Œë‘ë¦¬ë¡œ ê°•ì¡°ëœ ê¸°ë‘¥(ë¯¸ì°©ìˆ˜ ìƒíƒœ)ì„ í´ë¦­í•˜ì—¬ ì„ íƒí•©ë‹ˆë‹¤ (ë‹¤ì¤‘ ì„ íƒ ê°€ëŠ¥)',
                        'â‘¢ ì„ íƒëœ ê¸°ë‘¥ë“¤ì´ íŒŒë€ìƒ‰ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤',
                        'â‘£ ì €ì¥ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì„ íƒí•œ ëª¨ë“  ê¸°ë‘¥ì„ í•œ ë²ˆì— ì €ì¥í•©ë‹ˆë‹¤'
                    ],
                    note: 'â€» ë¯¸ì°©ìˆ˜(0ë‹¨ê³„) ìƒíƒœì˜ ê¸°ë‘¥ë§Œ ì»¤íŒ… ì™„ë£Œ ì²˜ë¦¬ ê°€ëŠ¥',
                    deleteNote: 'ğŸ—‘ï¸ ì£¼ê¸°ë‘¥ì»¤íŒ… ì‚­ì œ: ì‘ì—…ì¼ì ì‚­ì œëŠ” ê³µì •í‘œ(Gantt)ì—ì„œ ë°ì´í„° ì‚­ì œê°€ëŠ¥í•©ë‹ˆë‹¤.'
                },
                2: {
                    title: 'ğŸŸ  ê¸°ë‘¥ì†Œë¶€ì¬ê°€ê³µ ì…ë ¥ ì•ˆë‚´',
                    company: 'ìœ ì„ì² ê°•(ì˜¤ì°½ê³µì¥)',
                    steps: [
                        'â‘  ì‘ì—…ì¼ìë¥¼ í™•ì¸/ì„ íƒí•©ë‹ˆë‹¤',
                        'â‘¡ ê¸ˆìƒ‰ í…Œë‘ë¦¬ë¡œ ê°•ì¡°ëœ ê¸°ë‘¥(ì»¤íŒ…ì™„ë£Œ ìƒíƒœ)ì„ í´ë¦­í•©ë‹ˆë‹¤',
                        'â‘¢ ì €ì¥í•©ë‹ˆë‹¤'
                    ],
                    note: 'â€» ì£¼ê¸°ë‘¥ì»¤íŒ…(1ë‹¨ê³„)ì´ ì™„ë£Œëœ ê¸°ë‘¥ë§Œ ì†Œë¶€ì¬ê°€ê³µ ì²˜ë¦¬ ê°€ëŠ¥'
                },
                3: {
                    title: 'ğŸ”µ ì£¼ê¸°ë‘¥ì¡°ë¦½ ì…ë ¥ ì•ˆë‚´',
                    company: 'ìœ ì„ì² ê°•(ìŒì„±ê³µì¥)',
                    steps: [
                        'â‘  ì‘ì—…ì¼ìë¥¼ í™•ì¸/ì„ íƒí•©ë‹ˆë‹¤',
                        'â‘¡ ê¸ˆìƒ‰ í…Œë‘ë¦¬ë¡œ ê°•ì¡°ëœ ê¸°ë‘¥(ì†Œë¶€ì¬ê°€ê³µì™„ë£Œ ìƒíƒœ)ì„ í´ë¦­í•©ë‹ˆë‹¤',
                        'â‘¢ ì €ì¥í•©ë‹ˆë‹¤'
                    ],
                    note: 'â€» ê¸°ë‘¥ì†Œë¶€ì¬ê°€ê³µ(2ë‹¨ê³„)ì´ ì™„ë£Œëœ ê¸°ë‘¥ë§Œ ì£¼ê¸°ë‘¥ì¡°ë¦½ ì²˜ë¦¬ ê°€ëŠ¥'
                },
                4: {
                    title: 'ğŸ”· ì†Œë¶€ì¬ì¡°ë¦½ ì…ë ¥ ì•ˆë‚´',
                    company: 'ìœ ì„ì² ê°•(ìŒì„±ê³µì¥)',
                    steps: [
                        'â‘  ì‘ì—…ì¼ìë¥¼ í™•ì¸/ì„ íƒí•©ë‹ˆë‹¤',
                        'â‘¡ ê¸ˆìƒ‰ í…Œë‘ë¦¬ë¡œ ê°•ì¡°ëœ ê¸°ë‘¥(ì£¼ê¸°ë‘¥ì¡°ë¦½ì™„ë£Œ ìƒíƒœ)ì„ í´ë¦­í•©ë‹ˆë‹¤',
                        'â‘¢ ì €ì¥í•©ë‹ˆë‹¤'
                    ],
                    note: 'â€» ì£¼ê¸°ë‘¥ì¡°ë¦½(3ë‹¨ê³„)ì´ ì™„ë£Œëœ ê¸°ë‘¥ë§Œ ì†Œë¶€ì¬ì¡°ë¦½ ì²˜ë¦¬ ê°€ëŠ¥'
                },
                5: {
                    title: 'ğŸŸ£ í˜„ì¥ë°°ì†¡ ì…ë ¥ ì•ˆë‚´',
                    company: 'ìœ ì„ì² ê°•(ìŒì„±ê³µì¥)',
                    steps: [
                        'â‘  ì‘ì—…ì¼ìë¥¼ í™•ì¸/ì„ íƒí•©ë‹ˆë‹¤',
                        'â‘¡ ê¸ˆìƒ‰ í…Œë‘ë¦¬ë¡œ ê°•ì¡°ëœ ê¸°ë‘¥(ì†Œì¡°ë¦½ì™„ë£Œ ìƒíƒœ)ì„ í´ë¦­í•˜ì—¬ ì„ íƒí•©ë‹ˆë‹¤ (ë‹¤ì¤‘ ì„ íƒ ê°€ëŠ¥)',
                        'â‘¢ ì„ íƒëœ ê¸°ë‘¥ë“¤ì´ íŒŒë€ìƒ‰ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤',
                        'â‘£ ì €ì¥ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì„ íƒí•œ ëª¨ë“  ê¸°ë‘¥ì„ í•œ ë²ˆì— ì €ì¥í•©ë‹ˆë‹¤'
                    ],
                    note: 'â€» ì†Œë¶€ì¬ì¡°ë¦½(4ë‹¨ê³„)ì´ ì™„ë£Œëœ ê¸°ë‘¥ë§Œ í˜„ì¥ë°°ì†¡ ì²˜ë¦¬ ê°€ëŠ¥'
                },
                6: {
                    title: 'ğŸŸ¢ í˜„ì¥ì„¤ì¹˜ ì…ë ¥ ì•ˆë‚´',
                    company: 'ì§„í¥ê¸°ì—…',
                    steps: [
                        'â‘  ì‘ì—…ì¼ìë¥¼ í™•ì¸/ì„ íƒí•©ë‹ˆë‹¤',
                        'â‘¡ ê¸ˆìƒ‰ í…Œë‘ë¦¬ë¡œ ê°•ì¡°ëœ ê¸°ë‘¥(ë°°ì†¡ì™„ë£Œ ìƒíƒœ)ì„ í´ë¦­í•˜ì—¬ ì„ íƒí•©ë‹ˆë‹¤ (ë‹¤ì¤‘ ì„ íƒ ê°€ëŠ¥)',
                        'â‘¢ ì„ íƒëœ ê¸°ë‘¥ë“¤ì´ íŒŒë€ìƒ‰ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤',
                        'â‘£ ì €ì¥ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì„ íƒí•œ ëª¨ë“  ê¸°ë‘¥ì„ í•œ ë²ˆì— ì €ì¥í•©ë‹ˆë‹¤'
                    ],
                    note: 'â€» í˜„ì¥ë°°ì†¡(5ë‹¨ê³„)ì—ì„œ í™•ì¸ëœ ê¸°ë‘¥ë§Œ ì„¤ì¹˜ ì²˜ë¦¬ ê°€ëŠ¥\nìš´ì†¡ì°¨ìˆ˜ê³„íšì—ì„œ "ğŸ’¾ ìš´ì†¡ì°¨ìˆ˜ê³„íš ì €ì¥" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ í™•ì¸í•œ ê¸°ë‘¥ë§Œ í˜„ì¥ì„¤ì¹˜ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.'
                }
            };
            
            const guide = guideMessages[processId];
            const guideDiv = document.getElementById('process-guide');
            
            guideDiv.innerHTML = `
                <div style="margin-bottom:10px;">
                    <strong style="font-size:14px;color:#1565c0;">${guide.title}</strong>
                    <span style="margin-left:10px;padding:3px 8px;background:#e3f2fd;border-radius:4px;font-size:11px;color:#1976d2;">ë‹´ë‹¹: ${guide.company}</span>
                </div>
                <div style="margin-bottom:8px;font-size:12px;color:#555;">
                    ${guide.steps.map(step => `<div style="margin:3px 0;">${step}</div>`).join('')}
                </div>
                <div style="font-size:11px;color:#e65100;background:#fff3e0;padding:6px 10px;border-radius:4px;margin-bottom:8px;">
                    ${guide.note}
                </div>
                ${guide.deleteNote ? `<div style="font-size:11px;color:#d32f2f;background:#ffebee;padding:6px 10px;border-radius:4px;border-left:3px solid #f44336;">
                    ${guide.deleteNote}
                </div>` : ''}
            `;
        }

        // ê¸°ì¡´ í˜¸í™˜ì„±ì„ ìœ„í•œ í•¨ìˆ˜
        function selectCompany(company) {
            // ì²« ë²ˆì§¸ ê³µì •ìœ¼ë¡œ ìë™ ì„ íƒ
            if (company === 'yuseok') selectProcess(1);
            else if (company === 'jusin') selectProcess(4);
            else if (company === 'jinhung') selectProcess(5);
        }

        // Panel Navigation
        function showPanel(panelId, btnElement) {
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            // ì¼ì¼ ì…ë ¥ ë²„íŠ¼ì€ ì œì™¸í•˜ê³  active í´ë˜ìŠ¤ ì œê±°
            document.querySelectorAll('.tab-btn').forEach(b => {
                if (!b.closest('.company-selector')) {
                    b.classList.remove('active');
                }
            });
            
            const panel = document.getElementById('panel-' + panelId);
            if (panel) {
                panel.classList.add('active');
            }
            
            if (btnElement) {
                btnElement.classList.add('active');
            } else if (event && event.target) {
                event.target.classList.add('active');
            }
            
            if (panelId === 'gantt') {
                loadTransportPlan(); // ìš´ì†¡ê³„íš ë¡œë“œ
                renderGanttChart();
            } else if (panelId === 'chart') {
                renderCharts();
            } else if (panelId === 'overview') {
                renderColumnGrid('column-grid-overview');
                updateProgressBars();
            } else if (panelId === 'transport') {
                loadTransportPlan();
                renderTransportColumnGrid();
                renderTransportTrips();
            } else if (panelId === 'transportVolume') {
                renderTransportVolumeTable();
            } else if (panelId === 'installation') {
                renderInstallationStatus();
            }
        }

        // Set Today's Date
        function setToday() {
            const today = new Date();
            const dateStr = today.toISOString().split('T')[0];
            const workDateInput = document.getElementById('work-date');
            if (workDateInput) {
                workDateInput.value = dateStr;
                loadDayData();
            }
        }
        
        // Set Date by Date String
        function setDateByString(dateStr) {
            const workDateInput = document.getElementById('work-date');
            if (workDateInput) {
                workDateInput.value = dateStr;
                loadDayData();
            }
        }
        
        // Render Weekday Buttons
        function renderWeekdayButtons() {
            const weekdayButtonsContainer = document.getElementById('weekday-buttons');
            if (!weekdayButtonsContainer) return;
            
            weekdayButtonsContainer.innerHTML = '';
            
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];
            const todayDay = today.getDay(); // 0=ì¼ìš”ì¼, 1=ì›”ìš”ì¼, ..., 6=í† ìš”ì¼
            
            // ì´ë²ˆ ì£¼ ì›”ìš”ì¼ ê³„ì‚° (ì›”ìš”ì¼ì´ ì£¼ì˜ ì‹œì‘)
            const thisWeekMonday = new Date(today);
            const daysToMonday = todayDay === 0 ? -6 : 1 - todayDay; // ì¼ìš”ì¼ì´ë©´ -6, ì•„ë‹ˆë©´ 1-todayDay
            thisWeekMonday.setDate(today.getDate() + daysToMonday);
            
            // ì§€ë‚œì£¼ ì›”ìš”ì¼ ê³„ì‚° (ì´ë²ˆ ì£¼ ì›”ìš”ì¼ì—ì„œ 7ì¼ ë¹¼ê¸°)
            const lastWeekMonday = new Date(thisWeekMonday);
            lastWeekMonday.setDate(thisWeekMonday.getDate() - 7);
            
            const weekdays = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            
            // ì§€ë‚œì£¼ ë²„íŠ¼ ìƒì„± (ìœ„ì— í‘œì‹œ)
            for (let i = 0; i < 7; i++) {
                const date = new Date(lastWeekMonday);
                date.setDate(lastWeekMonday.getDate() + i);
                const dateStr = date.toISOString().split('T')[0];
                const weekday = weekdays[date.getDay()];
                const dayOfWeek = date.getDay(); // 0=ì¼ìš”ì¼, 6=í† ìš”ì¼
                const isSunday = dayOfWeek === 0;
                
                // ë‚ ì§œ í¬ë§·íŒ… (MM/DD)
                const month = date.getMonth() + 1;
                const day = date.getDate();
                const dateDisplay = `${month}/${day}`;
                
                // ì˜¤ëŠ˜ ë‚ ì§œì¸ì§€ í™•ì¸
                const isToday = dateStr === todayStr;
                const buttonText = isToday ? `ì˜¤ëŠ˜ ${dateDisplay}` : `${weekday} ${dateDisplay}`;
                
                const button = document.createElement('button');
                button.className = isToday ? 'action-btn primary' : 'action-btn';
                // ì¼ìš”ì¼ì€ ë¹¨ê°„ìƒ‰, ì˜¤ëŠ˜ì€ ê¸°ë³¸ ìƒ‰ìƒ, ê·¸ ì™¸ëŠ” ì§™ì€ í‘¸ë¥¸ìƒ‰
                let colorStyle = '';
                if (isToday) {
                    colorStyle = '';
                } else if (isSunday) {
                    colorStyle = 'background:#9e9e9e;color:#d32f2f;opacity:0.7;';
                } else {
                    colorStyle = 'background:#9e9e9e;color:#0d47a1;opacity:0.7;';
                }
                button.style.cssText = colorStyle + 'white-space:nowrap;min-width:80px;';
                button.textContent = buttonText;
                button.onclick = () => setDateByString(dateStr);
                
                weekdayButtonsContainer.appendChild(button);
            }
            
            // ì´ë²ˆ ì£¼ ë²„íŠ¼ ìƒì„± (ì•„ë˜ì— í‘œì‹œ)
            for (let i = 0; i < 7; i++) {
                const date = new Date(thisWeekMonday);
                date.setDate(thisWeekMonday.getDate() + i);
                const dateStr = date.toISOString().split('T')[0];
                const weekday = weekdays[date.getDay()];
                const dayOfWeek = date.getDay(); // 0=ì¼ìš”ì¼, 6=í† ìš”ì¼
                const isSunday = dayOfWeek === 0;
                
                // ë‚ ì§œ í¬ë§·íŒ… (MM/DD)
                const month = date.getMonth() + 1;
                const day = date.getDate();
                const dateDisplay = `${month}/${day}`;
                
                // ì˜¤ëŠ˜ ë‚ ì§œì¸ì§€ í™•ì¸
                const isToday = dateStr === todayStr;
                const buttonText = isToday ? `ì˜¤ëŠ˜ ${dateDisplay}` : `${weekday} ${dateDisplay}`;
                
                const button = document.createElement('button');
                button.className = isToday ? 'action-btn primary' : 'action-btn';
                // ì¼ìš”ì¼ì€ ë¹¨ê°„ìƒ‰, ì˜¤ëŠ˜ì€ ê¸°ë³¸ ìƒ‰ìƒ, ê·¸ ì™¸ëŠ” ì§™ì€ í‘¸ë¥¸ìƒ‰
                let colorStyle = '';
                if (isToday) {
                    colorStyle = '';
                } else if (isSunday) {
                    colorStyle = 'background:#9e9e9e;color:#d32f2f;';
                } else {
                    colorStyle = 'background:#9e9e9e;color:#0d47a1;';
                }
                button.style.cssText = colorStyle + 'white-space:nowrap;min-width:80px;';
                button.textContent = buttonText;
                button.onclick = () => setDateByString(dateStr);
                
                weekdayButtonsContainer.appendChild(button);
            }
        }

        // Render Column Grid
        function renderColumnGrid(containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            let availableCount = 0;
            let completedCount = 0;
            
            // íœ´ë¬´ì¼ ì²´í¬ (ì…ë ¥ íŒ¨ë„ìš©)
            const workDate = document.getElementById('work-date')?.value;
            const isHolidayToday = workDate && isHoliday(workDate);
            
            for (let i = 1; i <= TOTAL_COLUMNS; i++) {
                const colId = i + 'C';
                const colData = columnData[colId] || {};
                let status = colData.status || 0;
                
                // ì¼ì¼ì…ë ¥ì°½ì˜ ê³µì • 1-4ì—ì„œ ìš´ì†¡ì°¨ìˆ˜ê³„íšì˜ í˜„ì¥ë°°ì†¡(ê³„íš)ì´ í‘œì‹œë˜ì§€ ì•Šë„ë¡
                // ì‹¤ì œ ì™„ë£Œëœ ê³µì • ìƒíƒœë§Œ ë°˜ì˜ (dailyData[date][5]ì—ë§Œ ìˆëŠ” ê²ƒì€ ì œì™¸)
                if (containerId === 'column-grid-input' && currentProcess >= 1 && currentProcess <= 4) {
                    // ì‹¤ì œ ì™„ë£Œëœ ê³µì •(1-4)ì˜ ìµœëŒ€ê°’ì„ ì°¾ìŒ
                    let actualStatus = 0;
                    const workDate = document.getElementById('work-date')?.value;
                    
                    // ëª¨ë“  ë‚ ì§œì—ì„œ ì‹¤ì œ ì™„ë£Œëœ ê³µì • í™•ì¸
                    for (let date in dailyData) {
                        for (let p = 1; p <= 4; p++) {
                            const dayData = dailyData[date]?.[p];
                            if (dayData && (dayData.includes(i) || dayData.includes(colId) || dayData.includes(String(i)))) {
                                actualStatus = Math.max(actualStatus, p);
                            }
                        }
                    }
                    
                    // ì‹¤ì œ ì™„ë£Œëœ ê³µì • ìƒíƒœë¡œ ì—…ë°ì´íŠ¸ (ìš´ì†¡ì°¨ìˆ˜ê³„íšì˜ í˜„ì¥ë°°ì†¡(ê³„íš) ì œì™¸)
                    status = actualStatus;
                }
                
                // í˜„ì¥ì„¤ì¹˜(process 6) ì…ë ¥ ì‹œ í˜„ì¥ë°°ì†¡(process 5)ì—ì„œ í™•ì¸ëœ ê¸°ë‘¥ë§Œ ê°€ëŠ¥
                if (containerId === 'column-grid-input' && currentProcess === 6 && status < 5) {
                    // dailyData[date][5]ì— í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸ (í™•ì¸ì„ ë°›ì€ ê¸°ë‘¥ë§Œ í¬í•¨ë¨)
                    const workDate = document.getElementById('work-date')?.value;
                    let hasConfirmedDelivery = false;
                    
                    if (workDate && dailyData[workDate] && dailyData[workDate][5]) {
                        if (dailyData[workDate][5].includes(colId) || 
                            dailyData[workDate][5].includes(i) || 
                            dailyData[workDate][5].includes(String(i))) {
                            hasConfirmedDelivery = true;
                        }
                    }
                    
                    // ëª¨ë“  ë‚ ì§œì˜ dailyData[date][5]ë¥¼ í™•ì¸ (ë‹¤ë¥¸ ë‚ ì§œì— ë°°ì†¡ ê³„íšì´ ìˆì„ ìˆ˜ ìˆìŒ)
                    if (!hasConfirmedDelivery) {
                        for (let date in dailyData) {
                            if (dailyData[date] && dailyData[date][5]) {
                                if (dailyData[date][5].includes(colId) || 
                                    dailyData[date][5].includes(i) || 
                                    dailyData[date][5].includes(String(i))) {
                                    hasConfirmedDelivery = true;
                                    break;
                                }
                            }
                        }
                    }
                    
                    if (hasConfirmedDelivery) {
                        // í™•ì¸ëœ ê¸°ë‘¥ì´ë©´ statusë¥¼ 5ë¡œ ì„ì‹œ í‘œì‹œí•˜ì—¬ í´ë¦­ ê°€ëŠ¥í•˜ê²Œ í•¨
                        status = 5;
                    }
                }
                
                // í˜„ì¥ë°°ì†¡(process 5)ì€ ìš´ì†¡ì°¨ìˆ˜ê³„íšì—ì„œ ë°›ì€ ë°ì´í„°ë¡œ ì‹¤ì œ ìš´ì†¡ì´ ì•„ë‹˜ì„ í‘œì‹œ
                const statusNames = ['ë¯¸ì°©ìˆ˜', 'ì»¤íŒ…', 'ì†Œë¶€ì¬', 'ì¡°ë¦½', 'ì†Œì¡°ë¦½', 'ë°°ì†¡ê³„íš', 'ì„¤ì¹˜ì™„ë£Œ'];
                const lastUpdate = colData.lastUpdate || '';
                
                // ë‚ ì§œ í¬ë§·íŒ… (YYYY-MM-DD -> MM/DD)
                let dateDisplay = '';
                if (lastUpdate && lastUpdate.trim() !== '') {
                    const dateParts = lastUpdate.split('-');
                    if (dateParts.length === 3) {
                        // ì›”/ì¼ í˜•ì‹ìœ¼ë¡œ ë³€í™˜ (ì•ì˜ 0 ì œê±°)
                        const month = parseInt(dateParts[1], 10);
                        const day = parseInt(dateParts[2], 10);
                        dateDisplay = `${month}/${day}`;
                    } else {
                        dateDisplay = lastUpdate;
                    }
                }
                
                const div = document.createElement('div');
                div.className = `column-item status-${status}`;
                
                // ì…ë ¥ íŒ¨ë„ì—ì„œ íœ´ë¬´ì¼ì´ë©´ ì „ì²´ ë¹„í™œì„±í™”
                if (containerId === 'column-grid-input' && isHolidayToday) {
                    div.style.opacity = '0.4';
                    div.style.cursor = 'not-allowed';
                    div.style.background = '#ffcdd2';
                }
                // ì…ë ¥ íŒ¨ë„ì—ì„œ ì„ íƒ ê°€ëŠ¥í•œ ê¸°ë‘¥ ê°•ì¡° í‘œì‹œ
                else if (containerId === 'column-grid-input' && currentProcess && !editMode) {
                    // ì†Œë¶€ì¬ê°€ê³µ(process 2)ì€ ë…ë¦½ì ìœ¼ë¡œ ì„ íƒ ê°€ëŠ¥ (ëª¨ë“  ê¸°ë‘¥ ì„ íƒ ê°€ëŠ¥)
                    // ì£¼ê¸°ë‘¥ì¡°ë¦½(process 3)ì€ ì£¼ê¸°ë‘¥ì»¤íŒ…(process 1) ì™„ë£Œ ìƒíƒœë§Œ í™•ì¸
                    let canProcess = false;
                    if (currentProcess === 2) {
                        // ì†Œë¶€ì¬ê°€ê³µì€ ëª¨ë“  ê¸°ë‘¥ ì„ íƒ ê°€ëŠ¥
                        canProcess = true;
                    } else if (currentProcess === 3) {
                        // ì£¼ê¸°ë‘¥ì¡°ë¦½ì€ ì£¼ê¸°ë‘¥ì»¤íŒ…(process 1) ì™„ë£Œ ìƒíƒœ í™•ì¸
                        let hasCutting = false;
                        // ëª¨ë“  ë‚ ì§œì—ì„œ ì£¼ê¸°ë‘¥ì»¤íŒ…(process 1) ì™„ë£Œ í™•ì¸
                        for (let date in dailyData) {
                            if (dailyData[date] && dailyData[date][1]) {
                                if (dailyData[date][1].includes(colId) || 
                                    dailyData[date][1].includes(i) || 
                                    dailyData[date][1].includes(String(i))) {
                                    hasCutting = true;
                                    break;
                                }
                            }
                        }
                        // columnDataì—ì„œë„ í™•ì¸
                        if (!hasCutting) {
                            const colData = columnData[colId] || {};
                            if (colData.status >= 1) {
                                hasCutting = true;
                            }
                        }
                        canProcess = hasCutting;
                    } else if (currentProcess === 4) {
                        // ì†Œë¶€ì¬ì¡°ë¦½ì€ ì£¼ê¸°ë‘¥ì»¤íŒ…(process 1), ì†Œë¶€ì¬ê°€ê³µ(process 2), ì£¼ê¸°ë‘¥ì¡°ë¦½(process 3)ì´ ëª¨ë‘ ì™„ë£Œëœ ìƒíƒœ í™•ì¸
                        let hasCutting = false; // ì£¼ê¸°ë‘¥ì»¤íŒ… ì™„ë£Œ ì—¬ë¶€
                        let hasSubProcessing = false; // ì†Œë¶€ì¬ê°€ê³µ ì™„ë£Œ ì—¬ë¶€
                        let hasMainAssembly = false; // ì£¼ê¸°ë‘¥ì¡°ë¦½ ì™„ë£Œ ì—¬ë¶€
                        
                        // ëª¨ë“  ë‚ ì§œì—ì„œ ì£¼ê¸°ë‘¥ì»¤íŒ…(process 1) ì™„ë£Œ í™•ì¸
                        for (let date in dailyData) {
                            if (dailyData[date] && dailyData[date][1]) {
                                if (dailyData[date][1].includes(colId) || 
                                    dailyData[date][1].includes(i) || 
                                    dailyData[date][1].includes(String(i))) {
                                    hasCutting = true;
                                    break;
                                }
                            }
                        }
                        
                        // ëª¨ë“  ë‚ ì§œì—ì„œ ì†Œë¶€ì¬ê°€ê³µ(process 2) ì™„ë£Œ í™•ì¸
                        for (let date in dailyData) {
                            if (dailyData[date] && dailyData[date][2]) {
                                if (dailyData[date][2].includes(colId) || 
                                    dailyData[date][2].includes(i) || 
                                    dailyData[date][2].includes(String(i))) {
                                    hasSubProcessing = true;
                                    break;
                                }
                            }
                        }
                        
                        // ëª¨ë“  ë‚ ì§œì—ì„œ ì£¼ê¸°ë‘¥ì¡°ë¦½(process 3) ì™„ë£Œ í™•ì¸
                        for (let date in dailyData) {
                            if (dailyData[date] && dailyData[date][3]) {
                                if (dailyData[date][3].includes(colId) || 
                                    dailyData[date][3].includes(i) || 
                                    dailyData[date][3].includes(String(i))) {
                                    hasMainAssembly = true;
                                    break;
                                }
                            }
                        }
                        
                        // columnDataì—ì„œë„ í™•ì¸
                        const colData = columnData[colId] || {};
                        if (!hasCutting && colData.status >= 1) {
                            hasCutting = true;
                        }
                        if (!hasSubProcessing && colData.status >= 2) {
                            hasSubProcessing = true;
                        }
                        if (!hasMainAssembly && colData.status >= 3) {
                            hasMainAssembly = true;
                        }
                        
                        canProcess = (hasCutting && hasSubProcessing && hasMainAssembly);
                    } else {
                        // ë‚˜ë¨¸ì§€ ê³µì •ì€ ì´ì „ ê³µì • ì™„ë£Œ ìƒíƒœ í™•ì¸
                        canProcess = (status === currentProcess - 1);
                    }
                    
                    // ëª¨ë“  ê³µì •ì—ì„œ ì„ íƒëœ ê¸°ë‘¥ í‘œì‹œ
                    const isSelected = selectedColumns.includes(colId);
                    if (canProcess) {
                        if (isSelected) {
                            // ì„ íƒëœ ê¸°ë‘¥ì€ íŒŒë€ìƒ‰ í…Œë‘ë¦¬
                            div.style.boxShadow = '0 0 0 3px #2196f3, 0 0 10px rgba(33,150,243,0.6)';
                            div.style.background = '#e3f2fd';
                            div.style.animation = 'none';
                        } else {
                            // ì„ íƒ ê°€ëŠ¥í•œ ê¸°ë‘¥ì€ ê¸ˆìƒ‰ í…Œë‘ë¦¬
                            div.style.boxShadow = '0 0 0 3px #ffd700, 0 0 10px rgba(255,215,0,0.5)';
                            div.style.animation = 'pulse 1.5s infinite';
                        }
                        availableCount++;
                    } else if (status >= currentProcess) {
                        div.style.opacity = '0.5';
                        completedCount++;
                    }
                }
                // ìˆ˜ì • ëª¨ë“œì¼ ë•ŒëŠ” ëª¨ë“  ê¸°ë‘¥ í´ë¦­ ê°€ëŠ¥í•˜ë„ë¡ í‘œì‹œ
                else if (containerId === 'column-grid-input' && editMode) {
                    div.style.boxShadow = '0 0 0 2px #4caf50, 0 0 8px rgba(76,175,80,0.3)';
                    div.style.cursor = 'pointer';
                }
                
                // ì¼ì¼ì…ë ¥ íŒ¨ë„ì—ì„œë§Œ ë‚ ì§œ í‘œì‹œ
                const isInputPanel = (containerId === 'column-grid-input');
                const showDate = isInputPanel && dateDisplay && dateDisplay.trim() !== '';
                
                // ë°°ì†¡í™•ì¸ëœ ê¸°ë‘¥ì˜ ê¸€ì”¨ ìƒ‰ìƒ ì„¤ì •
                const isDeliveryConfirmed = (containerId === 'column-grid-input' && currentProcess === 5 && deliveryConfirmed[colId]);
                const textColorStyle = isDeliveryConfirmed ? 'color:#000000;font-weight:bold;' : '';
                
                // í˜„ì¥ë°°ì†¡(process 5)ì—ì„œ ì†Œì¡°ë¦½ ì™„ë£Œì¼ê³¼ ìš´ì†¡ê³„íšì¼, ì‹¤ì œ ë°°ì†¡ì¼ í‘œì‹œ
                let assemblyDate = ''; // ì†Œì¡°ë¦½(process 4) ì™„ë£Œ ë‚ ì§œ
                let transportPlanDate = ''; // ë‹¹ì´ˆ ìš´ì†¡ê³„íš ë‚ ì§œ
                let actualDeliveryDateStr = ''; // ì‹¤ì œ ë°°ì†¡ ë‚ ì§œ
                
                if (containerId === 'column-grid-input' && currentProcess === 5) {
                    // ì†Œì¡°ë¦½(process 4) ì™„ë£Œ ë‚ ì§œ ì°¾ê¸°
                    for (let date in dailyData) {
                        if (dailyData[date] && dailyData[date][4]) {
                            if (dailyData[date][4].includes(colId) || 
                                dailyData[date][4].includes(i) || 
                                dailyData[date][4].includes(String(i))) {
                                const dateParts = date.split('-');
                                if (dateParts.length === 3) {
                                    const month = parseInt(dateParts[1], 10);
                                    const day = parseInt(dateParts[2], 10);
                                    assemblyDate = `${month}/${day}`;
                                }
                                break;
                            }
                        }
                    }
                    
                    // ë‹¹ì´ˆ ìš´ì†¡ê³„íš ë‚ ì§œ ì°¾ê¸° (transportPlanì—ì„œ)
                    for (let tripNum in transportPlan) {
                        const tripData = transportPlan[tripNum];
                        if (tripData && tripData.columns && tripData.date) {
                            const colNum = typeof colId === 'string' ? parseInt(colId.replace('C', '')) : colId;
                            if (tripData.columns.includes(colNum) || 
                                tripData.columns.includes(i) || 
                                tripData.columns.includes(String(i)) ||
                                tripData.columns.includes(colId)) {
                                const dateParts = tripData.date.split('-');
                                if (dateParts.length === 3) {
                                    const month = parseInt(dateParts[1], 10);
                                    const day = parseInt(dateParts[2], 10);
                                    transportPlanDate = `${month}/${day}`;
                                }
                                break;
                            }
                        }
                    }
                    
                    // ì‹¤ì œ ë°°ì†¡ ë‚ ì§œ ì°¾ê¸° (actualDeliveryDateì—ì„œ)
                    if (actualDeliveryDate[colId]) {
                        const dateParts = actualDeliveryDate[colId].split('-');
                        if (dateParts.length === 3) {
                            const month = parseInt(dateParts[1], 10);
                            const day = parseInt(dateParts[2], 10);
                            actualDeliveryDateStr = `${month}/${day}`;
                        }
                    }
                }
                
                // ë‚ ì§œ í‘œì‹œ HTML ìƒì„±
                let dateDisplayHtml = '';
                if (containerId === 'column-grid-input' && currentProcess === 5 && (assemblyDate || transportPlanDate || actualDeliveryDateStr)) {
                    // í˜„ì¥ë°°ì†¡ì—ì„œëŠ” ì†Œì¡°ë¦½ì¼, ìš´ì†¡ê³„íšì¼, ì‹¤ì œë°°ì†¡ì¼ì„ ì¤„ë°”ê¿ˆìœ¼ë¡œ í‘œì‹œ
                    let dateLines = [];
                    if (assemblyDate) dateLines.push(`ì†Œì¡°ë¦½: ${assemblyDate}`);
                    if (transportPlanDate) dateLines.push(`ìš´ì†¡: ${transportPlanDate}`);
                    if (actualDeliveryDateStr) dateLines.push(`ì‹¤ì œë°°ì†¡: ${actualDeliveryDateStr}`);
                    if (dateLines.length > 0) {
                        dateDisplayHtml = `<span style="font-size:10px;color:${isDeliveryConfirmed ? '#000000' : '#2c4a7c'};margin-top:3px;display:block;line-height:1.4;font-weight:${isDeliveryConfirmed ? 'bold' : '600'};background:rgba(44,74,124,0.1);padding:2px 4px;border-radius:3px;">${dateLines.join('<br>')}</span>`;
                    }
                } else if (showDate) {
                    // ë‹¤ë¥¸ ê³µì •ì—ì„œëŠ” ê¸°ì¡´ ë‚ ì§œ í‘œì‹œ
                    dateDisplayHtml = `<span style="font-size:11px;color:${isDeliveryConfirmed ? '#000000' : '#2c4a7c'};margin-top:3px;display:block;line-height:1.2;font-weight:${isDeliveryConfirmed ? 'bold' : '600'};background:rgba(44,74,124,0.1);padding:1px 4px;border-radius:3px;">${dateDisplay}</span>`;
                }
                
                // í˜„ì¥ë°°ì†¡(process 5)ì—ì„œëŠ” ìƒíƒœ í…ìŠ¤íŠ¸ë¥¼ í‘œì‹œí•˜ì§€ ì•ŠìŒ
                const statusText = (containerId === 'column-grid-input' && currentProcess === 5) ? '' : statusNames[status];
                
                div.innerHTML = `
                    <span class="col-num" style="${textColorStyle}">${colId}</span>
                    ${dateDisplayHtml}
                    ${statusText ? `<span class="col-status" style="${textColorStyle}">${statusText}</span>` : ''}
                `;
                
                if (containerId === 'column-grid-input') {
                    // í˜„ì¥ë°°ì†¡(process 5)ì€ ë°°ì†¡í™•ì¸ ë²„íŠ¼ìœ¼ë¡œ ê´€ë¦¬
                    if (currentProcess === 5) {
                        // dailyData[date][5]ì— ìˆëŠ” ê¸°ë‘¥ì¸ì§€ í™•ì¸ (ìš´ì†¡ì°¨ìˆ˜ê³„íšì—ì„œ ë°›ì€ ë°ì´í„°)
                        let hasTransportPlan = false;
                        for (let date in dailyData) {
                            if (dailyData[date] && dailyData[date][5]) {
                                if (dailyData[date][5].includes(colId) || 
                                    dailyData[date][5].includes(i) || 
                                    dailyData[date][5].includes(String(i))) {
                                    hasTransportPlan = true;
                                    break;
                                }
                            }
                        }
                        
                        if (hasTransportPlan) {
                            // ë°°ì†¡í™•ì¸ ìƒíƒœì— ë”°ë¼ ìƒ‰ìƒ ë³€ê²½
                            if (deliveryConfirmed[colId]) {
                                div.style.background = '#9c27b0'; // ì§™ì€ ë§ˆì  íƒ€ - ë°°ì†¡í™•ì¸ë¨
                                div.style.borderColor = '#7b1fa2';
                                // ë°°ì†¡í™•ì¸ëœ ì…€ì˜ ê¸€ì”¨ ìƒ‰ìƒì„ êµµì€ ê²€ì •ìƒ‰ìœ¼ë¡œ í‘œì‹œ
                                div.style.color = '#000000';
                                div.style.fontWeight = 'bold';
                            } else {
                                div.style.background = '#fff5ff'; // ë” ì˜…ì€ ë§ˆì  íƒ€ - ë°°ì†¡ê³„íšë§Œ
                                div.style.borderColor = '#9c27b0';
                            }
                            div.style.cursor = 'pointer';
                            div.onclick = () => toggleDeliveryConfirmation(colId);
                        } else {
                            // ìš´ì†¡ì°¨ìˆ˜ê³„íšì— ì—†ëŠ” ê¸°ë‘¥ì€ ë¯¸ì°©ìˆ˜ ìƒíƒœë¡œ ì˜…ì€ íšŒìƒ‰ í‘œì‹œ
                            div.style.background = '#e0e0e0'; // ì˜…ì€ íšŒìƒ‰ - ë¯¸ì°©ìˆ˜
                            div.style.borderColor = '#bdbdbd';
                            div.style.opacity = '0.6';
                            div.style.cursor = 'not-allowed';
                        }
                    } else {
                        // ëª¨ë“  ê³µì •(1-6)ì—ì„œ ë‹¤ì¤‘ ì„ íƒ ëª¨ë“œ (í˜„ì¥ë°°ì†¡ ì œì™¸)
                        if (currentProcess && currentProcess >= 1 && currentProcess <= 6 && !editMode) {
                            div.onclick = () => toggleColumnSelection(colId);
                        } else {
                            div.onclick = () => openColumnModal(colId);
                        }
                    }
                }
                
                container.appendChild(div);
            }
            
            // ê°€ì´ë“œ í†µê³„ ì—…ë°ì´íŠ¸
            if (containerId === 'column-grid-input') {
                const statsDiv = document.getElementById('guide-stats');
                if (isHolidayToday) {
                    // íœ´ë¬´ì¼ ë©”ì‹œì§€
                    statsDiv.style.display = 'block';
                    statsDiv.style.background = '#ffcdd2';
                    statsDiv.style.color = '#c62828';
                    statsDiv.innerHTML = `<strong>ğŸš« ${getHolidayName(workDate)}</strong> - í•´ë‹¹ì¼ì€ ì‘ì—…ì„ ì…ë ¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`;
                } else if (currentProcess && currentProcess >= 1 && currentProcess <= 6 && selectedColumns.length > 0) {
                    // ëª¨ë“  ê³µì •ì—ì„œ ì„ íƒëœ ê¸°ë‘¥ì´ ìˆì„ ë•Œ
                    updateSelectedColumnsInfo();
                } else if (currentProcess) {
                    const processNames = ['', 'ì£¼ê¸°ë‘¥ì»¤íŒ…', 'ê¸°ë‘¥ì†Œë¶€ì¬ê°€ê³µ', 'ì£¼ê¸°ë‘¥ì¡°ë¦½', 'ì†Œë¶€ì¬ì¡°ë¦½', 'í˜„ì¥ë°°ì†¡', 'í˜„ì¥ì„¤ì¹˜'];
                    statsDiv.style.display = 'block';
                    statsDiv.style.background = '#e8f5e9';
                    statsDiv.style.color = '#2e7d32';
                    statsDiv.innerHTML = 
                        `ğŸ“Š <strong>${processNames[currentProcess]}</strong> - ì…ë ¥ ê°€ëŠ¥: <strong style="color:#f57c00;">${availableCount}ê°œ</strong> / ì™„ë£Œ: <strong style="color:#4caf50;">${completedCount}ê°œ</strong> / ëŒ€ê¸°: <strong style="color:#757575;">${TOTAL_COLUMNS - availableCount - completedCount}ê°œ</strong>`;
                } else {
                    statsDiv.style.display = 'none';
                }
            }
        }

        // ìˆ˜ì • ëª¨ë“œ í™œì„±í™”/ë¹„í™œì„±í™”
        function enableEditMode() {
            editMode = !editMode;
            const btn = document.getElementById('edit-mode-btn');
            if (!btn) {
                console.error('ìˆ˜ì • ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            if (editMode) {
                btn.style.background = '#4caf50';
                btn.textContent = 'âœ… ìˆ˜ì •ì¤‘';
                alert('ìˆ˜ì • ëª¨ë“œê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ê³µì •í‘œì—ì„œ ë‚ ì§œë¥¼ í´ë¦­í•˜ì—¬ ê¸°ë‘¥ ìƒíƒœë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
            } else {
                btn.style.background = '#ff9800';
                btn.textContent = 'âœï¸ ìˆ˜ì •';
                alert('ìˆ˜ì • ëª¨ë“œê°€ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
            renderColumnGrid('column-grid-input');
            // Gantt ì°¨íŠ¸ë„ ë‹¤ì‹œ ë Œë”ë§í•˜ì—¬ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
            if (document.getElementById('panel-gantt')?.classList.contains('active')) {
                renderGanttChart();
            }
        }
        
        // ì‚­ì œ ëª¨ë“œ í™œì„±í™”/ë¹„í™œì„±í™”
        function enableDeleteMode() {
            deleteMode = !deleteMode;
            const btn = document.getElementById('delete-mode-btn');
            if (!btn) {
                console.error('ì‚­ì œ ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            if (deleteMode) {
                btn.style.background = '#d32f2f';
                btn.textContent = 'âœ… ë°ì´í„° ì‚­ì œì¤‘';
                alert('ë°ì´í„° ì‚­ì œ ëª¨ë“œê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ê³µì •í‘œì—ì„œ ì‚­ì œí•  ë°ì´í„°ê°€ ìˆëŠ” ë‚ ì§œë¥¼ í´ë¦­í•˜ì—¬ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
            } else {
                btn.style.background = '#f44336';
                btn.textContent = 'ğŸ—‘ï¸ ë°ì´í„° ì‚­ì œ';
                alert('ë°ì´í„° ì‚­ì œ ëª¨ë“œê°€ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
            // Gantt ì°¨íŠ¸ ë‹¤ì‹œ ë Œë”ë§í•˜ì—¬ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€/ì œê±°
            if (document.getElementById('panel-gantt')?.classList.contains('active')) {
                renderGanttChart();
            }
        }
        
        // ëª¨ë‹¬ ì œì–´ í•¨ìˆ˜ë“¤
        function showProcessSelectionModal(colId, dateStr) {
            const modal = document.getElementById('process-selection-modal');
            const message = document.getElementById('process-selection-message');
            message.textContent = `${colId}ì˜ ${dateStr}ì— ì£¼ê¸°ë‘¥ì»¤íŒ…(1)ê³¼ ì†Œë¶€ì¬ê°€ê³µ(2)ì´ ëª¨ë‘ ìˆìŠµë‹ˆë‹¤.\n\nì‚­ì œí•  ê³µì •ì„ ì„ íƒí•˜ì„¸ìš”:`;
            modal.classList.add('active');
        }

        function hideProcessSelectionModal() {
            const modal = document.getElementById('process-selection-modal');
            modal.classList.remove('active');
            pendingDeleteInfo = null;
        }

        function selectProcessForDelete(processNum) {
            if (!pendingDeleteInfo) {
                hideProcessSelectionModal();
                return;
            }

            const { columnNum, dateStr, processNames } = pendingDeleteInfo;
            const colId = columnNum + 'C';

            if (!confirm(`âš ï¸ ë°ì´í„° ì‚­ì œ í™•ì¸\n\n${colId}ì˜ ${dateStr}ì—ì„œ ${processNum}.${processNames[processNum]}ë§Œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n(ë‹¤ë¥¸ ê³µì •ì€ ìœ ì§€ë©ë‹ˆë‹¤)\n\nâš ï¸ ì¼ì¼ì…ë ¥ì—ì„œë„ ê°•ì œ ì‚­ì œë©ë‹ˆë‹¤.`)) {
                hideProcessSelectionModal();
                return;
            }

            hideProcessSelectionModal();
            executeProcessDelete(columnNum, dateStr, processNum);
        }

        function cancelProcessSelection() {
            hideProcessSelectionModal();
        }

        // ì‹¤ì œ ì‚­ì œ ì‹¤í–‰ í•¨ìˆ˜
        function executeProcessDelete(columnNum, dateStr, processToDelete) {
            const colId = columnNum + 'C';
            const processNames = ['', 'ì£¼ê¸°ë‘¥ì»¤íŒ…', 'ì†Œë¶€ì¬ê°€ê³µ', 'ì£¼ê¸°ë‘¥ì¡°ë¦½', 'ì†Œë¶€ì¬ì¡°ë¦½', 'í˜„ì¥ë°°ì†¡', 'í˜„ì¥ì„¤ì¹˜'];
            
            // í•´ë‹¹ ê³µì • ì‚­ì œ
            if (dailyData[dateStr] && dailyData[dateStr][processToDelete]) {
                dailyData[dateStr][processToDelete] = dailyData[dateStr][processToDelete].filter(col => {
                    if (typeof col === 'number' && col === columnNum) return false;
                    if (typeof col === 'string') {
                        if (col === colId) return false;
                        if (col === String(columnNum)) return false;
                        const colNum = parseInt(col.replace('C', ''));
                        if (!isNaN(colNum) && colNum === columnNum) return false;
                    }
                    return true;
                });
                
                if (dailyData[dateStr][processToDelete].length === 0) {
                    delete dailyData[dateStr][processToDelete];
                }
            }
            
            // columnData ì—…ë°ì´íŠ¸
            if (columnData[colId] && columnData[colId].lastUpdate === dateStr) {
                let lastUpdate = '';
                for (let date in dailyData) {
                    for (let p = 1; p <= 6; p++) {
                        const dayData = dailyData[date][p];
                        if (dayData) {
                            const hasColumn = dayData.some(col => {
                                if (typeof col === 'number' && col === columnNum) return true;
                                if (typeof col === 'string') {
                                    if (col === colId) return true;
                                    if (col === String(columnNum)) return true;
                                    const colNum = parseInt(col.replace('C', ''));
                                    if (!isNaN(colNum) && colNum === columnNum) return true;
                                }
                                return false;
                            });
                            if (hasColumn && date > lastUpdate) {
                                lastUpdate = date;
                            }
                        }
                    }
                }
                columnData[colId].lastUpdate = lastUpdate;
                columnData[colId].status = getColumnStatus(colId);
            }
            
            saveToStorage();
            renderGanttChart();
            renderColumnGrid('column-grid-input');
            updateProgressBars();
            loadDayData(dateStr);
            checkDuplicateForDate(dateStr);
        }

        // Gantt ì°¨íŠ¸ ì…€ ì‚­ì œ í•¸ë“¤ëŸ¬
        function handleGanttCellDelete(columnNum, dateStr) {
            if (!deleteMode) {
                alert('ì‚­ì œ ëª¨ë“œë¥¼ ë¨¼ì € í™œì„±í™”í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const colId = columnNum + 'C';
            
            // í•´ë‹¹ ë‚ ì§œì— ì™„ë£Œëœ ê³µì • ì°¾ê¸°
            const completedProcesses = [];
            for (let p = 1; p <= 6; p++) {
                const dayData = dailyData[dateStr]?.[p];
                if (dayData && (dayData.includes(columnNum) || dayData.includes(colId) || dayData.includes(String(columnNum)))) {
                    completedProcesses.push(p);
                }
            }
            
            if (completedProcesses.length === 0) {
                alert(`${colId}ëŠ” ${dateStr}ì— ì™„ë£Œëœ ê³µì •ì´ ì—†ìŠµë‹ˆë‹¤.`);
                return;
            }
            
            const processNames = ['', 'ì£¼ê¸°ë‘¥ì»¤íŒ…', 'ì†Œë¶€ì¬ê°€ê³µ', 'ì£¼ê¸°ë‘¥ì¡°ë¦½', 'ì†Œë¶€ì¬ì¡°ë¦½', 'í˜„ì¥ë°°ì†¡', 'í˜„ì¥ì„¤ì¹˜'];
            
            // ì¤‘ë³µëœ ë°ì´í„°ì¸ ê²½ìš°
            if (completedProcesses.length > 1) {
                // ì£¼ê¸°ë‘¥ì»¤íŒ…(1)ê³¼ ì†Œë¶€ì¬ê°€ê³µ(2)ì´ ëª¨ë‘ ìˆëŠ” ê²½ìš° íŠ¹ë³„ ì²˜ë¦¬
                const hasP1 = completedProcesses.includes(1);
                const hasP2 = completedProcesses.includes(2);
                
                // ë””ë²„ê¹…: completedProcesses í™•ì¸
                console.log('ì‚­ì œ ìš”ì²­ - completedProcesses:', completedProcesses, 'hasP1:', hasP1, 'hasP2:', hasP2);
                
                if (hasP1 && hasP2) {
                    // ì£¼ê¸°ë‘¥ì»¤íŒ…(1)ê³¼ ì†Œë¶€ì¬ê°€ê³µ(2)ì´ ëª¨ë‘ ìˆëŠ” ê²½ìš° ëª¨ë‹¬ í‘œì‹œ
                    pendingDeleteInfo = { columnNum, dateStr, processNames };
                    showProcessSelectionModal(colId, dateStr);
                    return;
                } else {
                    // ë‹¤ë¥¸ ì¤‘ë³µ ê³µì •ì¸ ê²½ìš° ê¸°ì¡´ ë¡œì§ ì‚¬ìš© (ê°€ì¥ ë†’ì€ ê³µì •ì„ ë‚¨ê¸°ê³  ë‚˜ë¨¸ì§€ ì‚­ì œ)
                    const processList = completedProcesses.map(p => `${p}.${processNames[p]}`).join(', ');
                    const maxProcess = Math.max(...completedProcesses);
                    const processesToDelete = completedProcesses.filter(p => p !== maxProcess);
                    
                    if (confirm(`âš ï¸ ì¤‘ë³µëœ ë°ì´í„° ì‚­ì œ\n\n${colId}ì˜ ${dateStr}ì— ì¤‘ë³µ ì…ë ¥ëœ ê³µì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nìœ ì§€í•  ê³µì •: ${maxProcess}.${processNames[maxProcess]}\nì‚­ì œí•  ê³µì •: ${processesToDelete.map(p => `${p}.${processNames[p]}`).join(', ')}\n\nâš ï¸ ì¼ì¼ì…ë ¥ì—ì„œë„ ê°•ì œ ì‚­ì œë©ë‹ˆë‹¤.`)) {
                        // ê¸°ì¡´ ë¡œì§: ì—¬ëŸ¬ ê³µì • ì‚­ì œ
                        for (let p of processesToDelete) {
                            if (dailyData[dateStr] && dailyData[dateStr][p]) {
                                // ëª¨ë“  í˜•ì‹ì˜ ê¸°ë‘¥ ë²ˆí˜¸ ì œê±° (ìˆ«ì, "1C" í˜•ì‹, ë¬¸ìì—´ ë“±)
                                dailyData[dateStr][p] = dailyData[dateStr][p].filter(col => {
                                    // ìˆ«ì í˜•ì‹ ë¹„êµ
                                    if (typeof col === 'number' && col === columnNum) return false;
                                    // ë¬¸ìì—´ í˜•ì‹ ë¹„êµ
                                    if (typeof col === 'string') {
                                        if (col === colId) return false;
                                        if (col === String(columnNum)) return false;
                                        // "1C" í˜•ì‹ì—ì„œ ìˆ«ìë§Œ ì¶”ì¶œí•˜ì—¬ ë¹„êµ
                                        const colNum = parseInt(col.replace('C', ''));
                                        if (!isNaN(colNum) && colNum === columnNum) return false;
                                    }
                                    return true;
                                });
                                // ë¹ˆ ë°°ì—´ì´ë©´ ì‚­ì œ
                                if (dailyData[dateStr][p].length === 0) {
                                    delete dailyData[dateStr][p];
                                }
                            }
                        }
                        
                        // í™”ë©´ ì—…ë°ì´íŠ¸ ë° ì €ì¥ (ê¸°ì¡´ ë¡œì§)
                        // columnDataì˜ lastUpdateë„ í™•ì¸í•˜ì—¬ ì—…ë°ì´íŠ¸
                        if (columnData[colId] && columnData[colId].lastUpdate === dateStr) {
                            // ë‹¤ë¥¸ ë‚ ì§œì˜ ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì°¾ê¸°
                            let lastUpdate = '';
                            for (let date in dailyData) {
                                for (let p = 1; p <= 6; p++) {
                                    const dayData = dailyData[date][p];
                                    if (dayData) {
                                        // ëª¨ë“  í˜•ì‹ì˜ ê¸°ë‘¥ ë²ˆí˜¸ í™•ì¸
                                        const hasColumn = dayData.some(col => {
                                            if (typeof col === 'number' && col === columnNum) return true;
                                            if (typeof col === 'string') {
                                                if (col === colId) return true;
                                                if (col === String(columnNum)) return true;
                                                const colNum = parseInt(col.replace('C', ''));
                                                if (!isNaN(colNum) && colNum === columnNum) return true;
                                            }
                                            return false;
                                        });
                                        if (hasColumn) {
                                            if (!lastUpdate || date > lastUpdate) {
                                                lastUpdate = date;
                                            }
                                        }
                                    }
                                }
                            }
                            columnData[colId].lastUpdate = lastUpdate;
                            // ìƒíƒœë„ ì—…ë°ì´íŠ¸ (ë§ˆì§€ë§‰ ì™„ë£Œëœ ê³µì • ê¸°ì¤€)
                            if (lastUpdate) {
                                let maxStatus = 0;
                                for (let p = 1; p <= 6; p++) {
                                    const dayData = dailyData[lastUpdate]?.[p];
                                    if (dayData) {
                                        const hasColumn = dayData.some(col => {
                                            if (typeof col === 'number' && col === columnNum) return true;
                                            if (typeof col === 'string') {
                                                if (col === colId) return true;
                                                if (col === String(columnNum)) return true;
                                                const colNum = parseInt(col.replace('C', ''));
                                                if (!isNaN(colNum) && colNum === columnNum) return true;
                                            }
                                            return false;
                                        });
                                        if (hasColumn) {
                                            maxStatus = Math.max(maxStatus, p);
                                        }
                                    }
                                }
                                columnData[colId].status = maxStatus;
                            } else {
                                columnData[colId].status = 0;
                            }
                        }
                        
                        // ì €ì¥ (ê°•ì œ ì‚­ì œ ë°˜ì˜) - ë°˜ë“œì‹œ ì €ì¥
                        saveToStorage();
                        
                        // í™”ë©´ ì—…ë°ì´íŠ¸
                        renderGanttChart();
                        renderColumnGrid('column-grid-overview');
                        updateProgressBars();
                        
                        // ì¼ì¼ì…ë ¥ íŒ¨ë„ ê°•ì œ ì—…ë°ì´íŠ¸ (ë°˜ë“œì‹œ ì‚­ì œ ë°˜ì˜)
                        renderColumnGrid('column-grid-input');
                        
                        // 2ë‹¨ê³„: ì¼ì¼ì…ë ¥ íŒ¨ë„ì´ í•´ë‹¹ ë‚ ì§œë¥¼ ë³´ê³  ìˆìœ¼ë©´ loadDayData í˜¸ì¶œ
                        const workDateInput = document.getElementById('work-date');
                        if (workDateInput && workDateInput.value === dateStr) {
                            // loadDayData í•¨ìˆ˜ í˜¸ì¶œí•˜ì—¬ ì¼ì¼ì…ë ¥ ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ (ë°˜ë“œì‹œ ì‚­ì œ ë°˜ì˜)
                            loadDayData();
                            // ì¤‘ë³µ ì²´í¬ë„ ì—…ë°ì´íŠ¸
                            if (typeof checkDuplicateForDate === 'function') {
                                checkDuplicateForDate(dateStr);
                            }
                        }
                        
                        // 3ë‹¨ê³„: ì•½ê°„ì˜ ì§€ì—° í›„ ë‹¤ì‹œ í•œ ë²ˆ í™•ì¸í•˜ì—¬ í™•ì‹¤íˆ ë°˜ì˜
                        setTimeout(() => {
                            // ë‹¤ì‹œ ì €ì¥í•˜ì—¬ í™•ì‹¤íˆ ë°˜ì˜
                            saveToStorage();
                            // ì¼ì¼ì…ë ¥ ê·¸ë¦¬ë“œ ë‹¤ì‹œ ë Œë”ë§
                            renderColumnGrid('column-grid-input');
                            // ì¼ì¼ì…ë ¥ íŒ¨ë„ì´ í•´ë‹¹ ë‚ ì§œë¥¼ ë³´ê³  ìˆìœ¼ë©´ ë‹¤ì‹œ ë¡œë“œ
                            if (workDateInput && workDateInput.value === dateStr) {
                                loadDayData();
                                if (typeof checkDuplicateForDate === 'function') {
                                    checkDuplicateForDate(dateStr);
                                }
                            }
                        }, 200);
                        
                        // 4ë‹¨ê³„: ì¶”ê°€ í™•ì¸ (ë” ê¸´ ì§€ì—° í›„)
                        setTimeout(() => {
                            renderColumnGrid('column-grid-input');
                        }, 500);
                        
                        alert(`âœ… ${colId}ì˜ ${dateStr} ê³µì •ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.\n\nì¼ì¼ì…ë ¥ì—ì„œë„ ë°˜ë“œì‹œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
                        return;
                    } else {
                        return;
                    }
                }
                
                // ì£¼ê¸°ë‘¥ì»¤íŒ…(1) ë˜ëŠ” ì†Œë¶€ì¬ê°€ê³µ(2) ì¤‘ ì„ íƒí•œ ê²ƒë§Œ ì‚­ì œ
                if (processToDelete !== null) {
                    // ì„ íƒí•œ ê³µì •ë§Œ ì‚­ì œ
                    if (dailyData[dateStr] && dailyData[dateStr][processToDelete]) {
                        // ëª¨ë“  í˜•ì‹ì˜ ê¸°ë‘¥ ë²ˆí˜¸ ì œê±° (ìˆ«ì, "1C" í˜•ì‹, ë¬¸ìì—´ ë“±)
                        dailyData[dateStr][processToDelete] = dailyData[dateStr][processToDelete].filter(col => {
                            // ìˆ«ì í˜•ì‹ ë¹„êµ
                            if (typeof col === 'number' && col === columnNum) return false;
                            // ë¬¸ìì—´ í˜•ì‹ ë¹„êµ
                            if (typeof col === 'string') {
                                if (col === colId) return false;
                                if (col === String(columnNum)) return false;
                                // "1C" í˜•ì‹ì—ì„œ ìˆ«ìë§Œ ì¶”ì¶œí•˜ì—¬ ë¹„êµ
                                const colNum = parseInt(col.replace('C', ''));
                                if (!isNaN(colNum) && colNum === columnNum) return false;
                            }
                            return true;
                        });
                        // ë¹ˆ ë°°ì—´ì´ë©´ ì‚­ì œ
                        if (dailyData[dateStr][processToDelete].length === 0) {
                            delete dailyData[dateStr][processToDelete];
                        }
                    }
                    
                    // columnDataì˜ lastUpdateë„ í™•ì¸í•˜ì—¬ ì—…ë°ì´íŠ¸
                if (columnData[colId] && columnData[colId].lastUpdate === dateStr) {
                    // ë‹¤ë¥¸ ë‚ ì§œì˜ ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì°¾ê¸°
                    let lastUpdate = '';
                    for (let date in dailyData) {
                        for (let p = 1; p <= 6; p++) {
                            const dayData = dailyData[date][p];
                            if (dayData) {
                                // ëª¨ë“  í˜•ì‹ì˜ ê¸°ë‘¥ ë²ˆí˜¸ í™•ì¸
                                const hasColumn = dayData.some(col => {
                                    if (typeof col === 'number' && col === columnNum) return true;
                                    if (typeof col === 'string') {
                                        if (col === colId) return true;
                                        if (col === String(columnNum)) return true;
                                        const colNum = parseInt(col.replace('C', ''));
                                        if (!isNaN(colNum) && colNum === columnNum) return true;
                                    }
                                    return false;
                                });
                                if (hasColumn) {
                                    if (!lastUpdate || date > lastUpdate) {
                                        lastUpdate = date;
                                    }
                                }
                            }
                        }
                    }
                    columnData[colId].lastUpdate = lastUpdate;
                    // ìƒíƒœë„ ì—…ë°ì´íŠ¸ (ë§ˆì§€ë§‰ ì™„ë£Œëœ ê³µì • ê¸°ì¤€)
                    if (lastUpdate) {
                        let maxStatus = 0;
                        for (let p = 1; p <= 6; p++) {
                            const dayData = dailyData[lastUpdate]?.[p];
                            if (dayData) {
                                const hasColumn = dayData.some(col => {
                                    if (typeof col === 'number' && col === columnNum) return true;
                                    if (typeof col === 'string') {
                                        if (col === colId) return true;
                                        if (col === String(columnNum)) return true;
                                        const colNum = parseInt(col.replace('C', ''));
                                        if (!isNaN(colNum) && colNum === columnNum) return true;
                                    }
                                    return false;
                                });
                                if (hasColumn) {
                                    maxStatus = Math.max(maxStatus, p);
                                }
                            }
                        }
                        columnData[colId].status = maxStatus;
                    } else {
                        columnData[colId].status = 0;
                    }
                }
                
                // ì €ì¥ (ê°•ì œ ì‚­ì œ ë°˜ì˜) - ë°˜ë“œì‹œ ì €ì¥
                saveToStorage();
                
                // í™”ë©´ ì—…ë°ì´íŠ¸
                renderGanttChart();
                renderColumnGrid('column-grid-overview');
                updateProgressBars();
                
                // ì¼ì¼ì…ë ¥ íŒ¨ë„ ê°•ì œ ì—…ë°ì´íŠ¸ (ë°˜ë“œì‹œ ì‚­ì œ ë°˜ì˜)
                renderColumnGrid('column-grid-input');
                
                // 2ë‹¨ê³„: ì¼ì¼ì…ë ¥ íŒ¨ë„ì´ í•´ë‹¹ ë‚ ì§œë¥¼ ë³´ê³  ìˆìœ¼ë©´ loadDayData í˜¸ì¶œ
                const workDateInput = document.getElementById('work-date');
                if (workDateInput && workDateInput.value === dateStr) {
                    // loadDayData í•¨ìˆ˜ í˜¸ì¶œí•˜ì—¬ ì¼ì¼ì…ë ¥ ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ (ë°˜ë“œì‹œ ì‚­ì œ ë°˜ì˜)
                    loadDayData();
                    // ì¤‘ë³µ ì²´í¬ë„ ì—…ë°ì´íŠ¸
                    if (typeof checkDuplicateForDate === 'function') {
                        checkDuplicateForDate(dateStr);
                    }
                }
                
                // 3ë‹¨ê³„: ì•½ê°„ì˜ ì§€ì—° í›„ ë‹¤ì‹œ í•œ ë²ˆ í™•ì¸í•˜ì—¬ í™•ì‹¤íˆ ë°˜ì˜
                setTimeout(() => {
                    // ë‹¤ì‹œ ì €ì¥í•˜ì—¬ í™•ì‹¤íˆ ë°˜ì˜
                    saveToStorage();
                    // ì¼ì¼ì…ë ¥ ê·¸ë¦¬ë“œ ë‹¤ì‹œ ë Œë”ë§
                    renderColumnGrid('column-grid-input');
                    // ì¼ì¼ì…ë ¥ íŒ¨ë„ì´ í•´ë‹¹ ë‚ ì§œë¥¼ ë³´ê³  ìˆìœ¼ë©´ ë‹¤ì‹œ ë¡œë“œ
                    if (workDateInput && workDateInput.value === dateStr) {
                        loadDayData();
                        if (typeof checkDuplicateForDate === 'function') {
                            checkDuplicateForDate(dateStr);
                        }
                    }
                }, 200);
                
                // 4ë‹¨ê³„: ì¶”ê°€ í™•ì¸ (ë” ê¸´ ì§€ì—° í›„)
                setTimeout(() => {
                    renderColumnGrid('column-grid-input');
                }, 500);
                
                alert(`âœ… ${colId}ì˜ ${dateStr} ê³µì •ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.\n\nì¼ì¼ì…ë ¥ì—ì„œë„ ë°˜ë“œì‹œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
                }
            } else {
                // ë‹¨ì¼ ê³µì •ì¸ ê²½ìš° ê°•ì œ ì‚­ì œ
                const processNum = completedProcesses[0];
                const processName = processNames[processNum];
                
                if (confirm(`âš ï¸ ë°ì´í„° ì‚­ì œ\n\n${colId}ì˜ ${dateStr}ì— ì™„ë£Œëœ ${processNum}.${processName} ê³µì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâš ï¸ ì¼ì¼ì…ë ¥ì—ì„œë„ ê°•ì œ ì‚­ì œë©ë‹ˆë‹¤.`)) {
                    // í•´ë‹¹ ê³µì • ì‚­ì œ
                    if (dailyData[dateStr] && dailyData[dateStr][processNum]) {
                        dailyData[dateStr][processNum] = dailyData[dateStr][processNum].filter(col => {
                            if (typeof col === 'number' && col === columnNum) return false;
                            if (typeof col === 'string') {
                                if (col === colId) return false;
                                if (col === String(columnNum)) return false;
                                const colNum = parseInt(col.replace('C', ''));
                                if (!isNaN(colNum) && colNum === columnNum) return false;
                            }
                            return true;
                        });
                        
                        if (dailyData[dateStr][processNum].length === 0) {
                            delete dailyData[dateStr][processNum];
                        }
                        
                        if (dailyData[dateStr] && Object.keys(dailyData[dateStr]).length === 0) {
                            delete dailyData[dateStr];
                        }
                    }
                    
                    // columnData ìƒíƒœ ì—…ë°ì´íŠ¸
                    const remainingProcesses = [];
                    for (let date in dailyData) {
                        if (date !== dateStr) {
                            for (let p = 1; p <= 6; p++) {
                                const dayData = dailyData[date]?.[p];
                                if (dayData && (dayData.includes(columnNum) || dayData.includes(colId) || dayData.includes(String(columnNum)))) {
                                    remainingProcesses.push(p);
                                }
                            }
                        }
                    }
                    
                    if (columnData[colId]) {
                        if (remainingProcesses.length > 0) {
                            columnData[colId].status = Math.max(...remainingProcesses);
                            // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ë‚ ì§œ ì°¾ê¸°
                            let lastUpdate = '';
                            for (let date in dailyData) {
                                for (let p = 1; p <= 6; p++) {
                                    const dayData = dailyData[date]?.[p];
                                    if (dayData && (dayData.includes(columnNum) || dayData.includes(colId) || dayData.includes(String(columnNum)))) {
                                        if (!lastUpdate || date > lastUpdate) {
                                            lastUpdate = date;
                                        }
                                    }
                                }
                            }
                            columnData[colId].lastUpdate = lastUpdate;
                        } else {
                            columnData[colId].status = 0;
                            columnData[colId].lastUpdate = '';
                        }
                    }
                    
                    // ì €ì¥ ë° í™”ë©´ ì—…ë°ì´íŠ¸
                    saveToStorage();
                    renderGanttChart();
                    renderColumnGrid('column-grid-overview');
                    renderColumnGrid('column-grid-input');
                    updateProgressBars();
                    
                    const workDateInput = document.getElementById('work-date');
                    if (workDateInput && workDateInput.value === dateStr) {
                        loadDayData();
                        if (typeof checkDuplicateForDate === 'function') {
                            checkDuplicateForDate(dateStr);
                        }
                    }
                    
                    alert(`âœ… ${colId}ì˜ ${dateStr} ${processName} ê³µì •ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.\n\nì¼ì¼ì…ë ¥ì—ì„œë„ ë°˜ë“œì‹œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
                }
            }
        }

        // Open Column Modal
        function openColumnModal(columnId) {
            // í˜„ì¥ë°°ì†¡(process 5)ì€ ìš´ì†¡ì°¨ìˆ˜ê³„íšì—ì„œ ê´€ë¦¬ë˜ë¯€ë¡œ ëª¨ë‹¬ ì—´ê¸° ë¹„í™œì„±í™”
            if (currentProcess === 5 && !editMode) {
                alert('í˜„ì¥ë°°ì†¡ì€ ìš´ì†¡ì°¨ìˆ˜ê³„íšì—ì„œ ì´ë¯¸ ì„¤ì •ë˜ì—ˆìœ¼ë¯€ë¡œ ë³„ë„ ì…ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.\n\nìš´ì†¡ì°¨ìˆ˜ê³„íš íƒ­ì—ì„œ ë°°ì†¡ ì¼ì •ì„ í™•ì¸í•˜ì„¸ìš”.');
                return;
            }
            
            // íœ´ë¬´ì¼ ì²´í¬ (ìˆ˜ì • ëª¨ë“œê°€ ì•„ë‹ ë•Œë§Œ)
            if (!editMode) {
                const workDate = document.getElementById('work-date').value;
                if (isHoliday(workDate)) {
                    alert(`${getHolidayName(workDate)}\n\ní•´ë‹¹ì¼ì€ íœ´ë¬´ë¡œ ì‘ì—… ì…ë ¥ì´ ë¶ˆê°€í•©ë‹ˆë‹¤.`);
                    return;
                }
            }
            
            const currentStatus = columnData[columnId]?.status || 0;
            
            selectedColumn = columnId;
            document.getElementById('modal-column-num').textContent = columnId;
            
            // ìˆ˜ì • ëª¨ë“œì¼ ë•ŒëŠ” ëª¨ë“  ê³µì • ì„ íƒ ê°€ëŠ¥
            if (editMode) {
                const processNames = ['ë¯¸ì°©ìˆ˜', 'ì£¼ê¸°ë‘¥ì»¤íŒ…', 'ê¸°ë‘¥ì†Œë¶€ì¬ê°€ê³µ', 'ì£¼ê¸°ë‘¥ì¡°ë¦½', 'ì†Œë¶€ì¬ì¡°ë¦½', 'í˜„ì¥ë°°ì†¡', 'í˜„ì¥ì„¤ì¹˜'];
                let optionsHtml = '';
                for (let i = 0; i <= 6; i++) {
                    const selected = (i === currentStatus) ? 'selected' : '';
                    optionsHtml += `<option value="${i}" ${selected}>${i}. ${processNames[i]}</option>`;
                }
                document.getElementById('modal-process-select').innerHTML = optionsHtml;
                document.getElementById('modal-process-select').value = currentStatus;
            } else {
                // ì¼ë°˜ ëª¨ë“œ: í˜„ì¬ ì„ íƒëœ ê³µì •ë§Œ í‘œì‹œ
                if (!currentProcess) {
                    alert('ë¨¼ì € ì…ë ¥í•  ê³µì •ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                // ì„ íƒí•œ ê³µì •ì´ í˜„ì¬ ê¸°ë‘¥ì— ì ìš© ê°€ëŠ¥í•œì§€ í™•ì¸
                if (currentProcess > 1 && currentStatus < currentProcess - 1) {
                    // í˜„ì¥ì„¤ì¹˜(process 6)ì˜ ê²½ìš° í˜„ì¥ë°°ì†¡(process 5)ì—ì„œ í™•ì¸ëœ ê¸°ë‘¥ë§Œ ê°€ëŠ¥
                    if (currentProcess === 6) {
                        // dailyData[date][5]ì— í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸ (í™•ì¸ì„ ë°›ì€ ê¸°ë‘¥ë§Œ í¬í•¨ë¨)
                        const workDate = document.getElementById('work-date')?.value;
                        let hasConfirmedDelivery = false;
                        
                        if (workDate && dailyData[workDate] && dailyData[workDate][5]) {
                            // dailyData[date][5]ì— í•´ë‹¹ ê¸°ë‘¥ì´ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
                            const colNum = typeof columnId === 'string' ? parseInt(columnId.replace('C', '')) : columnId;
                            if (dailyData[workDate][5].includes(columnId) || 
                                dailyData[workDate][5].includes(colNum) || 
                                dailyData[workDate][5].includes(String(colNum))) {
                                hasConfirmedDelivery = true;
                            }
                        }
                        
                        // ëª¨ë“  ë‚ ì§œì˜ dailyData[date][5]ë¥¼ í™•ì¸ (ë‹¤ë¥¸ ë‚ ì§œì— ë°°ì†¡ ê³„íšì´ ìˆì„ ìˆ˜ ìˆìŒ)
                        if (!hasConfirmedDelivery) {
                            for (let date in dailyData) {
                                if (dailyData[date] && dailyData[date][5]) {
                                    const colNum = typeof columnId === 'string' ? parseInt(columnId.replace('C', '')) : columnId;
                                    if (dailyData[date][5].includes(columnId) || 
                                        dailyData[date][5].includes(colNum) || 
                                        dailyData[date][5].includes(String(colNum))) {
                                        hasConfirmedDelivery = true;
                                        break;
                                    }
                                }
                            }
                        }
                        
                        // statusê°€ 5 ì´ìƒì´ê±°ë‚˜ dailyData[date][5]ì— í¬í•¨ë˜ì–´ ìˆì–´ì•¼ í•¨
                        if (!hasConfirmedDelivery && (columnData[columnId]?.status || 0) < 5) {
                            alert('í˜„ì¥ì„¤ì¹˜ë¥¼ ì…ë ¥í•˜ë ¤ë©´ í˜„ì¥ë°°ì†¡(5ë‹¨ê³„)ì—ì„œ í™•ì¸ëœ ê¸°ë‘¥ì´ì–´ì•¼ í•©ë‹ˆë‹¤.\n\nìš´ì†¡ì°¨ìˆ˜ê³„íš íƒ­ì—ì„œ í•´ë‹¹ ê¸°ë‘¥ì˜ ë°°ì†¡ ì¼ì •ì„ ì„¤ì •í•˜ê³  "ğŸ’¾ ìš´ì†¡ì°¨ìˆ˜ê³„íš ì €ì¥" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ í™•ì¸í•´ì£¼ì„¸ìš”.');
                            return;
                        }
                    } else {
                        alert(`ì´ì „ ê³µì •(${currentProcess - 1}ë‹¨ê³„)ì´ ì™„ë£Œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`);
                        return;
                    }
                }
                
                // ì´ë¯¸ í•´ë‹¹ ê³µì • ì´ìƒì´ ì™„ë£Œëœ ê²½ìš°
                if (currentStatus >= currentProcess) {
                    alert(`ì´ ê¸°ë‘¥ì€ ì´ë¯¸ ${currentProcess}ë‹¨ê³„ ì´ìƒ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`);
                    return;
                }
                
                const processNames = ['ë¯¸ì°©ìˆ˜', 'ì£¼ê¸°ë‘¥ì»¤íŒ…', 'ê¸°ë‘¥ì†Œë¶€ì¬ê°€ê³µ', 'ì£¼ê¸°ë‘¥ì¡°ë¦½', 'ì†Œë¶€ì¬ì¡°ë¦½', 'í˜„ì¥ë°°ì†¡', 'í˜„ì¥ì„¤ì¹˜'];
                document.getElementById('modal-process-select').innerHTML = `
                    <option value="${currentProcess}">${currentProcess}. ${processNames[currentProcess]} ì™„ë£Œ</option>
                `;
                document.getElementById('modal-process-select').value = currentProcess;
            }
            
            // ë¹„ê³  í•„ë“œì— ê¸°ì¡´ ë‚´ìš© í‘œì‹œ
            const existingNote = columnData[columnId]?.note || '';
            document.getElementById('modal-note').value = existingNote;
            
            // ë‚ ì§œ í•„ë“œì— ê¸°ì¡´ ë‚ ì§œ í‘œì‹œ (ì—†ìœ¼ë©´ í˜„ì¬ ì‘ì—…ì¼ì)
            const existingDate = columnData[columnId]?.lastUpdate || workDate || '';
            const modalDateInput = document.getElementById('modal-work-date');
            const modalDateGroup = document.getElementById('modal-date-group');
            
            // ë‚ ì§œ í•„ë“œ ê°•ì œ í‘œì‹œ
            if (modalDateGroup) {
                modalDateGroup.style.display = 'block';
                modalDateGroup.style.visibility = 'visible';
                modalDateGroup.style.marginBottom = '15px';
            }
            
            if (modalDateInput) {
                modalDateInput.value = existingDate || workDate || '';
                // ëª…ì‹œì ìœ¼ë¡œ í‘œì‹œ
                modalDateInput.style.display = 'block';
                modalDateInput.style.visibility = 'visible';
                modalDateInput.style.width = '100%';
                modalDateInput.style.padding = '10px';
                modalDateInput.style.border = '2px solid #ddd';
                modalDateInput.style.borderRadius = '8px';
                modalDateInput.style.fontSize = '14px';
            }
            
            document.getElementById('column-modal').classList.add('active');
        }

        // Close Modal
        function closeModal() {
            document.getElementById('column-modal').classList.remove('active');
            selectedColumn = null;
        }

        // Save Column Status
        function saveColumnStatus() {
            if (!selectedColumn) {
                alert('ê¸°ë‘¥ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ëª¨ë‹¬ì—ì„œ ë‚ ì§œ ê°€ì ¸ì˜¤ê¸° (ë‚ ì§œ ìˆ˜ì • ê°€ëŠ¥)
            let workDate = document.getElementById('modal-work-date')?.value;
            if (!workDate) {
                // ëª¨ë‹¬ ë‚ ì§œê°€ ì—†ìœ¼ë©´ í˜„ì¬ ì‘ì—…ì¼ì ì‚¬ìš©
                workDate = document.getElementById('work-date')?.value;
                if (!workDate) {
                    const today = new Date();
                    workDate = today.toISOString().split('T')[0];
                }
            }
            
            // ìˆ˜ì • ëª¨ë“œì¼ ë•ŒëŠ” ì„ íƒëœ ê³µì • ì‚¬ìš©, ì¼ë°˜ ëª¨ë“œì¼ ë•ŒëŠ” currentProcess ì‚¬ìš©
            const selectedStatus = parseInt(document.getElementById('modal-process-select').value);
            const newStatus = editMode ? selectedStatus : (currentProcess || selectedStatus);
            
            if (newStatus === undefined || newStatus === null) {
                alert('ê³µì • ìƒíƒœë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ê¸°ì¡´ ë‚ ì§œì™€ ê³µì • ìƒíƒœ í™•ì¸ (ë‚ ì§œ ë³€ê²½ ì‹œ ê¸°ì¡´ ë°ì´í„° ì œê±°ìš©)
            const oldDate = columnData[selectedColumn]?.lastUpdate || '';
            const oldStatus = columnData[selectedColumn]?.status || 0;
            
            // í˜„ì¥ì„¤ì¹˜(process 6) ì…ë ¥ ì‹œ í˜„ì¥ë°°ì†¡(process 5)ì—ì„œ í™•ì¸ëœ ê¸°ë‘¥ë§Œ ê°€ëŠ¥
            if (newStatus === 6) {
                const currentStatus = columnData[selectedColumn]?.status || 0;
                
                // dailyData[date][5]ì— í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸ (í™•ì¸ì„ ë°›ì€ ê¸°ë‘¥ë§Œ í¬í•¨ë¨)
                let hasConfirmedDelivery = false;
                
                // í˜„ì¬ ì‘ì—…ì¼ìì˜ dailyData[date][5] í™•ì¸
                if (workDate && dailyData[workDate] && dailyData[workDate][5]) {
                    const colNum = typeof selectedColumn === 'string' ? parseInt(selectedColumn.replace('C', '')) : selectedColumn;
                    if (dailyData[workDate][5].includes(selectedColumn) || 
                        dailyData[workDate][5].includes(colNum) || 
                        dailyData[workDate][5].includes(String(colNum))) {
                        hasConfirmedDelivery = true;
                    }
                }
                
                // ëª¨ë“  ë‚ ì§œì˜ dailyData[date][5]ë¥¼ í™•ì¸ (ë‹¤ë¥¸ ë‚ ì§œì— ë°°ì†¡ ê³„íšì´ ìˆì„ ìˆ˜ ìˆìŒ)
                if (!hasConfirmedDelivery) {
                    for (let date in dailyData) {
                        if (dailyData[date] && dailyData[date][5]) {
                            const colNum = typeof selectedColumn === 'string' ? parseInt(selectedColumn.replace('C', '')) : selectedColumn;
                            if (dailyData[date][5].includes(selectedColumn) || 
                                dailyData[date][5].includes(colNum) || 
                                dailyData[date][5].includes(String(colNum))) {
                                hasConfirmedDelivery = true;
                                break;
                            }
                        }
                    }
                }
                
                // statusê°€ 5 ë¯¸ë§Œì´ê³  dailyData[date][5]ì—ë„ ì—†ìœ¼ë©´ ì˜¤ë¥˜
                if (currentStatus < 5 && !hasConfirmedDelivery) {
                    alert('í˜„ì¥ì„¤ì¹˜ë¥¼ ì…ë ¥í•˜ë ¤ë©´ í˜„ì¥ë°°ì†¡(5ë‹¨ê³„)ì—ì„œ í™•ì¸ëœ ê¸°ë‘¥ì´ì–´ì•¼ í•©ë‹ˆë‹¤.\n\nìš´ì†¡ì°¨ìˆ˜ê³„íš íƒ­ì—ì„œ í•´ë‹¹ ê¸°ë‘¥ì˜ ë°°ì†¡ ì¼ì •ì„ ì„¤ì •í•˜ê³  "ğŸ’¾ ìš´ì†¡ì°¨ìˆ˜ê³„íš ì €ì¥" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ í™•ì¸í•´ì£¼ì„¸ìš”.');
                    return;
                }
            }
            
            const note = document.getElementById('modal-note').value;
            
            // ê¸°ì¡´ ë‚ ì§œì˜ ë°ì´í„° ì œê±° (ë‚ ì§œê°€ ë³€ê²½ëœ ê²½ìš°)
            if (oldDate && oldDate !== workDate && oldStatus > 0) {
                // ê¸°ì¡´ ë‚ ì§œì˜ í•´ë‹¹ ê³µì •ì—ì„œ ê¸°ë‘¥ ì œê±°
                if (dailyData[oldDate] && dailyData[oldDate][oldStatus]) {
                    dailyData[oldDate][oldStatus] = dailyData[oldDate][oldStatus].filter(
                        col => col !== selectedColumn && 
                        col !== parseInt(selectedColumn.replace('C', '')) && 
                        col !== selectedColumn.replace('C', '')
                    );
                    // ë¹ˆ ë°°ì—´ì´ë©´ ì œê±°
                    if (dailyData[oldDate][oldStatus].length === 0) {
                        delete dailyData[oldDate][oldStatus];
                    }
                    // ë‚ ì§œì— ë‹¤ë¥¸ ê³µì • ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë‚ ì§œ ìì²´ ì œê±°
                    if (Object.keys(dailyData[oldDate]).length === 0) {
                        delete dailyData[oldDate];
                    }
                }
            } else if (oldDate === workDate && oldStatus > 0 && oldStatus !== newStatus) {
                // ê°™ì€ ë‚ ì§œì´ì§€ë§Œ ê³µì •ì´ ë³€ê²½ëœ ê²½ìš° ê¸°ì¡´ ê³µì •ì—ì„œ ì œê±°
                if (dailyData[oldDate] && dailyData[oldDate][oldStatus]) {
                    dailyData[oldDate][oldStatus] = dailyData[oldDate][oldStatus].filter(
                        col => col !== selectedColumn && 
                        col !== parseInt(selectedColumn.replace('C', '')) && 
                        col !== selectedColumn.replace('C', '')
                    );
                    if (dailyData[oldDate][oldStatus].length === 0) {
                        delete dailyData[oldDate][oldStatus];
                    }
                }
            }
            
            // Save data
            if (!columnData[selectedColumn]) {
                columnData[selectedColumn] = {};
            }
            columnData[selectedColumn].status = newStatus;
            columnData[selectedColumn].note = note;
            columnData[selectedColumn].lastUpdate = workDate;
            columnData[selectedColumn].updatedBy = PROCESSES.find(p => p.id === newStatus)?.company;
            
            // Track daily progress (ìƒˆ ë‚ ì§œì— ì¶”ê°€)
            if (!dailyData[workDate]) {
                dailyData[workDate] = {};
            }
            if (!dailyData[workDate][newStatus]) {
                dailyData[workDate][newStatus] = [];
            }
            // ê¸°ì¡´ í•­ëª© ì œê±° í›„ ìƒˆë¡œ ì¶”ê°€ (ì¤‘ë³µ ë°©ì§€)
            dailyData[workDate][newStatus] = dailyData[workDate][newStatus].filter(
                col => col !== selectedColumn && 
                col !== parseInt(selectedColumn.replace('C', '')) && 
                col !== selectedColumn.replace('C', '')
            );
            dailyData[workDate][newStatus].push(selectedColumn);
            
            // ì¤‘ë³µ ì…ë ¥ í™•ì¸: ê°™ì€ ë‚ ì§œì— ê°™ì€ ê¸°ë‘¥ì— ì—¬ëŸ¬ ê³µì •ì´ ìˆëŠ”ì§€ í™•ì¸
            const duplicateProcesses = [];
            for (let p = 1; p <= 6; p++) {
                if (p !== newStatus && dailyData[workDate][p] && 
                    (dailyData[workDate][p].includes(selectedColumn) || dailyData[workDate][p].includes(parseInt(selectedColumn)))) {
                    duplicateProcesses.push(p);
                }
            }
            
            // ì¤‘ë³µì´ ìˆìœ¼ë©´ ê²½ê³  í‘œì‹œ
            if (duplicateProcesses.length > 0) {
                const processNames = ['', 'ì£¼ê¸°ë‘¥ì»¤íŒ…', 'ì†Œë¶€ì¬ê°€ê³µ', 'ì£¼ê¸°ë‘¥ì¡°ë¦½', 'ì†Œë¶€ì¬ì¡°ë¦½', 'í˜„ì¥ë°°ì†¡', 'í˜„ì¥ì„¤ì¹˜'];
                const duplicateNames = duplicateProcesses.map(p => `${p}.${processNames[p]}`).join(', ');
                showConnectionStatus(`âš ï¸ ì¤‘ë³µì…ë ¥ ê²½ê³ : ${selectedColumn}ëŠ” ${workDate}ì— ${duplicateNames}ì™€ í•¨ê»˜ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                
                // ì¼ì¼ì…ë ¥ì°½ì— ì¤‘ë³µ ê²½ê³  í‘œì‹œ
                const duplicateWarning = document.getElementById('duplicate-warning');
                const duplicateWarningContent = document.getElementById('duplicate-warning-content');
                if (duplicateWarning && duplicateWarningContent) {
                    duplicateWarning.style.display = 'block';
                    duplicateWarningContent.innerHTML = `âš ï¸ <strong>ì¤‘ë³µì…ë ¥</strong>: ${selectedColumn}ëŠ” ${workDate}ì— ${duplicateNames}ì™€ í•¨ê»˜ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤.`;
                }
            } else {
                // ì¤‘ë³µì´ ì—†ìœ¼ë©´ ê²½ê³  ìˆ¨ê¸°ê¸°
                const duplicateWarning = document.getElementById('duplicate-warning');
                if (duplicateWarning) {
                    duplicateWarning.style.display = 'none';
                }
            }
            
            // ì‘ì—…ì¼ì ë³€ê²½ ì‹œ ì¤‘ë³µ í™•ì¸
            checkDuplicateForDate(workDate);
            
            // ì‘ì—…ì¼ì ë³€ê²½ ì‹œ ì¤‘ë³µ í™•ì¸
            checkDuplicateForDate(workDate);
            
            // Save to storage immediately
            try {
                saveToStorage();
            } catch (error) {
                console.error('ì €ì¥ ì˜¤ë¥˜:', error);
                alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                return;
            }
            
            // Close modal
            closeModal();
            
            // Update UI immediately - ì „ì²´ í˜„í™© í¬í•¨
            renderColumnGrid('column-grid-input');
            renderColumnGrid('column-grid-overview');
            updateProgressBars();
            
            // ì „ì²´ í˜„í™© íŒ¨ë„ì´ í™œì„±í™”ë˜ì–´ ìˆìœ¼ë©´ ê°•ì œë¡œ ìƒˆë¡œê³ ì¹¨
            const overviewPanel = document.getElementById('panel-overview');
            if (overviewPanel && overviewPanel.classList.contains('active')) {
                // ì•½ê°„ì˜ ì§€ì—°ì„ ë‘ê³  ë‹¤ì‹œ ë Œë”ë§í•˜ì—¬ í™•ì‹¤íˆ ì—…ë°ì´íŠ¸
                setTimeout(() => {
                    renderColumnGrid('column-grid-overview');
                    updateProgressBars();
                }, 100);
            }
            
            // Gantt ì°¨íŠ¸ íŒ¨ë„ì´ í™œì„±í™”ë˜ì–´ ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸
            const ganttPanel = document.getElementById('panel-gantt');
            if (ganttPanel && ganttPanel.classList.contains('active')) {
                // ì•½ê°„ì˜ ì§€ì—°ì„ ë‘ê³  ì—…ë°ì´íŠ¸í•˜ì—¬ ë°ì´í„°ê°€ ì™„ì „íˆ ì €ì¥ëœ í›„ ë Œë”ë§
                setTimeout(() => {
                    renderGanttChart();
                }, 100);
            }
            
            // ë””ë²„ê¹…: ì €ì¥ëœ ë°ì´í„° í™•ì¸
            console.log('ì €ì¥ëœ dailyData:', JSON.stringify(dailyData, null, 2));
            console.log('ì €ì¥ëœ columnData:', JSON.stringify(columnData, null, 2));
            
            // Show success message with date
            const processNames = ['ë¯¸ì°©ìˆ˜', 'ì£¼ê¸°ë‘¥ì»¤íŒ…', 'ê¸°ë‘¥ì†Œë¶€ì¬ê°€ê³µ', 'ì£¼ê¸°ë‘¥ì¡°ë¦½', 'ì†Œë¶€ì¬ì¡°ë¦½', 'í˜„ì¥ë°°ì†¡', 'í˜„ì¥ì„¤ì¹˜'];
            const dateParts = workDate.split('-');
            const dateDisplay = dateParts.length === 3 ? `${dateParts[1]}/${dateParts[2]}` : workDate;
            
            // ì €ì¥ ì™„ë£Œ ë©”ì‹œì§€ í‘œì‹œ
            alert('ì €ì¥í•˜ì˜€ìŠµë‹ˆë‹¤.');
            showConnectionStatus(`âœ… ${selectedColumn} - ${processNames[newStatus]} ì™„ë£Œ! (${dateDisplay})`);
        }

        // Update Progress Bars
        function updateProgressBars() {
            for (let p = 1; p <= 6; p++) {
                let count = 0;
                for (let c = 1; c <= TOTAL_COLUMNS; c++) {
                    const colId = c + 'C';
                    if (columnData[colId]?.status >= p) count++;
                }
                const percent = Math.round((count / TOTAL_COLUMNS) * 100);
                
                document.getElementById(`progress-p${p}`).style.width = percent + '%';
                document.getElementById(`progress-p${p}`).textContent = percent + '%';
                document.getElementById(`progress-p${p}-text`).textContent = `${count} / ${TOTAL_COLUMNS}`;
            }
        }

        // Render Gantt Chart
        // íœ´ë¬´ì¼ ì²´í¬ í—¬í¼ í•¨ìˆ˜
        function isHoliday(dateStr) {
            return HOLIDAYS.hasOwnProperty(dateStr);
        }
        
        function getHolidayName(dateStr) {
            return HOLIDAYS[dateStr] || '';
        }

        function renderGanttChart() {
            const table = document.getElementById('gantt-table');
            
            // ìš´ì†¡ê³„íšì´ ë¡œë“œë˜ì§€ ì•Šì•˜ë‹¤ë©´ ë¡œë“œ
            if (!transportPlan || Object.keys(transportPlan).length === 0) {
                loadTransportPlan();
            }
            
            // Generate date range
            const dates = [];
            let currentDate = new Date(START_DATE);
            while (currentDate <= END_DATE) {
                dates.push(new Date(currentDate));
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            // Build header
            let headerHtml = '<thead><tr><th class="col-header">ê¸°ë‘¥ë²ˆí˜¸</th>';
            dates.forEach(date => {
                const dayOfWeek = date.getDay();
                const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
                const dateStrFull = date.toISOString().split('T')[0];
                const isHolidayDate = isHoliday(dateStrFull);
                const dateStr = `${date.getMonth()+1}/${date.getDate()}`;
                
                let headerClass = 'date-header';
                if (isHolidayDate) {
                    headerClass += ' holiday-header';
                } else if (isWeekend) {
                    headerClass += ' weekend';
                }
                
                headerHtml += `<th class="${headerClass}" title="${isHolidayDate ? getHolidayName(dateStrFull) : ''}">${dateStr}</th>`;
            });
            headerHtml += '</tr></thead>';
            
            // Build body
            let bodyHtml = '<tbody>';
            for (let c = 1; c <= TOTAL_COLUMNS; c++) {
                bodyHtml += `<tr><td class="col-name">${c}C</td>`;
                
                dates.forEach(date => {
                    const dateStr = date.toISOString().split('T')[0];
                    const dayOfWeek = date.getDay();
                    const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
                    const isHolidayDate = isHoliday(dateStr);
                    
                    // íœ´ë¬´ì¼ì¸ ê²½ìš°
                    if (isHolidayDate) {
                        bodyHtml += `<td class="holiday" title="${getHolidayName(dateStr)}">`;
                        if (c === 1) {
                            // ì²« ë²ˆì§¸ í–‰ì—ë§Œ íœ´ë¬´ ë¼ë²¨ í‘œì‹œ
                        }
                        bodyHtml += '</td>';
                    } else {
                        // Find which process was completed on this date for this column
                        let cellClass = '';
                        
                        // ê¸°ë‘¥ ë²ˆí˜¸ í˜•ì‹: "1C", "2C" ë“±
                        const colId = c + 'C';
                        
                        // dailyDataì—ì„œ ì™„ë£Œëœ ê³µì • í™•ì¸
                        const completedProcesses = [];
                        for (let p = 1; p <= 6; p++) {
                            const dayData = dailyData[dateStr]?.[p];
                            if (dayData) {
                                // ìˆ«ì í˜•ì‹(c) ë˜ëŠ” ë¬¸ìì—´ í˜•ì‹(colId) ëª¨ë‘ í™•ì¸
                                if (dayData.includes(c) || dayData.includes(colId) || dayData.includes(String(c))) {
                                    completedProcesses.push(p);
                                }
                            }
                        }
                        
                        // ì¤‘ë³µ í™•ì¸: ê°™ì€ ë‚ ì§œì— ì—¬ëŸ¬ ê³µì •ì´ ì™„ë£Œëœ ê²½ìš°
                        // ë‹¨, ì£¼ê¸°ë‘¥ì»¤íŒ…(1)ê³¼ ì†Œë¶€ì¬ê°€ê³µ(2)ì€ ì¤‘ë³µ í—ˆìš©
                        let isAllowedDuplicate = false;
                        let hasP1P2Both = false; // ì£¼ê¸°ë‘¥ì»¤íŒ…(1)ê³¼ ì†Œë¶€ì¬ê°€ê³µ(2)ì´ ëª¨ë‘ ìˆëŠ”ì§€
                        
                        // ì£¼ê¸°ë‘¥ì»¤íŒ…(1)ê³¼ ì†Œë¶€ì¬ê°€ê³µ(2)ì´ ëª¨ë‘ ìˆëŠ”ì§€ í™•ì¸
                        const hasP1 = completedProcesses.includes(1);
                        const hasP2 = completedProcesses.includes(2);
                        if (hasP1 && hasP2) {
                            isAllowedDuplicate = true;
                            hasP1P2Both = true;
                        }
                        
                        // ì£¼ê¸°ë‘¥ì»¤íŒ…(1)ê³¼ ì†Œë¶€ì¬ê°€ê³µ(2)ì´ ëª¨ë‘ ìˆëŠ” ê²½ìš°ë¥¼ ë¨¼ì € ì²˜ë¦¬
                        if (hasP1P2Both) {
                            // ì£¼ê¸°ë‘¥ì»¤íŒ…(1)ê³¼ ì†Œë¶€ì¬ê°€ê³µ(2)ì´ ëª¨ë‘ ìˆëŠ” ê²½ìš° íŠ¹ë³„ ì²˜ë¦¬
                            // cellClassëŠ” ë‚˜ì¤‘ì— ë‘ ê°œì˜ divë¡œ ë Œë”ë§í•˜ë¯€ë¡œ 'both'ë¡œ ì„¤ì •
                            cellClass = 'gantt-cell both';
                        } else if (completedProcesses.length > 1 && !isAllowedDuplicate) {
                            cellClass = 'gantt-cell duplicate';
                        } else if (completedProcesses.length === 1) {
                            const processNum = completedProcesses[0];
                            if (processNum === 5) {
                                // í˜„ì¥ë°°ì†¡(process 5): ì‹¤ì œ ë°°ì†¡ ë‚ ì§œì¸ì§€ í™•ì¸
                                if (actualDeliveryDate[colId] && actualDeliveryDate[colId] === dateStr) {
                                    cellClass = 'gantt-cell p5 confirmed'; // ì§™ì€ ë§ˆì  íƒ€ - ì‹¤ì œ ë°°ì†¡ì¼
                                } else {
                                    cellClass = 'gantt-cell p5'; // ì§„í•œ ë§ˆì  íƒ€ - ìš´ì†¡ê³„íšì¼
                                }
                            } else if (processNum === 6) {
                                // 6. í˜„ì¥ì„¤ì¹˜(process 6): dailyDataì— ì €ì¥ëœ ë‚ ì§œì— í‘œì‹œ
                                cellClass = 'gantt-cell p6';
                            } else {
                                cellClass = `gantt-cell p${processNum}`;
                            }
                        }
                        
                        // ì‹¤ì œ ë°°ì†¡ ë‚ ì§œê°€ ìˆëŠ” ê²½ìš° í•´ë‹¹ ë‚ ì§œì— ì§™ì€ ë§ˆì  íƒ€ë¡œ í‘œì‹œ
                        if (!cellClass && actualDeliveryDate[colId] && actualDeliveryDate[colId] === dateStr) {
                            cellClass = 'gantt-cell p5 confirmed'; // ì§™ì€ ë§ˆì  íƒ€ - ì‹¤ì œ ë°°ì†¡ì¼
                        }
                        
                        // ìš´ì†¡ì°¨ìˆ˜ì¼ì •ì´ ìˆëŠ” ê²½ìš° í˜„ì¥ë°°ì†¡(p5)ìœ¼ë¡œ ë§ˆí¬ (ì‹¤ì œ ë°°ì†¡ì¼ì´ ì•„ë‹Œ ê²½ìš°ë§Œ)
                        // dailyDataì— ê¸°ë¡ì´ ì—†ê³  ì‹¤ì œ ë°°ì†¡ì¼ë„ ì•„ë‹ ë•Œë§Œ ìš´ì†¡ê³„íš í™•ì¸
                        if (!cellClass) {
                            // transportPlanì—ì„œ í•´ë‹¹ ê¸°ë‘¥ì˜ ìš´ì†¡ë‚ ì§œ í™•ì¸
                            if (transportPlan && typeof transportPlan === 'object' && Object.keys(transportPlan).length > 0) {
                                for (let tripNum in transportPlan) {
                                    const tripData = transportPlan[tripNum];
                                    if (tripData && typeof tripData === 'object') {
                                        const columns = tripData.columns;
                                        const date = tripData.date;
                                        
                                        // ê¸°ë‘¥ì´ í•´ë‹¹ ì°¨ìˆ˜ì— í¬í•¨ë˜ì–´ ìˆê³ , ë‚ ì§œê°€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
                                        if (columns && Array.isArray(columns) && date && date.trim() !== '' && date === dateStr) {
                                            // columns ë°°ì—´ì— ìˆ«ìë¡œ ë³€í™˜í•œ ê°’ì´ ìˆëŠ”ì§€ í™•ì¸
                                            const columnIndex = columns.findIndex(col => Number(col) === Number(c));
                                            if (columnIndex !== -1) {
                                                // ì‹¤ì œ ë°°ì†¡ ë‚ ì§œê°€ ì•„ë‹ˆë©´ ì˜…ì€ ë§ˆì  íƒ€ë¡œ í‘œì‹œ (ìš´ì†¡ê³„íšì¼)
                                                cellClass = 'gantt-cell p5'; // ì˜…ì€ ë§ˆì  íƒ€ - ìš´ì†¡ê³„íšì¼
                                                break;
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        
                        // í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€ (ì‚­ì œ ëª¨ë“œì¼ ë•Œë§Œ)
                        const currentProcessNum = cellClass ? cellClass.match(/p(\d)/)?.[1] || '0' : '0';
                        const clickHandler = deleteMode ? `onclick="handleGanttCellDelete(${c}, '${dateStr}')"` : '';
                        const cursorStyle = deleteMode ? 'cursor:pointer;' : '';
                        const hoverStyle = deleteMode ? 'transition:background-color 0.2s;' : '';
                        
                        bodyHtml += `<td class="${isWeekend ? 'weekend' : ''}" ${clickHandler} style="${cursorStyle}${hoverStyle}" onmouseover="${deleteMode ? 'this.style.backgroundColor=\'#ffebee\'' : ''}" onmouseout="${deleteMode ? 'this.style.backgroundColor=\'\'' : ''}">`;
                        if (cellClass) {
                            // ì£¼ê¸°ë‘¥ì»¤íŒ…(1)ê³¼ ì†Œë¶€ì¬ê°€ê³µ(2)ì´ ëª¨ë‘ ìˆëŠ” ê²½ìš° ë‘ ê°œì˜ divë¡œ ë¶„í•  í‘œì‹œ
                            if (cellClass === 'gantt-cell both') {
                                bodyHtml += `<div style="display:flex;width:100%;height:20px;border-radius:0;">`;
                                bodyHtml += `<div class="gantt-cell p1" style="flex:1;height:20px;min-width:0;"></div>`;
                                bodyHtml += `<div class="gantt-cell p2" style="flex:1;height:20px;min-width:0;"></div>`;
                                bodyHtml += `</div>`;
                            } else {
                                // ì‹¤ì œ ë°°ì†¡ ë‚ ì§œì¸ ê²½ìš° "O" í…ìŠ¤íŠ¸ í‘œì‹œ
                                const isActualDelivery = cellClass === 'gantt-cell p5 confirmed';
                                const cellText = isActualDelivery ? 'O' : '';
                                bodyHtml += `<div class="${cellClass}" style="${isActualDelivery ? 'display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:bold;color:#fff;' : ''}">${cellText}</div>`;
                            }
                        }
                        bodyHtml += '</td>';
                    }
                });
                
                bodyHtml += '</tr>';
            }
            bodyHtml += '</tbody>';
            
            table.innerHTML = headerHtml + bodyHtml;
        }

        // Render Charts
        function renderCharts() {
            renderProgressChart();
            renderCompanyChart();
        }

        function renderProgressChart() {
            const ctx = document.getElementById('progressChart').getContext('2d');
            
            // Generate date labels and data
            const dates = [];
            const datasets = [];
            const colors = ['#e74c3c', '#ff9800', '#2196f3', '#00bcd4', '#9c27b0', '#4caf50']; // process 5ëŠ” ë§ˆì  íƒ€
            const processNames = ['ì£¼ê¸°ë‘¥ì»¤íŒ…', 'ì†Œë¶€ì¬ê°€ê³µ', 'ì£¼ê¸°ë‘¥ì¡°ë¦½', 'ì†Œë¶€ì¬ì¡°ë¦½', 'í˜„ì¥ë°°ì†¡', 'í˜„ì¥ì„¤ì¹˜'];
            
            let currentDate = new Date(START_DATE);
            while (currentDate <= new Date()) {
                dates.push(currentDate.toISOString().split('T')[0]);
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            // Calculate cumulative data for each process
            for (let p = 1; p <= 6; p++) {
                const data = [];
                let cumulative = 0;
                
                dates.forEach(dateStr => {
                    if (dailyData[dateStr]?.[p]) {
                        cumulative += dailyData[dateStr][p].length;
                    }
                    data.push(cumulative);
                });
                
                datasets.push({
                    label: processNames[p-1],
                    data: data,
                    borderColor: colors[p-1],
                    backgroundColor: colors[p-1] + '20',
                    fill: true,
                    tension: 0.3
                });
            }
            
            if (progressChart) progressChart.destroy();
            
            progressChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates.map(d => d.substring(5)),
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: TOTAL_COLUMNS,
                            title: {
                                display: true,
                                text: 'ì™„ë£Œ ê¸°ë‘¥ ìˆ˜'
                            }
                        }
                    }
                }
            });
        }

        function renderCompanyChart() {
            const ctx = document.getElementById('companyChart').getContext('2d');
            
            // Calculate company progress
            const companyProgress = {
                'yuseok': { p1: 0, p2: 0, p3: 0, p4: 0, p5: 0 },
                'jinhung': { p6: 0 }
            };
            
            for (let c = 1; c <= TOTAL_COLUMNS; c++) {
                const colId = c + 'C';
                const status = columnData[colId]?.status || 0;
                if (status >= 1) companyProgress.yuseok.p1++;
                if (status >= 2) companyProgress.yuseok.p2++;
                if (status >= 3) companyProgress.yuseok.p3++;
                if (status >= 4) companyProgress.yuseok.p4++;
                if (status >= 5) companyProgress.yuseok.p5++;
                if (status >= 6) companyProgress.jinhung.p6++;
            }
            
            if (companyChart) companyChart.destroy();
            
            companyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['ìœ ì„ì² ê°•(ì¶©ì£¼)\n(ì»¤íŒ…)', 'ìœ ì„ì² ê°•(ì˜¤ì°½)\n(ì†Œë¶€ì¬)', 'ìœ ì„ì² ê°•(ìŒì„±)\n(ì¡°ë¦½)', 'ìœ ì„ì² ê°•(ìŒì„±)\n(ì†Œë¶€ì¬ì¡°ë¦½)', 'ìœ ì„ì² ê°•(ìŒì„±)\n(ë°°ì†¡)', 'ì§„í¥ê¸°ì—…\n(ì„¤ì¹˜)'],
                    datasets: [{
                        label: 'ì™„ë£Œ ê¸°ë‘¥ ìˆ˜',
                        data: [
                            companyProgress.yuseok.p1,
                            companyProgress.yuseok.p2,
                            companyProgress.yuseok.p3,
                            companyProgress.yuseok.p4,
                            companyProgress.yuseok.p5,
                            companyProgress.jinhung.p6
                        ],
                        backgroundColor: ['#e74c3c', '#ff9800', '#2196f3', '#00bcd4', '#9c27b0', '#4caf50'] // process 5ëŠ” ë§ˆì  íƒ€
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: TOTAL_COLUMNS,
                            title: {
                                display: true,
                                text: 'ì™„ë£Œ ê¸°ë‘¥ ìˆ˜'
                            }
                        }
                    }
                }
            });
        }

        // Save/Load Data
        function saveData() {
            // ëª¨ë“  ê³µì •(1-6)ì—ì„œ ì„ íƒëœ ê¸°ë‘¥ë“¤ì„ í•œ ë²ˆì— ì €ì¥
            if (currentProcess && currentProcess >= 1 && currentProcess <= 6 && selectedColumns.length > 0) {
                saveSelectedColumns();
            } else {
                saveToStorage();
            }
        }

        function saveToStorage() {
            try {
                // í•­ìƒ localStorageì— ë¨¼ì € ì €ì¥ (ë°±ì—…)
                localStorage.setItem(kcolKey('steelColumnData'), JSON.stringify(columnData));
                localStorage.setItem(kcolKey('steelColumnDaily'), JSON.stringify(dailyData));
                localStorage.setItem(kcolKey('columnCoordinates'), JSON.stringify(columnCoordinates));
                localStorage.setItem(kcolKey('deliveryConfirmed'), JSON.stringify(deliveryConfirmed));
                localStorage.setItem(kcolKey('actualDeliveryDate'), JSON.stringify(actualDeliveryDate));
                console.log('âœ… localStorage ì €ì¥ ì™„ë£Œ:', { columnData, dailyData, columnCoordinates, deliveryConfirmed, actualDeliveryDate });
                
                if (isFirebaseEnabled && db) {
                    // Firebaseì— ì €ì¥
                    db.ref(kcolRef('columnData')).set(columnData)
                        .then(() => {
                            return db.ref(kcolRef('dailyData')).set(dailyData);
                        })
                        .then(() => {
                            return db.ref(kcolRef('columnCoordinates')).set(columnCoordinates);
                        })
                        .then(() => {
                            return db.ref(kcolRef('deliveryConfirmed')).set(deliveryConfirmed);
                        })
                        .then(() => {
                            return db.ref(kcolRef('actualDeliveryDate')).set(actualDeliveryDate);
                        })
                        .then(() => {
                            console.log('âœ… Firebase ì €ì¥ ì™„ë£Œ');
                        })
                        .catch((error) => {
                            console.error('Firebase ì €ì¥ ì˜¤ë¥˜:', error);
                            // localStorageëŠ” ì´ë¯¸ ì €ì¥ë¨
                        });
                }
            } catch (error) {
                console.error('ì €ì¥ ì˜¤ë¥˜:', error);
                alert('ë°ì´í„° ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }
        
        // ì¢Œí‘œ ì„¤ì • ëª¨ë“œ í† ê¸€
        function toggleCoordinateSetup() {
            try {
                coordinateSetupMode = !coordinateSetupMode;
                const btn = document.getElementById('coordinate-setup-btn');
                const hint = document.getElementById('coordinate-setup-hint');
                const guide = document.getElementById('coordinate-guide');
                
                if (!btn) {
                    console.error('ì¢Œí‘œ ì„¤ì • ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    alert('ì¢Œí‘œ ì„¤ì • ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                console.log('ì¢Œí‘œ ì„¤ì • ëª¨ë“œ:', coordinateSetupMode);
                
                if (coordinateSetupMode) {
                    btn.classList.remove('inactive');
                    btn.classList.add('active');
                    // ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ì˜ background ì œê±°í•˜ì—¬ í´ë˜ìŠ¤ê°€ ì ìš©ë˜ë„ë¡
                    btn.style.background = '';
                    btn.style.backgroundColor = '';
                    btn.textContent = 'âœ… ì¢Œí‘œ ì„¤ì • ëª¨ë“œ (í™œì„±)';
                    if (hint) hint.style.display = 'inline';
                    if (guide) guide.style.display = 'block';
                    currentColumnForSetup = null;
                    console.log('ì¢Œí‘œ ì„¤ì • ëª¨ë“œ í™œì„±í™”ë¨', btn.className);
                } else {
                    btn.classList.remove('active');
                    btn.classList.add('inactive');
                    // ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ì˜ background ì œê±°í•˜ì—¬ í´ë˜ìŠ¤ê°€ ì ìš©ë˜ë„ë¡
                    btn.style.background = '';
                    btn.style.backgroundColor = '';
                    btn.textContent = 'ğŸ“ ì¢Œí‘œ ì„¤ì • ëª¨ë“œ';
                    if (hint) hint.style.display = 'none';
                    if (guide) guide.style.display = 'none';
                    currentColumnForSetup = null;
                    console.log('ì¢Œí‘œ ì„¤ì • ëª¨ë“œ ë¹„í™œì„±í™”ë¨', btn.className);
                }
                
                // í™”ë©´ ì—…ë°ì´íŠ¸
                renderInstallationStatus();
            } catch (error) {
                console.error('ì¢Œí‘œ ì„¤ì • ëª¨ë“œ í† ê¸€ ì˜¤ë¥˜:', error);
                alert('ì¢Œí‘œ ì„¤ì • ëª¨ë“œ ì „í™˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }
        
        // ë°°ì†¡í™•ì¸ í† ê¸€ í•¨ìˆ˜
        function toggleDeliveryConfirmation(columnId) {
            // ìš´ì†¡ì°¨ìˆ˜ê³„íšì— ìˆëŠ” ê¸°ë‘¥ë§Œ ë°°ì†¡í™•ì¸ ê°€ëŠ¥
            let hasTransportPlan = false;
            for (let date in dailyData) {
                if (dailyData[date] && dailyData[date][5]) {
                    const colNum = typeof columnId === 'string' ? parseInt(columnId.replace('C', '')) : columnId;
                    if (dailyData[date][5].includes(columnId) || 
                        dailyData[date][5].includes(colNum) || 
                        dailyData[date][5].includes(String(colNum))) {
                        hasTransportPlan = true;
                        break;
                    }
                }
            }
            
            if (!hasTransportPlan) {
                alert('ìš´ì†¡ì°¨ìˆ˜ê³„íšì— ë“±ë¡ëœ ê¸°ë‘¥ë§Œ ë°°ì†¡í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ë°°ì†¡í™•ì¸ ìƒíƒœ í† ê¸€ ë° ì‹¤ì œ ë°°ì†¡ ë‚ ì§œ ì €ì¥
            if (deliveryConfirmed[columnId]) {
                delete deliveryConfirmed[columnId];
                delete actualDeliveryDate[columnId];
                alert(`${columnId} ë°°ì†¡í™•ì¸ì„ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤.`);
                // í™”ë©´ ì—…ë°ì´íŠ¸ (ìš´ì†¡ ë‚ ì§œ ì œê±°ë¥¼ ìœ„í•´)
                renderColumnGrid('column-grid-input');
                saveToStorage();
            } else {
                // ì‹¤ì œ ë°°ì†¡ ë‚ ì§œ ì…ë ¥ ë°›ê¸°
                const today = new Date();
                const todayStr = today.toISOString().split('T')[0];
                const workDate = document.getElementById('work-date')?.value || todayStr;
                
                const deliveryDate = prompt(`${columnId}ì˜ ì‹¤ì œ ë°°ì†¡ ë‚ ì§œë¥¼ ì…ë ¥í•˜ì„¸ìš”.\n(YYYY-MM-DD í˜•ì‹, ê¸°ë³¸ê°’: ${workDate})`, workDate);
                
                if (deliveryDate && deliveryDate.trim() !== '') {
                    // ë‚ ì§œ í˜•ì‹ ê²€ì¦
                    const dateRegex = /^\d{4}-\d{2}-\d{2}$/;
                    if (dateRegex.test(deliveryDate.trim())) {
                        deliveryConfirmed[columnId] = true;
                        actualDeliveryDate[columnId] = deliveryDate.trim();
                        alert(`${columnId} ë°°ì†¡í™•ì¸ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤.\nì‹¤ì œ ë°°ì†¡ì¼: ${deliveryDate.trim()}`);
                    } else {
                        alert('ë‚ ì§œ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. (YYYY-MM-DD í˜•ì‹)');
                        return;
                    }
                } else {
                    // ì·¨ì†Œí•œ ê²½ìš°
                    return;
                }
            }
            
            // ì €ì¥ ë° í™”ë©´ ì—…ë°ì´íŠ¸
            saveToStorage();
            renderColumnGrid('column-grid-input');
            renderGanttChart();
        }
        
        // í‰ë©´ë„ ì´ë¯¸ì§€ í´ë¦­ í•¸ë“¤ëŸ¬
        function handleFloorPlanClick(event) {
            if (!coordinateSetupMode) return;
            
            const floorPlanImage = document.getElementById('installation-floor-plan-image');
            if (!floorPlanImage) return;
            
            const rect = floorPlanImage.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            const leftPercent = (x / rect.width) * 100;
            const topPercent = (y / rect.height) * 100;
            
            // ê¸°ë‘¥ ë²ˆí˜¸ ëª©ë¡ì—ì„œ ì„ íƒëœ ê¸°ë‘¥ì´ ì—†ìœ¼ë©´ ì•ˆë‚´
            if (!currentColumnForSetup) {
                alert('ë¨¼ì € ì˜¤ë¥¸ìª½ ê¸°ë‘¥ ë²ˆí˜¸ ëª©ë¡ì—ì„œ ì¢Œí‘œë¥¼ ì„¤ì •í•  ê¸°ë‘¥ì„ í´ë¦­í•˜ì„¸ìš”.');
                return;
            }
            
            // ê¸°ì¡´ ì¢Œí‘œ í™•ì¸
            const existingCoord = columnCoordinates[currentColumnForSetup];
            const newCoord = {
                left: leftPercent,
                top: topPercent
            };
            
            // ì¢Œí‘œê°€ ë³€ê²½ë˜ì—ˆëŠ”ì§€ í™•ì¸ (ì†Œìˆ˜ì  1ìë¦¬ê¹Œì§€ ë¹„êµ)
            const isChanged = !existingCoord || 
                Math.abs(existingCoord.left - newCoord.left) > 0.1 || 
                Math.abs(existingCoord.top - newCoord.top) > 0.1;
            
            if (isChanged) {
                // ì¢Œí‘œ ì €ì¥
                columnCoordinates[currentColumnForSetup] = newCoord;
                
                // localStorageì— ì €ì¥
                localStorage.setItem(kcolKey('columnCoordinates'), JSON.stringify(columnCoordinates));
                
                alert(`${currentColumnForSetup}ì˜ ì¢Œí‘œê°€ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤. (${leftPercent.toFixed(1)}%, ${topPercent.toFixed(1)}%)`);
                
                // í™”ë©´ ì—…ë°ì´íŠ¸
                renderInstallationStatus();
            } else {
                alert(`${currentColumnForSetup}ì˜ ì¢Œí‘œê°€ ë³€ê²½ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. (${leftPercent.toFixed(1)}%, ${topPercent.toFixed(1)}%)`);
            }
            
            // ë‹¤ìŒ ê¸°ë‘¥ ì„ íƒ ëŒ€ê¸°
            currentColumnForSetup = null;
        }

        function loadFromLocalStorage() {
            const savedColumnData = localStorage.getItem(kcolKey('steelColumnData'));
            const savedDailyData = localStorage.getItem(kcolKey('steelColumnDaily'));
            const savedTransportPlan = localStorage.getItem(kcolKey('transportPlan'));
            const savedCoordinates = localStorage.getItem(kcolKey('columnCoordinates'));
            const savedDeliveryConfirmed = localStorage.getItem(kcolKey('deliveryConfirmed'));
            
            if (savedColumnData) {
                columnData = JSON.parse(savedColumnData);
            }
            if (savedDailyData) {
                dailyData = JSON.parse(savedDailyData);
            }
            if (savedTransportPlan) {
                transportPlan = JSON.parse(savedTransportPlan);
            } else {
                transportPlan = {};
            }
            if (savedCoordinates) {
                columnCoordinates = JSON.parse(savedCoordinates);
            } else {
                columnCoordinates = {};
            }
            if (savedDeliveryConfirmed) {
                deliveryConfirmed = JSON.parse(savedDeliveryConfirmed);
            } else {
                deliveryConfirmed = {};
            }
            const savedActualDeliveryDate = localStorage.getItem(kcolKey('actualDeliveryDate'));
            if (savedActualDeliveryDate) {
                actualDeliveryDate = JSON.parse(savedActualDeliveryDate);
            } else {
                actualDeliveryDate = {};
            }
            
            // ìš´ì†¡ì°¨ìˆ˜ê³„íšì„ dailyDataì˜ í˜„ì¥ë°°ì†¡(process 5)ì— ë™ê¸°í™”
            // ì´ˆê¸° ë¡œë“œì´ë¯€ë¡œ í™•ì¸ ì—†ì´ ìë™ ë™ê¸°í™”
            syncTransportToDailyData(false);
        }

        function exportData() {
            const exportObj = {
                columnData: columnData,
                dailyData: dailyData,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(exportObj, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `kcolumn-data-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            
            URL.revokeObjectURL(url);
        }

        // JSON íŒŒì¼ ê°€ì ¸ì˜¤ê¸°
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    columnData = data.columnData || {};
                    dailyData = data.dailyData || {};
                    saveToStorage();
                    renderColumnGrid('column-grid-overview');
                    renderColumnGrid('column-grid-input');
                    updateProgressBars();
                    alert('ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.');
                } catch (error) {
                    alert('íŒŒì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                }
            };
            reader.readAsText(file);
        }

        function loadDayData() {
            const workDate = document.getElementById('work-date').value;
            
            // íœ´ë¬´ì¼ ì²´í¬
            if (isHoliday(workDate)) {
                const holidayName = getHolidayName(workDate);
                showConnectionStatus(`ğŸ”´ ${workDate}: ${holidayName} - ì‘ì—… ì…ë ¥ ë¶ˆê°€`);
            }
            
            // ì¤‘ë³µ í™•ì¸
            checkDuplicateForDate(workDate);
            
            renderColumnGrid('column-grid-input');
        }
        
        // íŠ¹ì • ë‚ ì§œì˜ ì¤‘ë³µ ì…ë ¥ í™•ì¸
        function checkDuplicateForDate(dateStr) {
            if (!dateStr || !dailyData[dateStr]) {
                const duplicateWarning = document.getElementById('duplicate-warning');
                if (duplicateWarning) {
                    duplicateWarning.style.display = 'none';
                }
                return;
            }
            
            const duplicates = [];
            const processNames = ['', 'ì£¼ê¸°ë‘¥ì»¤íŒ…', 'ì†Œë¶€ì¬ê°€ê³µ', 'ì£¼ê¸°ë‘¥ì¡°ë¦½', 'ì†Œë¶€ì¬ì¡°ë¦½', 'í˜„ì¥ë°°ì†¡', 'í˜„ì¥ì„¤ì¹˜'];
            
            // ëª¨ë“  ê¸°ë‘¥ì— ëŒ€í•´ ì¤‘ë³µ í™•ì¸
            for (let i = 1; i <= TOTAL_COLUMNS; i++) {
                const colId = i + 'C';
                const completedProcesses = [];
                
                for (let p = 1; p <= 6; p++) {
                    const dayData = dailyData[dateStr][p];
                    if (dayData && (dayData.includes(i) || dayData.includes(colId))) {
                        completedProcesses.push(p);
                    }
                }
                
                // ê°™ì€ ë‚ ì§œì— ì—¬ëŸ¬ ê³µì •ì´ ì™„ë£Œëœ ê²½ìš°
                // ë‹¨, ì£¼ê¸°ë‘¥ì»¤íŒ…(1)ê³¼ ì†Œë¶€ì¬ê°€ê³µ(2)ì€ ì¤‘ë³µ í—ˆìš©
                const isAllowedDuplicate = completedProcesses.length === 2 && 
                    completedProcesses.includes(1) && 
                    completedProcesses.includes(2);
                
                if (completedProcesses.length > 1 && !isAllowedDuplicate) {
                    const processList = completedProcesses.map(p => `${p}.${processNames[p]}`).join(', ');
                    duplicates.push(`${colId}: ${processList}`);
                }
            }
            
            // ì¤‘ë³µì´ ìˆìœ¼ë©´ ê²½ê³  í‘œì‹œ
            const duplicateWarning = document.getElementById('duplicate-warning');
            const duplicateWarningContent = document.getElementById('duplicate-warning-content');
            if (duplicateWarning && duplicateWarningContent) {
                if (duplicates.length > 0) {
                    duplicateWarning.style.display = 'block';
                    duplicateWarningContent.innerHTML = `âš ï¸ <strong>ì¤‘ë³µì…ë ¥</strong>: ${dateStr}<br>${duplicates.join('<br>')}`;
                } else {
                    duplicateWarning.style.display = 'none';
                }
            }
        }
        
        // ì¤‘ë³µëœ í•­ëª© ëª¨ë‘ ì‚­ì œ
        function deleteAllDuplicates() {
            const workDate = document.getElementById('work-date')?.value;
            if (!workDate) {
                alert('ì‘ì—…ì¼ìë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!dailyData[workDate]) {
                alert('í•´ë‹¹ ë‚ ì§œì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ì¤‘ë³µëœ í•­ëª© ì°¾ê¸°
            const duplicates = [];
            const processNames = ['', 'ì£¼ê¸°ë‘¥ì»¤íŒ…', 'ì†Œë¶€ì¬ê°€ê³µ', 'ì£¼ê¸°ë‘¥ì¡°ë¦½', 'ì†Œë¶€ì¬ì¡°ë¦½', 'í˜„ì¥ë°°ì†¡', 'í˜„ì¥ì„¤ì¹˜'];
            
            for (let i = 1; i <= TOTAL_COLUMNS; i++) {
                const colId = i + 'C';
                const completedProcesses = [];
                
                for (let p = 1; p <= 6; p++) {
                    const dayData = dailyData[workDate][p];
                    if (dayData && (dayData.includes(i) || dayData.includes(colId))) {
                        completedProcesses.push(p);
                    }
                }
                
                // ê°™ì€ ë‚ ì§œì— ì—¬ëŸ¬ ê³µì •ì´ ì™„ë£Œëœ ê²½ìš°
                if (completedProcesses.length > 1) {
                    duplicates.push({
                        columnId: colId,
                        columnNum: i,
                        processes: completedProcesses
                    });
                }
            }
            
            if (duplicates.length === 0) {
                alert('ì¤‘ë³µëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const processList = duplicates.map(d => {
                const processNames = ['', 'ì£¼ê¸°ë‘¥ì»¤íŒ…', 'ì†Œë¶€ì¬ê°€ê³µ', 'ì£¼ê¸°ë‘¥ì¡°ë¦½', 'ì†Œë¶€ì¬ì¡°ë¦½', 'í˜„ì¥ë°°ì†¡', 'í˜„ì¥ì„¤ì¹˜'];
                const processList = d.processes.map(p => `${p}.${processNames[p]}`).join(', ');
                return `${d.columnId}: ${processList}`;
            }).join('\n');
            
            if (confirm(`ë‹¤ìŒ ì¤‘ë³µ í•­ëª©ë“¤ì„ ëª¨ë‘ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n${processList}\n\nâš ï¸ ì£¼ì˜: ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
                // ì¤‘ë³µëœ í•­ëª© ì‚­ì œ (ê°€ì¥ ë†’ì€ ê³µì •ë§Œ ë‚¨ê¸°ê³  ë‚˜ë¨¸ì§€ ì‚­ì œ)
                duplicates.forEach(dup => {
                    // ê°€ì¥ ë†’ì€ ê³µì • ë²ˆí˜¸ ì°¾ê¸°
                    const maxProcess = Math.max(...dup.processes);
                    
                    // ê°€ì¥ ë†’ì€ ê³µì •ì„ ì œì™¸í•œ ë‚˜ë¨¸ì§€ ì‚­ì œ
                    dup.processes.forEach(p => {
                        if (p !== maxProcess) {
                            if (dailyData[workDate][p]) {
                                dailyData[workDate][p] = dailyData[workDate][p].filter(col => 
                                    col !== dup.columnId && col !== dup.columnNum
                                );
                                // ë¹ˆ ë°°ì—´ì´ë©´ ì‚­ì œ
                                if (dailyData[workDate][p].length === 0) {
                                    delete dailyData[workDate][p];
                                }
                            }
                        }
                    });
                    
                    // columnData ì—…ë°ì´íŠ¸
                    if (columnData[dup.columnId]) {
                        columnData[dup.columnId].status = maxProcess;
                        columnData[dup.columnId].lastUpdate = workDate;
                    }
                });
                
                // ì €ì¥
                saveToStorage();
                
                // í™”ë©´ ì—…ë°ì´íŠ¸
                renderGanttChart();
                renderColumnGrid('column-grid-overview');
                renderColumnGrid('column-grid-input');
                updateProgressBars();
                
                // ì¤‘ë³µ í™•ì¸ ë‹¤ì‹œ ì‹¤í–‰
                checkDuplicateForDate(workDate);
                
                alert(`${duplicates.length}ê°œì˜ ì¤‘ë³µ í•­ëª©ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤. (ê°€ì¥ ë†’ì€ ê³µì •ë§Œ ìœ ì§€)`);
            }
        }

        // ========== ìš´ì†¡ì°¨ìˆ˜ê³„íš ê´€ë ¨ í•¨ìˆ˜ ==========
        
        // ìš´ì†¡ê³„íš ë¡œë“œ
        function loadTransportPlan() {
            const saved = localStorage.getItem(kcolKey('transportPlan')) || localStorage.getItem('transportPlan');
            if (saved) {
                const data = JSON.parse(saved);
                // ê¸°ì¡´ í˜•ì‹ ë§ˆì´ê·¸ë ˆì´ì…˜ (ë°°ì—´ í˜•ì‹ -> ê°ì²´ í˜•ì‹)
                transportPlan = {};
                for (let tripNum in data) {
                    if (Array.isArray(data[tripNum])) {
                        // ê¸°ì¡´ í˜•ì‹: { 1: [1,2,3] }
                        transportPlan[tripNum] = {
                            columns: data[tripNum],
                            date: ''
                        };
                    } else {
                        // ìƒˆ í˜•ì‹: { 1: { columns: [1,2,3], date: '2025-01-15' } }
                        transportPlan[tripNum] = data[tripNum];
                    }
                }
            } else {
                transportPlan = {};
            }
            
            // ìš´ì†¡ì°¨ìˆ˜ê³„íšì„ dailyDataì˜ í˜„ì¥ë°°ì†¡(process 5)ì— ë™ê¸°í™”
            // ì´ˆê¸° ë¡œë“œì´ë¯€ë¡œ í™•ì¸ ì—†ì´ ìë™ ë™ê¸°í™”
            syncTransportToDailyData(false);
        }

        // ì°¨ìˆ˜ ë²„íŠ¼ ë Œë”ë§
        function renderTransportTrips() {
            const container = document.getElementById('transport-trips-list');
            container.innerHTML = '';
            
            const trips = Object.keys(transportPlan).map(Number).sort((a, b) => a - b);
            if (trips.length === 0) {
                trips.push(1);
                transportPlan[1] = { columns: [], date: '' };
            }
            
            trips.forEach(tripNum => {
                const btn = document.createElement('button');
                btn.className = 'action-btn' + (currentTransportTrip === tripNum ? ' primary' : ' secondary');
                const tripData = transportPlan[tripNum] || { columns: [], date: '' };
                const columnCount = tripData.columns?.length || 0;
                
                // ì°¨ìˆ˜ë³„ ì´ ë¬¼ëŸ‰ ê³„ì‚°
                let totalWeight = 0;
                if (tripData.columns && tripData.columns.length > 0) {
                    tripData.columns.forEach(columnId => {
                        totalWeight += calculateColumnWeight(columnId);
                    });
                }
                const weightStr = totalWeight > 0 ? `${totalWeight.toFixed(2)}í†¤` : '0í†¤';
                
                const dateStr = tripData.date ? tripData.date : '';
                btn.textContent = `${tripNum}ì°¨ìˆ˜ (${columnCount}ê°œ, ${weightStr}, ${dateStr})`;
                btn.type = 'button'; // í¼ ì œì¶œ ë°©ì§€
                btn.style.cursor = 'pointer';
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    selectTransportTrip(tripNum);
                });
                container.appendChild(btn);
            });
            
            if (currentTransportTrip && !transportPlan[currentTransportTrip]) {
                transportPlan[currentTransportTrip] = { columns: [], date: '' };
            }
            
            updateTransportTripInfo();
        }

        // ì°¨ìˆ˜ ì¶”ê°€
        function addTransportTrip() {
            const input = document.getElementById('transport-trip-input');
            const tripNum = parseInt(input.value) || 1;
            
            if (!transportPlan[tripNum]) {
                transportPlan[tripNum] = { columns: [], date: '' };
                selectTransportTrip(tripNum);
                renderTransportTrips();
                // ìš´ì†¡ì°¨ìˆ˜ê³„íš ë³€ê²½ ì‹œ í˜„ì¥ë°°ì†¡(process 5)ì— ë™ê¸°í™”
                // í™•ì¸ ì—†ì´ ìë™ ë™ê¸°í™” (ì €ì¥ ë²„íŠ¼ í´ë¦­ ì‹œì—ë§Œ í™•ì¸)
                syncTransportToDailyData(false);
                saveTransportPlan();
            } else {
                alert(`${tripNum}ì°¨ìˆ˜ëŠ” ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤.`);
            }
        }

        // ì°¨ìˆ˜ ì‚­ì œ
        function removeTransportTrip() {
            const trips = Object.keys(transportPlan).map(Number).sort((a, b) => a - b);
            if (trips.length <= 1) {
                alert('ìµœì†Œ 1ê°œì˜ ì°¨ìˆ˜ëŠ” ìœ ì§€í•´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            if (confirm(`${currentTransportTrip}ì°¨ìˆ˜ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\ní•´ë‹¹ ì°¨ìˆ˜ì˜ í˜„ì¥ë°°ì†¡ ë°ì´í„°ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.`)) {
                delete transportPlan[currentTransportTrip];
                
                // ë‹¤ë¥¸ ì°¨ìˆ˜ ì„ íƒ
                const remaining = Object.keys(transportPlan).map(Number).sort((a, b) => a - b);
                currentTransportTrip = remaining[0];
                
                renderTransportTrips();
                renderTransportColumnGrid();
                // ìš´ì†¡ì°¨ìˆ˜ê³„íš ë³€ê²½ ì‹œ í˜„ì¥ë°°ì†¡(process 5)ì— ë™ê¸°í™” (ì‚­ì œëœ ì°¨ìˆ˜ì˜ ê¸°ë‘¥ë“¤ë„ ì œê±°ë¨)
                // í™•ì¸ ì—†ì´ ìë™ ë™ê¸°í™” (ì €ì¥ ë²„íŠ¼ í´ë¦­ ì‹œì—ë§Œ í™•ì¸)
                syncTransportToDailyData(false);
                // í™”ë©´ ì—…ë°ì´íŠ¸
                renderGanttChart();
                renderColumnGrid('column-grid-overview');
                renderColumnGrid('column-grid-input');
                updateProgressBars();
                saveTransportPlan();
            }
        }

        // ì°¨ìˆ˜ ì„ íƒ
        function selectTransportTrip(tripNum) {
            try {
                currentTransportTrip = parseInt(tripNum) || 1;
                if (!transportPlan[currentTransportTrip]) {
                    transportPlan[currentTransportTrip] = { columns: [], date: '' };
                }
                // ì°¨ìˆ˜ ìˆ˜ì • ì…ë ¥ í•„ë“œ ì—…ë°ì´íŠ¸
                const editInput = document.getElementById('transport-trip-edit-input');
                if (editInput) {
                    editInput.value = currentTransportTrip;
                }
                renderTransportTrips();
                renderTransportColumnGrid();
                updateTransportTripInfo();
                // ì°¨ìˆ˜ ì„ íƒì€ ë°ì´í„° ë³€ê²½ì´ ì•„ë‹ˆë¯€ë¡œ ë™ê¸°í™” ë¶ˆí•„ìš”, ì €ì¥ë§Œ ìˆ˜í–‰
                saveTransportPlan(); // ìƒíƒœ ì €ì¥
            } catch (error) {
                console.error('Error in selectTransportTrip:', error);
                alert('ì°¨ìˆ˜ ì„ íƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ì°¨ìˆ˜ ë²ˆí˜¸ ìˆ˜ì •
        function editTransportTrip() {
            const editInput = document.getElementById('transport-trip-edit-input');
            const newTripNum = parseInt(editInput.value) || 1;
            const oldTripNum = currentTransportTrip;
            
            if (newTripNum === oldTripNum) {
                alert('ë™ì¼í•œ ì°¨ìˆ˜ ë²ˆí˜¸ì…ë‹ˆë‹¤.');
                return;
            }
            
            if (newTripNum < 1) {
                alert('ì°¨ìˆ˜ ë²ˆí˜¸ëŠ” 1 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            // ìƒˆ ì°¨ìˆ˜ ë²ˆí˜¸ê°€ ì´ë¯¸ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
            if (transportPlan[newTripNum]) {
                if (!confirm(`${newTripNum}ì°¨ìˆ˜ê°€ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤. ê¸°ì¡´ ë°ì´í„°ë¥¼ ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                    return;
                }
            }
            
            // ê¸°ì¡´ ì°¨ìˆ˜ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const oldTripData = transportPlan[oldTripNum] || { columns: [], date: '' };
            
            // ìƒˆ ì°¨ìˆ˜ ë²ˆí˜¸ë¡œ ë°ì´í„° ì´ë™
            transportPlan[newTripNum] = {
                columns: [...(oldTripData.columns || [])],
                date: oldTripData.date || ''
            };
            
            // ê¸°ì¡´ ì°¨ìˆ˜ ì‚­ì œ
            delete transportPlan[oldTripNum];
            
            // ìƒˆ ì°¨ìˆ˜ ì„ íƒ
            currentTransportTrip = newTripNum;
            
            // UI ì—…ë°ì´íŠ¸
            renderTransportTrips();
            renderTransportColumnGrid();
            updateTransportTripInfo();
            
            // ìš´ì†¡ì°¨ìˆ˜ê³„íš ë³€ê²½ ì‹œ í˜„ì¥ë°°ì†¡(process 5)ì— ë™ê¸°í™” (ì°¨ìˆ˜ ë²ˆí˜¸ ë³€ê²½ ë°˜ì˜)
            // í™•ì¸ ì—†ì´ ìë™ ë™ê¸°í™” (ì €ì¥ ë²„íŠ¼ í´ë¦­ ì‹œì—ë§Œ í™•ì¸)
            syncTransportToDailyData(false);
            // í™”ë©´ ì—…ë°ì´íŠ¸
            renderGanttChart();
            renderColumnGrid('column-grid-overview');
            renderColumnGrid('column-grid-input');
            updateProgressBars();
            
            saveTransportPlan();
            
            alert(`âœ… ${oldTripNum}ì°¨ìˆ˜ê°€ ${newTripNum}ì°¨ìˆ˜ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.\n\ní˜„ì¥ë°°ì†¡ ë°ì´í„°ë„ ë™ì¼í•˜ê²Œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }

        // ì°¨ìˆ˜ ì •ë³´ ì—…ë°ì´íŠ¸
        function updateTransportTripInfo() {
            document.getElementById('current-trip-number').textContent = currentTransportTrip;
            const tripData = transportPlan[currentTransportTrip] || { columns: [], date: '' };
            const count = tripData.columns?.length || 0;
            document.getElementById('selected-columns-count').textContent = count;
            
            // ì´ ë¬¼ëŸ‰ ê³„ì‚°
            let totalWeight = 0;
            if (tripData.columns && tripData.columns.length > 0) {
                tripData.columns.forEach(columnId => {
                    totalWeight += calculateColumnWeight(columnId);
                });
            }
            const weightEl = document.getElementById('selected-columns-weight');
            if (weightEl) {
                weightEl.textContent = totalWeight > 0 ? `${totalWeight.toFixed(2)}í†¤` : '0í†¤';
            }
            
            // ë‚ ì§œ ì…ë ¥ í•„ë“œ ì—…ë°ì´íŠ¸
            const dateInput = document.getElementById('transport-trip-date');
            if (dateInput) {
                dateInput.value = tripData.date || '';
            }
        }

        // ì°¨ìˆ˜ ìš´ì†¡ë‚ ì§œ ì—…ë°ì´íŠ¸
        function updateTransportTripDate() {
            const dateInput = document.getElementById('transport-trip-date');
            const date = dateInput.value;
            
            if (!transportPlan[currentTransportTrip]) {
                transportPlan[currentTransportTrip] = { columns: [], date: '' };
            }
            
            transportPlan[currentTransportTrip].date = date;
            renderTransportTrips(); // ë²„íŠ¼ì— ë‚ ì§œ í‘œì‹œ ì—…ë°ì´íŠ¸
            renderTransportColumnGrid(); // ê¸°ë‘¥ cellì— ë‚ ì§œ í‘œì‹œ ì—…ë°ì´íŠ¸
            
            // ìš´ì†¡ë‚ ì§œ ë³€ê²½ ì‹œ ìë™ìœ¼ë¡œ í˜„ì¥ë°°ì†¡(process 5)ì— ë™ê¸°í™”
            // í™•ì¸ ì—†ì´ ìë™ ë™ê¸°í™” (ì €ì¥ ë²„íŠ¼ í´ë¦­ ì‹œì—ë§Œ í™•ì¸)
            if (date && date.trim() !== '') {
                syncTransportToDailyData(false);
                // í™”ë©´ ì—…ë°ì´íŠ¸
                renderGanttChart();
                renderColumnGrid('column-grid-overview');
                renderColumnGrid('column-grid-input');
                updateProgressBars();
            }
            
            saveTransportPlan();
        }

        // ê¸°ë‘¥ ë¬¼ëŸ‰ ê³„ì‚° í•¨ìˆ˜ (í†¤)
        function calculateColumnWeight(columnId) {
            if (!transportVolumeData || transportVolumeData.length === 0) {
                return 0;
            }
            
            // ìš´ì†¡ë¬¼ëŸ‰ì‚°ì • ë°ì´í„°ì—ì„œ í•´ë‹¹ ê¸°ë‘¥ ì°¾ê¸°
            const colData = transportVolumeData.find(item => {
                const itemNo = parseInt(item.no) || 0;
                return itemNo === columnId;
            });
            
            if (!colData) {
                return 0;
            }
            
            // ì†Œë¶€ì¬ ì˜ˆìƒë¬¼ëŸ‰ì´ ìˆìœ¼ë©´ ìš°ì„  ì‚¬ìš© (kg ë‹¨ìœ„ ê°€ì •)
            if (colData.sub && !isNaN(parseFloat(colData.sub))) {
                const subWeight = parseFloat(colData.sub);
                return subWeight / 1000; // kgì„ í†¤ìœ¼ë¡œ ë³€í™˜
            }
            
            // ì†Œë¶€ì¬ ì˜ˆìƒë¬¼ëŸ‰ì´ ì—†ìœ¼ë©´ ì‚¬ì´ì¦ˆì™€ ê¸¸ì´ë¡œ ê·¼ì‚¬ì¹˜ ê³„ì‚°
            const length = parseFloat(colData.length) || 0; // mm
            if (length === 0) {
                return 0;
            }
            
            // Hí˜•ê°• ë‹¨ìœ„ ì¤‘ëŸ‰ ê·¼ì‚¬ì¹˜ (kg/m) - ì‚¬ì´ì¦ˆë³„ ê¸°ë³¸ê°’
            const sizeStr = String(colData.size || '').toUpperCase();
            let unitWeight = 0; // kg/m
            
            // ì‚¬ì´ì¦ˆì—ì„œ Hê°’ ì¶”ì¶œ (ì˜ˆ: H400x200 -> 400)
            const hMatch = sizeStr.match(/H(\d+)/);
            if (hMatch) {
                const hValue = parseInt(hMatch[1]);
                // Hí˜•ê°• ë‹¨ìœ„ ì¤‘ëŸ‰ ê·¼ì‚¬ì¹˜ (kg/m) - ê·œê²©ë³„ ëŒ€ëµê°’
                if (hValue <= 400) unitWeight = 66;      // H400x200x8x13
                else if (hValue <= 450) unitWeight = 76; // H450x200x9x14
                else if (hValue <= 500) unitWeight = 89; // H500x200x10x16
                else if (hValue <= 600) unitWeight = 106; // H600x200x11x17
                else if (hValue <= 700) unitWeight = 125; // H700x300
                else unitWeight = 150; // ê·¸ ì™¸
            }
            
            if (unitWeight === 0) {
                return 0;
            }
            
            // ë¬´ê²Œ ê³„ì‚°: ë‹¨ìœ„ ì¤‘ëŸ‰(kg/m) Ã— ê¸¸ì´(m) = ë¬´ê²Œ(kg)
            const lengthM = length / 1000; // mmë¥¼ më¡œ ë³€í™˜
            const weightKg = unitWeight * lengthM;
            
            // í†¤ìœ¼ë¡œ ë³€í™˜ (kg / 1000)
            return weightKg / 1000;
        }

        // ìš´ì†¡ìš© ê¸°ë‘¥ ê·¸ë¦¬ë“œ ë Œë”ë§
        function renderTransportColumnGrid() {
            const container = document.getElementById('column-grid-transport');
            container.innerHTML = '';
            
            const tripData = transportPlan[currentTransportTrip] || { columns: [], date: '' };
            const selectedColumns = tripData.columns || [];
            
            for (let i = 1; i <= TOTAL_COLUMNS; i++) {
                const div = document.createElement('div');
                div.className = 'column-item';
                
                const isSelected = selectedColumns.includes(i);
                const isDuplicate = duplicateColumns[i] && duplicateColumns[i].length > 1;
                
                // ê¸°ë‘¥ ë²ˆí˜¸ì™€ ìš´ì†¡ì¼ì í‘œì‹œ
                const columnLabel = document.createElement('div');
                columnLabel.textContent = i + 'C';
                columnLabel.style.fontWeight = 'bold';
                columnLabel.style.fontSize = '14px';
                div.appendChild(columnLabel);
                
                // ì„ íƒëœ ê¸°ë‘¥ì¸ ê²½ìš° ìš´ì†¡ì¼ìì™€ ë¬¼ëŸ‰ í‘œì‹œ
                if (isSelected) {
                    // ìš´ì†¡ì¼ì í‘œì‹œ
                    if (tripData.date) {
                        const dateLabel = document.createElement('div');
                        const dateObj = new Date(tripData.date);
                        const formattedDate = `${dateObj.getMonth() + 1}/${dateObj.getDate()}`;
                        dateLabel.textContent = formattedDate;
                        dateLabel.style.fontSize = '11px';
                        dateLabel.style.marginTop = '4px';
                        dateLabel.style.opacity = '0.9';
                        div.appendChild(dateLabel);
                    }
                    
                    // ë¬¼ëŸ‰(í†¤) í‘œì‹œ
                    const weight = calculateColumnWeight(i);
                    const weightLabel = document.createElement('div');
                    weightLabel.textContent = weight > 0 ? `${weight.toFixed(2)}í†¤` : '0í†¤';
                    weightLabel.style.fontSize = '11px';
                    weightLabel.style.marginTop = '2px';
                    weightLabel.style.opacity = '0.85';
                    weightLabel.style.fontWeight = '600';
                    div.appendChild(weightLabel);
                }
                
                if (isDuplicate) {
                    // ì¤‘ë³µëœ ê¸°ë‘¥: ë¹¨ê°„ìƒ‰ í…Œë‘ë¦¬ì™€ ë°°ê²½
                    div.style.background = '#ffcdd2';
                    div.style.color = '#c62828';
                    div.style.boxShadow = '0 0 0 3px #f44336, 0 0 15px rgba(244,67,54,0.6)';
                    div.style.fontWeight = 'bold';
                    div.style.border = '2px solid #d32f2f';
                    div.style.display = 'flex';
                    div.style.flexDirection = 'column';
                    div.style.alignItems = 'center';
                    div.style.justifyContent = 'center';
                    div.title = `ì¤‘ë³µ: ${duplicateColumns[i].map(t => t + 'ì°¨ìˆ˜').join(', ')}ì— í¬í•¨ë¨`;
                } else if (isSelected) {
                    div.style.background = '#4caf50';
                    div.style.color = 'white';
                    div.style.boxShadow = '0 0 0 3px #66bb6a, 0 0 10px rgba(76,175,80,0.5)';
                    div.style.fontWeight = 'bold';
                    div.style.border = 'none';
                    div.style.display = 'flex';
                    div.style.flexDirection = 'column';
                    div.style.alignItems = 'center';
                    div.style.justifyContent = 'center';
                } else {
                    div.style.background = '#f5f5f5';
                    div.style.color = '#666';
                    div.style.boxShadow = 'none';
                    div.style.border = 'none';
                    div.style.display = 'flex';
                    div.style.alignItems = 'center';
                    div.style.justifyContent = 'center';
                }
                
                div.style.cursor = 'pointer';
                div.style.transition = 'all 0.2s';
                
                div.onmouseenter = function() {
                    if (!isSelected) {
                        this.style.background = '#e8f5e9';
                        this.style.transform = 'scale(1.05)';
                    }
                };
                
                div.onmouseleave = function() {
                    if (!isSelected) {
                        this.style.background = '#f5f5f5';
                        this.style.transform = 'scale(1)';
                    }
                };
                
                div.onclick = () => toggleColumnForTransport(i);
                
                container.appendChild(div);
            }
        }

        // ê¸°ë‘¥ ì„ íƒ/í•´ì œ
        function toggleColumnForTransport(columnId) {
            if (!transportPlan[currentTransportTrip]) {
                transportPlan[currentTransportTrip] = { columns: [], date: '' };
            }
            
            const tripData = transportPlan[currentTransportTrip];
            if (!tripData.columns) {
                tripData.columns = [];
            }
            if (!tripData.date) {
                tripData.date = '';
            }
            
            const index = tripData.columns.indexOf(columnId);
            
            if (index > -1) {
                // ì´ë¯¸ ì„ íƒëœ ê²½ìš° - ë‹¤ë¥¸ ì°¨ìˆ˜ì— ìˆëŠ”ì§€ í™•ì¸
                let inOtherTrip = false;
                for (let trip in transportPlan) {
                    const otherTripData = transportPlan[trip];
                    if (parseInt(trip) !== currentTransportTrip && otherTripData?.columns?.includes(columnId)) {
                        inOtherTrip = true;
                        break;
                    }
                }
                
                if (!inOtherTrip || confirm('ë‹¤ë¥¸ ì°¨ìˆ˜ì—ë„ í¬í•¨ëœ ê¸°ë‘¥ì…ë‹ˆë‹¤. ì´ ì°¨ìˆ˜ì—ì„œë§Œ ì œê±°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    tripData.columns.splice(index, 1);
                }
            } else {
                // ì„ íƒë˜ì§€ ì•Šì€ ê²½ìš° - ë‹¤ë¥¸ ì°¨ìˆ˜ì— ìˆëŠ”ì§€ í™•ì¸
                let inOtherTrip = false;
                let otherTripNum = null;
                for (let trip in transportPlan) {
                    const otherTripData = transportPlan[trip];
                    if (parseInt(trip) !== currentTransportTrip && otherTripData?.columns?.includes(columnId)) {
                        inOtherTrip = true;
                        otherTripNum = trip;
                        break;
                    }
                }
                
                if (inOtherTrip) {
                    if (confirm(`${otherTripNum}ì°¨ìˆ˜ì— ì´ë¯¸ í¬í•¨ëœ ê¸°ë‘¥ì…ë‹ˆë‹¤. ì´ ì°¨ìˆ˜ì—ë„ ì¶”ê°€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                        tripData.columns.push(columnId);
                    }
                } else {
                    tripData.columns.push(columnId);
                }
            }
            
            tripData.columns.sort((a, b) => a - b);
            // ì¤‘ë³µ ì²´í¬ ê²°ê³¼ ì´ˆê¸°í™” (ì„ íƒ ë³€ê²½ ì‹œ)
            duplicateColumns = {};
            document.getElementById('duplicate-check-result').style.display = 'none';
            renderTransportColumnGrid();
            renderTransportTrips();
            updateTransportTripInfo();
            
            // ìš´ì†¡ì°¨ìˆ˜ê³„íš ë³€ê²½ ì‹œ ìë™ìœ¼ë¡œ í˜„ì¥ë°°ì†¡(process 5)ì— ë™ê¸°í™”
            // ê¸°ë‘¥ ì„ íƒ/í•´ì œ ì‹œ í•­ìƒ ë™ê¸°í™” (ë‚ ì§œê°€ ì—†ì–´ë„ ë™ê¸°í™”í•˜ì—¬ ê¸°ì¡´ ë°ì´í„° ì •ë¦¬)
            // í™•ì¸ ì—†ì´ ìë™ ë™ê¸°í™” (ì €ì¥ ë²„íŠ¼ í´ë¦­ ì‹œì—ë§Œ í™•ì¸)
            syncTransportToDailyData(false);
            // í™”ë©´ ì—…ë°ì´íŠ¸
            renderGanttChart();
            renderColumnGrid('column-grid-overview');
            renderColumnGrid('column-grid-input');
            updateProgressBars();
            
            // ìë™ ì €ì¥ (í™•ì¸ ì—†ì´)
            saveTransportPlan();
        }

        // ìš´ì†¡ë¬¼ëŸ‰ì‚°ì •: í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ
        function downloadTransportVolumeTemplate() {
            const headers = ['ê¸°ë‘¥ë²ˆí˜¸', 'ì‚¬ì´ì¦ˆ', 'ê¸¸ì´(mm)', 'ì†Œë¶€ì¬ì˜ˆìƒë¬¼ëŸ‰'];
            const sample = [
                ['1', 'H-400x200x8x13', '12000', 'ì˜ˆ: 3ê°œ'],
                ['2', 'H-350x175x7x11', '11500', 'ì˜ˆ: 2ê°œ']
            ];
            const csv = [headers.join(','), ...sample.map(r => r.join(','))].join('\n');
            const blob = new Blob(["\uFEFF" + csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'transport_volume_template.csv';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        // ìš´ì†¡ë¬¼ëŸ‰ì‚°ì •: í‘œ ë Œë”ë§
        function renderTransportVolumeTable(data = transportVolumeData) {
            const tbody = document.getElementById('transport-volume-tbody');
            if (!tbody) return;
            
            if (!data || data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;color:#888;padding:16px;">ì—‘ì…€ì„ ì—…ë¡œë“œí•˜ë©´ ì—¬ê¸°ì—ì„œ 50ê°œ ê¸°ë‘¥ ë°ì´í„°ê°€ í‘œì‹œë©ë‹ˆë‹¤.</td></tr>';
                return;
            }
            
            const rows = data.slice(0, 50).map(item => {
                const colNo = item.no ?? item.column ?? item.id ?? '';
                return `
                    <tr>
                        <td style="text-align:center;">${colNo || ''}</td>
                        <td>${item.size || ''}</td>
                        <td style="text-align:right;">${item.length || ''}</td>
                        <td>${item.sub || ''}</td>
                    </tr>
                `;
            });
            tbody.innerHTML = rows.join('');
        }

        // í˜„ì¥ì„¤ì¹˜í˜„í™©: ì„¤ì¹˜ ìƒíƒœ ë Œë”ë§
        function renderInstallationStatus() {
            const columnList = document.getElementById('installation-column-list');
            const floorPlanImage = document.getElementById('installation-floor-plan-image');
            const progressSummary = document.getElementById('installation-progress-summary');
            
            if (!columnList || !floorPlanImage) return;
            
            // ê³µì •ìœ¨ ê³„ì‚° ë° í‘œì‹œ
            if (progressSummary) {
                const processNames = ['ì£¼ê¸°ë‘¥ì»¤íŒ…', 'ì†Œë¶€ì¬ê°€ê³µ', 'ì£¼ê¸°ë‘¥ì¡°ë¦½', 'ì†Œë¶€ì¬ì¡°ë¦½', 'í˜„ì¥ë°°ì†¡', 'í˜„ì¥ì„¤ì¹˜'];
                const processColors = ['#e74c3c', '#ff9800', '#2196f3', '#00bcd4', '#9c27b0', '#4caf50'];
                let progressHtml = '';
                
                for (let p = 1; p <= 6; p++) {
                    // dailyDataì—ì„œ ì™„ë£Œëœ ê¸°ë‘¥ ìˆ˜ ê³„ì‚° (ì¤‘ë³µ ì œê±°)
                    const uniqueColumns = new Set();
                    for (let date in dailyData) {
                        if (dailyData[date] && dailyData[date][p]) {
                            dailyData[date][p].forEach(col => {
                                const colId = typeof col === 'string' ? col : (col + 'C');
                                uniqueColumns.add(colId);
                            });
                        }
                    }
                    const completedCount = uniqueColumns.size;
                    const percentage = TOTAL_COLUMNS > 0 ? Math.round((completedCount / TOTAL_COLUMNS) * 100) : 0;
                    
                    progressHtml += `
                        <div style="text-align:center;padding:8px;background:#f8f9fa;border-radius:6px;border:1px solid #e0e0e0;">
                            <div style="font-size:11px;color:#666;margin-bottom:4px;">${processNames[p-1]}</div>
                            <div style="font-size:18px;font-weight:bold;color:${processColors[p-1]};margin-bottom:4px;">${percentage}%</div>
                            <div style="font-size:10px;color:#999;">${completedCount}/${TOTAL_COLUMNS}</div>
                            <div style="margin-top:6px;height:4px;background:#e0e0e0;border-radius:2px;overflow:hidden;">
                                <div style="height:100%;background:${processColors[p-1]};width:${percentage}%;transition:width 0.3s;"></div>
                            </div>
                        </div>
                    `;
                }
                
                progressSummary.innerHTML = progressHtml;
            }
            
            // ê¸°ë‘¥ ë²ˆí˜¸ ëª©ë¡ ìƒì„± (5ì—´ ê·¸ë¦¬ë“œ)
            let html = '';
            const installedColumns = [];
            
            for (let i = 1; i <= TOTAL_COLUMNS; i++) {
                const colId = i + 'C';
                const colData = columnData[colId] || {};
                const status = colData.status || 0;
                
                // ì„¤ì¹˜ ì™„ë£Œ ì—¬ë¶€ í™•ì¸ (ìƒíƒœ 6 = í˜„ì¥ì„¤ì¹˜ ì™„ë£Œ)
                const isInstalled = status === 6;
                const isDelivered = status === 5; // í˜„ì¥ë°°ì†¡ ì™„ë£Œ
                
                // ìƒ‰ìƒ ê²°ì •
                let bgColor = '#f5f5f5'; // ê¸°ë³¸ (ë¯¸ì°©ìˆ˜)
                let textColor = '#666';
                let statusText = 'ë¯¸ì°©ìˆ˜';
                
                if (isInstalled) {
                    bgColor = '#4caf50'; // ì´ˆë¡ìƒ‰ (ì„¤ì¹˜ì™„ë£Œ)
                    textColor = '#fff';
                    statusText = 'ì„¤ì¹˜ì™„ë£Œ';
                    installedColumns.push({ id: colId, num: i });
                } else if (isDelivered) {
                    bgColor = '#fff5ff'; // ì˜…ì€ ë§ˆì  íƒ€ (ë°°ì†¡ê³„íš - ì‹¤ì œ ìš´ì†¡ì´ ì•„ë‹˜)
                    textColor = '#fff';
                    statusText = 'ë°°ì†¡ê³„íš';
                } else if (status > 0) {
                    bgColor = '#ff9800'; // ì£¼í™©ìƒ‰ (ì§„í–‰ì¤‘)
                    textColor = '#fff';
                    statusText = 'ì§„í–‰ì¤‘';
                }
                
                // ì¢Œí‘œ ì„¤ì • ëª¨ë“œì¼ ë•Œ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
                const clickHandler = coordinateSetupMode ? `onclick="currentColumnForSetup='${colId}'; alert('${colId}ì˜ ì¢Œí‘œë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. í‰ë©´ë„ ì´ë¯¸ì§€ë¥¼ í´ë¦­í•˜ì„¸ìš”.');"` : '';
                const cursorStyle = coordinateSetupMode ? 'cursor:pointer;' : '';
                const borderStyle = coordinateSetupMode ? 'border:2px solid #ff9800;' : '';
                
                html += `
                    <div ${clickHandler} style="padding:8px;background:${bgColor};color:${textColor};border-radius:6px;text-align:center;font-size:13px;font-weight:600;min-height:50px;display:flex;flex-direction:column;justify-content:center;${cursorStyle}${borderStyle}">
                        <div>${colId}</div>
                        <div style="font-size:11px;margin-top:4px;opacity:0.9;">${statusText}</div>
                    </div>
                `;
            }
            
            columnList.innerHTML = html;
            
            // í‰ë©´ë„ ì´ë¯¸ì§€ì— ì„¤ì¹˜ëœ ê¸°ë‘¥ ë§ˆì»¤ í‘œì‹œ
            floorPlanImage.innerHTML = '';
            
            // ì¢Œí‘œ ì„¤ì • ëª¨ë“œì¼ ë•Œ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
            if (coordinateSetupMode) {
                floorPlanImage.style.cursor = 'crosshair';
                floorPlanImage.onclick = handleFloorPlanClick;
            } else {
                floorPlanImage.style.cursor = 'default';
                floorPlanImage.onclick = null;
            }
            
            // ëª¨ë“  ê¸°ë‘¥ì— ëŒ€í•œ ë§ˆì»¤ í‘œì‹œ (ì„¤ì¹˜ ì™„ë£Œ ì—¬ë¶€ì™€ ê´€ê³„ì—†ì´ ì¢Œí‘œê°€ ìˆìœ¼ë©´ í‘œì‹œ)
            for (let i = 1; i <= TOTAL_COLUMNS; i++) {
                const colId = i + 'C';
                const colData = columnData[colId] || {};
                const status = colData.status || 0;
                
                // dailyDataì—ì„œ process 6 ì™„ë£Œ ì—¬ë¶€ í™•ì¸ (ëª¨ë“  ë‚ ì§œ í™•ì¸)
                let isInstalled = status === 6;
                if (!isInstalled) {
                    for (let date in dailyData) {
                        if (dailyData[date] && dailyData[date][6]) {
                            const colNum = typeof colId === 'string' ? parseInt(colId.replace('C', '')) : colId;
                            if (dailyData[date][6].includes(colId) || 
                                dailyData[date][6].includes(i) || 
                                dailyData[date][6].includes(String(i)) ||
                                dailyData[date][6].includes(colNum)) {
                                isInstalled = true;
                                break;
                            }
                        }
                    }
                }
                
                // ì¢Œí‘œê°€ ìˆê±°ë‚˜ ì„¤ì¹˜ ì™„ë£Œëœ ê²½ìš°ì—ë§Œ í‘œì‹œ
                const coord = columnCoordinates[colId];
                if (coord || isInstalled) {
                    const pos = coord || { left: 50, top: 50 }; // ê¸°ë³¸ ìœ„ì¹˜
                    
                    const marker = document.createElement('div');
                    marker.style.cssText = `
                        position: absolute;
                        width: ${isInstalled ? '24px' : '20px'};
                        height: ${isInstalled ? '24px' : '20px'};
                        background: ${isInstalled ? '#4caf50' : '#ff9800'};
                        border: 3px solid #fff;
                        border-radius: 50%;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.4);
                        cursor: ${coordinateSetupMode ? 'pointer' : 'default'};
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: ${isInstalled ? '11px' : '10px'};
                        font-weight: bold;
                        color: white;
                        z-index: 10;
                        transform: translate(-50%, -50%);
                    `;
                    marker.textContent = i;
                    marker.title = `${colId} ${isInstalled ? 'ì„¤ì¹˜ì™„ë£Œ' : 'ì¢Œí‘œì„¤ì •ë¨'}`;
                    
                    // ì‹¤ì œ ì¢Œí‘œì— ë§ì¶° ë°°ì¹˜
                    marker.style.left = pos.left + '%';
                    marker.style.top = pos.top + '%';
                    
                    // ì¢Œí‘œ ì„¤ì • ëª¨ë“œì¼ ë•Œ ë§ˆì»¤ í´ë¦­ìœ¼ë¡œ í•´ë‹¹ ê¸°ë‘¥ ì„ íƒ
                    if (coordinateSetupMode) {
                        marker.onclick = (e) => {
                            e.stopPropagation();
                            currentColumnForSetup = colId;
                            alert(`${colId}ì˜ ì¢Œí‘œë¥¼ ë³€ê²½í•˜ë ¤ë©´ í‰ë©´ë„ ì´ë¯¸ì§€ë¥¼ í´ë¦­í•˜ì„¸ìš”.`);
                        };
                    }
                    
                    floorPlanImage.appendChild(marker);
                }
            }
            
            if (installedColumns.length === 0 && Object.keys(columnCoordinates).length === 0) {
                floorPlanImage.innerHTML = '<div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#999;font-size:14px;">ì„¤ì¹˜ ì™„ë£Œëœ ê¸°ë‘¥ì´ ì—†ìŠµë‹ˆë‹¤.<br>ì¢Œí‘œ ì„¤ì • ëª¨ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ê¸°ë‘¥ ìœ„ì¹˜ë¥¼ ì„¤ì •í•˜ì„¸ìš”.</div>';
            }
        }

        // ìš´ì†¡ë¬¼ëŸ‰ì‚°ì •: ì—‘ì…€ ì—…ë¡œë“œ ì²˜ë¦¬
        function handleTransportVolumeFile(event) {
            const file = event.target.files[0];
            const statusEl = document.getElementById('transport-volume-status');
            
            if (!file) {
                if (statusEl) statusEl.textContent = 'íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.';
                return;
            }
            if (typeof XLSX === 'undefined') {
                alert('ì—‘ì…€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (statusEl) statusEl.textContent = 'íŒŒì¼ì„ ì½ëŠ” ì¤‘...';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.SheetNames[0];
                    const sheet = workbook.Sheets[firstSheet];
                    const rows = XLSX.utils.sheet_to_json(sheet, { defval: '' });
                    
                    transportVolumeData = rows.slice(0, 50).map((row, idx) => {
                        const norm = {};
                        Object.keys(row).forEach(k => {
                            norm[k.trim().toLowerCase()] = row[k];
                        });
                        
                        const colNo = row['ê¸°ë‘¥ë²ˆí˜¸'] || row['ê¸°ë‘¥'] || row['ë²ˆí˜¸'] || row['Column'] || row['No'] || norm['ê¸°ë‘¥ë²ˆí˜¸'] || norm['ê¸°ë‘¥'] || norm['ë²ˆí˜¸'] || norm['column'] || norm['no'];
                        const size = row['ì‚¬ì´ì¦ˆ'] || row['ê·œê²©'] || row['size'] || norm['ì‚¬ì´ì¦ˆ'] || norm['ê·œê²©'] || norm['size'];
                        const lengthVal = row['ê¸¸ì´(mm)'] || row['ê¸¸ì´'] || row['length'] || row['len'] || norm['ê¸¸ì´(mm)'] || norm['ê¸¸ì´'] || norm['length'] || norm['len'];
                        const sub = row['ì†Œë¶€ì¬ì˜ˆìƒë¬¼ëŸ‰'] || row['ì†Œë¶€ì¬'] || row['ì˜ˆìƒë¬¼ëŸ‰'] || row['sub'] || norm['ì†Œë¶€ì¬ì˜ˆìƒë¬¼ëŸ‰'] || norm['ì†Œë¶€ì¬'] || norm['ì˜ˆìƒë¬¼ëŸ‰'] || norm['sub'];
                        
                        return {
                            no: colNo || (idx + 1),
                            size: size || '',
                            length: lengthVal || '',
                            sub: sub || ''
                        };
                    });
                    
                    renderTransportVolumeTable();
                    if (statusEl) statusEl.textContent = `ì—…ë¡œë“œ ì™„ë£Œ: ${transportVolumeData.length}ê°œ (ìµœëŒ€ 50ê°œ í‘œì‹œ)`;
                } catch (err) {
                    console.error('ìš´ì†¡ë¬¼ëŸ‰ ì—‘ì…€ ì²˜ë¦¬ ì˜¤ë¥˜:', err);
                    alert('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í…œí”Œë¦¿ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                    if (statusEl) statusEl.textContent = 'âš ï¸ íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                }
            };
            reader.readAsArrayBuffer(file);
        }

        // ì¤‘ë³µ ê¸°ë‘¥ ì²´í¬ í•¨ìˆ˜
        function checkDuplicateColumns() {
            duplicateColumns = {}; // ì´ˆê¸°í™”
            
            // ëª¨ë“  ì°¨ìˆ˜ì—ì„œ ê¸°ë‘¥ ì‚¬ìš© íšŸìˆ˜ ê³„ì‚°
            const columnUsage = {}; // { columnId: [tripNumbers] }
            
            for (let tripNum in transportPlan) {
                const tripData = transportPlan[tripNum] || { columns: [], date: '' };
                const columns = tripData.columns || [];
                columns.forEach(columnId => {
                    if (!columnUsage[columnId]) {
                        columnUsage[columnId] = [];
                    }
                    columnUsage[columnId].push(parseInt(tripNum));
                });
            }
            
            // ì¤‘ë³µëœ ê¸°ë‘¥ ì°¾ê¸° (2ê°œ ì´ìƒ ì°¨ìˆ˜ì— í¬í•¨ëœ ê¸°ë‘¥)
            for (let columnId in columnUsage) {
                if (columnUsage[columnId].length > 1) {
                    duplicateColumns[columnId] = columnUsage[columnId];
                }
            }
            
            // ê²°ê³¼ í‘œì‹œ
            const resultDiv = document.getElementById('duplicate-check-result');
            const infoDiv = document.getElementById('duplicate-info');
            
            if (Object.keys(duplicateColumns).length === 0) {
                // ì¤‘ë³µ ì—†ìŒ
                resultDiv.style.display = 'none';
                alert('âœ… ì¤‘ë³µëœ ê¸°ë‘¥ì´ ì—†ìŠµë‹ˆë‹¤.');
            } else {
                // ì¤‘ë³µ ìˆìŒ
                resultDiv.style.display = 'block';
                resultDiv.style.background = '#ffebee';
                resultDiv.style.borderLeft = '4px solid #f44336';
                
                let infoHtml = '<div style="margin-bottom:8px;"><strong>ë‹¤ìŒ ê¸°ë‘¥ì´ ì—¬ëŸ¬ ì°¨ìˆ˜ì— ì¤‘ë³µ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤:</strong></div>';
                infoHtml += '<ul style="margin:0;padding-left:20px;">';
                
                const duplicateList = Object.keys(duplicateColumns).map(Number).sort((a, b) => a - b);
                duplicateList.forEach(columnId => {
                    const trips = duplicateColumns[columnId].sort((a, b) => a - b);
                    infoHtml += `<li style="margin:5px 0;">${columnId}C: ${trips.map(t => t + 'ì°¨ìˆ˜').join(', ')}ì— í¬í•¨</li>`;
                });
                
                infoHtml += '</ul>';
                infoDiv.innerHTML = infoHtml;
                
                alert(`âš ï¸ ${duplicateList.length}ê°œì˜ ê¸°ë‘¥ì´ ì¤‘ë³µë˜ì—ˆìŠµë‹ˆë‹¤. í™”ë©´ì—ì„œ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.`);
            }
            
            // ê·¸ë¦¬ë“œ ë‹¤ì‹œ ë Œë”ë§í•˜ì—¬ ì¤‘ë³µ í‘œì‹œ
            renderTransportColumnGrid();
        }

        // ìš´ì†¡ê³„íš ì €ì¥
        // ìš´ì†¡ì°¨ìˆ˜ê³„íšì„ dailyDataì˜ í˜„ì¥ë°°ì†¡(process 5)ì— ë™ê¸°í™”
        function syncTransportToDailyData(needConfirm = false) {
            // í˜„ì¥ë°°ì†¡ ìƒíƒœë¡œ ë³€ê²½ë  ê¸°ë‘¥ ëª©ë¡ ìˆ˜ì§‘
            const columnsToUpdate = [];
            for (let tripNum in transportPlan) {
                const tripData = transportPlan[tripNum];
                if (!tripData || !tripData.date || !tripData.columns || tripData.columns.length === 0) {
                    continue;
                }
                
                const date = tripData.date.trim();
                if (!date) {
                    continue;
                }
                
                for (let col of tripData.columns) {
                    let colId;
                    if (typeof col === 'number') {
                        colId = col + 'C';
                    } else if (typeof col === 'string') {
                        if (col.endsWith('C')) {
                            colId = col;
                        } else {
                            colId = col + 'C';
                        }
                    } else {
                        colId = String(col) + 'C';
                    }
                    
                    const currentStatus = columnData[colId]?.status || 0;
                    if (currentStatus < 5) {
                        columnsToUpdate.push({ colId, date, tripNum });
                    }
                }
            }
            
            // í˜„ì¥ë°°ì†¡ ìƒíƒœë¡œ ë³€ê²½ë  ê¸°ë‘¥ì´ ìˆê³  í™•ì¸ì´ í•„ìš”í•˜ë©´ í™•ì¸ ë©”ì‹œì§€ í‘œì‹œ
            if (needConfirm && columnsToUpdate.length > 0) {
                const columnList = columnsToUpdate.map(c => c.colId).join(', ');
                const message = `ë‹¤ìŒ ê¸°ë‘¥ë“¤ì„ í˜„ì¥ë°°ì†¡ ìƒíƒœë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nê¸°ë‘¥: ${columnList}\n\nâ€» ìš´ì†¡ì°¨ìˆ˜ê³„íšì—ì„œ ë°›ì€ ë°ì´í„°ë¡œ ì‹¤ì œ ìš´ì†¡ì´ ì•„ë‹Œ ë°°ì†¡ ê³„íšì…ë‹ˆë‹¤.`;
                if (!confirm(message)) {
                    return false; // ì‚¬ìš©ìê°€ ì·¨ì†Œí•˜ë©´ ë™ê¸°í™”í•˜ì§€ ì•ŠìŒ
                }
            }
            
            // 1ë‹¨ê³„: ê¸°ì¡´ dailyData[date][5]ì—ì„œ ëª¨ë“  ê¸°ë‘¥ ì œê±° (ìš´ì†¡ì°¨ìˆ˜ê³„íšì— ì—†ëŠ” ê¸°ë‘¥ ì œê±°ë¥¼ ìœ„í•´)
            for (let date in dailyData) {
                if (dailyData[date] && dailyData[date][5]) {
                    dailyData[date][5] = [];
                }
            }
            
            // 2ë‹¨ê³„: transportPlanì˜ ê° ì°¨ìˆ˜ë¥¼ dailyDataì— ë™ê¸°í™” (ë™ì¼í•œ ì¼ì •ìœ¼ë¡œ ë³µì‚¬)
            for (let tripNum in transportPlan) {
                const tripData = transportPlan[tripNum];
                if (!tripData || !tripData.date || !tripData.columns || tripData.columns.length === 0) {
                    continue;
                }
                
                const date = tripData.date.trim();
                if (!date) {
                    continue; // ë‚ ì§œê°€ ì—†ìœ¼ë©´ ìŠ¤í‚µ
                }
                
                const columns = tripData.columns;
                
                // dailyData ì´ˆê¸°í™”
                if (!dailyData[date]) {
                    dailyData[date] = {};
                }
                // í•´ë‹¹ ë‚ ì§œì˜ í˜„ì¥ë°°ì†¡(process 5) ë°°ì—´ ì´ˆê¸°í™”
                dailyData[date][5] = [];
                
                // ê¸°ë‘¥ ë²ˆí˜¸ë¥¼ "1C" í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ì¶”ê°€ (ë™ì¼í•œ ì¼ì •ìœ¼ë¡œ ë³µì‚¬)
                for (let col of columns) {
                    // ê¸°ë‘¥ ë²ˆí˜¸ í˜•ì‹ ì •ê·œí™”: ìˆ«ìë©´ "1C" í˜•ì‹ìœ¼ë¡œ, ë¬¸ìì—´ì´ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš©
                    let colId;
                    if (typeof col === 'number') {
                        colId = col + 'C';
                    } else if (typeof col === 'string') {
                        // "1C" í˜•ì‹ì´ë©´ ê·¸ëŒ€ë¡œ, ìˆ«ì ë¬¸ìì—´ì´ë©´ "C" ì¶”ê°€
                        if (col.endsWith('C')) {
                            colId = col;
                        } else {
                            colId = col + 'C';
                        }
                    } else {
                        colId = String(col) + 'C';
                    }
                    
                    // ì¤‘ë³µ ë°©ì§€: ì´ë¯¸ ì¶”ê°€ë˜ì§€ ì•Šì€ ê²½ìš°ë§Œ ì¶”ê°€
                    if (!dailyData[date][5].includes(colId)) {
                        dailyData[date][5].push(colId);
                    }
                }
                
                // 3ë‹¨ê³„: columnDataì˜ statusì™€ lastUpdate ì—…ë°ì´íŠ¸
                for (let col of columns) {
                    // ê¸°ë‘¥ ë²ˆí˜¸ í˜•ì‹ ì •ê·œí™”
                    let colId;
                    if (typeof col === 'number') {
                        colId = col + 'C';
                    } else if (typeof col === 'string') {
                        if (col.endsWith('C')) {
                            colId = col;
                        } else {
                            colId = col + 'C';
                        }
                    } else {
                        colId = String(col) + 'C';
                    }
                    
                    if (!columnData[colId]) {
                        columnData[colId] = { status: 0, lastUpdate: '' };
                    }
                    
                    // í˜„ì¥ë°°ì†¡(5)ì€ ìš´ì†¡ì°¨ìˆ˜ê³„íšì—ì„œ ë°›ì€ ë°ì´í„°ë¡œ ì‹¤ì œ ìš´ì†¡ì´ ì•„ë‹˜
                    // ë”°ë¼ì„œ columnData.statusë¥¼ 5ë¡œ ì—…ë°ì´íŠ¸í•˜ì§€ ì•ŠìŒ
                    // (ì¼ì¼ì…ë ¥ì°½ì˜ ê³µì • 1-4ì—ì„œ "ë°°ì†¡ì™„ë£Œ"ë¡œ í‘œì‹œë˜ì§€ ì•Šë„ë¡)
                    // dailyData[date][5]ì—ë§Œ ì €ì¥í•˜ì—¬ í˜„ì¥ì„¤ì¹˜(process 6)ì—ì„œ í™•ì¸ ê°€ëŠ¥í•˜ë„ë¡ í•¨
                    
                    // lastUpdateë„ ì—…ë°ì´íŠ¸í•˜ì§€ ì•ŠìŒ (ì‹¤ì œ ì™„ë£Œëœ ê³µì •ì˜ ë‚ ì§œë§Œ ìœ ì§€)
                }
            }
            
            // 4ë‹¨ê³„: ë¹ˆ ë°°ì—´ ì •ë¦¬
            for (let date in dailyData) {
                if (dailyData[date] && dailyData[date][5] && dailyData[date][5].length === 0) {
                    delete dailyData[date][5];
                }
                if (dailyData[date] && Object.keys(dailyData[date]).length === 0) {
                    delete dailyData[date];
                }
            }
            
            // 5ë‹¨ê³„: ì €ì¥
            saveToStorage();
            return true;
        }
        
        function saveTransportPlan() {
            localStorage.setItem(kcolKey('transportPlan'), JSON.stringify(transportPlan));
            
            // ìš´ì†¡ì°¨ìˆ˜ê³„íšì„ dailyDataì˜ í˜„ì¥ë°°ì†¡(process 5)ì— ë™ê¸°í™” (í™•ì¸ í•„ìš”)
            const syncResult = syncTransportToDailyData(true);
            if (!syncResult) {
                // ì‚¬ìš©ìê°€ ì·¨ì†Œí•œ ê²½ìš° ì €ì¥ë„ ì·¨ì†Œ
                return;
            }
            
            // Firebaseì— ì €ì¥ (í™œì„±í™”ëœ ê²½ìš°)
            if (isFirebaseEnabled && db) {
                db.ref(kcolRef('transportPlan')).set(transportPlan)
                    .then(() => {
                        alert('âœ… ìš´ì†¡ì°¨ìˆ˜ê³„íšì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. (í˜„ì¥ë°°ì†¡ ë°ì´í„° ìë™ ë™ê¸°í™” ì™„ë£Œ)');
                        // í™”ë©´ ì—…ë°ì´íŠ¸
                        renderGanttChart();
                        renderColumnGrid('column-grid-overview');
                        renderColumnGrid('column-grid-input');
                        updateProgressBars();
                    })
                    .catch((error) => {
                        console.error('Firebase ì €ì¥ ì˜¤ë¥˜:', error);
                        alert('âš ï¸ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    });
            } else {
                alert('âœ… ìš´ì†¡ì°¨ìˆ˜ê³„íšì´ ë¡œì»¬ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. (í˜„ì¥ë°°ì†¡ ë°ì´í„° ìë™ ë™ê¸°í™” ì™„ë£Œ)');
                // í™”ë©´ ì—…ë°ì´íŠ¸
                renderGanttChart();
                renderColumnGrid('column-grid-overview');
                renderColumnGrid('column-grid-input');
                updateProgressBars();
            }
        }

        // ì„ íƒ ì´ˆê¸°í™”
        function clearTransportSelection() {
            if (confirm(`í˜„ì¬ ì„ íƒëœ ${currentTransportTrip}ì°¨ìˆ˜ì˜ ëª¨ë“  ê¸°ë‘¥ ì„ íƒì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                if (!transportPlan[currentTransportTrip]) {
                    transportPlan[currentTransportTrip] = { columns: [], date: '' };
                }
                transportPlan[currentTransportTrip].columns = [];
                renderTransportColumnGrid();
                renderTransportTrips();
                updateTransportTripInfo();
                saveTransportPlan();
            }
        }
        
        // ì „ì²´ ë°ì´í„° ì´ˆê¸°í™”
        function resetAllData() {
            if (!confirm('âš ï¸ ì „ì²´ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ˆê¸°í™”í•  ë°ì´í„°:\n- ëª¨ë“  ê¸°ë‘¥ì˜ ê³µì • ìƒíƒœ\n- ëª¨ë“  ì¼ì¼ ì…ë ¥ ë°ì´í„°\n- ìš´ì†¡ì°¨ìˆ˜ê³„íš\n- í˜„ì¥ë°°ì†¡ ë°ì´í„°\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                return;
            }
            
            // ì¶”ê°€ í™•ì¸
            if (!confirm('ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nëª¨ë“  ê³µì • ì§„í–‰ ìƒí™©ì´ ì‚­ì œë©ë‹ˆë‹¤.')) {
                return;
            }
            
            // ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™”
            columnData = {};
            dailyData = {};
            transportPlan = {};
            deliveryConfirmed = {}; // í˜„ì¥ë°°ì†¡ í™•ì¸ ë°ì´í„° ì´ˆê¸°í™”
            actualDeliveryDate = {}; // ì‹¤ì œ ë°°ì†¡ ë‚ ì§œ ë°ì´í„° ì´ˆê¸°í™”
            // columnCoordinatesëŠ” ìœ ì§€ (í˜„ì¥ì„¤ì¹˜í˜„í™©ë„ ì¢Œí‘œê°’ ë³´ì¡´)
            
            // ì´ˆê¸° ìƒíƒœë¡œ columnData ì„¤ì • (ëª¨ë“  ê¸°ë‘¥ì„ ë¯¸ì°©ìˆ˜ ìƒíƒœë¡œ)
            for (let i = 1; i <= TOTAL_COLUMNS; i++) {
                const colId = i + 'C';
                columnData[colId] = {
                    status: 0,
                    lastUpdate: '',
                    note: '',
                    updatedBy: ''
                };
            }
            
            // ìš´ì†¡ì°¨ìˆ˜ê³„íš ì´ˆê¸°í™” (1ì°¨ìˆ˜ë§Œ ë‚¨ê¸°ê³  ë¹ˆ ìƒíƒœë¡œ)
            transportPlan = {
                1: { columns: [], date: '' }
            };
            currentTransportTrip = 1;
            
            // ì €ì¥
            saveToStorage();
            
            // ìš´ì†¡ì°¨ìˆ˜ê³„íšë„ ì €ì¥
            localStorage.setItem(kcolKey('transportPlan'), JSON.stringify(transportPlan));
            
            // Firebaseì— ì €ì¥ (í™œì„±í™”ëœ ê²½ìš°)
            if (isFirebaseEnabled && db) {
                db.ref(kcolRef('columnData')).set(columnData)
                    .then(() => {
                        return db.ref(kcolRef('dailyData')).set(dailyData);
                    })
                    .then(() => {
                        return db.ref(kcolRef('transportPlan')).set(transportPlan);
                    })
                    .then(() => {
                        return db.ref(kcolRef('deliveryConfirmed')).set(deliveryConfirmed);
                    })
                    .then(() => {
                        return db.ref(kcolRef('actualDeliveryDate')).set(actualDeliveryDate);
                    })
                    .then(() => {
                        // columnCoordinatesëŠ” ìœ ì§€í•˜ë¯€ë¡œ Firebaseì—ì„œë„ ì‚­ì œí•˜ì§€ ì•ŠìŒ
                        // return db.ref(kcolRef('columnCoordinates')).set(columnCoordinates);
                        return Promise.resolve();
                    })
                    .then(() => {
                        alert('âœ… ì „ì²´ ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
                        // í™”ë©´ ì—…ë°ì´íŠ¸
                        renderColumnGrid('column-grid-overview');
                        renderColumnGrid('column-grid-input');
                        renderGanttChart();
                        updateProgressBars();
                        renderTransportTrips();
                        renderTransportColumnGrid();
                        updateTransportTripInfo();
                    })
                    .catch((error) => {
                        console.error('Firebase ì €ì¥ ì˜¤ë¥˜:', error);
                        alert('âš ï¸ ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    });
            } else {
                alert('âœ… ì „ì²´ ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
                // í™”ë©´ ì—…ë°ì´íŠ¸
                renderColumnGrid('column-grid-overview');
                renderColumnGrid('column-grid-input');
                renderGanttChart();
                updateProgressBars();
                renderTransportTrips();
                renderTransportColumnGrid();
                updateTransportTripInfo();
            }
        }

        // Close modal on outside click
        document.getElementById('column-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Close process selection modal on outside click
        document.getElementById('process-selection-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                cancelProcessSelection();
            }
        });
    </script>

    <!-- Process Selection Modal -->
    <div id="process-selection-modal" class="process-selection-modal">
        <div class="process-selection-content">
            <h3>âš ï¸ ì‚­ì œí•  ê³µì • ì„ íƒ</h3>
            <p id="process-selection-message"></p>
            <div class="process-selection-buttons">
                <button class="process-select-btn p1" onclick="selectProcessForDelete(1)">
                    1. ì£¼ê¸°ë‘¥ì»¤íŒ… ì‚­ì œ
                </button>
                <button class="process-select-btn p2" onclick="selectProcessForDelete(2)">
                    2. ì†Œë¶€ì¬ê°€ê³µ ì‚­ì œ
                </button>
                <button class="process-select-btn cancel" onclick="cancelProcessSelection()">
                    ì·¨ì†Œ
                </button>
            </div>
        </div>
    </div>
    <script src="../../js/auth-config.js"></script>
    <script src="../../js/auth.js"></script>
    <script src="../../js/auth-guard.js"></script>
</body>
</html>
