{"version":3,"sources":["../../../../src/app/%28protected%29/layout.tsx","../../../../src/lib/db/users.ts"],"sourcesContent":["import { redirect } from 'next/navigation';\nimport { createClient } from '@/lib/supabase/server';\nimport { getUserProfile } from '@/lib/db/users';\n\ninterface ProtectedLayoutProps {\n  children: React.ReactNode;\n}\n\nconst ROUTE_PERMISSIONS: Record<string, 'access_column' | 'access_beam' | null> = {\n  '/k-col/auto-find-section': 'access_column',\n  '/k-col/calculator': 'access_column',\n  '/k-col/boq-report': 'access_column',\n  '/k-col/user-guide': 'access_column',\n  '/k-col/developer-guide': 'access_column',\n  '/k-col/print': 'access_column',\n  '/k-col/calc-data-1': 'access_column',\n  '/k-col/calc-data-2': 'access_column',\n  '/admin': null,\n};\n\nexport default async function ProtectedLayout({ children }: ProtectedLayoutProps) {\n  const supabase = await createClient();\n  const { data: { user } } = await supabase.auth.getUser();\n\n  if (!user) {\n    redirect('/login');\n  }\n\n  const profile = await getUserProfile(user.id);\n\n  if (!profile) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"max-w-md w-full bg-white shadow-lg rounded-lg p-8\">\n          <h1 className=\"text-2xl font-bold text-red-600 mb-4\">프로필 오류</h1>\n          <p className=\"text-gray-700\">\n            사용자 프로필을 찾을 수 없습니다. 관리자에게 문의하세요.\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!profile.is_approved) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"max-w-md w-full bg-white shadow-lg rounded-lg p-8\">\n          <h1 className=\"text-2xl font-bold text-yellow-600 mb-4\">승인 대기 중</h1>\n          <p className=\"text-gray-700 mb-4\">\n            계정이 아직 승인되지 않았습니다. 관리자의 승인을 기다려주세요.\n          </p>\n          <p className=\"text-sm text-gray-500\">\n            승인이 완료되면 이메일로 알림을 받으실 수 있습니다.\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  return <>{children}</>;\n}\n","import { createClient } from '../supabase/server';\nimport type { UserProfile } from './types';\n\nexport async function getUserProfile(id: string): Promise<UserProfile | null> {\n  const supabase = await createClient();\n  \n  const { data, error } = await supabase\n    .from('user_profiles')\n    .select('*')\n    .eq('id', id)\n    .maybeSingle();\n  \n  if (error) {\n    console.error('Error fetching user profile:', error);\n    return null;\n  }\n  \n  return data;\n}\n\nexport async function updateUserProfile(\n  id: string, \n  updates: Partial<Omit<UserProfile, 'id' | 'created_at'>>\n): Promise<UserProfile | null> {\n  const supabase = await createClient();\n  \n  const { data, error } = await supabase\n    .from('user_profiles')\n    .update({\n      ...updates,\n      updated_at: new Date().toISOString(),\n    })\n    .eq('id', id)\n    .select()\n    .single();\n  \n  if (error) {\n    console.error('Error updating user profile:', error);\n    return null;\n  }\n  \n  return data;\n}\n"],"names":[],"mappings":"qDAAA,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OCEO,eAAe,EAAe,CAAU,EAC7C,IAAM,EAAW,MAAM,CAAA,EAAA,EAAA,YAAA,AAAY,IAE7B,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAC3B,IAAI,CAAC,iBACL,MAAM,CAAC,KACP,EAAE,CAAC,KAAM,GACT,WAAW,UAEV,AAAJ,GACE,IADS,IACD,KAAK,CAAC,+BAAgC,GACvC,MAGF,CACT,CDEe,eAAe,EAAgB,UAAE,CAAQ,CAAwB,EAC9E,IAAM,EAAW,MAAM,CAAA,EAAA,EAAA,YAAA,AAAY,IAC7B,CAAE,KAAM,CAAE,MAAI,CAAE,CAAE,CAAG,MAAM,EAAS,IAAI,CAAC,OAAO,EAElD,CAAC,GACH,CAAA,EAAA,AADS,EACT,QAAA,AAAQ,EAAC,UAGX,IAAM,EAAU,MAAM,EAAe,EAAK,EAAE,SAE5C,AAAK,EAaA,EAbD,AAaS,KAbC,MAaU,CAgBjB,CAhBmB,AAgBnB,EAAA,EAAA,GAAA,EAAA,EAAA,QAAA,CAAA,UAAG,IAdN,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,oEACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,8DACb,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,mDAA0C,YACxD,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,8BAAqB,wCAGlC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,iCAAwB,uCAnBzC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,oEACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,8DACb,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,gDAAuC,WACrD,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,yBAAgB,yCAyBvC"}