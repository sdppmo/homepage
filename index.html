<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>SongDoPartners | K-COL Steel Column Design</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <div class="page-wrapper">
    <!-- TOP ROW: Left Column + Main Content -->
    <div class="top-row">
      <!-- LEFT COLUMN -->
      <aside class="left-column">
        <!-- Logo Section -->
        <div class="logo-section">
          <div class="logo-container">
            <img src="assets/images/sdppmo_logo.png" alt="SongDoPartners">
          </div>
          <div class="welcome-text">Welcome to SongDoPartners !!</div>

          <!-- Auth Section (hidden until auth check completes) -->
          <div class="auth-section" id="authSection" style="visibility: hidden;">
            <!-- Logged Out State -->
            <div class="auth-guest" id="authGuest">
              <div class="auth-buttons">
                <button class="auth-btn primary" id="loginBtn">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/>
                    <polyline points="10 17 15 12 10 7"/>
                    <line x1="15" y1="12" x2="3" y2="12"/>
                  </svg>
                  ë¡œê·¸ì¸
                </button>
                <button class="auth-btn secondary" id="signupBtn">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                    <circle cx="8.5" cy="7" r="4"/>
                    <line x1="20" y1="8" x2="20" y2="14"/>
                    <line x1="23" y1="11" x2="17" y2="11"/>
                  </svg>
                  íšŒì›ê°€ì…
                </button>
              </div>
            </div>

            <!-- Logged In State -->
            <div class="auth-user" id="authUser" style="display:none;">
              <div class="user-card">
                <div class="user-card-header">
                  <div class="gh-avatar" id="userAvatar">S</div>
                  <div class="user-info">
                    <span class="user-name" id="userName">User</span>
                    <span class="user-email" id="userEmail">user@example.com</span>
                  </div>
                </div>
                <div class="user-card-actions">
                  <a href="pages/admin.html" class="user-action-btn admin" id="adminLink" style="display:none;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <rect x="3" y="3" width="7" height="7"/>
                      <rect x="14" y="3" width="7" height="7"/>
                      <rect x="14" y="14" width="7" height="7"/>
                      <rect x="3" y="14" width="7" height="7"/>
                    </svg>
                    ê´€ë¦¬ì
                  </a>
                  <button class="user-action-btn settings" id="settingsBtn">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="3"/>
                      <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                    </svg>
                    ì„¤ì •
                  </button>
                  <button class="user-action-btn logout" id="logoutBtn">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                      <polyline points="16 17 21 12 16 7"/>
                      <line x1="21" y1="12" x2="9" y2="12"/>
                    </svg>
                    ë¡œê·¸ì•„ì›ƒ
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Navigation Menu -->
        <nav class="nav-menu">
          <a href="pages/consulting.html" class="nav-item gold">Consulting</a>
          <a href="pages/products.html" class="nav-item gold">Products</a>
          <a href="pages/slim-box-web-support.html" class="nav-item gray-text">Slim-box Web Support (soon)</a>
          <a href="pages/k-col web software/crossHcolumnCalculator.html" class="nav-item active gold" data-requires-auth="true">K-COL Web Software</a>
          <a href="pages/K-product/2H_steel_product.html" class="nav-item gold" id="kcol-product-schedule-link" data-requires-auth="true">K-COL Product Schedule</a>
          <div class="nav-item small-text gray-text">EX-Slim-Box(Not in Service)</div>
          <a href="pages/ks-code-database.html" class="nav-item gold">KS code DB(ì² ê³¨ìš©)</a>
          <a href="pages/qa.html" class="nav-item gold">Q & A (logged-in user)</a>
          <div class="nav-item gray-text" onclick="enableKosisMode()" style="cursor: pointer;">KOSIS (ì›”í‰ê· ê°€ê²©)</div>
        </nav>

        <!-- Brochure Grid -->
        <div class="brochure-grid">
          <a href="pages/k-col web software/k-col-user-guide.html#kcol-guide-header" class="brochure-btn">K-COL Brochure</a>
          <a href="assets/pdf/hyundai-steel-h-beam.pdf" target="_blank" class="brochure-btn">í˜„ëŒ€ì œì²  Hí˜•ê°•</a>
          <button class="brochure-btn gray-text">SLim-Box Brochure</button>
          <a href="assets/pdf/Pos-H Brochure step4.pdf" target="_blank" class="brochure-btn white">POS H í˜•ê°•</a>
          <button class="brochure-btn gray-text">Ex_Slim-Beam Brochure</button>
          <button class="brochure-btn yellow">Sunex MTL</button>
        </div>
      </aside>

      <!-- MAIN CONTENT AREA (Right pane) -->
      <div class="main-area">
        <!-- Background Image - Covers entire right pane -->
        <div class="bg-image"></div>

        <!-- Content Layer - On top of background -->
        <div class="content-layer">
          <!-- World Clocks -->
          <div class="world-clocks">
            <div class="clock-container">
              <div class="clock" id="clock-indonesia">
                <div class="clock-face">
                  <div class="hand hour-hand" id="hour-indonesia"></div>
                  <div class="hand minute-hand" id="minute-indonesia"></div>
                  <div class="hand second-hand" id="second-indonesia"></div>
                  <div class="clock-center"></div>
                </div>
              </div>
              <div class="clock-label">Indonesia <span class="ampm-indicator" id="ampm-indonesia">AM</span></div>
            </div>
            <div class="clock-container">
              <div class="clock" id="clock-seoul">
                <div class="clock-face">
                  <div class="hand hour-hand" id="hour-seoul"></div>
                  <div class="hand minute-hand" id="minute-seoul"></div>
                  <div class="hand second-hand" id="second-seoul"></div>
                  <div class="clock-center"></div>
                </div>
              </div>
              <div class="clock-label">Seoul <span class="ampm-indicator" id="ampm-seoul">AM</span></div>
            </div>
            <div class="clock-container">
              <div class="clock" id="clock-sanfrancisco">
                <div class="clock-face">
                  <div class="hand hour-hand" id="hour-sanfrancisco"></div>
                  <div class="hand minute-hand" id="minute-sanfrancisco"></div>
                  <div class="hand second-hand" id="second-sanfrancisco"></div>
                  <div class="clock-center"></div>
                </div>
              </div>
              <div class="clock-label">San Francisco <span class="ampm-indicator" id="ampm-sanfrancisco">AM</span></div>
            </div>
            <div class="clock-container">
              <div class="clock" id="clock-newyork">
                <div class="clock-face">
                  <div class="hand hour-hand" id="hour-newyork"></div>
                  <div class="hand minute-hand" id="minute-newyork"></div>
                  <div class="hand second-hand" id="second-newyork"></div>
                  <div class="clock-center"></div>
                </div>
              </div>
              <div class="clock-label">New York <span class="ampm-indicator" id="ampm-newyork">AM</span></div>
            </div>
          </div>

          <!-- Price Section - KOSIS ê°€ê²© ì •ë³´ (ë™ì ) -->
          <section class="price-section" id="priceSection" style="display: none;">
            <h2 id="priceSectionTitle">ì›”ê°„ ê°€ê²© ì •ë³´</h2>
            <p id="priceSectionUnit">ë‹¨ìœ„: ì›/í†¤</p>

            <table>
              <thead>
                <tr>
                  <th>ì›”</th>
                  <th>í‰ê·  ê°€ê²©</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>2024-12</td>
                  <td>645,000</td>
                </tr>
              </tbody>
            </table>

            <small>
              â€» ë³¸ ê°€ê²© ì •ë³´ëŠ” ê³µê³µ í†µê³„ ê¸°ë°˜ì˜ ì›” í‰ê·  ì°¸ê³ ê°’ì´ë©°,<br>
              ì‹¤ì œ ê±°ë˜ ê°€ê²©ì€ ì¡°ê±´ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
              ì¶œì²˜: <a href="https://kosis.kr/statHtml/statHtml.do?orgId=101&tblId=DT_1ST1501&vw_cd=MT_ZTITLE&list_id=101_10101_001&seqNo=&lang_mode=ko&language=kor&obj_var_id=&itm_id=&conn_path=MT_ZTITLE" target="_blank" style="color: #667eea; text-decoration: underline;">KOSIS (êµ­ê°€í†µê³„í¬í„¸)</a>
            </small>
          </section>

          <!-- Right Sidebar -->
          <aside class="right-sidebar">
            <!-- News Section -->
            <div class="news-section">
              <div class="news-title">NEWS</div>
              <div class="news-item">K-COL Steel Column<br>Program is release on<br>1 of Dec.<br>New Auto Find Section<br>to be loaded on<br>1 of Feb.</div>
              <div class="news-item">Slimbox tests on 1 of Jan<br>with posco Global R&D<br>Center at Songdo, Incheon</div>
              <div class="news-item">H beam price up<br>50won/kg on Nov. from<br>Hyundai-steel</div>
              <div class="news-item">K-COL<br>ì‹¤ì‹œê³µ í˜„ì¥ OPEN</div>
            </div>
          </aside>

          <!-- Exchange Table - ì¢Œì¸¡ í•˜ë‹¨ -->
          <div class="exchange-table exchange-table-bottom-left">
            <div class="exchange-header">
              í™˜ìœ¨(won/$): <span id="exchange-rate">ë¡œë”©ì¤‘...</span>
            </div>
            <div class="exchange-row">
              <div class="exchange-cell kosis-clickable" data-price-type="construction" data-month="12" style="cursor: pointer;">ê±´ì„¤ì§€ìˆ˜(12ì›”)</div>
              <div class="exchange-cell kosis-clickable" data-price-type="construction" data-month="1" style="cursor: pointer;">ê±´ì„¤ì§€ìˆ˜(1ì›”)</div>
            </div>
            <div class="exchange-row">
              <div class="exchange-cell kosis-clickable" title="KOSIS (êµ­ê°€í†µê³„í¬í„¸)ì—ì„œ ë°›ì•„ë´…ë‹ˆë‹¤. ì§€ë‚œ 12ì›” ê°€ê²©ì„ ì•Œë ¤ì¤ë‹ˆë‹¤." data-price-type="steel" data-month="12" style="cursor: pointer;">
                ì² ê°•ê°€ê²© (12ì›”)
              </div>
              <div class="exchange-cell kosis-clickable" data-price-type="steel" data-month="1" style="cursor: pointer;">ì² ê°•ê°€ê²© (1ì›”)</div>
            </div>
            <div class="exchange-row">
              <div class="exchange-cell kosis-clickable" data-price-type="plate" data-month="12" style="cursor: pointer;">íŒì¬ê°€ê²©(12ì›”)</div>
              <div class="exchange-cell kosis-clickable" data-price-type="plate" data-month="1" style="cursor: pointer;">íŒì¬ê°€ê²©(1ì›”)</div>
            </div>
            <div class="exchange-row">
              <div class="exchange-cell kosis-clickable" title="ì² ê·¼ê°€ê²©ì„ ì•Œìˆ˜ ìˆëŠ” ì‚¬ì´íŠ¸ì—ì„œ ë°›ì•„ì„œ ì˜¬ë¦½ë‹ˆë‹¤. ì§€ë‚œ 12ì›”ê°€ê²©" data-price-type="rebar" data-month="12" style="cursor: pointer;">
                ì² ê·¼ê°€ê²©(12ì›”)
              </div>
              <div class="exchange-cell kosis-clickable" data-price-type="rebar" data-month="1" style="cursor: pointer;">ì² ê·¼ê°€ê²©(1ì›”)</div>
            </div>
            <div class="exchange-row">
              <div class="exchange-cell kosis-clickable" data-price-type="concrete" data-month="12" style="cursor: pointer;">ë ˆë¯¸ì½˜ê°€ê²©(12ì›”)</div>
              <div class="exchange-cell kosis-clickable" data-price-type="concrete" data-month="1" style="cursor: pointer;">ë ˆë¯¸ì½˜ê°€ê²©(1ì›”)</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- BOTTOM ROW: Product Logos + Footer (Same height) -->
    <div class="bottom-row">
      <!-- Product Logos -->
      <div class="product-logos">
        <img src="assets/images/product-1.png" alt="K-COL">
        <img src="assets/images/product-2.png" alt="SLiM-BOX">
        <img src="assets/images/product-3.png" alt="ExSlim-Beam">
        <img src="assets/images/product-4.png" alt="COL">
      </div>

      <!-- Footer -->
      <footer class="footer">
        <div class="footer-info">
          <div>Homepage : http://www.kcol.kr</div>
          <div>E-Mail Address : If any problems, contact me : <a href="mailto:sbd_pmo@naver.com">sbd_pmo@naver.com</a></div>
          <div>HQ. Address : 77-bungi, 42-bungil, Conventia Daero, Yeonsu-ku, Incheon, KOREA</div>
          <div>Seoul Office Address : TBD</div>
        </div>
        <div class="db-button">
          <div class="click-text">CLICK</div>
          <div class="main-text">Go to<br>SDP Projects</div>
        </div>
        <div class="company-logos">
          <div class="company-logo dongyang"><a href="https://dystec.co.kr/new/" target="_blank"><img src="assets/images/network-1.png" alt="DONG YANG SÂ·Tec"></a></div>
          <div class="company-logo posco"><a href="https://www.posco.co.kr" target="_blank"><img src="assets/images/network-2.png" alt="POSCO"></a></div>
          <div class="company-logo steelball"><a href="https://www.steelall.co.kr" target="_blank"><img src="assets/images/network-3.png" alt="Steel Ball"></a></div>
          <div class="company-logo p6sc"><a href="https://www.p6ix.co.kr" target="_blank"><img src="assets/images/network-6.png" alt="p6sc"></a></div>
          <div class="company-logo clbs"><a href="https://www.clbs.co.kr/main.jsp" target="_blank"><img src="assets/images/network-5.png" alt="CLBS"></a></div>
          <div class="company-logo hyundai"><a href="https://www.hyundai-steel.com" target="_blank"><img src="assets/images/network-4.jfif" alt="HYUNDAI STEEL"></a></div>
        </div>
      </footer>
    </div>
  </div>

  <!-- Project Selection Modal -->
  <div id="project-modal" class="proj-modal-overlay" aria-hidden="true">
    <div class="proj-modal" role="dialog" aria-modal="true" aria-labelledby="project-modal-title">
      <div class="proj-modal-header">
        <div class="proj-modal-title">
          <strong id="project-modal-title">í”„ë¡œì íŠ¸ ì„ íƒ</strong>
          <span>K-COL Product Schedule</span>
        </div>
        <button type="button" id="project-modal-close" class="proj-modal-close" aria-label="ë‹«ê¸°">âœ•</button>
      </div>
      <div class="proj-modal-body">
        <div class="proj-modal-note">
          <div class="dot"></div>
          <div>
            6ê°œ í”„ë¡œì íŠ¸ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ë©´ ê³µì •ê´€ë¦¬(ì¼ì¼ì…ë ¥/ìš´ì†¡ì°¨ìˆ˜/ê³µì •í‘œ/ìš´ì†¡ë¬¼ëŸ‰ì‚°ì •)ê°€ <strong>í”„ë¡œì íŠ¸ë³„ë¡œ ë¶„ë¦¬</strong>ë˜ì–´ ì €ì¥ë©ë‹ˆë‹¤.
          </div>
        </div>
        <div id="project-list" class="proj-grid"></div>
        <div class="proj-footer">
          <div class="last">ë§ˆì§€ë§‰ ì„ íƒ: <strong><span id="project-last">(ì—†ìŒ)</span></strong></div>
          <button type="button" id="project-clear-last" class="proj-btn-secondary">ë§ˆì§€ë§‰ ì„ íƒ ì´ˆê¸°í™”</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts: load order matters -->
  <script src="js/auth-config.js?v=20260122d"></script>
  <script src="js/auth.js?v=20260122d"></script>
  <script src="js/feature-guard.js?v=20260122e"></script>
  
  <!-- KOSIS Mode Function - must be defined before main.js -->
  <script>
    // KOSIS ëª¨ë“œ í™œì„±í™” í•¨ìˆ˜ (ì „ì—­ìœ¼ë¡œ ë¨¼ì € ì •ì˜)
    window.kosisModeEnabled = false;
    
    window.enableKosisMode = function() {
      console.log('enableKosisMode í˜¸ì¶œë¨');
      window.kosisModeEnabled = !window.kosisModeEnabled;
      const cells = document.querySelectorAll('.kosis-clickable');
      
      console.log('í´ë¦­ ê°€ëŠ¥í•œ ì…€ ê°œìˆ˜:', cells.length);
      console.log('KOSIS ëª¨ë“œ ìƒíƒœ:', window.kosisModeEnabled);
      
      cells.forEach(cell => {
        if (window.kosisModeEnabled) {
          // í™œì„±í™” ì‹œ: íŒŒë€ìƒ‰ ë°°ê²½, í…Œë‘ë¦¬, êµµì€ ê¸€ì”¨
          cell.style.backgroundColor = '#f0f4ff';
          cell.style.border = '2px solid #667eea';
          cell.style.fontWeight = '600';
          cell.style.cursor = 'pointer';
          cell.title = 'í´ë¦­í•˜ì—¬ ì›”í‰ê·  ê°€ê²© í™•ì¸';
        } else {
          // ë¹„í™œì„±í™” ì‹œ: ê¸°ë³¸ ìŠ¤íƒ€ì¼
          cell.style.backgroundColor = '';
          cell.style.border = '';
          cell.style.fontWeight = '';
          cell.style.cursor = '';
          cell.title = '';
        }
      });
      
      // ë©”ë‰´ í•­ëª© ì‹œê°ì  í”¼ë“œë°±
      const allNavItems = document.querySelectorAll('.nav-item');
      allNavItems.forEach(item => {
        if (item.textContent && item.textContent.includes('KOSIS')) {
          if (window.kosisModeEnabled) {
            item.style.backgroundColor = '#667eea';
            item.style.color = '#fff';
            item.title = 'KOSIS ëª¨ë“œ í™œì„±í™”ë¨ - ê°€ê²© í•­ëª©ì„ í´ë¦­í•˜ì„¸ìš”';
          } else {
            item.style.backgroundColor = '';
            item.style.color = '';
            item.title = 'KOSIS ëª¨ë“œ ë¹„í™œì„±í™”ë¨';
          }
        }
      });
      
      if (window.kosisModeEnabled) {
        console.log('KOSIS ëª¨ë“œê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
        // ë” ì¹œì ˆí•œ ì•ˆë‚´ ë©”ì‹œì§€
        alert('âœ… KOSIS ëª¨ë“œê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nğŸ“Š ì‚¬ìš© ë°©ë²•:\n1. ì•„ë˜ ê°€ê²© í•­ëª©(ê±´ì„¤ì§€ìˆ˜, ì² ê°•ê°€ê²©, íŒì¬ê°€ê²© ë“±)ì„ í´ë¦­í•˜ì„¸ìš”\n2. í´ë¦­í•œ í•­ëª©ì˜ ì›”í‰ê·  ê°€ê²©ì´ í‘œì‹œë©ë‹ˆë‹¤\n3. ë‹¤ì‹œ í´ë¦­í•˜ë©´ KOSIS ëª¨ë“œë¥¼ ë¹„í™œì„±í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤');
      } else {
        console.log('KOSIS ëª¨ë“œê°€ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
        const priceSection = document.getElementById('priceSection');
        if (priceSection) {
          priceSection.style.display = 'none';
        }
        alert('KOSIS ëª¨ë“œê°€ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
      }
    };
    
    console.log('enableKosisMode í•¨ìˆ˜ê°€ ì „ì—­ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
  </script>
  
  <script src="js/main.js?v=20260122b"></script>
  <script src="js/login.js?v=20260122b"></script>
  <script src="js/clocks.js?v=20260122b"></script>
  <script src="js/modal.js?v=20260122b"></script>
  
  <!-- Exchange Rate Script -->
  <script>
    // í™˜ìœ¨ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ì›ë‹¬ëŸ¬ ê³ ì‹œí™˜ìœ¨)
    async function fetchExchangeRate() {
      const rateElement = document.getElementById('exchange-rate');
      if (!rateElement) return;

      // Fetch with timeout helper
      function fetchWithTimeout(url, options, timeout = 5000) {
        return Promise.race([
          fetch(url, options),
          new Promise((_, reject) => setTimeout(() => reject(new Error('Timeout')), timeout))
        ]);
      }

      try {
        // 1) Primary: Frankfurter API (ECB rates, CORS-friendly, no API key)
        try {
          const response = await fetchWithTimeout('https://api.frankfurter.dev/v1/latest?base=USD&symbols=KRW', {
            method: 'GET',
            headers: { 'Accept': 'application/json' }
          }, 5000);
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          const fx = await response.json();
          const rate = fx && fx.rates && fx.rates.KRW ? fx.rates.KRW : null;
          if (!rate) throw new Error('Data missing');
          rateElement.textContent = Math.round(rate).toLocaleString() + 'ì›';
          rateElement.title = 'ì—…ë°ì´íŠ¸: ' + new Date().toLocaleString('ko-KR') + ' (USD/KRW, ECB)';
          return;
        } catch (e) {
          console.warn('Frankfurter API ì‹¤íŒ¨, fallback ì‹œë„:', e.message);
        }

        // 2) Fallback: ExchangeRate-API (open endpoint, CORS-friendly)
        const response = await fetchWithTimeout('https://open.er-api.com/v6/latest/USD', {
          method: 'GET',
          headers: { 'Accept': 'application/json' }
        }, 5000);
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        const fx = await response.json();
        const rate = fx && fx.rates && fx.rates.KRW ? fx.rates.KRW : null;
        if (!rate) throw new Error('Data missing');
        rateElement.textContent = Math.round(rate).toLocaleString() + 'ì›';
        rateElement.title = 'ì—…ë°ì´íŠ¸: ' + new Date().toLocaleString('ko-KR') + ' (USD/KRW)';
      } catch (error) {
        console.error('í™˜ìœ¨ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
        rateElement.textContent = 'í™•ì¸ë¶ˆê°€';
        rateElement.title = 'í™˜ìœ¨ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
      }
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ í™˜ìœ¨ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', fetchExchangeRate);
    } else {
      fetchExchangeRate();
    }

    // 1ì‹œê°„ë§ˆë‹¤ í™˜ìœ¨ ì •ë³´ ì—…ë°ì´íŠ¸
    setInterval(fetchExchangeRate, 3600000);

    // ê°€ê²© íƒ€ì…ë³„ í‘œì‹œ ì´ë¦„ ë° ë‹¨ìœ„
    const priceTypeInfo = {
      // 1) ê±´ì„¤ê³µì‚¬ë¹„ì§€ìˆ˜(2020=100)
      // https://kosis.kr/statHtml/statHtml.do?orgId=397&tblId=DT_39701_A003
      'construction': {
        name: 'ê±´ì„¤ê³µì‚¬ë¹„ì§€ìˆ˜ (2020=100)',
        unit: 'ì§€ìˆ˜',
        orgId: '397',
        tblId: 'DT_39701_A003',
        itmId: 'ALL'
      },
      // ê¸°ì¡´ ì² ê°•ê°€ê²©(ì›/í†¤) - í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ í‘œ ìœ ì§€
      'steel': {
        name: 'ì² ê°• ê°€ê²©',
        unit: 'ì›/í†¤',
        orgId: '101',
        tblId: 'DT_1ST1501',
        itmId: 'ALL'
      },
      // 2) ìƒì‚°ìë¬¼ê°€ì§€ìˆ˜(í’ˆëª©ë³„) - íŒì¬(ì§€ìˆ˜): "ì¤‘í›„íŒ/ì—´ê°„ì••ì—°ê°•ì¬" ë“± í‚¤ì›Œë“œë¡œ í•„í„°
      // https://kosis.kr/statHtml/statHtml.do?conn_path=I2&orgId=301&tblId=DT_404Y016
      'plate': {
        name: 'íŒì¬ê°€ê²©(ì§€ìˆ˜)',
        unit: 'ì§€ìˆ˜',
        orgId: '301',
        tblId: 'DT_404Y016',
        itmId: 'ALL',
        keywords: ['ì¤‘í›„íŒ', 'ì—´ê°„ì••ì—°ê°•ì¬', 'ì—´ê°„ì••ì—°']
      },
      // 3) ìƒì‚°ìë¬¼ê°€ì§€ìˆ˜(ê¸°ë³¸ë¶„ë¥˜) - ì² ê·¼(ì§€ìˆ˜): "ì² ê·¼ë°ë´‰ê°•" í‚¤ì›Œë“œë¡œ í•„í„°
      // https://kosis.kr/statHtml/statHtml.do?conn_path=I2&orgId=301&tblId=DT_404Y014
      'rebar': {
        name: 'ì² ê·¼ê°€ê²©(ì§€ìˆ˜)',
        unit: 'ì§€ìˆ˜',
        orgId: '301',
        tblId: 'DT_404Y014',
        itmId: 'ALL',
        keywords: ['ì² ê·¼ë°ë´‰ê°•', 'ì² ê·¼', 'ë´‰ê°•']
      },
      // 4) ìƒì‚°ìë¬¼ê°€ì§€ìˆ˜(ê¸°ë³¸ë¶„ë¥˜) - ë ˆë¯¸ì½˜(ì§€ìˆ˜): "ë ˆë¯¸ì½˜" í‚¤ì›Œë“œë¡œ í•„í„°
      // https://kosis.kr/statHtml/statHtml.do?conn_path=I2&orgId=301&tblId=DT_404Y014
      'concrete': {
        name: 'ë ˆë¯¸ì½˜ê°€ê²©(ì§€ìˆ˜)',
        unit: 'ì§€ìˆ˜',
        orgId: '301',
        tblId: 'DT_404Y014',
        itmId: 'ALL',
        keywords: ['ë ˆë¯¸ì½˜']
      }
    };

    // KOSIS ê°€ê²© ì •ë³´ í‘œì‹œ (ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡)
    window.showKosisPrice = function(priceType, month) {
      console.log('showKosisPrice í˜¸ì¶œë¨:', priceType, month);
      console.log('KOSIS ëª¨ë“œ ìƒíƒœ:', window.kosisModeEnabled);
      
      // KOSIS ëª¨ë“œê°€ í™œì„±í™”ë˜ì§€ ì•Šì•˜ìœ¼ë©´ ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ
      if (!window.kosisModeEnabled) {
        alert('âš ï¸ KOSIS ëª¨ë“œê°€ í™œì„±í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\n\në¨¼ì € ì™¼ìª½ ë©”ë‰´ì—ì„œ "KOSIS (ì›”í‰ê· ê°€ê²©)"ì„ í´ë¦­í•˜ì—¬ ëª¨ë“œë¥¼ í™œì„±í™”í•´ì£¼ì„¸ìš”.');
        return;
      }

      const priceSection = document.getElementById('priceSection');
      const priceSectionTitle = document.getElementById('priceSectionTitle');
      const priceSectionUnit = document.getElementById('priceSectionUnit');
      
      if (!priceSection || !priceSectionTitle || !priceSectionUnit) {
        console.error('ê°€ê²© ì„¹ì…˜ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      const info = priceTypeInfo[priceType];
      if (!info) {
        console.error('ê°€ê²© íƒ€ì… ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', priceType);
        return;
      }

      console.log('ê°€ê²© ì •ë³´ í‘œì‹œ ì‹œì‘:', info);

      // ì„¹ì…˜ ì œëª© ë° ë‹¨ìœ„ ì—…ë°ì´íŠ¸
      priceSectionTitle.textContent = `ì›”ê°„ ${info.name}`;
      priceSectionUnit.textContent = `ë‹¨ìœ„: ${info.unit}`;

      // ì„¹ì…˜ í‘œì‹œ
      priceSection.style.display = 'block';

      // KOSIS APIë¥¼ í†µí•´ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
      fetchKosisPriceData(priceType, month, info);
    };
    
    // ê°€ê²© í•­ëª© í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
    function setupKosisClickListeners() {
      const clickableCells = document.querySelectorAll('.kosis-clickable');
      clickableCells.forEach(cell => {
        // ê¸°ì¡´ onclick ì œê±°í•˜ê³  ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        cell.removeAttribute('onclick');
        cell.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          
          const priceType = this.getAttribute('data-price-type');
          const month = parseInt(this.getAttribute('data-month'));
          
          console.log('ê°€ê²© í•­ëª© í´ë¦­ë¨:', priceType, month);
          
          if (priceType && month) {
            window.showKosisPrice(priceType, month);
          }
        });
      });
      
      console.log('KOSIS í´ë¦­ ê°€ëŠ¥í•œ í•­ëª© ê°œìˆ˜:', clickableCells.length);
    }
    
    // DOM ë¡œë“œ í›„ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', setupKosisClickListeners);
    } else {
      setupKosisClickListeners();
    }

    // í´ë¦­ì´ ì”¹íˆëŠ” ê²½ìš°ë¥¼ ëŒ€ë¹„í•œ ì´ë²¤íŠ¸ ìœ„ì„ (capture phase)
    document.addEventListener('click', function(e) {
      const cell = e.target && e.target.closest ? e.target.closest('.kosis-clickable') : null;
      if (!cell) return;

      e.preventDefault();
      e.stopPropagation();

      const priceType = cell.getAttribute('data-price-type');
      const month = parseInt(cell.getAttribute('data-month'), 10);

      console.log('ê°€ê²© í•­ëª© í´ë¦­(ìœ„ì„)ë¨:', priceType, month);

      if (priceType && month) {
        window.showKosisPrice(priceType, month);
      }
    }, true);

    // ì² ê°• ê°€ê²© ì„¹ì…˜ í† ê¸€ ë° ë°ì´í„° ë¡œë“œ (ê¸°ì¡´ í•¨ìˆ˜ ìœ ì§€)
    window.togglePriceSection = function() {
      window.showKosisPrice('steel', 12);
    };

    // KOSIS APIë¥¼ í†µí•œ ê°€ê²© ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ë²”ìš©)
    async function fetchKosisPriceData(priceType, month, info) {
      const priceTableBody = document.querySelector('#priceSection tbody');
      if (!priceTableBody) return;

      // Supabase Edge Function í”„ë¡ì‹œë¡œ KOSIS í˜¸ì¶œ (CORS/í‚¤ë…¸ì¶œ ë°©ì§€)
      const supaUrl = window.SDP_AUTH_CONFIG && window.SDP_AUTH_CONFIG.url;
      const anonKey = window.SDP_AUTH_CONFIG && window.SDP_AUTH_CONFIG.anonKey;

      // í”„ë¡ì‹œë¥¼ ì“¸ ìˆ˜ ì—†ìœ¼ë©´ ê¸°ë³¸ ë°ì´í„° í‘œì‹œ
      if (!supaUrl || !anonKey) {
        console.log('Supabase ì„¤ì •ì´ ì—†ì–´ ê¸°ë³¸ ë°ì´í„°ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.');
        displayDefaultPriceData(priceTableBody, priceType, month);
        return;
      }

      const orgId = info.orgId || '101';
      const tblId = info.tblId;
      const itmId = info.itmId || 'ALL';

      try {
        const response = await fetch(`${supaUrl}/functions/v1/kosis-proxy`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'apikey': anonKey,
            'Authorization': `Bearer ${anonKey}`
          },
          body: JSON.stringify({
            orgId,
            tblId,
            // ì¼ë¶€ KOSIS í‘œëŠ” itmIdë¥¼ ìš”êµ¬í•˜ì§€ ì•Šê±°ë‚˜ ALLì„ í—ˆìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
            // Edge Functionì—ì„œ itmIdê°€ ë¹„ì–´ìˆìœ¼ë©´ íŒŒë¼ë¯¸í„° ìì²´ë¥¼ ìƒëµí•©ë‹ˆë‹¤.
            ...(itmId && itmId !== 'ALL' ? { itmId } : {}),
            prdSe: 'M',
            objL1: 'ALL',
            numOfRows: 24,
            format: 'json'
          })
        });
        
        if (!response.ok) {
          const errText = await response.text();
          throw new Error(`HTTP ${response.status}: ${errText}`);
        }

        const data = await response.json();
        
        const items =
          (data && data.response && data.response.body && data.response.body.items) ?
            data.response.body.items :
          (Array.isArray(data) ? data : null);

        if (items && Array.isArray(items)) {
          let filtered = items;

          // í‚¤ì›Œë“œ í•„í„° (ì² ê·¼/ë ˆë¯¸ì½˜/íŒì¬ ë“±)
          if (info.keywords && Array.isArray(info.keywords) && info.keywords.length > 0) {
            filtered = items.filter((it) => {
              const hay = [
                it.ITM_NM, it.itmNm,
                it.C1_NM, it.C2_NM, it.C3_NM, it.C4_NM,
                it.OBJ_NM, it.objNm,
              ].filter(Boolean).join(' ');
              return info.keywords.some((kw) => hay.includes(kw));
            });

            // í•„í„° ê²°ê³¼ê°€ ì—†ìœ¼ë©´ ì „ì²´ë¥¼ í‘œì‹œ (fallback)
            if (!filtered || filtered.length === 0) filtered = items;
          }
          
          // í…Œì´ë¸” ì—…ë°ì´íŠ¸
          priceTableBody.innerHTML = '';
          
          // ìµœì‹  ë°ì´í„°ë¶€í„° í‘œì‹œ (ì—­ìˆœ)
          filtered.slice().reverse().forEach(item => {
            const row = document.createElement('tr');
            const dateCell = document.createElement('td');
            const priceCell = document.createElement('td');
            
            // ë‚ ì§œ í¬ë§·íŒ… (ì˜ˆ: 202412 -> 2024-12)
            const dateStr = item.PRD_DE || '';
            const formattedDate = dateStr.length === 6 
              ? `${dateStr.substring(0, 4)}-${dateStr.substring(4, 6)}`
              : dateStr;
            
            dateCell.textContent = formattedDate;

            // ê°’ í¬ë§· (ì§€ìˆ˜ëŠ” ì†Œìˆ˜ì  ìˆì„ ìˆ˜ ìˆìŒ)
            const raw = item.DT;
            const num = raw !== undefined && raw !== null ? Number(raw) : NaN;
            if (!Number.isNaN(num)) {
              const isInt = Number.isInteger(num);
              priceCell.textContent = num.toLocaleString(undefined, {
                maximumFractionDigits: isInt ? 0 : 2,
              });
            } else {
              priceCell.textContent = raw ? String(raw) : '-';
            }
            
            row.appendChild(dateCell);
            row.appendChild(priceCell);
            priceTableBody.appendChild(row);
          });
        } else {
          console.error('KOSIS API ì‘ë‹µ í˜•ì‹ì´ ì˜ˆìƒê³¼ ë‹¤ë¦…ë‹ˆë‹¤:', data);
          displayDefaultPriceData(priceTableBody, priceType, month);
        }
      } catch (error) {
        console.error('KOSIS API ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
        // ì‚¬ìš©ìì—ê²Œ "ì—°ê²°(í‚¤/ë°°í¬) í•„ìš”"ë¥¼ ë°”ë¡œ ë³´ì´ê²Œ í‘œì‹œ
        priceTableBody.innerHTML = '';
        const row = document.createElement('tr');
        const c1 = document.createElement('td');
        const c2 = document.createElement('td');
        c1.textContent = 'KOSIS';
        c2.textContent = 'ì—°ë™ í•„ìš” (í‚¤/ë°°í¬ í™•ì¸)';
        row.appendChild(c1);
        row.appendChild(c2);
        priceTableBody.appendChild(row);
        displayDefaultPriceData(priceTableBody, priceType, month);
      }
    }

    // ê¸°ë³¸ ê°€ê²© ë°ì´í„° í‘œì‹œ (API í‚¤ê°€ ì—†ê±°ë‚˜ ì˜¤ë¥˜ ë°œìƒ ì‹œ)
    function displayDefaultPriceData(tableBody, priceType, month) {
      tableBody.innerHTML = '';
      
      // ì˜ˆì‹œ ë°ì´í„° (ì‹¤ì œë¡œëŠ” KOSISì—ì„œ ê°€ì ¸ì™€ì•¼ í•¨)
      const defaultData = {
        'construction': { '12': '105.5', '1': '106.2' },
        'steel': { '12': '645,000', '1': '650,000' },
        'plate': { '12': '580,000', '1': '585,000' },
        'rebar': { '12': '720,000', '1': '725,000' },
        'concrete': { '12': '85,000', '1': '86,000' }
      };

      const currentYear = new Date().getFullYear();
      const targetMonth = month === 12 ? 12 : 1;
      const targetYear = month === 12 ? currentYear - 1 : currentYear;

      const row = document.createElement('tr');
      const dateCell = document.createElement('td');
      const priceCell = document.createElement('td');
      
      dateCell.textContent = `${targetYear}-${String(targetMonth).padStart(2, '0')}`;
      priceCell.textContent = defaultData[priceType] ? defaultData[priceType][month] : '-';
      
      row.appendChild(dateCell);
      row.appendChild(priceCell);
      tableBody.appendChild(row);
    }

    // ê¸°ì¡´ í•¨ìˆ˜ëª… ìœ ì§€ (í•˜ìœ„ í˜¸í™˜ì„±)
    async function fetchSteelPrice() {
      fetchKosisPriceData('steel', 12, priceTypeInfo['steel']);
    }
  </script>
</body>
</html>
